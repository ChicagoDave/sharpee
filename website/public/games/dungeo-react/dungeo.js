"use strict";var SharpeeGame=(()=>{var E8=Object.create;var rA=Object.defineProperty;var T8=Object.getOwnPropertyDescriptor;var _8=Object.getOwnPropertyNames;var b8=Object.getPrototypeOf,O8=Object.prototype.hasOwnProperty;var I8=(t,e,r)=>e in t?rA(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var p=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var S8=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of _8(e))!O8.call(t,i)&&i!==r&&rA(t,i,{get:()=>e[i],enumerable:!(n=T8(e,i))||n.enumerable});return t};var S=(t,e,r)=>(r=t!=null?E8(b8(t)):{},S8(e||!t||!t.__esModule?rA(r,"default",{value:t,enumerable:!0}):r,t));var d=(t,e,r)=>I8(t,typeof e!="symbol"?e+"":e,r);var IB=p(ye=>{"use strict";var hf=Symbol.for("react.element"),A8=Symbol.for("react.portal"),R8=Symbol.for("react.fragment"),w8=Symbol.for("react.strict_mode"),C8=Symbol.for("react.profiler"),N8=Symbol.for("react.provider"),D8=Symbol.for("react.context"),P8=Symbol.for("react.forward_ref"),L8=Symbol.for("react.suspense"),M8=Symbol.for("react.memo"),k8=Symbol.for("react.lazy"),fB=Symbol.iterator;function x8(t){return t===null||typeof t!="object"?null:(t=fB&&t[fB]||t["@@iterator"],typeof t=="function"?t:null)}var hB={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},yB=Object.assign,vB={};function ld(t,e,r){this.props=t,this.context=e,this.refs=vB,this.updater=r||hB}ld.prototype.isReactComponent={};ld.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};ld.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function EB(){}EB.prototype=ld.prototype;function iA(t,e,r){this.props=t,this.context=e,this.refs=vB,this.updater=r||hB}var oA=iA.prototype=new EB;oA.constructor=iA;yB(oA,ld.prototype);oA.isPureReactComponent=!0;var pB=Array.isArray,TB=Object.prototype.hasOwnProperty,aA={current:null},_B={key:!0,ref:!0,__self:!0,__source:!0};function bB(t,e,r){var n,i={},o=null,a=null;if(e!=null)for(n in e.ref!==void 0&&(a=e.ref),e.key!==void 0&&(o=""+e.key),e)TB.call(e,n)&&!_B.hasOwnProperty(n)&&(i[n]=e[n]);var s=arguments.length-2;if(s===1)i.children=r;else if(1<s){for(var c=Array(s),l=0;l<s;l++)c[l]=arguments[l+2];i.children=c}if(t&&t.defaultProps)for(n in s=t.defaultProps,s)i[n]===void 0&&(i[n]=s[n]);return{$$typeof:hf,type:t,key:o,ref:a,props:i,_owner:aA.current}}function B8(t,e){return{$$typeof:hf,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function sA(t){return typeof t=="object"&&t!==null&&t.$$typeof===hf}function j8(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(r){return e[r]})}var gB=/\/+/g;function nA(t,e){return typeof t=="object"&&t!==null&&t.key!=null?j8(""+t.key):e.toString(36)}function oh(t,e,r,n,i){var o=typeof t;(o==="undefined"||o==="boolean")&&(t=null);var a=!1;if(t===null)a=!0;else switch(o){case"string":case"number":a=!0;break;case"object":switch(t.$$typeof){case hf:case A8:a=!0}}if(a)return a=t,i=i(a),t=n===""?"."+nA(a,0):n,pB(i)?(r="",t!=null&&(r=t.replace(gB,"$&/")+"/"),oh(i,e,r,"",function(l){return l})):i!=null&&(sA(i)&&(i=B8(i,r+(!i.key||a&&a.key===i.key?"":(""+i.key).replace(gB,"$&/")+"/")+t)),e.push(i)),1;if(a=0,n=n===""?".":n+":",pB(t))for(var s=0;s<t.length;s++){o=t[s];var c=n+nA(o,s);a+=oh(o,e,r,c,i)}else if(c=x8(t),typeof c=="function")for(t=c.call(t),s=0;!(o=t.next()).done;)o=o.value,c=n+nA(o,s++),a+=oh(o,e,r,c,i);else if(o==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return a}function ih(t,e,r){if(t==null)return t;var n=[],i=0;return oh(t,n,"","",function(o){return e.call(r,o,i++)}),n}function W8(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(r){(t._status===0||t._status===-1)&&(t._status=1,t._result=r)},function(r){(t._status===0||t._status===-1)&&(t._status=2,t._result=r)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var Sr={current:null},ah={transition:null},H8={ReactCurrentDispatcher:Sr,ReactCurrentBatchConfig:ah,ReactCurrentOwner:aA};function OB(){throw Error("act(...) is not supported in production builds of React.")}ye.Children={map:ih,forEach:function(t,e,r){ih(t,function(){e.apply(this,arguments)},r)},count:function(t){var e=0;return ih(t,function(){e++}),e},toArray:function(t){return ih(t,function(e){return e})||[]},only:function(t){if(!sA(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};ye.Component=ld;ye.Fragment=R8;ye.Profiler=C8;ye.PureComponent=iA;ye.StrictMode=w8;ye.Suspense=L8;ye.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=H8;ye.act=OB;ye.cloneElement=function(t,e,r){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var n=yB({},t.props),i=t.key,o=t.ref,a=t._owner;if(e!=null){if(e.ref!==void 0&&(o=e.ref,a=aA.current),e.key!==void 0&&(i=""+e.key),t.type&&t.type.defaultProps)var s=t.type.defaultProps;for(c in e)TB.call(e,c)&&!_B.hasOwnProperty(c)&&(n[c]=e[c]===void 0&&s!==void 0?s[c]:e[c])}var c=arguments.length-2;if(c===1)n.children=r;else if(1<c){s=Array(c);for(var l=0;l<c;l++)s[l]=arguments[l+2];n.children=s}return{$$typeof:hf,type:t.type,key:i,ref:o,props:n,_owner:a}};ye.createContext=function(t){return t={$$typeof:D8,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:N8,_context:t},t.Consumer=t};ye.createElement=bB;ye.createFactory=function(t){var e=bB.bind(null,t);return e.type=t,e};ye.createRef=function(){return{current:null}};ye.forwardRef=function(t){return{$$typeof:P8,render:t}};ye.isValidElement=sA;ye.lazy=function(t){return{$$typeof:k8,_payload:{_status:-1,_result:t},_init:W8}};ye.memo=function(t,e){return{$$typeof:M8,type:t,compare:e===void 0?null:e}};ye.startTransition=function(t){var e=ah.transition;ah.transition={};try{t()}finally{ah.transition=e}};ye.unstable_act=OB;ye.useCallback=function(t,e){return Sr.current.useCallback(t,e)};ye.useContext=function(t){return Sr.current.useContext(t)};ye.useDebugValue=function(){};ye.useDeferredValue=function(t){return Sr.current.useDeferredValue(t)};ye.useEffect=function(t,e){return Sr.current.useEffect(t,e)};ye.useId=function(){return Sr.current.useId()};ye.useImperativeHandle=function(t,e,r){return Sr.current.useImperativeHandle(t,e,r)};ye.useInsertionEffect=function(t,e){return Sr.current.useInsertionEffect(t,e)};ye.useLayoutEffect=function(t,e){return Sr.current.useLayoutEffect(t,e)};ye.useMemo=function(t,e){return Sr.current.useMemo(t,e)};ye.useReducer=function(t,e,r){return Sr.current.useReducer(t,e,r)};ye.useRef=function(t){return Sr.current.useRef(t)};ye.useState=function(t){return Sr.current.useState(t)};ye.useSyncExternalStore=function(t,e,r){return Sr.current.useSyncExternalStore(t,e,r)};ye.useTransition=function(){return Sr.current.useTransition()};ye.version="18.3.1"});var or=p((ATe,SB)=>{"use strict";SB.exports=IB()});var kB=p(Ve=>{"use strict";function dA(t,e){var r=t.length;t.push(e);e:for(;0<r;){var n=r-1>>>1,i=t[n];if(0<sh(i,e))t[n]=e,t[r]=i,r=n;else break e}}function ji(t){return t.length===0?null:t[0]}function lh(t){if(t.length===0)return null;var e=t[0],r=t.pop();if(r!==e){t[0]=r;e:for(var n=0,i=t.length,o=i>>>1;n<o;){var a=2*(n+1)-1,s=t[a],c=a+1,l=t[c];if(0>sh(s,r))c<i&&0>sh(l,s)?(t[n]=l,t[c]=r,n=c):(t[n]=s,t[a]=r,n=a);else if(c<i&&0>sh(l,r))t[n]=l,t[c]=r,n=c;else break e}}return e}function sh(t,e){var r=t.sortIndex-e.sortIndex;return r!==0?r:t.id-e.id}typeof performance=="object"&&typeof performance.now=="function"?(AB=performance,Ve.unstable_now=function(){return AB.now()}):(cA=Date,RB=cA.now(),Ve.unstable_now=function(){return cA.now()-RB});var AB,cA,RB,Lo=[],Zs=[],U8=1,mi=null,ar=3,uh=!1,xl=!1,vf=!1,NB=typeof setTimeout=="function"?setTimeout:null,DB=typeof clearTimeout=="function"?clearTimeout:null,wB=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function mA(t){for(var e=ji(Zs);e!==null;){if(e.callback===null)lh(Zs);else if(e.startTime<=t)lh(Zs),e.sortIndex=e.expirationTime,dA(Lo,e);else break;e=ji(Zs)}}function fA(t){if(vf=!1,mA(t),!xl)if(ji(Lo)!==null)xl=!0,gA(pA);else{var e=ji(Zs);e!==null&&hA(fA,e.startTime-t)}}function pA(t,e){xl=!1,vf&&(vf=!1,DB(Ef),Ef=-1),uh=!0;var r=ar;try{for(mA(e),mi=ji(Lo);mi!==null&&(!(mi.expirationTime>e)||t&&!MB());){var n=mi.callback;if(typeof n=="function"){mi.callback=null,ar=mi.priorityLevel;var i=n(mi.expirationTime<=e);e=Ve.unstable_now(),typeof i=="function"?mi.callback=i:mi===ji(Lo)&&lh(Lo),mA(e)}else lh(Lo);mi=ji(Lo)}if(mi!==null)var o=!0;else{var a=ji(Zs);a!==null&&hA(fA,a.startTime-e),o=!1}return o}finally{mi=null,ar=r,uh=!1}}var dh=!1,ch=null,Ef=-1,PB=5,LB=-1;function MB(){return!(Ve.unstable_now()-LB<PB)}function lA(){if(ch!==null){var t=Ve.unstable_now();LB=t;var e=!0;try{e=ch(!0,t)}finally{e?yf():(dh=!1,ch=null)}}else dh=!1}var yf;typeof wB=="function"?yf=function(){wB(lA)}:typeof MessageChannel<"u"?(uA=new MessageChannel,CB=uA.port2,uA.port1.onmessage=lA,yf=function(){CB.postMessage(null)}):yf=function(){NB(lA,0)};var uA,CB;function gA(t){ch=t,dh||(dh=!0,yf())}function hA(t,e){Ef=NB(function(){t(Ve.unstable_now())},e)}Ve.unstable_IdlePriority=5;Ve.unstable_ImmediatePriority=1;Ve.unstable_LowPriority=4;Ve.unstable_NormalPriority=3;Ve.unstable_Profiling=null;Ve.unstable_UserBlockingPriority=2;Ve.unstable_cancelCallback=function(t){t.callback=null};Ve.unstable_continueExecution=function(){xl||uh||(xl=!0,gA(pA))};Ve.unstable_forceFrameRate=function(t){0>t||125<t?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):PB=0<t?Math.floor(1e3/t):5};Ve.unstable_getCurrentPriorityLevel=function(){return ar};Ve.unstable_getFirstCallbackNode=function(){return ji(Lo)};Ve.unstable_next=function(t){switch(ar){case 1:case 2:case 3:var e=3;break;default:e=ar}var r=ar;ar=e;try{return t()}finally{ar=r}};Ve.unstable_pauseExecution=function(){};Ve.unstable_requestPaint=function(){};Ve.unstable_runWithPriority=function(t,e){switch(t){case 1:case 2:case 3:case 4:case 5:break;default:t=3}var r=ar;ar=t;try{return e()}finally{ar=r}};Ve.unstable_scheduleCallback=function(t,e,r){var n=Ve.unstable_now();switch(typeof r=="object"&&r!==null?(r=r.delay,r=typeof r=="number"&&0<r?n+r:n):r=n,t){case 1:var i=-1;break;case 2:i=250;break;case 5:i=1073741823;break;case 4:i=1e4;break;default:i=5e3}return i=r+i,t={id:U8++,callback:e,priorityLevel:t,startTime:r,expirationTime:i,sortIndex:-1},r>n?(t.sortIndex=r,dA(Zs,t),ji(Lo)===null&&t===ji(Zs)&&(vf?(DB(Ef),Ef=-1):vf=!0,hA(fA,r-n))):(t.sortIndex=i,dA(Lo,t),xl||uh||(xl=!0,gA(pA))),t};Ve.unstable_shouldYield=MB;Ve.unstable_wrapCallback=function(t){var e=ar;return function(){var r=ar;ar=e;try{return t.apply(this,arguments)}finally{ar=r}}}});var BB=p((wTe,xB)=>{"use strict";xB.exports=kB()});var UW=p(Gn=>{"use strict";var q8=or(),qn=BB();function D(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,r=1;r<arguments.length;r++)e+="&args[]="+encodeURIComponent(arguments[r]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var G1=new Set,Uf={};function Kl(t,e){Nd(t,e),Nd(t+"Capture",e)}function Nd(t,e){for(Uf[t]=e,t=0;t<e.length;t++)G1.add(e[t])}var Na=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),WA=Object.prototype.hasOwnProperty,F8=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,jB={},WB={};function G8(t){return WA.call(WB,t)?!0:WA.call(jB,t)?!1:F8.test(t)?WB[t]=!0:(jB[t]=!0,!1)}function V8(t,e,r,n){if(r!==null&&r.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return n?!1:r!==null?!r.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function Y8(t,e,r,n){if(e===null||typeof e>"u"||V8(t,e,r,n))return!0;if(n)return!1;if(r!==null)switch(r.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function wr(t,e,r,n,i,o,a){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=n,this.attributeNamespace=i,this.mustUseProperty=r,this.propertyName=t,this.type=e,this.sanitizeURL=o,this.removeEmptyString=a}var Kt={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){Kt[t]=new wr(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];Kt[e]=new wr(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){Kt[t]=new wr(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){Kt[t]=new wr(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){Kt[t]=new wr(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){Kt[t]=new wr(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){Kt[t]=new wr(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){Kt[t]=new wr(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){Kt[t]=new wr(t,5,!1,t.toLowerCase(),null,!1,!1)});var DR=/[\-:]([a-z])/g;function PR(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(DR,PR);Kt[e]=new wr(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(DR,PR);Kt[e]=new wr(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(DR,PR);Kt[e]=new wr(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){Kt[t]=new wr(t,1,!1,t.toLowerCase(),null,!1,!1)});Kt.xlinkHref=new wr("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){Kt[t]=new wr(t,1,!1,t.toLowerCase(),null,!0,!0)});function LR(t,e,r,n){var i=Kt.hasOwnProperty(e)?Kt[e]:null;(i!==null?i.type!==0:n||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(Y8(e,r,i,n)&&(r=null),n||i===null?G8(e)&&(r===null?t.removeAttribute(e):t.setAttribute(e,""+r)):i.mustUseProperty?t[i.propertyName]=r===null?i.type===3?!1:"":r:(e=i.attributeName,n=i.attributeNamespace,r===null?t.removeAttribute(e):(i=i.type,r=i===3||i===4&&r===!0?"":""+r,n?t.setAttributeNS(n,e,r):t.setAttribute(e,r))))}var Ma=q8.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,mh=Symbol.for("react.element"),md=Symbol.for("react.portal"),fd=Symbol.for("react.fragment"),MR=Symbol.for("react.strict_mode"),HA=Symbol.for("react.profiler"),V1=Symbol.for("react.provider"),Y1=Symbol.for("react.context"),kR=Symbol.for("react.forward_ref"),UA=Symbol.for("react.suspense"),qA=Symbol.for("react.suspense_list"),xR=Symbol.for("react.memo"),ec=Symbol.for("react.lazy"),z1=Symbol.for("react.offscreen"),HB=Symbol.iterator;function Tf(t){return t===null||typeof t!="object"?null:(t=HB&&t[HB]||t["@@iterator"],typeof t=="function"?t:null)}var dt=Object.assign,yA;function wf(t){if(yA===void 0)try{throw Error()}catch(r){var e=r.stack.trim().match(/\n( *(at )?)/);yA=e&&e[1]||""}return`
`+yA+t}var vA=!1;function EA(t,e){if(!t||vA)return"";vA=!0;var r=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(l){var n=l}Reflect.construct(t,[],e)}else{try{e.call()}catch(l){n=l}t.call(e.prototype)}else{try{throw Error()}catch(l){n=l}t()}}catch(l){if(l&&n&&typeof l.stack=="string"){for(var i=l.stack.split(`
`),o=n.stack.split(`
`),a=i.length-1,s=o.length-1;1<=a&&0<=s&&i[a]!==o[s];)s--;for(;1<=a&&0<=s;a--,s--)if(i[a]!==o[s]){if(a!==1||s!==1)do if(a--,s--,0>s||i[a]!==o[s]){var c=`
`+i[a].replace(" at new "," at ");return t.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",t.displayName)),c}while(1<=a&&0<=s);break}}}finally{vA=!1,Error.prepareStackTrace=r}return(t=t?t.displayName||t.name:"")?wf(t):""}function z8(t){switch(t.tag){case 5:return wf(t.type);case 16:return wf("Lazy");case 13:return wf("Suspense");case 19:return wf("SuspenseList");case 0:case 2:case 15:return t=EA(t.type,!1),t;case 11:return t=EA(t.type.render,!1),t;case 1:return t=EA(t.type,!0),t;default:return""}}function FA(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case fd:return"Fragment";case md:return"Portal";case HA:return"Profiler";case MR:return"StrictMode";case UA:return"Suspense";case qA:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case Y1:return(t.displayName||"Context")+".Consumer";case V1:return(t._context.displayName||"Context")+".Provider";case kR:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case xR:return e=t.displayName||null,e!==null?e:FA(t.type)||"Memo";case ec:e=t._payload,t=t._init;try{return FA(t(e))}catch{}}return null}function $8(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return FA(e);case 8:return e===MR?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function pc(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function $1(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function K8(t){var e=$1(t)?"checked":"value",r=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),n=""+t[e];if(!t.hasOwnProperty(e)&&typeof r<"u"&&typeof r.get=="function"&&typeof r.set=="function"){var i=r.get,o=r.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return i.call(this)},set:function(a){n=""+a,o.call(this,a)}}),Object.defineProperty(t,e,{enumerable:r.enumerable}),{getValue:function(){return n},setValue:function(a){n=""+a},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function fh(t){t._valueTracker||(t._valueTracker=K8(t))}function K1(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var r=e.getValue(),n="";return t&&(n=$1(t)?t.checked?"true":"false":t.value),t=n,t!==r?(e.setValue(t),!0):!1}function Uh(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function GA(t,e){var r=e.checked;return dt({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:r??t._wrapperState.initialChecked})}function UB(t,e){var r=e.defaultValue==null?"":e.defaultValue,n=e.checked!=null?e.checked:e.defaultChecked;r=pc(e.value!=null?e.value:r),t._wrapperState={initialChecked:n,initialValue:r,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function Q1(t,e){e=e.checked,e!=null&&LR(t,"checked",e,!1)}function VA(t,e){Q1(t,e);var r=pc(e.value),n=e.type;if(r!=null)n==="number"?(r===0&&t.value===""||t.value!=r)&&(t.value=""+r):t.value!==""+r&&(t.value=""+r);else if(n==="submit"||n==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?YA(t,e.type,r):e.hasOwnProperty("defaultValue")&&YA(t,e.type,pc(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function qB(t,e,r){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var n=e.type;if(!(n!=="submit"&&n!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,r||e===t.value||(t.value=e),t.defaultValue=e}r=t.name,r!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,r!==""&&(t.name=r)}function YA(t,e,r){(e!=="number"||Uh(t.ownerDocument)!==t)&&(r==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+r&&(t.defaultValue=""+r))}var Cf=Array.isArray;function Id(t,e,r,n){if(t=t.options,e){e={};for(var i=0;i<r.length;i++)e["$"+r[i]]=!0;for(r=0;r<t.length;r++)i=e.hasOwnProperty("$"+t[r].value),t[r].selected!==i&&(t[r].selected=i),i&&n&&(t[r].defaultSelected=!0)}else{for(r=""+pc(r),e=null,i=0;i<t.length;i++){if(t[i].value===r){t[i].selected=!0,n&&(t[i].defaultSelected=!0);return}e!==null||t[i].disabled||(e=t[i])}e!==null&&(e.selected=!0)}}function zA(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(D(91));return dt({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function FB(t,e){var r=e.value;if(r==null){if(r=e.children,e=e.defaultValue,r!=null){if(e!=null)throw Error(D(92));if(Cf(r)){if(1<r.length)throw Error(D(93));r=r[0]}e=r}e==null&&(e=""),r=e}t._wrapperState={initialValue:pc(r)}}function X1(t,e){var r=pc(e.value),n=pc(e.defaultValue);r!=null&&(r=""+r,r!==t.value&&(t.value=r),e.defaultValue==null&&t.defaultValue!==r&&(t.defaultValue=r)),n!=null&&(t.defaultValue=""+n)}function GB(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function Z1(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function $A(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?Z1(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var ph,J1=(function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,r,n,i){MSApp.execUnsafeLocalFunction(function(){return t(e,r,n,i)})}:t})(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(ph=ph||document.createElement("div"),ph.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=ph.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function qf(t,e){if(e){var r=t.firstChild;if(r&&r===t.lastChild&&r.nodeType===3){r.nodeValue=e;return}}t.textContent=e}var Pf={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Q8=["Webkit","ms","Moz","O"];Object.keys(Pf).forEach(function(t){Q8.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),Pf[e]=Pf[t]})});function ej(t,e,r){return e==null||typeof e=="boolean"||e===""?"":r||typeof e!="number"||e===0||Pf.hasOwnProperty(t)&&Pf[t]?(""+e).trim():e+"px"}function tj(t,e){t=t.style;for(var r in e)if(e.hasOwnProperty(r)){var n=r.indexOf("--")===0,i=ej(r,e[r],n);r==="float"&&(r="cssFloat"),n?t.setProperty(r,i):t[r]=i}}var X8=dt({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function KA(t,e){if(e){if(X8[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(D(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(D(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(D(61))}if(e.style!=null&&typeof e.style!="object")throw Error(D(62))}}function QA(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var XA=null;function BR(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var ZA=null,Sd=null,Ad=null;function VB(t){if(t=ap(t)){if(typeof ZA!="function")throw Error(D(280));var e=t.stateNode;e&&(e=gy(e),ZA(t.stateNode,t.type,e))}}function rj(t){Sd?Ad?Ad.push(t):Ad=[t]:Sd=t}function nj(){if(Sd){var t=Sd,e=Ad;if(Ad=Sd=null,VB(t),e)for(t=0;t<e.length;t++)VB(e[t])}}function ij(t,e){return t(e)}function oj(){}var TA=!1;function aj(t,e,r){if(TA)return t(e,r);TA=!0;try{return ij(t,e,r)}finally{TA=!1,(Sd!==null||Ad!==null)&&(oj(),nj())}}function Ff(t,e){var r=t.stateNode;if(r===null)return null;var n=gy(r);if(n===null)return null;r=n[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(t=t.type,n=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!n;break e;default:t=!1}if(t)return null;if(r&&typeof r!="function")throw Error(D(231,e,typeof r));return r}var JA=!1;if(Na)try{ud={},Object.defineProperty(ud,"passive",{get:function(){JA=!0}}),window.addEventListener("test",ud,ud),window.removeEventListener("test",ud,ud)}catch{JA=!1}var ud;function Z8(t,e,r,n,i,o,a,s,c){var l=Array.prototype.slice.call(arguments,3);try{e.apply(r,l)}catch(u){this.onError(u)}}var Lf=!1,qh=null,Fh=!1,eR=null,J8={onError:function(t){Lf=!0,qh=t}};function eX(t,e,r,n,i,o,a,s,c){Lf=!1,qh=null,Z8.apply(J8,arguments)}function tX(t,e,r,n,i,o,a,s,c){if(eX.apply(this,arguments),Lf){if(Lf){var l=qh;Lf=!1,qh=null}else throw Error(D(198));Fh||(Fh=!0,eR=l)}}function Ql(t){var e=t,r=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,(e.flags&4098)!==0&&(r=e.return),t=e.return;while(t)}return e.tag===3?r:null}function sj(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function YB(t){if(Ql(t)!==t)throw Error(D(188))}function rX(t){var e=t.alternate;if(!e){if(e=Ql(t),e===null)throw Error(D(188));return e!==t?null:t}for(var r=t,n=e;;){var i=r.return;if(i===null)break;var o=i.alternate;if(o===null){if(n=i.return,n!==null){r=n;continue}break}if(i.child===o.child){for(o=i.child;o;){if(o===r)return YB(i),t;if(o===n)return YB(i),e;o=o.sibling}throw Error(D(188))}if(r.return!==n.return)r=i,n=o;else{for(var a=!1,s=i.child;s;){if(s===r){a=!0,r=i,n=o;break}if(s===n){a=!0,n=i,r=o;break}s=s.sibling}if(!a){for(s=o.child;s;){if(s===r){a=!0,r=o,n=i;break}if(s===n){a=!0,n=o,r=i;break}s=s.sibling}if(!a)throw Error(D(189))}}if(r.alternate!==n)throw Error(D(190))}if(r.tag!==3)throw Error(D(188));return r.stateNode.current===r?t:e}function cj(t){return t=rX(t),t!==null?lj(t):null}function lj(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=lj(t);if(e!==null)return e;t=t.sibling}return null}var uj=qn.unstable_scheduleCallback,zB=qn.unstable_cancelCallback,nX=qn.unstable_shouldYield,iX=qn.unstable_requestPaint,vt=qn.unstable_now,oX=qn.unstable_getCurrentPriorityLevel,jR=qn.unstable_ImmediatePriority,dj=qn.unstable_UserBlockingPriority,Gh=qn.unstable_NormalPriority,aX=qn.unstable_LowPriority,mj=qn.unstable_IdlePriority,dy=null,Bo=null;function sX(t){if(Bo&&typeof Bo.onCommitFiberRoot=="function")try{Bo.onCommitFiberRoot(dy,t,void 0,(t.current.flags&128)===128)}catch{}}var Fi=Math.clz32?Math.clz32:uX,cX=Math.log,lX=Math.LN2;function uX(t){return t>>>=0,t===0?32:31-(cX(t)/lX|0)|0}var gh=64,hh=4194304;function Nf(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function Vh(t,e){var r=t.pendingLanes;if(r===0)return 0;var n=0,i=t.suspendedLanes,o=t.pingedLanes,a=r&268435455;if(a!==0){var s=a&~i;s!==0?n=Nf(s):(o&=a,o!==0&&(n=Nf(o)))}else a=r&~i,a!==0?n=Nf(a):o!==0&&(n=Nf(o));if(n===0)return 0;if(e!==0&&e!==n&&(e&i)===0&&(i=n&-n,o=e&-e,i>=o||i===16&&(o&4194240)!==0))return e;if((n&4)!==0&&(n|=r&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=n;0<e;)r=31-Fi(e),i=1<<r,n|=t[r],e&=~i;return n}function dX(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function mX(t,e){for(var r=t.suspendedLanes,n=t.pingedLanes,i=t.expirationTimes,o=t.pendingLanes;0<o;){var a=31-Fi(o),s=1<<a,c=i[a];c===-1?((s&r)===0||(s&n)!==0)&&(i[a]=dX(s,e)):c<=e&&(t.expiredLanes|=s),o&=~s}}function tR(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function fj(){var t=gh;return gh<<=1,(gh&4194240)===0&&(gh=64),t}function _A(t){for(var e=[],r=0;31>r;r++)e.push(t);return e}function ip(t,e,r){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-Fi(e),t[e]=r}function fX(t,e){var r=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var n=t.eventTimes;for(t=t.expirationTimes;0<r;){var i=31-Fi(r),o=1<<i;e[i]=0,n[i]=-1,t[i]=-1,r&=~o}}function WR(t,e){var r=t.entangledLanes|=e;for(t=t.entanglements;r;){var n=31-Fi(r),i=1<<n;i&e|t[n]&e&&(t[n]|=e),r&=~i}}var Be=0;function pj(t){return t&=-t,1<t?4<t?(t&268435455)!==0?16:536870912:4:1}var gj,HR,hj,yj,vj,rR=!1,yh=[],ac=null,sc=null,cc=null,Gf=new Map,Vf=new Map,rc=[],pX="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function $B(t,e){switch(t){case"focusin":case"focusout":ac=null;break;case"dragenter":case"dragleave":sc=null;break;case"mouseover":case"mouseout":cc=null;break;case"pointerover":case"pointerout":Gf.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Vf.delete(e.pointerId)}}function _f(t,e,r,n,i,o){return t===null||t.nativeEvent!==o?(t={blockedOn:e,domEventName:r,eventSystemFlags:n,nativeEvent:o,targetContainers:[i]},e!==null&&(e=ap(e),e!==null&&HR(e)),t):(t.eventSystemFlags|=n,e=t.targetContainers,i!==null&&e.indexOf(i)===-1&&e.push(i),t)}function gX(t,e,r,n,i){switch(e){case"focusin":return ac=_f(ac,t,e,r,n,i),!0;case"dragenter":return sc=_f(sc,t,e,r,n,i),!0;case"mouseover":return cc=_f(cc,t,e,r,n,i),!0;case"pointerover":var o=i.pointerId;return Gf.set(o,_f(Gf.get(o)||null,t,e,r,n,i)),!0;case"gotpointercapture":return o=i.pointerId,Vf.set(o,_f(Vf.get(o)||null,t,e,r,n,i)),!0}return!1}function Ej(t){var e=Wl(t.target);if(e!==null){var r=Ql(e);if(r!==null){if(e=r.tag,e===13){if(e=sj(r),e!==null){t.blockedOn=e,vj(t.priority,function(){hj(r)});return}}else if(e===3&&r.stateNode.current.memoizedState.isDehydrated){t.blockedOn=r.tag===3?r.stateNode.containerInfo:null;return}}}t.blockedOn=null}function Dh(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var r=nR(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(r===null){r=t.nativeEvent;var n=new r.constructor(r.type,r);XA=n,r.target.dispatchEvent(n),XA=null}else return e=ap(r),e!==null&&HR(e),t.blockedOn=r,!1;e.shift()}return!0}function KB(t,e,r){Dh(t)&&r.delete(e)}function hX(){rR=!1,ac!==null&&Dh(ac)&&(ac=null),sc!==null&&Dh(sc)&&(sc=null),cc!==null&&Dh(cc)&&(cc=null),Gf.forEach(KB),Vf.forEach(KB)}function bf(t,e){t.blockedOn===e&&(t.blockedOn=null,rR||(rR=!0,qn.unstable_scheduleCallback(qn.unstable_NormalPriority,hX)))}function Yf(t){function e(i){return bf(i,t)}if(0<yh.length){bf(yh[0],t);for(var r=1;r<yh.length;r++){var n=yh[r];n.blockedOn===t&&(n.blockedOn=null)}}for(ac!==null&&bf(ac,t),sc!==null&&bf(sc,t),cc!==null&&bf(cc,t),Gf.forEach(e),Vf.forEach(e),r=0;r<rc.length;r++)n=rc[r],n.blockedOn===t&&(n.blockedOn=null);for(;0<rc.length&&(r=rc[0],r.blockedOn===null);)Ej(r),r.blockedOn===null&&rc.shift()}var Rd=Ma.ReactCurrentBatchConfig,Yh=!0;function yX(t,e,r,n){var i=Be,o=Rd.transition;Rd.transition=null;try{Be=1,UR(t,e,r,n)}finally{Be=i,Rd.transition=o}}function vX(t,e,r,n){var i=Be,o=Rd.transition;Rd.transition=null;try{Be=4,UR(t,e,r,n)}finally{Be=i,Rd.transition=o}}function UR(t,e,r,n){if(Yh){var i=nR(t,e,r,n);if(i===null)wA(t,e,n,zh,r),$B(t,n);else if(gX(i,t,e,r,n))n.stopPropagation();else if($B(t,n),e&4&&-1<pX.indexOf(t)){for(;i!==null;){var o=ap(i);if(o!==null&&gj(o),o=nR(t,e,r,n),o===null&&wA(t,e,n,zh,r),o===i)break;i=o}i!==null&&n.stopPropagation()}else wA(t,e,n,null,r)}}var zh=null;function nR(t,e,r,n){if(zh=null,t=BR(n),t=Wl(t),t!==null)if(e=Ql(t),e===null)t=null;else if(r=e.tag,r===13){if(t=sj(e),t!==null)return t;t=null}else if(r===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return zh=t,null}function Tj(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(oX()){case jR:return 1;case dj:return 4;case Gh:case aX:return 16;case mj:return 536870912;default:return 16}default:return 16}}var ic=null,qR=null,Ph=null;function _j(){if(Ph)return Ph;var t,e=qR,r=e.length,n,i="value"in ic?ic.value:ic.textContent,o=i.length;for(t=0;t<r&&e[t]===i[t];t++);var a=r-t;for(n=1;n<=a&&e[r-n]===i[o-n];n++);return Ph=i.slice(t,1<n?1-n:void 0)}function Lh(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function vh(){return!0}function QB(){return!1}function Fn(t){function e(r,n,i,o,a){this._reactName=r,this._targetInst=i,this.type=n,this.nativeEvent=o,this.target=a,this.currentTarget=null;for(var s in t)t.hasOwnProperty(s)&&(r=t[s],this[s]=r?r(o):o[s]);return this.isDefaultPrevented=(o.defaultPrevented!=null?o.defaultPrevented:o.returnValue===!1)?vh:QB,this.isPropagationStopped=QB,this}return dt(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var r=this.nativeEvent;r&&(r.preventDefault?r.preventDefault():typeof r.returnValue!="unknown"&&(r.returnValue=!1),this.isDefaultPrevented=vh)},stopPropagation:function(){var r=this.nativeEvent;r&&(r.stopPropagation?r.stopPropagation():typeof r.cancelBubble!="unknown"&&(r.cancelBubble=!0),this.isPropagationStopped=vh)},persist:function(){},isPersistent:vh}),e}var Bd={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},FR=Fn(Bd),op=dt({},Bd,{view:0,detail:0}),EX=Fn(op),bA,OA,Of,my=dt({},op,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:GR,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==Of&&(Of&&t.type==="mousemove"?(bA=t.screenX-Of.screenX,OA=t.screenY-Of.screenY):OA=bA=0,Of=t),bA)},movementY:function(t){return"movementY"in t?t.movementY:OA}}),XB=Fn(my),TX=dt({},my,{dataTransfer:0}),_X=Fn(TX),bX=dt({},op,{relatedTarget:0}),IA=Fn(bX),OX=dt({},Bd,{animationName:0,elapsedTime:0,pseudoElement:0}),IX=Fn(OX),SX=dt({},Bd,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),AX=Fn(SX),RX=dt({},Bd,{data:0}),ZB=Fn(RX),wX={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},CX={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},NX={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function DX(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=NX[t])?!!e[t]:!1}function GR(){return DX}var PX=dt({},op,{key:function(t){if(t.key){var e=wX[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=Lh(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?CX[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:GR,charCode:function(t){return t.type==="keypress"?Lh(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?Lh(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),LX=Fn(PX),MX=dt({},my,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),JB=Fn(MX),kX=dt({},op,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:GR}),xX=Fn(kX),BX=dt({},Bd,{propertyName:0,elapsedTime:0,pseudoElement:0}),jX=Fn(BX),WX=dt({},my,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),HX=Fn(WX),UX=[9,13,27,32],VR=Na&&"CompositionEvent"in window,Mf=null;Na&&"documentMode"in document&&(Mf=document.documentMode);var qX=Na&&"TextEvent"in window&&!Mf,bj=Na&&(!VR||Mf&&8<Mf&&11>=Mf),e1=" ",t1=!1;function Oj(t,e){switch(t){case"keyup":return UX.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Ij(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var pd=!1;function FX(t,e){switch(t){case"compositionend":return Ij(e);case"keypress":return e.which!==32?null:(t1=!0,e1);case"textInput":return t=e.data,t===e1&&t1?null:t;default:return null}}function GX(t,e){if(pd)return t==="compositionend"||!VR&&Oj(t,e)?(t=_j(),Ph=qR=ic=null,pd=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return bj&&e.locale!=="ko"?null:e.data;default:return null}}var VX={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function r1(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!VX[t.type]:e==="textarea"}function Sj(t,e,r,n){rj(n),e=$h(e,"onChange"),0<e.length&&(r=new FR("onChange","change",null,r,n),t.push({event:r,listeners:e}))}var kf=null,zf=null;function YX(t){xj(t,0)}function fy(t){var e=yd(t);if(K1(e))return t}function zX(t,e){if(t==="change")return e}var Aj=!1;Na&&(Na?(Th="oninput"in document,Th||(SA=document.createElement("div"),SA.setAttribute("oninput","return;"),Th=typeof SA.oninput=="function"),Eh=Th):Eh=!1,Aj=Eh&&(!document.documentMode||9<document.documentMode));var Eh,Th,SA;function n1(){kf&&(kf.detachEvent("onpropertychange",Rj),zf=kf=null)}function Rj(t){if(t.propertyName==="value"&&fy(zf)){var e=[];Sj(e,zf,t,BR(t)),aj(YX,e)}}function $X(t,e,r){t==="focusin"?(n1(),kf=e,zf=r,kf.attachEvent("onpropertychange",Rj)):t==="focusout"&&n1()}function KX(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return fy(zf)}function QX(t,e){if(t==="click")return fy(e)}function XX(t,e){if(t==="input"||t==="change")return fy(e)}function ZX(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var Vi=typeof Object.is=="function"?Object.is:ZX;function $f(t,e){if(Vi(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var r=Object.keys(t),n=Object.keys(e);if(r.length!==n.length)return!1;for(n=0;n<r.length;n++){var i=r[n];if(!WA.call(e,i)||!Vi(t[i],e[i]))return!1}return!0}function i1(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function o1(t,e){var r=i1(t);t=0;for(var n;r;){if(r.nodeType===3){if(n=t+r.textContent.length,t<=e&&n>=e)return{node:r,offset:e-t};t=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=i1(r)}}function wj(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?wj(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function Cj(){for(var t=window,e=Uh();e instanceof t.HTMLIFrameElement;){try{var r=typeof e.contentWindow.location.href=="string"}catch{r=!1}if(r)t=e.contentWindow;else break;e=Uh(t.document)}return e}function YR(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function JX(t){var e=Cj(),r=t.focusedElem,n=t.selectionRange;if(e!==r&&r&&r.ownerDocument&&wj(r.ownerDocument.documentElement,r)){if(n!==null&&YR(r)){if(e=n.start,t=n.end,t===void 0&&(t=e),"selectionStart"in r)r.selectionStart=e,r.selectionEnd=Math.min(t,r.value.length);else if(t=(e=r.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var i=r.textContent.length,o=Math.min(n.start,i);n=n.end===void 0?o:Math.min(n.end,i),!t.extend&&o>n&&(i=n,n=o,o=i),i=o1(r,o);var a=o1(r,n);i&&a&&(t.rangeCount!==1||t.anchorNode!==i.node||t.anchorOffset!==i.offset||t.focusNode!==a.node||t.focusOffset!==a.offset)&&(e=e.createRange(),e.setStart(i.node,i.offset),t.removeAllRanges(),o>n?(t.addRange(e),t.extend(a.node,a.offset)):(e.setEnd(a.node,a.offset),t.addRange(e)))}}for(e=[],t=r;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof r.focus=="function"&&r.focus(),r=0;r<e.length;r++)t=e[r],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var e9=Na&&"documentMode"in document&&11>=document.documentMode,gd=null,iR=null,xf=null,oR=!1;function a1(t,e,r){var n=r.window===r?r.document:r.nodeType===9?r:r.ownerDocument;oR||gd==null||gd!==Uh(n)||(n=gd,"selectionStart"in n&&YR(n)?n={start:n.selectionStart,end:n.selectionEnd}:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection(),n={anchorNode:n.anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset}),xf&&$f(xf,n)||(xf=n,n=$h(iR,"onSelect"),0<n.length&&(e=new FR("onSelect","select",null,e,r),t.push({event:e,listeners:n}),e.target=gd)))}function _h(t,e){var r={};return r[t.toLowerCase()]=e.toLowerCase(),r["Webkit"+t]="webkit"+e,r["Moz"+t]="moz"+e,r}var hd={animationend:_h("Animation","AnimationEnd"),animationiteration:_h("Animation","AnimationIteration"),animationstart:_h("Animation","AnimationStart"),transitionend:_h("Transition","TransitionEnd")},AA={},Nj={};Na&&(Nj=document.createElement("div").style,"AnimationEvent"in window||(delete hd.animationend.animation,delete hd.animationiteration.animation,delete hd.animationstart.animation),"TransitionEvent"in window||delete hd.transitionend.transition);function py(t){if(AA[t])return AA[t];if(!hd[t])return t;var e=hd[t],r;for(r in e)if(e.hasOwnProperty(r)&&r in Nj)return AA[t]=e[r];return t}var Dj=py("animationend"),Pj=py("animationiteration"),Lj=py("animationstart"),Mj=py("transitionend"),kj=new Map,s1="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function hc(t,e){kj.set(t,e),Kl(e,[t])}for(bh=0;bh<s1.length;bh++)Oh=s1[bh],c1=Oh.toLowerCase(),l1=Oh[0].toUpperCase()+Oh.slice(1),hc(c1,"on"+l1);var Oh,c1,l1,bh;hc(Dj,"onAnimationEnd");hc(Pj,"onAnimationIteration");hc(Lj,"onAnimationStart");hc("dblclick","onDoubleClick");hc("focusin","onFocus");hc("focusout","onBlur");hc(Mj,"onTransitionEnd");Nd("onMouseEnter",["mouseout","mouseover"]);Nd("onMouseLeave",["mouseout","mouseover"]);Nd("onPointerEnter",["pointerout","pointerover"]);Nd("onPointerLeave",["pointerout","pointerover"]);Kl("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Kl("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Kl("onBeforeInput",["compositionend","keypress","textInput","paste"]);Kl("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Kl("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Kl("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Df="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),t9=new Set("cancel close invalid load scroll toggle".split(" ").concat(Df));function u1(t,e,r){var n=t.type||"unknown-event";t.currentTarget=r,tX(n,e,void 0,t),t.currentTarget=null}function xj(t,e){e=(e&4)!==0;for(var r=0;r<t.length;r++){var n=t[r],i=n.event;n=n.listeners;e:{var o=void 0;if(e)for(var a=n.length-1;0<=a;a--){var s=n[a],c=s.instance,l=s.currentTarget;if(s=s.listener,c!==o&&i.isPropagationStopped())break e;u1(i,s,l),o=c}else for(a=0;a<n.length;a++){if(s=n[a],c=s.instance,l=s.currentTarget,s=s.listener,c!==o&&i.isPropagationStopped())break e;u1(i,s,l),o=c}}}if(Fh)throw t=eR,Fh=!1,eR=null,t}function Xe(t,e){var r=e[uR];r===void 0&&(r=e[uR]=new Set);var n=t+"__bubble";r.has(n)||(Bj(e,t,2,!1),r.add(n))}function RA(t,e,r){var n=0;e&&(n|=4),Bj(r,t,n,e)}var Ih="_reactListening"+Math.random().toString(36).slice(2);function Kf(t){if(!t[Ih]){t[Ih]=!0,G1.forEach(function(r){r!=="selectionchange"&&(t9.has(r)||RA(r,!1,t),RA(r,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[Ih]||(e[Ih]=!0,RA("selectionchange",!1,e))}}function Bj(t,e,r,n){switch(Tj(e)){case 1:var i=yX;break;case 4:i=vX;break;default:i=UR}r=i.bind(null,e,r,t),i=void 0,!JA||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(i=!0),n?i!==void 0?t.addEventListener(e,r,{capture:!0,passive:i}):t.addEventListener(e,r,!0):i!==void 0?t.addEventListener(e,r,{passive:i}):t.addEventListener(e,r,!1)}function wA(t,e,r,n,i){var o=n;if((e&1)===0&&(e&2)===0&&n!==null)e:for(;;){if(n===null)return;var a=n.tag;if(a===3||a===4){var s=n.stateNode.containerInfo;if(s===i||s.nodeType===8&&s.parentNode===i)break;if(a===4)for(a=n.return;a!==null;){var c=a.tag;if((c===3||c===4)&&(c=a.stateNode.containerInfo,c===i||c.nodeType===8&&c.parentNode===i))return;a=a.return}for(;s!==null;){if(a=Wl(s),a===null)return;if(c=a.tag,c===5||c===6){n=o=a;continue e}s=s.parentNode}}n=n.return}aj(function(){var l=o,u=BR(r),m=[];e:{var f=kj.get(t);if(f!==void 0){var g=FR,h=t;switch(t){case"keypress":if(Lh(r)===0)break e;case"keydown":case"keyup":g=LX;break;case"focusin":h="focus",g=IA;break;case"focusout":h="blur",g=IA;break;case"beforeblur":case"afterblur":g=IA;break;case"click":if(r.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":g=XB;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":g=_X;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":g=xX;break;case Dj:case Pj:case Lj:g=IX;break;case Mj:g=jX;break;case"scroll":g=EX;break;case"wheel":g=HX;break;case"copy":case"cut":case"paste":g=AX;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":g=JB}var y=(e&4)!==0,_=!y&&t==="scroll",v=y?f!==null?f+"Capture":null:f;y=[];for(var E=l,T;E!==null;){T=E;var O=T.stateNode;if(T.tag===5&&O!==null&&(T=O,v!==null&&(O=Ff(E,v),O!=null&&y.push(Qf(E,O,T)))),_)break;E=E.return}0<y.length&&(f=new g(f,h,null,r,u),m.push({event:f,listeners:y}))}}if((e&7)===0){e:{if(f=t==="mouseover"||t==="pointerover",g=t==="mouseout"||t==="pointerout",f&&r!==XA&&(h=r.relatedTarget||r.fromElement)&&(Wl(h)||h[Da]))break e;if((g||f)&&(f=u.window===u?u:(f=u.ownerDocument)?f.defaultView||f.parentWindow:window,g?(h=r.relatedTarget||r.toElement,g=l,h=h?Wl(h):null,h!==null&&(_=Ql(h),h!==_||h.tag!==5&&h.tag!==6)&&(h=null)):(g=null,h=l),g!==h)){if(y=XB,O="onMouseLeave",v="onMouseEnter",E="mouse",(t==="pointerout"||t==="pointerover")&&(y=JB,O="onPointerLeave",v="onPointerEnter",E="pointer"),_=g==null?f:yd(g),T=h==null?f:yd(h),f=new y(O,E+"leave",g,r,u),f.target=_,f.relatedTarget=T,O=null,Wl(u)===l&&(y=new y(v,E+"enter",h,r,u),y.target=T,y.relatedTarget=_,O=y),_=O,g&&h)t:{for(y=g,v=h,E=0,T=y;T;T=dd(T))E++;for(T=0,O=v;O;O=dd(O))T++;for(;0<E-T;)y=dd(y),E--;for(;0<T-E;)v=dd(v),T--;for(;E--;){if(y===v||v!==null&&y===v.alternate)break t;y=dd(y),v=dd(v)}y=null}else y=null;g!==null&&d1(m,f,g,y,!1),h!==null&&_!==null&&d1(m,_,h,y,!0)}}e:{if(f=l?yd(l):window,g=f.nodeName&&f.nodeName.toLowerCase(),g==="select"||g==="input"&&f.type==="file")var R=zX;else if(r1(f))if(Aj)R=XX;else{R=KX;var I=$X}else(g=f.nodeName)&&g.toLowerCase()==="input"&&(f.type==="checkbox"||f.type==="radio")&&(R=QX);if(R&&(R=R(t,l))){Sj(m,R,r,u);break e}I&&I(t,f,l),t==="focusout"&&(I=f._wrapperState)&&I.controlled&&f.type==="number"&&YA(f,"number",f.value)}switch(I=l?yd(l):window,t){case"focusin":(r1(I)||I.contentEditable==="true")&&(gd=I,iR=l,xf=null);break;case"focusout":xf=iR=gd=null;break;case"mousedown":oR=!0;break;case"contextmenu":case"mouseup":case"dragend":oR=!1,a1(m,r,u);break;case"selectionchange":if(e9)break;case"keydown":case"keyup":a1(m,r,u)}var w;if(VR)e:{switch(t){case"compositionstart":var N="onCompositionStart";break e;case"compositionend":N="onCompositionEnd";break e;case"compositionupdate":N="onCompositionUpdate";break e}N=void 0}else pd?Oj(t,r)&&(N="onCompositionEnd"):t==="keydown"&&r.keyCode===229&&(N="onCompositionStart");N&&(bj&&r.locale!=="ko"&&(pd||N!=="onCompositionStart"?N==="onCompositionEnd"&&pd&&(w=_j()):(ic=u,qR="value"in ic?ic.value:ic.textContent,pd=!0)),I=$h(l,N),0<I.length&&(N=new ZB(N,t,null,r,u),m.push({event:N,listeners:I}),w?N.data=w:(w=Ij(r),w!==null&&(N.data=w)))),(w=qX?FX(t,r):GX(t,r))&&(l=$h(l,"onBeforeInput"),0<l.length&&(u=new ZB("onBeforeInput","beforeinput",null,r,u),m.push({event:u,listeners:l}),u.data=w))}xj(m,e)})}function Qf(t,e,r){return{instance:t,listener:e,currentTarget:r}}function $h(t,e){for(var r=e+"Capture",n=[];t!==null;){var i=t,o=i.stateNode;i.tag===5&&o!==null&&(i=o,o=Ff(t,r),o!=null&&n.unshift(Qf(t,o,i)),o=Ff(t,e),o!=null&&n.push(Qf(t,o,i))),t=t.return}return n}function dd(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function d1(t,e,r,n,i){for(var o=e._reactName,a=[];r!==null&&r!==n;){var s=r,c=s.alternate,l=s.stateNode;if(c!==null&&c===n)break;s.tag===5&&l!==null&&(s=l,i?(c=Ff(r,o),c!=null&&a.unshift(Qf(r,c,s))):i||(c=Ff(r,o),c!=null&&a.push(Qf(r,c,s)))),r=r.return}a.length!==0&&t.push({event:e,listeners:a})}var r9=/\r\n?/g,n9=/\u0000|\uFFFD/g;function m1(t){return(typeof t=="string"?t:""+t).replace(r9,`
`).replace(n9,"")}function Sh(t,e,r){if(e=m1(e),m1(t)!==e&&r)throw Error(D(425))}function Kh(){}var aR=null,sR=null;function cR(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var lR=typeof setTimeout=="function"?setTimeout:void 0,i9=typeof clearTimeout=="function"?clearTimeout:void 0,f1=typeof Promise=="function"?Promise:void 0,o9=typeof queueMicrotask=="function"?queueMicrotask:typeof f1<"u"?function(t){return f1.resolve(null).then(t).catch(a9)}:lR;function a9(t){setTimeout(function(){throw t})}function CA(t,e){var r=e,n=0;do{var i=r.nextSibling;if(t.removeChild(r),i&&i.nodeType===8)if(r=i.data,r==="/$"){if(n===0){t.removeChild(i),Yf(e);return}n--}else r!=="$"&&r!=="$?"&&r!=="$!"||n++;r=i}while(r);Yf(e)}function lc(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function p1(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var r=t.data;if(r==="$"||r==="$!"||r==="$?"){if(e===0)return t;e--}else r==="/$"&&e++}t=t.previousSibling}return null}var jd=Math.random().toString(36).slice(2),xo="__reactFiber$"+jd,Xf="__reactProps$"+jd,Da="__reactContainer$"+jd,uR="__reactEvents$"+jd,s9="__reactListeners$"+jd,c9="__reactHandles$"+jd;function Wl(t){var e=t[xo];if(e)return e;for(var r=t.parentNode;r;){if(e=r[Da]||r[xo]){if(r=e.alternate,e.child!==null||r!==null&&r.child!==null)for(t=p1(t);t!==null;){if(r=t[xo])return r;t=p1(t)}return e}t=r,r=t.parentNode}return null}function ap(t){return t=t[xo]||t[Da],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function yd(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(D(33))}function gy(t){return t[Xf]||null}var dR=[],vd=-1;function yc(t){return{current:t}}function Ze(t){0>vd||(t.current=dR[vd],dR[vd]=null,vd--)}function Ye(t,e){vd++,dR[vd]=t.current,t.current=e}var gc={},ur=yc(gc),nn=yc(!1),Gl=gc;function Dd(t,e){var r=t.type.contextTypes;if(!r)return gc;var n=t.stateNode;if(n&&n.__reactInternalMemoizedUnmaskedChildContext===e)return n.__reactInternalMemoizedMaskedChildContext;var i={},o;for(o in r)i[o]=e[o];return n&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=i),i}function on(t){return t=t.childContextTypes,t!=null}function Qh(){Ze(nn),Ze(ur)}function g1(t,e,r){if(ur.current!==gc)throw Error(D(168));Ye(ur,e),Ye(nn,r)}function jj(t,e,r){var n=t.stateNode;if(e=e.childContextTypes,typeof n.getChildContext!="function")return r;n=n.getChildContext();for(var i in n)if(!(i in e))throw Error(D(108,$8(t)||"Unknown",i));return dt({},r,n)}function Xh(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||gc,Gl=ur.current,Ye(ur,t),Ye(nn,nn.current),!0}function h1(t,e,r){var n=t.stateNode;if(!n)throw Error(D(169));r?(t=jj(t,e,Gl),n.__reactInternalMemoizedMergedChildContext=t,Ze(nn),Ze(ur),Ye(ur,t)):Ze(nn),Ye(nn,r)}var Aa=null,hy=!1,NA=!1;function Wj(t){Aa===null?Aa=[t]:Aa.push(t)}function l9(t){hy=!0,Wj(t)}function vc(){if(!NA&&Aa!==null){NA=!0;var t=0,e=Be;try{var r=Aa;for(Be=1;t<r.length;t++){var n=r[t];do n=n(!0);while(n!==null)}Aa=null,hy=!1}catch(i){throw Aa!==null&&(Aa=Aa.slice(t+1)),uj(jR,vc),i}finally{Be=e,NA=!1}}return null}var Ed=[],Td=0,Zh=null,Jh=0,fi=[],pi=0,Vl=null,Ra=1,wa="";function Bl(t,e){Ed[Td++]=Jh,Ed[Td++]=Zh,Zh=t,Jh=e}function Hj(t,e,r){fi[pi++]=Ra,fi[pi++]=wa,fi[pi++]=Vl,Vl=t;var n=Ra;t=wa;var i=32-Fi(n)-1;n&=~(1<<i),r+=1;var o=32-Fi(e)+i;if(30<o){var a=i-i%5;o=(n&(1<<a)-1).toString(32),n>>=a,i-=a,Ra=1<<32-Fi(e)+i|r<<i|n,wa=o+t}else Ra=1<<o|r<<i|n,wa=t}function zR(t){t.return!==null&&(Bl(t,1),Hj(t,1,0))}function $R(t){for(;t===Zh;)Zh=Ed[--Td],Ed[Td]=null,Jh=Ed[--Td],Ed[Td]=null;for(;t===Vl;)Vl=fi[--pi],fi[pi]=null,wa=fi[--pi],fi[pi]=null,Ra=fi[--pi],fi[pi]=null}var Un=null,Hn=null,it=!1,qi=null;function Uj(t,e){var r=gi(5,null,null,0);r.elementType="DELETED",r.stateNode=e,r.return=t,e=t.deletions,e===null?(t.deletions=[r],t.flags|=16):e.push(r)}function y1(t,e){switch(t.tag){case 5:var r=t.type;return e=e.nodeType!==1||r.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,Un=t,Hn=lc(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,Un=t,Hn=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(r=Vl!==null?{id:Ra,overflow:wa}:null,t.memoizedState={dehydrated:e,treeContext:r,retryLane:1073741824},r=gi(18,null,null,0),r.stateNode=e,r.return=t,t.child=r,Un=t,Hn=null,!0):!1;default:return!1}}function mR(t){return(t.mode&1)!==0&&(t.flags&128)===0}function fR(t){if(it){var e=Hn;if(e){var r=e;if(!y1(t,e)){if(mR(t))throw Error(D(418));e=lc(r.nextSibling);var n=Un;e&&y1(t,e)?Uj(n,r):(t.flags=t.flags&-4097|2,it=!1,Un=t)}}else{if(mR(t))throw Error(D(418));t.flags=t.flags&-4097|2,it=!1,Un=t}}}function v1(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;Un=t}function Ah(t){if(t!==Un)return!1;if(!it)return v1(t),it=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!cR(t.type,t.memoizedProps)),e&&(e=Hn)){if(mR(t))throw qj(),Error(D(418));for(;e;)Uj(t,e),e=lc(e.nextSibling)}if(v1(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(D(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var r=t.data;if(r==="/$"){if(e===0){Hn=lc(t.nextSibling);break e}e--}else r!=="$"&&r!=="$!"&&r!=="$?"||e++}t=t.nextSibling}Hn=null}}else Hn=Un?lc(t.stateNode.nextSibling):null;return!0}function qj(){for(var t=Hn;t;)t=lc(t.nextSibling)}function Pd(){Hn=Un=null,it=!1}function KR(t){qi===null?qi=[t]:qi.push(t)}var u9=Ma.ReactCurrentBatchConfig;function If(t,e,r){if(t=r.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(r._owner){if(r=r._owner,r){if(r.tag!==1)throw Error(D(309));var n=r.stateNode}if(!n)throw Error(D(147,t));var i=n,o=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===o?e.ref:(e=function(a){var s=i.refs;a===null?delete s[o]:s[o]=a},e._stringRef=o,e)}if(typeof t!="string")throw Error(D(284));if(!r._owner)throw Error(D(290,t))}return t}function Rh(t,e){throw t=Object.prototype.toString.call(e),Error(D(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function E1(t){var e=t._init;return e(t._payload)}function Fj(t){function e(v,E){if(t){var T=v.deletions;T===null?(v.deletions=[E],v.flags|=16):T.push(E)}}function r(v,E){if(!t)return null;for(;E!==null;)e(v,E),E=E.sibling;return null}function n(v,E){for(v=new Map;E!==null;)E.key!==null?v.set(E.key,E):v.set(E.index,E),E=E.sibling;return v}function i(v,E){return v=fc(v,E),v.index=0,v.sibling=null,v}function o(v,E,T){return v.index=T,t?(T=v.alternate,T!==null?(T=T.index,T<E?(v.flags|=2,E):T):(v.flags|=2,E)):(v.flags|=1048576,E)}function a(v){return t&&v.alternate===null&&(v.flags|=2),v}function s(v,E,T,O){return E===null||E.tag!==6?(E=BA(T,v.mode,O),E.return=v,E):(E=i(E,T),E.return=v,E)}function c(v,E,T,O){var R=T.type;return R===fd?u(v,E,T.props.children,O,T.key):E!==null&&(E.elementType===R||typeof R=="object"&&R!==null&&R.$$typeof===ec&&E1(R)===E.type)?(O=i(E,T.props),O.ref=If(v,E,T),O.return=v,O):(O=Hh(T.type,T.key,T.props,null,v.mode,O),O.ref=If(v,E,T),O.return=v,O)}function l(v,E,T,O){return E===null||E.tag!==4||E.stateNode.containerInfo!==T.containerInfo||E.stateNode.implementation!==T.implementation?(E=jA(T,v.mode,O),E.return=v,E):(E=i(E,T.children||[]),E.return=v,E)}function u(v,E,T,O,R){return E===null||E.tag!==7?(E=Fl(T,v.mode,O,R),E.return=v,E):(E=i(E,T),E.return=v,E)}function m(v,E,T){if(typeof E=="string"&&E!==""||typeof E=="number")return E=BA(""+E,v.mode,T),E.return=v,E;if(typeof E=="object"&&E!==null){switch(E.$$typeof){case mh:return T=Hh(E.type,E.key,E.props,null,v.mode,T),T.ref=If(v,null,E),T.return=v,T;case md:return E=jA(E,v.mode,T),E.return=v,E;case ec:var O=E._init;return m(v,O(E._payload),T)}if(Cf(E)||Tf(E))return E=Fl(E,v.mode,T,null),E.return=v,E;Rh(v,E)}return null}function f(v,E,T,O){var R=E!==null?E.key:null;if(typeof T=="string"&&T!==""||typeof T=="number")return R!==null?null:s(v,E,""+T,O);if(typeof T=="object"&&T!==null){switch(T.$$typeof){case mh:return T.key===R?c(v,E,T,O):null;case md:return T.key===R?l(v,E,T,O):null;case ec:return R=T._init,f(v,E,R(T._payload),O)}if(Cf(T)||Tf(T))return R!==null?null:u(v,E,T,O,null);Rh(v,T)}return null}function g(v,E,T,O,R){if(typeof O=="string"&&O!==""||typeof O=="number")return v=v.get(T)||null,s(E,v,""+O,R);if(typeof O=="object"&&O!==null){switch(O.$$typeof){case mh:return v=v.get(O.key===null?T:O.key)||null,c(E,v,O,R);case md:return v=v.get(O.key===null?T:O.key)||null,l(E,v,O,R);case ec:var I=O._init;return g(v,E,T,I(O._payload),R)}if(Cf(O)||Tf(O))return v=v.get(T)||null,u(E,v,O,R,null);Rh(E,O)}return null}function h(v,E,T,O){for(var R=null,I=null,w=E,N=E=0,G=null;w!==null&&N<T.length;N++){w.index>N?(G=w,w=null):G=w.sibling;var k=f(v,w,T[N],O);if(k===null){w===null&&(w=G);break}t&&w&&k.alternate===null&&e(v,w),E=o(k,E,N),I===null?R=k:I.sibling=k,I=k,w=G}if(N===T.length)return r(v,w),it&&Bl(v,N),R;if(w===null){for(;N<T.length;N++)w=m(v,T[N],O),w!==null&&(E=o(w,E,N),I===null?R=w:I.sibling=w,I=w);return it&&Bl(v,N),R}for(w=n(v,w);N<T.length;N++)G=g(w,v,N,T[N],O),G!==null&&(t&&G.alternate!==null&&w.delete(G.key===null?N:G.key),E=o(G,E,N),I===null?R=G:I.sibling=G,I=G);return t&&w.forEach(function(pe){return e(v,pe)}),it&&Bl(v,N),R}function y(v,E,T,O){var R=Tf(T);if(typeof R!="function")throw Error(D(150));if(T=R.call(T),T==null)throw Error(D(151));for(var I=R=null,w=E,N=E=0,G=null,k=T.next();w!==null&&!k.done;N++,k=T.next()){w.index>N?(G=w,w=null):G=w.sibling;var pe=f(v,w,k.value,O);if(pe===null){w===null&&(w=G);break}t&&w&&pe.alternate===null&&e(v,w),E=o(pe,E,N),I===null?R=pe:I.sibling=pe,I=pe,w=G}if(k.done)return r(v,w),it&&Bl(v,N),R;if(w===null){for(;!k.done;N++,k=T.next())k=m(v,k.value,O),k!==null&&(E=o(k,E,N),I===null?R=k:I.sibling=k,I=k);return it&&Bl(v,N),R}for(w=n(v,w);!k.done;N++,k=T.next())k=g(w,v,N,k.value,O),k!==null&&(t&&k.alternate!==null&&w.delete(k.key===null?N:k.key),E=o(k,E,N),I===null?R=k:I.sibling=k,I=k);return t&&w.forEach(function(oe){return e(v,oe)}),it&&Bl(v,N),R}function _(v,E,T,O){if(typeof T=="object"&&T!==null&&T.type===fd&&T.key===null&&(T=T.props.children),typeof T=="object"&&T!==null){switch(T.$$typeof){case mh:e:{for(var R=T.key,I=E;I!==null;){if(I.key===R){if(R=T.type,R===fd){if(I.tag===7){r(v,I.sibling),E=i(I,T.props.children),E.return=v,v=E;break e}}else if(I.elementType===R||typeof R=="object"&&R!==null&&R.$$typeof===ec&&E1(R)===I.type){r(v,I.sibling),E=i(I,T.props),E.ref=If(v,I,T),E.return=v,v=E;break e}r(v,I);break}else e(v,I);I=I.sibling}T.type===fd?(E=Fl(T.props.children,v.mode,O,T.key),E.return=v,v=E):(O=Hh(T.type,T.key,T.props,null,v.mode,O),O.ref=If(v,E,T),O.return=v,v=O)}return a(v);case md:e:{for(I=T.key;E!==null;){if(E.key===I)if(E.tag===4&&E.stateNode.containerInfo===T.containerInfo&&E.stateNode.implementation===T.implementation){r(v,E.sibling),E=i(E,T.children||[]),E.return=v,v=E;break e}else{r(v,E);break}else e(v,E);E=E.sibling}E=jA(T,v.mode,O),E.return=v,v=E}return a(v);case ec:return I=T._init,_(v,E,I(T._payload),O)}if(Cf(T))return h(v,E,T,O);if(Tf(T))return y(v,E,T,O);Rh(v,T)}return typeof T=="string"&&T!==""||typeof T=="number"?(T=""+T,E!==null&&E.tag===6?(r(v,E.sibling),E=i(E,T),E.return=v,v=E):(r(v,E),E=BA(T,v.mode,O),E.return=v,v=E),a(v)):r(v,E)}return _}var Ld=Fj(!0),Gj=Fj(!1),ey=yc(null),ty=null,_d=null,QR=null;function XR(){QR=_d=ty=null}function ZR(t){var e=ey.current;Ze(ey),t._currentValue=e}function pR(t,e,r){for(;t!==null;){var n=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,n!==null&&(n.childLanes|=e)):n!==null&&(n.childLanes&e)!==e&&(n.childLanes|=e),t===r)break;t=t.return}}function wd(t,e){ty=t,QR=_d=null,t=t.dependencies,t!==null&&t.firstContext!==null&&((t.lanes&e)!==0&&(rn=!0),t.firstContext=null)}function yi(t){var e=t._currentValue;if(QR!==t)if(t={context:t,memoizedValue:e,next:null},_d===null){if(ty===null)throw Error(D(308));_d=t,ty.dependencies={lanes:0,firstContext:t}}else _d=_d.next=t;return e}var Hl=null;function JR(t){Hl===null?Hl=[t]:Hl.push(t)}function Vj(t,e,r,n){var i=e.interleaved;return i===null?(r.next=r,JR(e)):(r.next=i.next,i.next=r),e.interleaved=r,Pa(t,n)}function Pa(t,e){t.lanes|=e;var r=t.alternate;for(r!==null&&(r.lanes|=e),r=t,t=t.return;t!==null;)t.childLanes|=e,r=t.alternate,r!==null&&(r.childLanes|=e),r=t,t=t.return;return r.tag===3?r.stateNode:null}var tc=!1;function ew(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Yj(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function Ca(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function uc(t,e,r){var n=t.updateQueue;if(n===null)return null;if(n=n.shared,(Ae&2)!==0){var i=n.pending;return i===null?e.next=e:(e.next=i.next,i.next=e),n.pending=e,Pa(t,r)}return i=n.interleaved,i===null?(e.next=e,JR(n)):(e.next=i.next,i.next=e),n.interleaved=e,Pa(t,r)}function Mh(t,e,r){if(e=e.updateQueue,e!==null&&(e=e.shared,(r&4194240)!==0)){var n=e.lanes;n&=t.pendingLanes,r|=n,e.lanes=r,WR(t,r)}}function T1(t,e){var r=t.updateQueue,n=t.alternate;if(n!==null&&(n=n.updateQueue,r===n)){var i=null,o=null;if(r=r.firstBaseUpdate,r!==null){do{var a={eventTime:r.eventTime,lane:r.lane,tag:r.tag,payload:r.payload,callback:r.callback,next:null};o===null?i=o=a:o=o.next=a,r=r.next}while(r!==null);o===null?i=o=e:o=o.next=e}else i=o=e;r={baseState:n.baseState,firstBaseUpdate:i,lastBaseUpdate:o,shared:n.shared,effects:n.effects},t.updateQueue=r;return}t=r.lastBaseUpdate,t===null?r.firstBaseUpdate=e:t.next=e,r.lastBaseUpdate=e}function ry(t,e,r,n){var i=t.updateQueue;tc=!1;var o=i.firstBaseUpdate,a=i.lastBaseUpdate,s=i.shared.pending;if(s!==null){i.shared.pending=null;var c=s,l=c.next;c.next=null,a===null?o=l:a.next=l,a=c;var u=t.alternate;u!==null&&(u=u.updateQueue,s=u.lastBaseUpdate,s!==a&&(s===null?u.firstBaseUpdate=l:s.next=l,u.lastBaseUpdate=c))}if(o!==null){var m=i.baseState;a=0,u=l=c=null,s=o;do{var f=s.lane,g=s.eventTime;if((n&f)===f){u!==null&&(u=u.next={eventTime:g,lane:0,tag:s.tag,payload:s.payload,callback:s.callback,next:null});e:{var h=t,y=s;switch(f=e,g=r,y.tag){case 1:if(h=y.payload,typeof h=="function"){m=h.call(g,m,f);break e}m=h;break e;case 3:h.flags=h.flags&-65537|128;case 0:if(h=y.payload,f=typeof h=="function"?h.call(g,m,f):h,f==null)break e;m=dt({},m,f);break e;case 2:tc=!0}}s.callback!==null&&s.lane!==0&&(t.flags|=64,f=i.effects,f===null?i.effects=[s]:f.push(s))}else g={eventTime:g,lane:f,tag:s.tag,payload:s.payload,callback:s.callback,next:null},u===null?(l=u=g,c=m):u=u.next=g,a|=f;if(s=s.next,s===null){if(s=i.shared.pending,s===null)break;f=s,s=f.next,f.next=null,i.lastBaseUpdate=f,i.shared.pending=null}}while(!0);if(u===null&&(c=m),i.baseState=c,i.firstBaseUpdate=l,i.lastBaseUpdate=u,e=i.shared.interleaved,e!==null){i=e;do a|=i.lane,i=i.next;while(i!==e)}else o===null&&(i.shared.lanes=0);zl|=a,t.lanes=a,t.memoizedState=m}}function _1(t,e,r){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var n=t[e],i=n.callback;if(i!==null){if(n.callback=null,n=r,typeof i!="function")throw Error(D(191,i));i.call(n)}}}var sp={},jo=yc(sp),Zf=yc(sp),Jf=yc(sp);function Ul(t){if(t===sp)throw Error(D(174));return t}function tw(t,e){switch(Ye(Jf,e),Ye(Zf,t),Ye(jo,sp),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:$A(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=$A(e,t)}Ze(jo),Ye(jo,e)}function Md(){Ze(jo),Ze(Zf),Ze(Jf)}function zj(t){Ul(Jf.current);var e=Ul(jo.current),r=$A(e,t.type);e!==r&&(Ye(Zf,t),Ye(jo,r))}function rw(t){Zf.current===t&&(Ze(jo),Ze(Zf))}var lt=yc(0);function ny(t){for(var e=t;e!==null;){if(e.tag===13){var r=e.memoizedState;if(r!==null&&(r=r.dehydrated,r===null||r.data==="$?"||r.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if((e.flags&128)!==0)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var DA=[];function nw(){for(var t=0;t<DA.length;t++)DA[t]._workInProgressVersionPrimary=null;DA.length=0}var kh=Ma.ReactCurrentDispatcher,PA=Ma.ReactCurrentBatchConfig,Yl=0,ut=null,Nt=null,Ht=null,iy=!1,Bf=!1,ep=0,d9=0;function sr(){throw Error(D(321))}function iw(t,e){if(e===null)return!1;for(var r=0;r<e.length&&r<t.length;r++)if(!Vi(t[r],e[r]))return!1;return!0}function ow(t,e,r,n,i,o){if(Yl=o,ut=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,kh.current=t===null||t.memoizedState===null?g9:h9,t=r(n,i),Bf){o=0;do{if(Bf=!1,ep=0,25<=o)throw Error(D(301));o+=1,Ht=Nt=null,e.updateQueue=null,kh.current=y9,t=r(n,i)}while(Bf)}if(kh.current=oy,e=Nt!==null&&Nt.next!==null,Yl=0,Ht=Nt=ut=null,iy=!1,e)throw Error(D(300));return t}function aw(){var t=ep!==0;return ep=0,t}function ko(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ht===null?ut.memoizedState=Ht=t:Ht=Ht.next=t,Ht}function vi(){if(Nt===null){var t=ut.alternate;t=t!==null?t.memoizedState:null}else t=Nt.next;var e=Ht===null?ut.memoizedState:Ht.next;if(e!==null)Ht=e,Nt=t;else{if(t===null)throw Error(D(310));Nt=t,t={memoizedState:Nt.memoizedState,baseState:Nt.baseState,baseQueue:Nt.baseQueue,queue:Nt.queue,next:null},Ht===null?ut.memoizedState=Ht=t:Ht=Ht.next=t}return Ht}function tp(t,e){return typeof e=="function"?e(t):e}function LA(t){var e=vi(),r=e.queue;if(r===null)throw Error(D(311));r.lastRenderedReducer=t;var n=Nt,i=n.baseQueue,o=r.pending;if(o!==null){if(i!==null){var a=i.next;i.next=o.next,o.next=a}n.baseQueue=i=o,r.pending=null}if(i!==null){o=i.next,n=n.baseState;var s=a=null,c=null,l=o;do{var u=l.lane;if((Yl&u)===u)c!==null&&(c=c.next={lane:0,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null}),n=l.hasEagerState?l.eagerState:t(n,l.action);else{var m={lane:u,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null};c===null?(s=c=m,a=n):c=c.next=m,ut.lanes|=u,zl|=u}l=l.next}while(l!==null&&l!==o);c===null?a=n:c.next=s,Vi(n,e.memoizedState)||(rn=!0),e.memoizedState=n,e.baseState=a,e.baseQueue=c,r.lastRenderedState=n}if(t=r.interleaved,t!==null){i=t;do o=i.lane,ut.lanes|=o,zl|=o,i=i.next;while(i!==t)}else i===null&&(r.lanes=0);return[e.memoizedState,r.dispatch]}function MA(t){var e=vi(),r=e.queue;if(r===null)throw Error(D(311));r.lastRenderedReducer=t;var n=r.dispatch,i=r.pending,o=e.memoizedState;if(i!==null){r.pending=null;var a=i=i.next;do o=t(o,a.action),a=a.next;while(a!==i);Vi(o,e.memoizedState)||(rn=!0),e.memoizedState=o,e.baseQueue===null&&(e.baseState=o),r.lastRenderedState=o}return[o,n]}function $j(){}function Kj(t,e){var r=ut,n=vi(),i=e(),o=!Vi(n.memoizedState,i);if(o&&(n.memoizedState=i,rn=!0),n=n.queue,sw(Zj.bind(null,r,n,t),[t]),n.getSnapshot!==e||o||Ht!==null&&Ht.memoizedState.tag&1){if(r.flags|=2048,rp(9,Xj.bind(null,r,n,i,e),void 0,null),Ut===null)throw Error(D(349));(Yl&30)!==0||Qj(r,e,i)}return i}function Qj(t,e,r){t.flags|=16384,t={getSnapshot:e,value:r},e=ut.updateQueue,e===null?(e={lastEffect:null,stores:null},ut.updateQueue=e,e.stores=[t]):(r=e.stores,r===null?e.stores=[t]:r.push(t))}function Xj(t,e,r,n){e.value=r,e.getSnapshot=n,Jj(e)&&eW(t)}function Zj(t,e,r){return r(function(){Jj(e)&&eW(t)})}function Jj(t){var e=t.getSnapshot;t=t.value;try{var r=e();return!Vi(t,r)}catch{return!0}}function eW(t){var e=Pa(t,1);e!==null&&Gi(e,t,1,-1)}function b1(t){var e=ko();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:tp,lastRenderedState:t},e.queue=t,t=t.dispatch=p9.bind(null,ut,t),[e.memoizedState,t]}function rp(t,e,r,n){return t={tag:t,create:e,destroy:r,deps:n,next:null},e=ut.updateQueue,e===null?(e={lastEffect:null,stores:null},ut.updateQueue=e,e.lastEffect=t.next=t):(r=e.lastEffect,r===null?e.lastEffect=t.next=t:(n=r.next,r.next=t,t.next=n,e.lastEffect=t)),t}function tW(){return vi().memoizedState}function xh(t,e,r,n){var i=ko();ut.flags|=t,i.memoizedState=rp(1|e,r,void 0,n===void 0?null:n)}function yy(t,e,r,n){var i=vi();n=n===void 0?null:n;var o=void 0;if(Nt!==null){var a=Nt.memoizedState;if(o=a.destroy,n!==null&&iw(n,a.deps)){i.memoizedState=rp(e,r,o,n);return}}ut.flags|=t,i.memoizedState=rp(1|e,r,o,n)}function O1(t,e){return xh(8390656,8,t,e)}function sw(t,e){return yy(2048,8,t,e)}function rW(t,e){return yy(4,2,t,e)}function nW(t,e){return yy(4,4,t,e)}function iW(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function oW(t,e,r){return r=r!=null?r.concat([t]):null,yy(4,4,iW.bind(null,e,t),r)}function cw(){}function aW(t,e){var r=vi();e=e===void 0?null:e;var n=r.memoizedState;return n!==null&&e!==null&&iw(e,n[1])?n[0]:(r.memoizedState=[t,e],t)}function sW(t,e){var r=vi();e=e===void 0?null:e;var n=r.memoizedState;return n!==null&&e!==null&&iw(e,n[1])?n[0]:(t=t(),r.memoizedState=[t,e],t)}function cW(t,e,r){return(Yl&21)===0?(t.baseState&&(t.baseState=!1,rn=!0),t.memoizedState=r):(Vi(r,e)||(r=fj(),ut.lanes|=r,zl|=r,t.baseState=!0),e)}function m9(t,e){var r=Be;Be=r!==0&&4>r?r:4,t(!0);var n=PA.transition;PA.transition={};try{t(!1),e()}finally{Be=r,PA.transition=n}}function lW(){return vi().memoizedState}function f9(t,e,r){var n=mc(t);if(r={lane:n,action:r,hasEagerState:!1,eagerState:null,next:null},uW(t))dW(e,r);else if(r=Vj(t,e,r,n),r!==null){var i=Rr();Gi(r,t,n,i),mW(r,e,n)}}function p9(t,e,r){var n=mc(t),i={lane:n,action:r,hasEagerState:!1,eagerState:null,next:null};if(uW(t))dW(e,i);else{var o=t.alternate;if(t.lanes===0&&(o===null||o.lanes===0)&&(o=e.lastRenderedReducer,o!==null))try{var a=e.lastRenderedState,s=o(a,r);if(i.hasEagerState=!0,i.eagerState=s,Vi(s,a)){var c=e.interleaved;c===null?(i.next=i,JR(e)):(i.next=c.next,c.next=i),e.interleaved=i;return}}catch{}r=Vj(t,e,i,n),r!==null&&(i=Rr(),Gi(r,t,n,i),mW(r,e,n))}}function uW(t){var e=t.alternate;return t===ut||e!==null&&e===ut}function dW(t,e){Bf=iy=!0;var r=t.pending;r===null?e.next=e:(e.next=r.next,r.next=e),t.pending=e}function mW(t,e,r){if((r&4194240)!==0){var n=e.lanes;n&=t.pendingLanes,r|=n,e.lanes=r,WR(t,r)}}var oy={readContext:yi,useCallback:sr,useContext:sr,useEffect:sr,useImperativeHandle:sr,useInsertionEffect:sr,useLayoutEffect:sr,useMemo:sr,useReducer:sr,useRef:sr,useState:sr,useDebugValue:sr,useDeferredValue:sr,useTransition:sr,useMutableSource:sr,useSyncExternalStore:sr,useId:sr,unstable_isNewReconciler:!1},g9={readContext:yi,useCallback:function(t,e){return ko().memoizedState=[t,e===void 0?null:e],t},useContext:yi,useEffect:O1,useImperativeHandle:function(t,e,r){return r=r!=null?r.concat([t]):null,xh(4194308,4,iW.bind(null,e,t),r)},useLayoutEffect:function(t,e){return xh(4194308,4,t,e)},useInsertionEffect:function(t,e){return xh(4,2,t,e)},useMemo:function(t,e){var r=ko();return e=e===void 0?null:e,t=t(),r.memoizedState=[t,e],t},useReducer:function(t,e,r){var n=ko();return e=r!==void 0?r(e):e,n.memoizedState=n.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},n.queue=t,t=t.dispatch=f9.bind(null,ut,t),[n.memoizedState,t]},useRef:function(t){var e=ko();return t={current:t},e.memoizedState=t},useState:b1,useDebugValue:cw,useDeferredValue:function(t){return ko().memoizedState=t},useTransition:function(){var t=b1(!1),e=t[0];return t=m9.bind(null,t[1]),ko().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,r){var n=ut,i=ko();if(it){if(r===void 0)throw Error(D(407));r=r()}else{if(r=e(),Ut===null)throw Error(D(349));(Yl&30)!==0||Qj(n,e,r)}i.memoizedState=r;var o={value:r,getSnapshot:e};return i.queue=o,O1(Zj.bind(null,n,o,t),[t]),n.flags|=2048,rp(9,Xj.bind(null,n,o,r,e),void 0,null),r},useId:function(){var t=ko(),e=Ut.identifierPrefix;if(it){var r=wa,n=Ra;r=(n&~(1<<32-Fi(n)-1)).toString(32)+r,e=":"+e+"R"+r,r=ep++,0<r&&(e+="H"+r.toString(32)),e+=":"}else r=d9++,e=":"+e+"r"+r.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},h9={readContext:yi,useCallback:aW,useContext:yi,useEffect:sw,useImperativeHandle:oW,useInsertionEffect:rW,useLayoutEffect:nW,useMemo:sW,useReducer:LA,useRef:tW,useState:function(){return LA(tp)},useDebugValue:cw,useDeferredValue:function(t){var e=vi();return cW(e,Nt.memoizedState,t)},useTransition:function(){var t=LA(tp)[0],e=vi().memoizedState;return[t,e]},useMutableSource:$j,useSyncExternalStore:Kj,useId:lW,unstable_isNewReconciler:!1},y9={readContext:yi,useCallback:aW,useContext:yi,useEffect:sw,useImperativeHandle:oW,useInsertionEffect:rW,useLayoutEffect:nW,useMemo:sW,useReducer:MA,useRef:tW,useState:function(){return MA(tp)},useDebugValue:cw,useDeferredValue:function(t){var e=vi();return Nt===null?e.memoizedState=t:cW(e,Nt.memoizedState,t)},useTransition:function(){var t=MA(tp)[0],e=vi().memoizedState;return[t,e]},useMutableSource:$j,useSyncExternalStore:Kj,useId:lW,unstable_isNewReconciler:!1};function Hi(t,e){if(t&&t.defaultProps){e=dt({},e),t=t.defaultProps;for(var r in t)e[r]===void 0&&(e[r]=t[r]);return e}return e}function gR(t,e,r,n){e=t.memoizedState,r=r(n,e),r=r==null?e:dt({},e,r),t.memoizedState=r,t.lanes===0&&(t.updateQueue.baseState=r)}var vy={isMounted:function(t){return(t=t._reactInternals)?Ql(t)===t:!1},enqueueSetState:function(t,e,r){t=t._reactInternals;var n=Rr(),i=mc(t),o=Ca(n,i);o.payload=e,r!=null&&(o.callback=r),e=uc(t,o,i),e!==null&&(Gi(e,t,i,n),Mh(e,t,i))},enqueueReplaceState:function(t,e,r){t=t._reactInternals;var n=Rr(),i=mc(t),o=Ca(n,i);o.tag=1,o.payload=e,r!=null&&(o.callback=r),e=uc(t,o,i),e!==null&&(Gi(e,t,i,n),Mh(e,t,i))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var r=Rr(),n=mc(t),i=Ca(r,n);i.tag=2,e!=null&&(i.callback=e),e=uc(t,i,n),e!==null&&(Gi(e,t,n,r),Mh(e,t,n))}};function I1(t,e,r,n,i,o,a){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(n,o,a):e.prototype&&e.prototype.isPureReactComponent?!$f(r,n)||!$f(i,o):!0}function fW(t,e,r){var n=!1,i=gc,o=e.contextType;return typeof o=="object"&&o!==null?o=yi(o):(i=on(e)?Gl:ur.current,n=e.contextTypes,o=(n=n!=null)?Dd(t,i):gc),e=new e(r,o),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=vy,t.stateNode=e,e._reactInternals=t,n&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=i,t.__reactInternalMemoizedMaskedChildContext=o),e}function S1(t,e,r,n){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(r,n),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(r,n),e.state!==t&&vy.enqueueReplaceState(e,e.state,null)}function hR(t,e,r,n){var i=t.stateNode;i.props=r,i.state=t.memoizedState,i.refs={},ew(t);var o=e.contextType;typeof o=="object"&&o!==null?i.context=yi(o):(o=on(e)?Gl:ur.current,i.context=Dd(t,o)),i.state=t.memoizedState,o=e.getDerivedStateFromProps,typeof o=="function"&&(gR(t,e,o,r),i.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof i.getSnapshotBeforeUpdate=="function"||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(e=i.state,typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount(),e!==i.state&&vy.enqueueReplaceState(i,i.state,null),ry(t,r,i,n),i.state=t.memoizedState),typeof i.componentDidMount=="function"&&(t.flags|=4194308)}function kd(t,e){try{var r="",n=e;do r+=z8(n),n=n.return;while(n);var i=r}catch(o){i=`
Error generating stack: `+o.message+`
`+o.stack}return{value:t,source:e,stack:i,digest:null}}function kA(t,e,r){return{value:t,source:null,stack:r??null,digest:e??null}}function yR(t,e){try{console.error(e.value)}catch(r){setTimeout(function(){throw r})}}var v9=typeof WeakMap=="function"?WeakMap:Map;function pW(t,e,r){r=Ca(-1,r),r.tag=3,r.payload={element:null};var n=e.value;return r.callback=function(){sy||(sy=!0,RR=n),yR(t,e)},r}function gW(t,e,r){r=Ca(-1,r),r.tag=3;var n=t.type.getDerivedStateFromError;if(typeof n=="function"){var i=e.value;r.payload=function(){return n(i)},r.callback=function(){yR(t,e)}}var o=t.stateNode;return o!==null&&typeof o.componentDidCatch=="function"&&(r.callback=function(){yR(t,e),typeof n!="function"&&(dc===null?dc=new Set([this]):dc.add(this));var a=e.stack;this.componentDidCatch(e.value,{componentStack:a!==null?a:""})}),r}function A1(t,e,r){var n=t.pingCache;if(n===null){n=t.pingCache=new v9;var i=new Set;n.set(e,i)}else i=n.get(e),i===void 0&&(i=new Set,n.set(e,i));i.has(r)||(i.add(r),t=P9.bind(null,t,e,r),e.then(t,t))}function R1(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function w1(t,e,r,n,i){return(t.mode&1)===0?(t===e?t.flags|=65536:(t.flags|=128,r.flags|=131072,r.flags&=-52805,r.tag===1&&(r.alternate===null?r.tag=17:(e=Ca(-1,1),e.tag=2,uc(r,e,1))),r.lanes|=1),t):(t.flags|=65536,t.lanes=i,t)}var E9=Ma.ReactCurrentOwner,rn=!1;function Ar(t,e,r,n){e.child=t===null?Gj(e,null,r,n):Ld(e,t.child,r,n)}function C1(t,e,r,n,i){r=r.render;var o=e.ref;return wd(e,i),n=ow(t,e,r,n,o,i),r=aw(),t!==null&&!rn?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~i,La(t,e,i)):(it&&r&&zR(e),e.flags|=1,Ar(t,e,n,i),e.child)}function N1(t,e,r,n,i){if(t===null){var o=r.type;return typeof o=="function"&&!hw(o)&&o.defaultProps===void 0&&r.compare===null&&r.defaultProps===void 0?(e.tag=15,e.type=o,hW(t,e,o,n,i)):(t=Hh(r.type,null,n,e,e.mode,i),t.ref=e.ref,t.return=e,e.child=t)}if(o=t.child,(t.lanes&i)===0){var a=o.memoizedProps;if(r=r.compare,r=r!==null?r:$f,r(a,n)&&t.ref===e.ref)return La(t,e,i)}return e.flags|=1,t=fc(o,n),t.ref=e.ref,t.return=e,e.child=t}function hW(t,e,r,n,i){if(t!==null){var o=t.memoizedProps;if($f(o,n)&&t.ref===e.ref)if(rn=!1,e.pendingProps=n=o,(t.lanes&i)!==0)(t.flags&131072)!==0&&(rn=!0);else return e.lanes=t.lanes,La(t,e,i)}return vR(t,e,r,n,i)}function yW(t,e,r){var n=e.pendingProps,i=n.children,o=t!==null?t.memoizedState:null;if(n.mode==="hidden")if((e.mode&1)===0)e.memoizedState={baseLanes:0,cachePool:null,transitions:null},Ye(Od,Wn),Wn|=r;else{if((r&1073741824)===0)return t=o!==null?o.baseLanes|r:r,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,Ye(Od,Wn),Wn|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},n=o!==null?o.baseLanes:r,Ye(Od,Wn),Wn|=n}else o!==null?(n=o.baseLanes|r,e.memoizedState=null):n=r,Ye(Od,Wn),Wn|=n;return Ar(t,e,i,r),e.child}function vW(t,e){var r=e.ref;(t===null&&r!==null||t!==null&&t.ref!==r)&&(e.flags|=512,e.flags|=2097152)}function vR(t,e,r,n,i){var o=on(r)?Gl:ur.current;return o=Dd(e,o),wd(e,i),r=ow(t,e,r,n,o,i),n=aw(),t!==null&&!rn?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~i,La(t,e,i)):(it&&n&&zR(e),e.flags|=1,Ar(t,e,r,i),e.child)}function D1(t,e,r,n,i){if(on(r)){var o=!0;Xh(e)}else o=!1;if(wd(e,i),e.stateNode===null)Bh(t,e),fW(e,r,n),hR(e,r,n,i),n=!0;else if(t===null){var a=e.stateNode,s=e.memoizedProps;a.props=s;var c=a.context,l=r.contextType;typeof l=="object"&&l!==null?l=yi(l):(l=on(r)?Gl:ur.current,l=Dd(e,l));var u=r.getDerivedStateFromProps,m=typeof u=="function"||typeof a.getSnapshotBeforeUpdate=="function";m||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(s!==n||c!==l)&&S1(e,a,n,l),tc=!1;var f=e.memoizedState;a.state=f,ry(e,n,a,i),c=e.memoizedState,s!==n||f!==c||nn.current||tc?(typeof u=="function"&&(gR(e,r,u,n),c=e.memoizedState),(s=tc||I1(e,r,s,n,f,c,l))?(m||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount()),typeof a.componentDidMount=="function"&&(e.flags|=4194308)):(typeof a.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=n,e.memoizedState=c),a.props=n,a.state=c,a.context=l,n=s):(typeof a.componentDidMount=="function"&&(e.flags|=4194308),n=!1)}else{a=e.stateNode,Yj(t,e),s=e.memoizedProps,l=e.type===e.elementType?s:Hi(e.type,s),a.props=l,m=e.pendingProps,f=a.context,c=r.contextType,typeof c=="object"&&c!==null?c=yi(c):(c=on(r)?Gl:ur.current,c=Dd(e,c));var g=r.getDerivedStateFromProps;(u=typeof g=="function"||typeof a.getSnapshotBeforeUpdate=="function")||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(s!==m||f!==c)&&S1(e,a,n,c),tc=!1,f=e.memoizedState,a.state=f,ry(e,n,a,i);var h=e.memoizedState;s!==m||f!==h||nn.current||tc?(typeof g=="function"&&(gR(e,r,g,n),h=e.memoizedState),(l=tc||I1(e,r,l,n,f,h,c)||!1)?(u||typeof a.UNSAFE_componentWillUpdate!="function"&&typeof a.componentWillUpdate!="function"||(typeof a.componentWillUpdate=="function"&&a.componentWillUpdate(n,h,c),typeof a.UNSAFE_componentWillUpdate=="function"&&a.UNSAFE_componentWillUpdate(n,h,c)),typeof a.componentDidUpdate=="function"&&(e.flags|=4),typeof a.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof a.componentDidUpdate!="function"||s===t.memoizedProps&&f===t.memoizedState||(e.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||s===t.memoizedProps&&f===t.memoizedState||(e.flags|=1024),e.memoizedProps=n,e.memoizedState=h),a.props=n,a.state=h,a.context=c,n=l):(typeof a.componentDidUpdate!="function"||s===t.memoizedProps&&f===t.memoizedState||(e.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||s===t.memoizedProps&&f===t.memoizedState||(e.flags|=1024),n=!1)}return ER(t,e,r,n,o,i)}function ER(t,e,r,n,i,o){vW(t,e);var a=(e.flags&128)!==0;if(!n&&!a)return i&&h1(e,r,!1),La(t,e,o);n=e.stateNode,E9.current=e;var s=a&&typeof r.getDerivedStateFromError!="function"?null:n.render();return e.flags|=1,t!==null&&a?(e.child=Ld(e,t.child,null,o),e.child=Ld(e,null,s,o)):Ar(t,e,s,o),e.memoizedState=n.state,i&&h1(e,r,!0),e.child}function EW(t){var e=t.stateNode;e.pendingContext?g1(t,e.pendingContext,e.pendingContext!==e.context):e.context&&g1(t,e.context,!1),tw(t,e.containerInfo)}function P1(t,e,r,n,i){return Pd(),KR(i),e.flags|=256,Ar(t,e,r,n),e.child}var TR={dehydrated:null,treeContext:null,retryLane:0};function _R(t){return{baseLanes:t,cachePool:null,transitions:null}}function TW(t,e,r){var n=e.pendingProps,i=lt.current,o=!1,a=(e.flags&128)!==0,s;if((s=a)||(s=t!==null&&t.memoizedState===null?!1:(i&2)!==0),s?(o=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(i|=1),Ye(lt,i&1),t===null)return fR(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?((e.mode&1)===0?e.lanes=1:t.data==="$!"?e.lanes=8:e.lanes=1073741824,null):(a=n.children,t=n.fallback,o?(n=e.mode,o=e.child,a={mode:"hidden",children:a},(n&1)===0&&o!==null?(o.childLanes=0,o.pendingProps=a):o=_y(a,n,0,null),t=Fl(t,n,r,null),o.return=e,t.return=e,o.sibling=t,e.child=o,e.child.memoizedState=_R(r),e.memoizedState=TR,t):lw(e,a));if(i=t.memoizedState,i!==null&&(s=i.dehydrated,s!==null))return T9(t,e,a,n,s,i,r);if(o){o=n.fallback,a=e.mode,i=t.child,s=i.sibling;var c={mode:"hidden",children:n.children};return(a&1)===0&&e.child!==i?(n=e.child,n.childLanes=0,n.pendingProps=c,e.deletions=null):(n=fc(i,c),n.subtreeFlags=i.subtreeFlags&14680064),s!==null?o=fc(s,o):(o=Fl(o,a,r,null),o.flags|=2),o.return=e,n.return=e,n.sibling=o,e.child=n,n=o,o=e.child,a=t.child.memoizedState,a=a===null?_R(r):{baseLanes:a.baseLanes|r,cachePool:null,transitions:a.transitions},o.memoizedState=a,o.childLanes=t.childLanes&~r,e.memoizedState=TR,n}return o=t.child,t=o.sibling,n=fc(o,{mode:"visible",children:n.children}),(e.mode&1)===0&&(n.lanes=r),n.return=e,n.sibling=null,t!==null&&(r=e.deletions,r===null?(e.deletions=[t],e.flags|=16):r.push(t)),e.child=n,e.memoizedState=null,n}function lw(t,e){return e=_y({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function wh(t,e,r,n){return n!==null&&KR(n),Ld(e,t.child,null,r),t=lw(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function T9(t,e,r,n,i,o,a){if(r)return e.flags&256?(e.flags&=-257,n=kA(Error(D(422))),wh(t,e,a,n)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(o=n.fallback,i=e.mode,n=_y({mode:"visible",children:n.children},i,0,null),o=Fl(o,i,a,null),o.flags|=2,n.return=e,o.return=e,n.sibling=o,e.child=n,(e.mode&1)!==0&&Ld(e,t.child,null,a),e.child.memoizedState=_R(a),e.memoizedState=TR,o);if((e.mode&1)===0)return wh(t,e,a,null);if(i.data==="$!"){if(n=i.nextSibling&&i.nextSibling.dataset,n)var s=n.dgst;return n=s,o=Error(D(419)),n=kA(o,n,void 0),wh(t,e,a,n)}if(s=(a&t.childLanes)!==0,rn||s){if(n=Ut,n!==null){switch(a&-a){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}i=(i&(n.suspendedLanes|a))!==0?0:i,i!==0&&i!==o.retryLane&&(o.retryLane=i,Pa(t,i),Gi(n,t,i,-1))}return gw(),n=kA(Error(D(421))),wh(t,e,a,n)}return i.data==="$?"?(e.flags|=128,e.child=t.child,e=L9.bind(null,t),i._reactRetry=e,null):(t=o.treeContext,Hn=lc(i.nextSibling),Un=e,it=!0,qi=null,t!==null&&(fi[pi++]=Ra,fi[pi++]=wa,fi[pi++]=Vl,Ra=t.id,wa=t.overflow,Vl=e),e=lw(e,n.children),e.flags|=4096,e)}function L1(t,e,r){t.lanes|=e;var n=t.alternate;n!==null&&(n.lanes|=e),pR(t.return,e,r)}function xA(t,e,r,n,i){var o=t.memoizedState;o===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:n,tail:r,tailMode:i}:(o.isBackwards=e,o.rendering=null,o.renderingStartTime=0,o.last=n,o.tail=r,o.tailMode=i)}function _W(t,e,r){var n=e.pendingProps,i=n.revealOrder,o=n.tail;if(Ar(t,e,n.children,r),n=lt.current,(n&2)!==0)n=n&1|2,e.flags|=128;else{if(t!==null&&(t.flags&128)!==0)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&L1(t,r,e);else if(t.tag===19)L1(t,r,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}n&=1}if(Ye(lt,n),(e.mode&1)===0)e.memoizedState=null;else switch(i){case"forwards":for(r=e.child,i=null;r!==null;)t=r.alternate,t!==null&&ny(t)===null&&(i=r),r=r.sibling;r=i,r===null?(i=e.child,e.child=null):(i=r.sibling,r.sibling=null),xA(e,!1,i,r,o);break;case"backwards":for(r=null,i=e.child,e.child=null;i!==null;){if(t=i.alternate,t!==null&&ny(t)===null){e.child=i;break}t=i.sibling,i.sibling=r,r=i,i=t}xA(e,!0,r,null,o);break;case"together":xA(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Bh(t,e){(e.mode&1)===0&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function La(t,e,r){if(t!==null&&(e.dependencies=t.dependencies),zl|=e.lanes,(r&e.childLanes)===0)return null;if(t!==null&&e.child!==t.child)throw Error(D(153));if(e.child!==null){for(t=e.child,r=fc(t,t.pendingProps),e.child=r,r.return=e;t.sibling!==null;)t=t.sibling,r=r.sibling=fc(t,t.pendingProps),r.return=e;r.sibling=null}return e.child}function _9(t,e,r){switch(e.tag){case 3:EW(e),Pd();break;case 5:zj(e);break;case 1:on(e.type)&&Xh(e);break;case 4:tw(e,e.stateNode.containerInfo);break;case 10:var n=e.type._context,i=e.memoizedProps.value;Ye(ey,n._currentValue),n._currentValue=i;break;case 13:if(n=e.memoizedState,n!==null)return n.dehydrated!==null?(Ye(lt,lt.current&1),e.flags|=128,null):(r&e.child.childLanes)!==0?TW(t,e,r):(Ye(lt,lt.current&1),t=La(t,e,r),t!==null?t.sibling:null);Ye(lt,lt.current&1);break;case 19:if(n=(r&e.childLanes)!==0,(t.flags&128)!==0){if(n)return _W(t,e,r);e.flags|=128}if(i=e.memoizedState,i!==null&&(i.rendering=null,i.tail=null,i.lastEffect=null),Ye(lt,lt.current),n)break;return null;case 22:case 23:return e.lanes=0,yW(t,e,r)}return La(t,e,r)}var bW,bR,OW,IW;bW=function(t,e){for(var r=e.child;r!==null;){if(r.tag===5||r.tag===6)t.appendChild(r.stateNode);else if(r.tag!==4&&r.child!==null){r.child.return=r,r=r.child;continue}if(r===e)break;for(;r.sibling===null;){if(r.return===null||r.return===e)return;r=r.return}r.sibling.return=r.return,r=r.sibling}};bR=function(){};OW=function(t,e,r,n){var i=t.memoizedProps;if(i!==n){t=e.stateNode,Ul(jo.current);var o=null;switch(r){case"input":i=GA(t,i),n=GA(t,n),o=[];break;case"select":i=dt({},i,{value:void 0}),n=dt({},n,{value:void 0}),o=[];break;case"textarea":i=zA(t,i),n=zA(t,n),o=[];break;default:typeof i.onClick!="function"&&typeof n.onClick=="function"&&(t.onclick=Kh)}KA(r,n);var a;r=null;for(l in i)if(!n.hasOwnProperty(l)&&i.hasOwnProperty(l)&&i[l]!=null)if(l==="style"){var s=i[l];for(a in s)s.hasOwnProperty(a)&&(r||(r={}),r[a]="")}else l!=="dangerouslySetInnerHTML"&&l!=="children"&&l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&l!=="autoFocus"&&(Uf.hasOwnProperty(l)?o||(o=[]):(o=o||[]).push(l,null));for(l in n){var c=n[l];if(s=i?.[l],n.hasOwnProperty(l)&&c!==s&&(c!=null||s!=null))if(l==="style")if(s){for(a in s)!s.hasOwnProperty(a)||c&&c.hasOwnProperty(a)||(r||(r={}),r[a]="");for(a in c)c.hasOwnProperty(a)&&s[a]!==c[a]&&(r||(r={}),r[a]=c[a])}else r||(o||(o=[]),o.push(l,r)),r=c;else l==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,s=s?s.__html:void 0,c!=null&&s!==c&&(o=o||[]).push(l,c)):l==="children"?typeof c!="string"&&typeof c!="number"||(o=o||[]).push(l,""+c):l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&(Uf.hasOwnProperty(l)?(c!=null&&l==="onScroll"&&Xe("scroll",t),o||s===c||(o=[])):(o=o||[]).push(l,c))}r&&(o=o||[]).push("style",r);var l=o;(e.updateQueue=l)&&(e.flags|=4)}};IW=function(t,e,r,n){r!==n&&(e.flags|=4)};function Sf(t,e){if(!it)switch(t.tailMode){case"hidden":e=t.tail;for(var r=null;e!==null;)e.alternate!==null&&(r=e),e=e.sibling;r===null?t.tail=null:r.sibling=null;break;case"collapsed":r=t.tail;for(var n=null;r!==null;)r.alternate!==null&&(n=r),r=r.sibling;n===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:n.sibling=null}}function cr(t){var e=t.alternate!==null&&t.alternate.child===t.child,r=0,n=0;if(e)for(var i=t.child;i!==null;)r|=i.lanes|i.childLanes,n|=i.subtreeFlags&14680064,n|=i.flags&14680064,i.return=t,i=i.sibling;else for(i=t.child;i!==null;)r|=i.lanes|i.childLanes,n|=i.subtreeFlags,n|=i.flags,i.return=t,i=i.sibling;return t.subtreeFlags|=n,t.childLanes=r,e}function b9(t,e,r){var n=e.pendingProps;switch($R(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return cr(e),null;case 1:return on(e.type)&&Qh(),cr(e),null;case 3:return n=e.stateNode,Md(),Ze(nn),Ze(ur),nw(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),(t===null||t.child===null)&&(Ah(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&(e.flags&256)===0||(e.flags|=1024,qi!==null&&(NR(qi),qi=null))),bR(t,e),cr(e),null;case 5:rw(e);var i=Ul(Jf.current);if(r=e.type,t!==null&&e.stateNode!=null)OW(t,e,r,n,i),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!n){if(e.stateNode===null)throw Error(D(166));return cr(e),null}if(t=Ul(jo.current),Ah(e)){n=e.stateNode,r=e.type;var o=e.memoizedProps;switch(n[xo]=e,n[Xf]=o,t=(e.mode&1)!==0,r){case"dialog":Xe("cancel",n),Xe("close",n);break;case"iframe":case"object":case"embed":Xe("load",n);break;case"video":case"audio":for(i=0;i<Df.length;i++)Xe(Df[i],n);break;case"source":Xe("error",n);break;case"img":case"image":case"link":Xe("error",n),Xe("load",n);break;case"details":Xe("toggle",n);break;case"input":UB(n,o),Xe("invalid",n);break;case"select":n._wrapperState={wasMultiple:!!o.multiple},Xe("invalid",n);break;case"textarea":FB(n,o),Xe("invalid",n)}KA(r,o),i=null;for(var a in o)if(o.hasOwnProperty(a)){var s=o[a];a==="children"?typeof s=="string"?n.textContent!==s&&(o.suppressHydrationWarning!==!0&&Sh(n.textContent,s,t),i=["children",s]):typeof s=="number"&&n.textContent!==""+s&&(o.suppressHydrationWarning!==!0&&Sh(n.textContent,s,t),i=["children",""+s]):Uf.hasOwnProperty(a)&&s!=null&&a==="onScroll"&&Xe("scroll",n)}switch(r){case"input":fh(n),qB(n,o,!0);break;case"textarea":fh(n),GB(n);break;case"select":case"option":break;default:typeof o.onClick=="function"&&(n.onclick=Kh)}n=i,e.updateQueue=n,n!==null&&(e.flags|=4)}else{a=i.nodeType===9?i:i.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=Z1(r)),t==="http://www.w3.org/1999/xhtml"?r==="script"?(t=a.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof n.is=="string"?t=a.createElement(r,{is:n.is}):(t=a.createElement(r),r==="select"&&(a=t,n.multiple?a.multiple=!0:n.size&&(a.size=n.size))):t=a.createElementNS(t,r),t[xo]=e,t[Xf]=n,bW(t,e,!1,!1),e.stateNode=t;e:{switch(a=QA(r,n),r){case"dialog":Xe("cancel",t),Xe("close",t),i=n;break;case"iframe":case"object":case"embed":Xe("load",t),i=n;break;case"video":case"audio":for(i=0;i<Df.length;i++)Xe(Df[i],t);i=n;break;case"source":Xe("error",t),i=n;break;case"img":case"image":case"link":Xe("error",t),Xe("load",t),i=n;break;case"details":Xe("toggle",t),i=n;break;case"input":UB(t,n),i=GA(t,n),Xe("invalid",t);break;case"option":i=n;break;case"select":t._wrapperState={wasMultiple:!!n.multiple},i=dt({},n,{value:void 0}),Xe("invalid",t);break;case"textarea":FB(t,n),i=zA(t,n),Xe("invalid",t);break;default:i=n}KA(r,i),s=i;for(o in s)if(s.hasOwnProperty(o)){var c=s[o];o==="style"?tj(t,c):o==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,c!=null&&J1(t,c)):o==="children"?typeof c=="string"?(r!=="textarea"||c!=="")&&qf(t,c):typeof c=="number"&&qf(t,""+c):o!=="suppressContentEditableWarning"&&o!=="suppressHydrationWarning"&&o!=="autoFocus"&&(Uf.hasOwnProperty(o)?c!=null&&o==="onScroll"&&Xe("scroll",t):c!=null&&LR(t,o,c,a))}switch(r){case"input":fh(t),qB(t,n,!1);break;case"textarea":fh(t),GB(t);break;case"option":n.value!=null&&t.setAttribute("value",""+pc(n.value));break;case"select":t.multiple=!!n.multiple,o=n.value,o!=null?Id(t,!!n.multiple,o,!1):n.defaultValue!=null&&Id(t,!!n.multiple,n.defaultValue,!0);break;default:typeof i.onClick=="function"&&(t.onclick=Kh)}switch(r){case"button":case"input":case"select":case"textarea":n=!!n.autoFocus;break e;case"img":n=!0;break e;default:n=!1}}n&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return cr(e),null;case 6:if(t&&e.stateNode!=null)IW(t,e,t.memoizedProps,n);else{if(typeof n!="string"&&e.stateNode===null)throw Error(D(166));if(r=Ul(Jf.current),Ul(jo.current),Ah(e)){if(n=e.stateNode,r=e.memoizedProps,n[xo]=e,(o=n.nodeValue!==r)&&(t=Un,t!==null))switch(t.tag){case 3:Sh(n.nodeValue,r,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&Sh(n.nodeValue,r,(t.mode&1)!==0)}o&&(e.flags|=4)}else n=(r.nodeType===9?r:r.ownerDocument).createTextNode(n),n[xo]=e,e.stateNode=n}return cr(e),null;case 13:if(Ze(lt),n=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(it&&Hn!==null&&(e.mode&1)!==0&&(e.flags&128)===0)qj(),Pd(),e.flags|=98560,o=!1;else if(o=Ah(e),n!==null&&n.dehydrated!==null){if(t===null){if(!o)throw Error(D(318));if(o=e.memoizedState,o=o!==null?o.dehydrated:null,!o)throw Error(D(317));o[xo]=e}else Pd(),(e.flags&128)===0&&(e.memoizedState=null),e.flags|=4;cr(e),o=!1}else qi!==null&&(NR(qi),qi=null),o=!0;if(!o)return e.flags&65536?e:null}return(e.flags&128)!==0?(e.lanes=r,e):(n=n!==null,n!==(t!==null&&t.memoizedState!==null)&&n&&(e.child.flags|=8192,(e.mode&1)!==0&&(t===null||(lt.current&1)!==0?Dt===0&&(Dt=3):gw())),e.updateQueue!==null&&(e.flags|=4),cr(e),null);case 4:return Md(),bR(t,e),t===null&&Kf(e.stateNode.containerInfo),cr(e),null;case 10:return ZR(e.type._context),cr(e),null;case 17:return on(e.type)&&Qh(),cr(e),null;case 19:if(Ze(lt),o=e.memoizedState,o===null)return cr(e),null;if(n=(e.flags&128)!==0,a=o.rendering,a===null)if(n)Sf(o,!1);else{if(Dt!==0||t!==null&&(t.flags&128)!==0)for(t=e.child;t!==null;){if(a=ny(t),a!==null){for(e.flags|=128,Sf(o,!1),n=a.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),e.subtreeFlags=0,n=r,r=e.child;r!==null;)o=r,t=n,o.flags&=14680066,a=o.alternate,a===null?(o.childLanes=0,o.lanes=t,o.child=null,o.subtreeFlags=0,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=a.childLanes,o.lanes=a.lanes,o.child=a.child,o.subtreeFlags=0,o.deletions=null,o.memoizedProps=a.memoizedProps,o.memoizedState=a.memoizedState,o.updateQueue=a.updateQueue,o.type=a.type,t=a.dependencies,o.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),r=r.sibling;return Ye(lt,lt.current&1|2),e.child}t=t.sibling}o.tail!==null&&vt()>xd&&(e.flags|=128,n=!0,Sf(o,!1),e.lanes=4194304)}else{if(!n)if(t=ny(a),t!==null){if(e.flags|=128,n=!0,r=t.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),Sf(o,!0),o.tail===null&&o.tailMode==="hidden"&&!a.alternate&&!it)return cr(e),null}else 2*vt()-o.renderingStartTime>xd&&r!==1073741824&&(e.flags|=128,n=!0,Sf(o,!1),e.lanes=4194304);o.isBackwards?(a.sibling=e.child,e.child=a):(r=o.last,r!==null?r.sibling=a:e.child=a,o.last=a)}return o.tail!==null?(e=o.tail,o.rendering=e,o.tail=e.sibling,o.renderingStartTime=vt(),e.sibling=null,r=lt.current,Ye(lt,n?r&1|2:r&1),e):(cr(e),null);case 22:case 23:return pw(),n=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==n&&(e.flags|=8192),n&&(e.mode&1)!==0?(Wn&1073741824)!==0&&(cr(e),e.subtreeFlags&6&&(e.flags|=8192)):cr(e),null;case 24:return null;case 25:return null}throw Error(D(156,e.tag))}function O9(t,e){switch($R(e),e.tag){case 1:return on(e.type)&&Qh(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return Md(),Ze(nn),Ze(ur),nw(),t=e.flags,(t&65536)!==0&&(t&128)===0?(e.flags=t&-65537|128,e):null;case 5:return rw(e),null;case 13:if(Ze(lt),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(D(340));Pd()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return Ze(lt),null;case 4:return Md(),null;case 10:return ZR(e.type._context),null;case 22:case 23:return pw(),null;case 24:return null;default:return null}}var Ch=!1,lr=!1,I9=typeof WeakSet=="function"?WeakSet:Set,$=null;function bd(t,e){var r=t.ref;if(r!==null)if(typeof r=="function")try{r(null)}catch(n){pt(t,e,n)}else r.current=null}function OR(t,e,r){try{r()}catch(n){pt(t,e,n)}}var M1=!1;function S9(t,e){if(aR=Yh,t=Cj(),YR(t)){if("selectionStart"in t)var r={start:t.selectionStart,end:t.selectionEnd};else e:{r=(r=t.ownerDocument)&&r.defaultView||window;var n=r.getSelection&&r.getSelection();if(n&&n.rangeCount!==0){r=n.anchorNode;var i=n.anchorOffset,o=n.focusNode;n=n.focusOffset;try{r.nodeType,o.nodeType}catch{r=null;break e}var a=0,s=-1,c=-1,l=0,u=0,m=t,f=null;t:for(;;){for(var g;m!==r||i!==0&&m.nodeType!==3||(s=a+i),m!==o||n!==0&&m.nodeType!==3||(c=a+n),m.nodeType===3&&(a+=m.nodeValue.length),(g=m.firstChild)!==null;)f=m,m=g;for(;;){if(m===t)break t;if(f===r&&++l===i&&(s=a),f===o&&++u===n&&(c=a),(g=m.nextSibling)!==null)break;m=f,f=m.parentNode}m=g}r=s===-1||c===-1?null:{start:s,end:c}}else r=null}r=r||{start:0,end:0}}else r=null;for(sR={focusedElem:t,selectionRange:r},Yh=!1,$=e;$!==null;)if(e=$,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,$=t;else for(;$!==null;){e=$;try{var h=e.alternate;if((e.flags&1024)!==0)switch(e.tag){case 0:case 11:case 15:break;case 1:if(h!==null){var y=h.memoizedProps,_=h.memoizedState,v=e.stateNode,E=v.getSnapshotBeforeUpdate(e.elementType===e.type?y:Hi(e.type,y),_);v.__reactInternalSnapshotBeforeUpdate=E}break;case 3:var T=e.stateNode.containerInfo;T.nodeType===1?T.textContent="":T.nodeType===9&&T.documentElement&&T.removeChild(T.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(D(163))}}catch(O){pt(e,e.return,O)}if(t=e.sibling,t!==null){t.return=e.return,$=t;break}$=e.return}return h=M1,M1=!1,h}function jf(t,e,r){var n=e.updateQueue;if(n=n!==null?n.lastEffect:null,n!==null){var i=n=n.next;do{if((i.tag&t)===t){var o=i.destroy;i.destroy=void 0,o!==void 0&&OR(e,r,o)}i=i.next}while(i!==n)}}function Ey(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var r=e=e.next;do{if((r.tag&t)===t){var n=r.create;r.destroy=n()}r=r.next}while(r!==e)}}function IR(t){var e=t.ref;if(e!==null){var r=t.stateNode;t.tag,t=r,typeof e=="function"?e(t):e.current=t}}function SW(t){var e=t.alternate;e!==null&&(t.alternate=null,SW(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[xo],delete e[Xf],delete e[uR],delete e[s9],delete e[c9])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function AW(t){return t.tag===5||t.tag===3||t.tag===4}function k1(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||AW(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function SR(t,e,r){var n=t.tag;if(n===5||n===6)t=t.stateNode,e?r.nodeType===8?r.parentNode.insertBefore(t,e):r.insertBefore(t,e):(r.nodeType===8?(e=r.parentNode,e.insertBefore(t,r)):(e=r,e.appendChild(t)),r=r._reactRootContainer,r!=null||e.onclick!==null||(e.onclick=Kh));else if(n!==4&&(t=t.child,t!==null))for(SR(t,e,r),t=t.sibling;t!==null;)SR(t,e,r),t=t.sibling}function AR(t,e,r){var n=t.tag;if(n===5||n===6)t=t.stateNode,e?r.insertBefore(t,e):r.appendChild(t);else if(n!==4&&(t=t.child,t!==null))for(AR(t,e,r),t=t.sibling;t!==null;)AR(t,e,r),t=t.sibling}var zt=null,Ui=!1;function Js(t,e,r){for(r=r.child;r!==null;)RW(t,e,r),r=r.sibling}function RW(t,e,r){if(Bo&&typeof Bo.onCommitFiberUnmount=="function")try{Bo.onCommitFiberUnmount(dy,r)}catch{}switch(r.tag){case 5:lr||bd(r,e);case 6:var n=zt,i=Ui;zt=null,Js(t,e,r),zt=n,Ui=i,zt!==null&&(Ui?(t=zt,r=r.stateNode,t.nodeType===8?t.parentNode.removeChild(r):t.removeChild(r)):zt.removeChild(r.stateNode));break;case 18:zt!==null&&(Ui?(t=zt,r=r.stateNode,t.nodeType===8?CA(t.parentNode,r):t.nodeType===1&&CA(t,r),Yf(t)):CA(zt,r.stateNode));break;case 4:n=zt,i=Ui,zt=r.stateNode.containerInfo,Ui=!0,Js(t,e,r),zt=n,Ui=i;break;case 0:case 11:case 14:case 15:if(!lr&&(n=r.updateQueue,n!==null&&(n=n.lastEffect,n!==null))){i=n=n.next;do{var o=i,a=o.destroy;o=o.tag,a!==void 0&&((o&2)!==0||(o&4)!==0)&&OR(r,e,a),i=i.next}while(i!==n)}Js(t,e,r);break;case 1:if(!lr&&(bd(r,e),n=r.stateNode,typeof n.componentWillUnmount=="function"))try{n.props=r.memoizedProps,n.state=r.memoizedState,n.componentWillUnmount()}catch(s){pt(r,e,s)}Js(t,e,r);break;case 21:Js(t,e,r);break;case 22:r.mode&1?(lr=(n=lr)||r.memoizedState!==null,Js(t,e,r),lr=n):Js(t,e,r);break;default:Js(t,e,r)}}function x1(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var r=t.stateNode;r===null&&(r=t.stateNode=new I9),e.forEach(function(n){var i=M9.bind(null,t,n);r.has(n)||(r.add(n),n.then(i,i))})}}function Wi(t,e){var r=e.deletions;if(r!==null)for(var n=0;n<r.length;n++){var i=r[n];try{var o=t,a=e,s=a;e:for(;s!==null;){switch(s.tag){case 5:zt=s.stateNode,Ui=!1;break e;case 3:zt=s.stateNode.containerInfo,Ui=!0;break e;case 4:zt=s.stateNode.containerInfo,Ui=!0;break e}s=s.return}if(zt===null)throw Error(D(160));RW(o,a,i),zt=null,Ui=!1;var c=i.alternate;c!==null&&(c.return=null),i.return=null}catch(l){pt(i,e,l)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)wW(e,t),e=e.sibling}function wW(t,e){var r=t.alternate,n=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(Wi(e,t),Mo(t),n&4){try{jf(3,t,t.return),Ey(3,t)}catch(y){pt(t,t.return,y)}try{jf(5,t,t.return)}catch(y){pt(t,t.return,y)}}break;case 1:Wi(e,t),Mo(t),n&512&&r!==null&&bd(r,r.return);break;case 5:if(Wi(e,t),Mo(t),n&512&&r!==null&&bd(r,r.return),t.flags&32){var i=t.stateNode;try{qf(i,"")}catch(y){pt(t,t.return,y)}}if(n&4&&(i=t.stateNode,i!=null)){var o=t.memoizedProps,a=r!==null?r.memoizedProps:o,s=t.type,c=t.updateQueue;if(t.updateQueue=null,c!==null)try{s==="input"&&o.type==="radio"&&o.name!=null&&Q1(i,o),QA(s,a);var l=QA(s,o);for(a=0;a<c.length;a+=2){var u=c[a],m=c[a+1];u==="style"?tj(i,m):u==="dangerouslySetInnerHTML"?J1(i,m):u==="children"?qf(i,m):LR(i,u,m,l)}switch(s){case"input":VA(i,o);break;case"textarea":X1(i,o);break;case"select":var f=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!o.multiple;var g=o.value;g!=null?Id(i,!!o.multiple,g,!1):f!==!!o.multiple&&(o.defaultValue!=null?Id(i,!!o.multiple,o.defaultValue,!0):Id(i,!!o.multiple,o.multiple?[]:"",!1))}i[Xf]=o}catch(y){pt(t,t.return,y)}}break;case 6:if(Wi(e,t),Mo(t),n&4){if(t.stateNode===null)throw Error(D(162));i=t.stateNode,o=t.memoizedProps;try{i.nodeValue=o}catch(y){pt(t,t.return,y)}}break;case 3:if(Wi(e,t),Mo(t),n&4&&r!==null&&r.memoizedState.isDehydrated)try{Yf(e.containerInfo)}catch(y){pt(t,t.return,y)}break;case 4:Wi(e,t),Mo(t);break;case 13:Wi(e,t),Mo(t),i=t.child,i.flags&8192&&(o=i.memoizedState!==null,i.stateNode.isHidden=o,!o||i.alternate!==null&&i.alternate.memoizedState!==null||(mw=vt())),n&4&&x1(t);break;case 22:if(u=r!==null&&r.memoizedState!==null,t.mode&1?(lr=(l=lr)||u,Wi(e,t),lr=l):Wi(e,t),Mo(t),n&8192){if(l=t.memoizedState!==null,(t.stateNode.isHidden=l)&&!u&&(t.mode&1)!==0)for($=t,u=t.child;u!==null;){for(m=$=u;$!==null;){switch(f=$,g=f.child,f.tag){case 0:case 11:case 14:case 15:jf(4,f,f.return);break;case 1:bd(f,f.return);var h=f.stateNode;if(typeof h.componentWillUnmount=="function"){n=f,r=f.return;try{e=n,h.props=e.memoizedProps,h.state=e.memoizedState,h.componentWillUnmount()}catch(y){pt(n,r,y)}}break;case 5:bd(f,f.return);break;case 22:if(f.memoizedState!==null){j1(m);continue}}g!==null?(g.return=f,$=g):j1(m)}u=u.sibling}e:for(u=null,m=t;;){if(m.tag===5){if(u===null){u=m;try{i=m.stateNode,l?(o=i.style,typeof o.setProperty=="function"?o.setProperty("display","none","important"):o.display="none"):(s=m.stateNode,c=m.memoizedProps.style,a=c!=null&&c.hasOwnProperty("display")?c.display:null,s.style.display=ej("display",a))}catch(y){pt(t,t.return,y)}}}else if(m.tag===6){if(u===null)try{m.stateNode.nodeValue=l?"":m.memoizedProps}catch(y){pt(t,t.return,y)}}else if((m.tag!==22&&m.tag!==23||m.memoizedState===null||m===t)&&m.child!==null){m.child.return=m,m=m.child;continue}if(m===t)break e;for(;m.sibling===null;){if(m.return===null||m.return===t)break e;u===m&&(u=null),m=m.return}u===m&&(u=null),m.sibling.return=m.return,m=m.sibling}}break;case 19:Wi(e,t),Mo(t),n&4&&x1(t);break;case 21:break;default:Wi(e,t),Mo(t)}}function Mo(t){var e=t.flags;if(e&2){try{e:{for(var r=t.return;r!==null;){if(AW(r)){var n=r;break e}r=r.return}throw Error(D(160))}switch(n.tag){case 5:var i=n.stateNode;n.flags&32&&(qf(i,""),n.flags&=-33);var o=k1(t);AR(t,o,i);break;case 3:case 4:var a=n.stateNode.containerInfo,s=k1(t);SR(t,s,a);break;default:throw Error(D(161))}}catch(c){pt(t,t.return,c)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function A9(t,e,r){$=t,CW(t,e,r)}function CW(t,e,r){for(var n=(t.mode&1)!==0;$!==null;){var i=$,o=i.child;if(i.tag===22&&n){var a=i.memoizedState!==null||Ch;if(!a){var s=i.alternate,c=s!==null&&s.memoizedState!==null||lr;s=Ch;var l=lr;if(Ch=a,(lr=c)&&!l)for($=i;$!==null;)a=$,c=a.child,a.tag===22&&a.memoizedState!==null?W1(i):c!==null?(c.return=a,$=c):W1(i);for(;o!==null;)$=o,CW(o,e,r),o=o.sibling;$=i,Ch=s,lr=l}B1(t,e,r)}else(i.subtreeFlags&8772)!==0&&o!==null?(o.return=i,$=o):B1(t,e,r)}}function B1(t){for(;$!==null;){var e=$;if((e.flags&8772)!==0){var r=e.alternate;try{if((e.flags&8772)!==0)switch(e.tag){case 0:case 11:case 15:lr||Ey(5,e);break;case 1:var n=e.stateNode;if(e.flags&4&&!lr)if(r===null)n.componentDidMount();else{var i=e.elementType===e.type?r.memoizedProps:Hi(e.type,r.memoizedProps);n.componentDidUpdate(i,r.memoizedState,n.__reactInternalSnapshotBeforeUpdate)}var o=e.updateQueue;o!==null&&_1(e,o,n);break;case 3:var a=e.updateQueue;if(a!==null){if(r=null,e.child!==null)switch(e.child.tag){case 5:r=e.child.stateNode;break;case 1:r=e.child.stateNode}_1(e,a,r)}break;case 5:var s=e.stateNode;if(r===null&&e.flags&4){r=s;var c=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&r.focus();break;case"img":c.src&&(r.src=c.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var l=e.alternate;if(l!==null){var u=l.memoizedState;if(u!==null){var m=u.dehydrated;m!==null&&Yf(m)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(D(163))}lr||e.flags&512&&IR(e)}catch(f){pt(e,e.return,f)}}if(e===t){$=null;break}if(r=e.sibling,r!==null){r.return=e.return,$=r;break}$=e.return}}function j1(t){for(;$!==null;){var e=$;if(e===t){$=null;break}var r=e.sibling;if(r!==null){r.return=e.return,$=r;break}$=e.return}}function W1(t){for(;$!==null;){var e=$;try{switch(e.tag){case 0:case 11:case 15:var r=e.return;try{Ey(4,e)}catch(c){pt(e,r,c)}break;case 1:var n=e.stateNode;if(typeof n.componentDidMount=="function"){var i=e.return;try{n.componentDidMount()}catch(c){pt(e,i,c)}}var o=e.return;try{IR(e)}catch(c){pt(e,o,c)}break;case 5:var a=e.return;try{IR(e)}catch(c){pt(e,a,c)}}}catch(c){pt(e,e.return,c)}if(e===t){$=null;break}var s=e.sibling;if(s!==null){s.return=e.return,$=s;break}$=e.return}}var R9=Math.ceil,ay=Ma.ReactCurrentDispatcher,uw=Ma.ReactCurrentOwner,hi=Ma.ReactCurrentBatchConfig,Ae=0,Ut=null,bt=null,$t=0,Wn=0,Od=yc(0),Dt=0,np=null,zl=0,Ty=0,dw=0,Wf=null,tn=null,mw=0,xd=1/0,Sa=null,sy=!1,RR=null,dc=null,Nh=!1,oc=null,cy=0,Hf=0,wR=null,jh=-1,Wh=0;function Rr(){return(Ae&6)!==0?vt():jh!==-1?jh:jh=vt()}function mc(t){return(t.mode&1)===0?1:(Ae&2)!==0&&$t!==0?$t&-$t:u9.transition!==null?(Wh===0&&(Wh=fj()),Wh):(t=Be,t!==0||(t=window.event,t=t===void 0?16:Tj(t.type)),t)}function Gi(t,e,r,n){if(50<Hf)throw Hf=0,wR=null,Error(D(185));ip(t,r,n),((Ae&2)===0||t!==Ut)&&(t===Ut&&((Ae&2)===0&&(Ty|=r),Dt===4&&nc(t,$t)),an(t,n),r===1&&Ae===0&&(e.mode&1)===0&&(xd=vt()+500,hy&&vc()))}function an(t,e){var r=t.callbackNode;mX(t,e);var n=Vh(t,t===Ut?$t:0);if(n===0)r!==null&&zB(r),t.callbackNode=null,t.callbackPriority=0;else if(e=n&-n,t.callbackPriority!==e){if(r!=null&&zB(r),e===1)t.tag===0?l9(H1.bind(null,t)):Wj(H1.bind(null,t)),o9(function(){(Ae&6)===0&&vc()}),r=null;else{switch(pj(n)){case 1:r=jR;break;case 4:r=dj;break;case 16:r=Gh;break;case 536870912:r=mj;break;default:r=Gh}r=BW(r,NW.bind(null,t))}t.callbackPriority=e,t.callbackNode=r}}function NW(t,e){if(jh=-1,Wh=0,(Ae&6)!==0)throw Error(D(327));var r=t.callbackNode;if(Cd()&&t.callbackNode!==r)return null;var n=Vh(t,t===Ut?$t:0);if(n===0)return null;if((n&30)!==0||(n&t.expiredLanes)!==0||e)e=ly(t,n);else{e=n;var i=Ae;Ae|=2;var o=PW();(Ut!==t||$t!==e)&&(Sa=null,xd=vt()+500,ql(t,e));do try{N9();break}catch(s){DW(t,s)}while(!0);XR(),ay.current=o,Ae=i,bt!==null?e=0:(Ut=null,$t=0,e=Dt)}if(e!==0){if(e===2&&(i=tR(t),i!==0&&(n=i,e=CR(t,i))),e===1)throw r=np,ql(t,0),nc(t,n),an(t,vt()),r;if(e===6)nc(t,n);else{if(i=t.current.alternate,(n&30)===0&&!w9(i)&&(e=ly(t,n),e===2&&(o=tR(t),o!==0&&(n=o,e=CR(t,o))),e===1))throw r=np,ql(t,0),nc(t,n),an(t,vt()),r;switch(t.finishedWork=i,t.finishedLanes=n,e){case 0:case 1:throw Error(D(345));case 2:jl(t,tn,Sa);break;case 3:if(nc(t,n),(n&130023424)===n&&(e=mw+500-vt(),10<e)){if(Vh(t,0)!==0)break;if(i=t.suspendedLanes,(i&n)!==n){Rr(),t.pingedLanes|=t.suspendedLanes&i;break}t.timeoutHandle=lR(jl.bind(null,t,tn,Sa),e);break}jl(t,tn,Sa);break;case 4:if(nc(t,n),(n&4194240)===n)break;for(e=t.eventTimes,i=-1;0<n;){var a=31-Fi(n);o=1<<a,a=e[a],a>i&&(i=a),n&=~o}if(n=i,n=vt()-n,n=(120>n?120:480>n?480:1080>n?1080:1920>n?1920:3e3>n?3e3:4320>n?4320:1960*R9(n/1960))-n,10<n){t.timeoutHandle=lR(jl.bind(null,t,tn,Sa),n);break}jl(t,tn,Sa);break;case 5:jl(t,tn,Sa);break;default:throw Error(D(329))}}}return an(t,vt()),t.callbackNode===r?NW.bind(null,t):null}function CR(t,e){var r=Wf;return t.current.memoizedState.isDehydrated&&(ql(t,e).flags|=256),t=ly(t,e),t!==2&&(e=tn,tn=r,e!==null&&NR(e)),t}function NR(t){tn===null?tn=t:tn.push.apply(tn,t)}function w9(t){for(var e=t;;){if(e.flags&16384){var r=e.updateQueue;if(r!==null&&(r=r.stores,r!==null))for(var n=0;n<r.length;n++){var i=r[n],o=i.getSnapshot;i=i.value;try{if(!Vi(o(),i))return!1}catch{return!1}}}if(r=e.child,e.subtreeFlags&16384&&r!==null)r.return=e,e=r;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function nc(t,e){for(e&=~dw,e&=~Ty,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var r=31-Fi(e),n=1<<r;t[r]=-1,e&=~n}}function H1(t){if((Ae&6)!==0)throw Error(D(327));Cd();var e=Vh(t,0);if((e&1)===0)return an(t,vt()),null;var r=ly(t,e);if(t.tag!==0&&r===2){var n=tR(t);n!==0&&(e=n,r=CR(t,n))}if(r===1)throw r=np,ql(t,0),nc(t,e),an(t,vt()),r;if(r===6)throw Error(D(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,jl(t,tn,Sa),an(t,vt()),null}function fw(t,e){var r=Ae;Ae|=1;try{return t(e)}finally{Ae=r,Ae===0&&(xd=vt()+500,hy&&vc())}}function $l(t){oc!==null&&oc.tag===0&&(Ae&6)===0&&Cd();var e=Ae;Ae|=1;var r=hi.transition,n=Be;try{if(hi.transition=null,Be=1,t)return t()}finally{Be=n,hi.transition=r,Ae=e,(Ae&6)===0&&vc()}}function pw(){Wn=Od.current,Ze(Od)}function ql(t,e){t.finishedWork=null,t.finishedLanes=0;var r=t.timeoutHandle;if(r!==-1&&(t.timeoutHandle=-1,i9(r)),bt!==null)for(r=bt.return;r!==null;){var n=r;switch($R(n),n.tag){case 1:n=n.type.childContextTypes,n!=null&&Qh();break;case 3:Md(),Ze(nn),Ze(ur),nw();break;case 5:rw(n);break;case 4:Md();break;case 13:Ze(lt);break;case 19:Ze(lt);break;case 10:ZR(n.type._context);break;case 22:case 23:pw()}r=r.return}if(Ut=t,bt=t=fc(t.current,null),$t=Wn=e,Dt=0,np=null,dw=Ty=zl=0,tn=Wf=null,Hl!==null){for(e=0;e<Hl.length;e++)if(r=Hl[e],n=r.interleaved,n!==null){r.interleaved=null;var i=n.next,o=r.pending;if(o!==null){var a=o.next;o.next=i,n.next=a}r.pending=n}Hl=null}return t}function DW(t,e){do{var r=bt;try{if(XR(),kh.current=oy,iy){for(var n=ut.memoizedState;n!==null;){var i=n.queue;i!==null&&(i.pending=null),n=n.next}iy=!1}if(Yl=0,Ht=Nt=ut=null,Bf=!1,ep=0,uw.current=null,r===null||r.return===null){Dt=1,np=e,bt=null;break}e:{var o=t,a=r.return,s=r,c=e;if(e=$t,s.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){var l=c,u=s,m=u.tag;if((u.mode&1)===0&&(m===0||m===11||m===15)){var f=u.alternate;f?(u.updateQueue=f.updateQueue,u.memoizedState=f.memoizedState,u.lanes=f.lanes):(u.updateQueue=null,u.memoizedState=null)}var g=R1(a);if(g!==null){g.flags&=-257,w1(g,a,s,o,e),g.mode&1&&A1(o,l,e),e=g,c=l;var h=e.updateQueue;if(h===null){var y=new Set;y.add(c),e.updateQueue=y}else h.add(c);break e}else{if((e&1)===0){A1(o,l,e),gw();break e}c=Error(D(426))}}else if(it&&s.mode&1){var _=R1(a);if(_!==null){(_.flags&65536)===0&&(_.flags|=256),w1(_,a,s,o,e),KR(kd(c,s));break e}}o=c=kd(c,s),Dt!==4&&(Dt=2),Wf===null?Wf=[o]:Wf.push(o),o=a;do{switch(o.tag){case 3:o.flags|=65536,e&=-e,o.lanes|=e;var v=pW(o,c,e);T1(o,v);break e;case 1:s=c;var E=o.type,T=o.stateNode;if((o.flags&128)===0&&(typeof E.getDerivedStateFromError=="function"||T!==null&&typeof T.componentDidCatch=="function"&&(dc===null||!dc.has(T)))){o.flags|=65536,e&=-e,o.lanes|=e;var O=gW(o,s,e);T1(o,O);break e}}o=o.return}while(o!==null)}MW(r)}catch(R){e=R,bt===r&&r!==null&&(bt=r=r.return);continue}break}while(!0)}function PW(){var t=ay.current;return ay.current=oy,t===null?oy:t}function gw(){(Dt===0||Dt===3||Dt===2)&&(Dt=4),Ut===null||(zl&268435455)===0&&(Ty&268435455)===0||nc(Ut,$t)}function ly(t,e){var r=Ae;Ae|=2;var n=PW();(Ut!==t||$t!==e)&&(Sa=null,ql(t,e));do try{C9();break}catch(i){DW(t,i)}while(!0);if(XR(),Ae=r,ay.current=n,bt!==null)throw Error(D(261));return Ut=null,$t=0,Dt}function C9(){for(;bt!==null;)LW(bt)}function N9(){for(;bt!==null&&!nX();)LW(bt)}function LW(t){var e=xW(t.alternate,t,Wn);t.memoizedProps=t.pendingProps,e===null?MW(t):bt=e,uw.current=null}function MW(t){var e=t;do{var r=e.alternate;if(t=e.return,(e.flags&32768)===0){if(r=b9(r,e,Wn),r!==null){bt=r;return}}else{if(r=O9(r,e),r!==null){r.flags&=32767,bt=r;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{Dt=6,bt=null;return}}if(e=e.sibling,e!==null){bt=e;return}bt=e=t}while(e!==null);Dt===0&&(Dt=5)}function jl(t,e,r){var n=Be,i=hi.transition;try{hi.transition=null,Be=1,D9(t,e,r,n)}finally{hi.transition=i,Be=n}return null}function D9(t,e,r,n){do Cd();while(oc!==null);if((Ae&6)!==0)throw Error(D(327));r=t.finishedWork;var i=t.finishedLanes;if(r===null)return null;if(t.finishedWork=null,t.finishedLanes=0,r===t.current)throw Error(D(177));t.callbackNode=null,t.callbackPriority=0;var o=r.lanes|r.childLanes;if(fX(t,o),t===Ut&&(bt=Ut=null,$t=0),(r.subtreeFlags&2064)===0&&(r.flags&2064)===0||Nh||(Nh=!0,BW(Gh,function(){return Cd(),null})),o=(r.flags&15990)!==0,(r.subtreeFlags&15990)!==0||o){o=hi.transition,hi.transition=null;var a=Be;Be=1;var s=Ae;Ae|=4,uw.current=null,S9(t,r),wW(r,t),JX(sR),Yh=!!aR,sR=aR=null,t.current=r,A9(r,t,i),iX(),Ae=s,Be=a,hi.transition=o}else t.current=r;if(Nh&&(Nh=!1,oc=t,cy=i),o=t.pendingLanes,o===0&&(dc=null),sX(r.stateNode,n),an(t,vt()),e!==null)for(n=t.onRecoverableError,r=0;r<e.length;r++)i=e[r],n(i.value,{componentStack:i.stack,digest:i.digest});if(sy)throw sy=!1,t=RR,RR=null,t;return(cy&1)!==0&&t.tag!==0&&Cd(),o=t.pendingLanes,(o&1)!==0?t===wR?Hf++:(Hf=0,wR=t):Hf=0,vc(),null}function Cd(){if(oc!==null){var t=pj(cy),e=hi.transition,r=Be;try{if(hi.transition=null,Be=16>t?16:t,oc===null)var n=!1;else{if(t=oc,oc=null,cy=0,(Ae&6)!==0)throw Error(D(331));var i=Ae;for(Ae|=4,$=t.current;$!==null;){var o=$,a=o.child;if(($.flags&16)!==0){var s=o.deletions;if(s!==null){for(var c=0;c<s.length;c++){var l=s[c];for($=l;$!==null;){var u=$;switch(u.tag){case 0:case 11:case 15:jf(8,u,o)}var m=u.child;if(m!==null)m.return=u,$=m;else for(;$!==null;){u=$;var f=u.sibling,g=u.return;if(SW(u),u===l){$=null;break}if(f!==null){f.return=g,$=f;break}$=g}}}var h=o.alternate;if(h!==null){var y=h.child;if(y!==null){h.child=null;do{var _=y.sibling;y.sibling=null,y=_}while(y!==null)}}$=o}}if((o.subtreeFlags&2064)!==0&&a!==null)a.return=o,$=a;else e:for(;$!==null;){if(o=$,(o.flags&2048)!==0)switch(o.tag){case 0:case 11:case 15:jf(9,o,o.return)}var v=o.sibling;if(v!==null){v.return=o.return,$=v;break e}$=o.return}}var E=t.current;for($=E;$!==null;){a=$;var T=a.child;if((a.subtreeFlags&2064)!==0&&T!==null)T.return=a,$=T;else e:for(a=E;$!==null;){if(s=$,(s.flags&2048)!==0)try{switch(s.tag){case 0:case 11:case 15:Ey(9,s)}}catch(R){pt(s,s.return,R)}if(s===a){$=null;break e}var O=s.sibling;if(O!==null){O.return=s.return,$=O;break e}$=s.return}}if(Ae=i,vc(),Bo&&typeof Bo.onPostCommitFiberRoot=="function")try{Bo.onPostCommitFiberRoot(dy,t)}catch{}n=!0}return n}finally{Be=r,hi.transition=e}}return!1}function U1(t,e,r){e=kd(r,e),e=pW(t,e,1),t=uc(t,e,1),e=Rr(),t!==null&&(ip(t,1,e),an(t,e))}function pt(t,e,r){if(t.tag===3)U1(t,t,r);else for(;e!==null;){if(e.tag===3){U1(e,t,r);break}else if(e.tag===1){var n=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof n.componentDidCatch=="function"&&(dc===null||!dc.has(n))){t=kd(r,t),t=gW(e,t,1),e=uc(e,t,1),t=Rr(),e!==null&&(ip(e,1,t),an(e,t));break}}e=e.return}}function P9(t,e,r){var n=t.pingCache;n!==null&&n.delete(e),e=Rr(),t.pingedLanes|=t.suspendedLanes&r,Ut===t&&($t&r)===r&&(Dt===4||Dt===3&&($t&130023424)===$t&&500>vt()-mw?ql(t,0):dw|=r),an(t,e)}function kW(t,e){e===0&&((t.mode&1)===0?e=1:(e=hh,hh<<=1,(hh&130023424)===0&&(hh=4194304)));var r=Rr();t=Pa(t,e),t!==null&&(ip(t,e,r),an(t,r))}function L9(t){var e=t.memoizedState,r=0;e!==null&&(r=e.retryLane),kW(t,r)}function M9(t,e){var r=0;switch(t.tag){case 13:var n=t.stateNode,i=t.memoizedState;i!==null&&(r=i.retryLane);break;case 19:n=t.stateNode;break;default:throw Error(D(314))}n!==null&&n.delete(e),kW(t,r)}var xW;xW=function(t,e,r){if(t!==null)if(t.memoizedProps!==e.pendingProps||nn.current)rn=!0;else{if((t.lanes&r)===0&&(e.flags&128)===0)return rn=!1,_9(t,e,r);rn=(t.flags&131072)!==0}else rn=!1,it&&(e.flags&1048576)!==0&&Hj(e,Jh,e.index);switch(e.lanes=0,e.tag){case 2:var n=e.type;Bh(t,e),t=e.pendingProps;var i=Dd(e,ur.current);wd(e,r),i=ow(null,e,n,t,i,r);var o=aw();return e.flags|=1,typeof i=="object"&&i!==null&&typeof i.render=="function"&&i.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,on(n)?(o=!0,Xh(e)):o=!1,e.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,ew(e),i.updater=vy,e.stateNode=i,i._reactInternals=e,hR(e,n,t,r),e=ER(null,e,n,!0,o,r)):(e.tag=0,it&&o&&zR(e),Ar(null,e,i,r),e=e.child),e;case 16:n=e.elementType;e:{switch(Bh(t,e),t=e.pendingProps,i=n._init,n=i(n._payload),e.type=n,i=e.tag=x9(n),t=Hi(n,t),i){case 0:e=vR(null,e,n,t,r);break e;case 1:e=D1(null,e,n,t,r);break e;case 11:e=C1(null,e,n,t,r);break e;case 14:e=N1(null,e,n,Hi(n.type,t),r);break e}throw Error(D(306,n,""))}return e;case 0:return n=e.type,i=e.pendingProps,i=e.elementType===n?i:Hi(n,i),vR(t,e,n,i,r);case 1:return n=e.type,i=e.pendingProps,i=e.elementType===n?i:Hi(n,i),D1(t,e,n,i,r);case 3:e:{if(EW(e),t===null)throw Error(D(387));n=e.pendingProps,o=e.memoizedState,i=o.element,Yj(t,e),ry(e,n,null,r);var a=e.memoizedState;if(n=a.element,o.isDehydrated)if(o={element:n,isDehydrated:!1,cache:a.cache,pendingSuspenseBoundaries:a.pendingSuspenseBoundaries,transitions:a.transitions},e.updateQueue.baseState=o,e.memoizedState=o,e.flags&256){i=kd(Error(D(423)),e),e=P1(t,e,n,r,i);break e}else if(n!==i){i=kd(Error(D(424)),e),e=P1(t,e,n,r,i);break e}else for(Hn=lc(e.stateNode.containerInfo.firstChild),Un=e,it=!0,qi=null,r=Gj(e,null,n,r),e.child=r;r;)r.flags=r.flags&-3|4096,r=r.sibling;else{if(Pd(),n===i){e=La(t,e,r);break e}Ar(t,e,n,r)}e=e.child}return e;case 5:return zj(e),t===null&&fR(e),n=e.type,i=e.pendingProps,o=t!==null?t.memoizedProps:null,a=i.children,cR(n,i)?a=null:o!==null&&cR(n,o)&&(e.flags|=32),vW(t,e),Ar(t,e,a,r),e.child;case 6:return t===null&&fR(e),null;case 13:return TW(t,e,r);case 4:return tw(e,e.stateNode.containerInfo),n=e.pendingProps,t===null?e.child=Ld(e,null,n,r):Ar(t,e,n,r),e.child;case 11:return n=e.type,i=e.pendingProps,i=e.elementType===n?i:Hi(n,i),C1(t,e,n,i,r);case 7:return Ar(t,e,e.pendingProps,r),e.child;case 8:return Ar(t,e,e.pendingProps.children,r),e.child;case 12:return Ar(t,e,e.pendingProps.children,r),e.child;case 10:e:{if(n=e.type._context,i=e.pendingProps,o=e.memoizedProps,a=i.value,Ye(ey,n._currentValue),n._currentValue=a,o!==null)if(Vi(o.value,a)){if(o.children===i.children&&!nn.current){e=La(t,e,r);break e}}else for(o=e.child,o!==null&&(o.return=e);o!==null;){var s=o.dependencies;if(s!==null){a=o.child;for(var c=s.firstContext;c!==null;){if(c.context===n){if(o.tag===1){c=Ca(-1,r&-r),c.tag=2;var l=o.updateQueue;if(l!==null){l=l.shared;var u=l.pending;u===null?c.next=c:(c.next=u.next,u.next=c),l.pending=c}}o.lanes|=r,c=o.alternate,c!==null&&(c.lanes|=r),pR(o.return,r,e),s.lanes|=r;break}c=c.next}}else if(o.tag===10)a=o.type===e.type?null:o.child;else if(o.tag===18){if(a=o.return,a===null)throw Error(D(341));a.lanes|=r,s=a.alternate,s!==null&&(s.lanes|=r),pR(a,r,e),a=o.sibling}else a=o.child;if(a!==null)a.return=o;else for(a=o;a!==null;){if(a===e){a=null;break}if(o=a.sibling,o!==null){o.return=a.return,a=o;break}a=a.return}o=a}Ar(t,e,i.children,r),e=e.child}return e;case 9:return i=e.type,n=e.pendingProps.children,wd(e,r),i=yi(i),n=n(i),e.flags|=1,Ar(t,e,n,r),e.child;case 14:return n=e.type,i=Hi(n,e.pendingProps),i=Hi(n.type,i),N1(t,e,n,i,r);case 15:return hW(t,e,e.type,e.pendingProps,r);case 17:return n=e.type,i=e.pendingProps,i=e.elementType===n?i:Hi(n,i),Bh(t,e),e.tag=1,on(n)?(t=!0,Xh(e)):t=!1,wd(e,r),fW(e,n,i),hR(e,n,i,r),ER(null,e,n,!0,t,r);case 19:return _W(t,e,r);case 22:return yW(t,e,r)}throw Error(D(156,e.tag))};function BW(t,e){return uj(t,e)}function k9(t,e,r,n){this.tag=t,this.key=r,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function gi(t,e,r,n){return new k9(t,e,r,n)}function hw(t){return t=t.prototype,!(!t||!t.isReactComponent)}function x9(t){if(typeof t=="function")return hw(t)?1:0;if(t!=null){if(t=t.$$typeof,t===kR)return 11;if(t===xR)return 14}return 2}function fc(t,e){var r=t.alternate;return r===null?(r=gi(t.tag,e,t.key,t.mode),r.elementType=t.elementType,r.type=t.type,r.stateNode=t.stateNode,r.alternate=t,t.alternate=r):(r.pendingProps=e,r.type=t.type,r.flags=0,r.subtreeFlags=0,r.deletions=null),r.flags=t.flags&14680064,r.childLanes=t.childLanes,r.lanes=t.lanes,r.child=t.child,r.memoizedProps=t.memoizedProps,r.memoizedState=t.memoizedState,r.updateQueue=t.updateQueue,e=t.dependencies,r.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},r.sibling=t.sibling,r.index=t.index,r.ref=t.ref,r}function Hh(t,e,r,n,i,o){var a=2;if(n=t,typeof t=="function")hw(t)&&(a=1);else if(typeof t=="string")a=5;else e:switch(t){case fd:return Fl(r.children,i,o,e);case MR:a=8,i|=8;break;case HA:return t=gi(12,r,e,i|2),t.elementType=HA,t.lanes=o,t;case UA:return t=gi(13,r,e,i),t.elementType=UA,t.lanes=o,t;case qA:return t=gi(19,r,e,i),t.elementType=qA,t.lanes=o,t;case z1:return _y(r,i,o,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case V1:a=10;break e;case Y1:a=9;break e;case kR:a=11;break e;case xR:a=14;break e;case ec:a=16,n=null;break e}throw Error(D(130,t==null?t:typeof t,""))}return e=gi(a,r,e,i),e.elementType=t,e.type=n,e.lanes=o,e}function Fl(t,e,r,n){return t=gi(7,t,n,e),t.lanes=r,t}function _y(t,e,r,n){return t=gi(22,t,n,e),t.elementType=z1,t.lanes=r,t.stateNode={isHidden:!1},t}function BA(t,e,r){return t=gi(6,t,null,e),t.lanes=r,t}function jA(t,e,r){return e=gi(4,t.children!==null?t.children:[],t.key,e),e.lanes=r,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function B9(t,e,r,n,i){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=_A(0),this.expirationTimes=_A(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=_A(0),this.identifierPrefix=n,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function yw(t,e,r,n,i,o,a,s,c){return t=new B9(t,e,r,s,c),e===1?(e=1,o===!0&&(e|=8)):e=0,o=gi(3,null,null,e),t.current=o,o.stateNode=t,o.memoizedState={element:n,isDehydrated:r,cache:null,transitions:null,pendingSuspenseBoundaries:null},ew(o),t}function j9(t,e,r){var n=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:md,key:n==null?null:""+n,children:t,containerInfo:e,implementation:r}}function jW(t){if(!t)return gc;t=t._reactInternals;e:{if(Ql(t)!==t||t.tag!==1)throw Error(D(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(on(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(D(171))}if(t.tag===1){var r=t.type;if(on(r))return jj(t,r,e)}return e}function WW(t,e,r,n,i,o,a,s,c){return t=yw(r,n,!0,t,i,o,a,s,c),t.context=jW(null),r=t.current,n=Rr(),i=mc(r),o=Ca(n,i),o.callback=e??null,uc(r,o,i),t.current.lanes=i,ip(t,i,n),an(t,n),t}function by(t,e,r,n){var i=e.current,o=Rr(),a=mc(i);return r=jW(r),e.context===null?e.context=r:e.pendingContext=r,e=Ca(o,a),e.payload={element:t},n=n===void 0?null:n,n!==null&&(e.callback=n),t=uc(i,e,a),t!==null&&(Gi(t,i,a,o),Mh(t,i,a)),a}function uy(t){return t=t.current,t.child?(t.child.tag===5,t.child.stateNode):null}function q1(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var r=t.retryLane;t.retryLane=r!==0&&r<e?r:e}}function vw(t,e){q1(t,e),(t=t.alternate)&&q1(t,e)}function W9(){return null}var HW=typeof reportError=="function"?reportError:function(t){console.error(t)};function Ew(t){this._internalRoot=t}Oy.prototype.render=Ew.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(D(409));by(t,e,null,null)};Oy.prototype.unmount=Ew.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;$l(function(){by(null,t,null,null)}),e[Da]=null}};function Oy(t){this._internalRoot=t}Oy.prototype.unstable_scheduleHydration=function(t){if(t){var e=yj();t={blockedOn:null,target:t,priority:e};for(var r=0;r<rc.length&&e!==0&&e<rc[r].priority;r++);rc.splice(r,0,t),r===0&&Ej(t)}};function Tw(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function Iy(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function F1(){}function H9(t,e,r,n,i){if(i){if(typeof n=="function"){var o=n;n=function(){var l=uy(a);o.call(l)}}var a=WW(e,n,t,0,null,!1,!1,"",F1);return t._reactRootContainer=a,t[Da]=a.current,Kf(t.nodeType===8?t.parentNode:t),$l(),a}for(;i=t.lastChild;)t.removeChild(i);if(typeof n=="function"){var s=n;n=function(){var l=uy(c);s.call(l)}}var c=yw(t,0,!1,null,null,!1,!1,"",F1);return t._reactRootContainer=c,t[Da]=c.current,Kf(t.nodeType===8?t.parentNode:t),$l(function(){by(e,c,r,n)}),c}function Sy(t,e,r,n,i){var o=r._reactRootContainer;if(o){var a=o;if(typeof i=="function"){var s=i;i=function(){var c=uy(a);s.call(c)}}by(e,a,t,i)}else a=H9(r,e,t,i,n);return uy(a)}gj=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var r=Nf(e.pendingLanes);r!==0&&(WR(e,r|1),an(e,vt()),(Ae&6)===0&&(xd=vt()+500,vc()))}break;case 13:$l(function(){var n=Pa(t,1);if(n!==null){var i=Rr();Gi(n,t,1,i)}}),vw(t,1)}};HR=function(t){if(t.tag===13){var e=Pa(t,134217728);if(e!==null){var r=Rr();Gi(e,t,134217728,r)}vw(t,134217728)}};hj=function(t){if(t.tag===13){var e=mc(t),r=Pa(t,e);if(r!==null){var n=Rr();Gi(r,t,e,n)}vw(t,e)}};yj=function(){return Be};vj=function(t,e){var r=Be;try{return Be=t,e()}finally{Be=r}};ZA=function(t,e,r){switch(e){case"input":if(VA(t,r),e=r.name,r.type==="radio"&&e!=null){for(r=t;r.parentNode;)r=r.parentNode;for(r=r.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<r.length;e++){var n=r[e];if(n!==t&&n.form===t.form){var i=gy(n);if(!i)throw Error(D(90));K1(n),VA(n,i)}}}break;case"textarea":X1(t,r);break;case"select":e=r.value,e!=null&&Id(t,!!r.multiple,e,!1)}};ij=fw;oj=$l;var U9={usingClientEntryPoint:!1,Events:[ap,yd,gy,rj,nj,fw]},Af={findFiberByHostInstance:Wl,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},q9={bundleType:Af.bundleType,version:Af.version,rendererPackageName:Af.rendererPackageName,rendererConfig:Af.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Ma.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=cj(t),t===null?null:t.stateNode},findFiberByHostInstance:Af.findFiberByHostInstance||W9,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"&&(Rf=__REACT_DEVTOOLS_GLOBAL_HOOK__,!Rf.isDisabled&&Rf.supportsFiber))try{dy=Rf.inject(q9),Bo=Rf}catch{}var Rf;Gn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=U9;Gn.createPortal=function(t,e){var r=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Tw(e))throw Error(D(200));return j9(t,e,null,r)};Gn.createRoot=function(t,e){if(!Tw(t))throw Error(D(299));var r=!1,n="",i=HW;return e!=null&&(e.unstable_strictMode===!0&&(r=!0),e.identifierPrefix!==void 0&&(n=e.identifierPrefix),e.onRecoverableError!==void 0&&(i=e.onRecoverableError)),e=yw(t,1,!1,null,null,r,!1,n,i),t[Da]=e.current,Kf(t.nodeType===8?t.parentNode:t),new Ew(e)};Gn.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(D(188)):(t=Object.keys(t).join(","),Error(D(268,t)));return t=cj(e),t=t===null?null:t.stateNode,t};Gn.flushSync=function(t){return $l(t)};Gn.hydrate=function(t,e,r){if(!Iy(e))throw Error(D(200));return Sy(null,t,e,!0,r)};Gn.hydrateRoot=function(t,e,r){if(!Tw(t))throw Error(D(405));var n=r!=null&&r.hydratedSources||null,i=!1,o="",a=HW;if(r!=null&&(r.unstable_strictMode===!0&&(i=!0),r.identifierPrefix!==void 0&&(o=r.identifierPrefix),r.onRecoverableError!==void 0&&(a=r.onRecoverableError)),e=WW(e,null,t,1,r??null,i,!1,o,a),t[Da]=e.current,Kf(t),n)for(t=0;t<n.length;t++)r=n[t],i=r._getVersion,i=i(r._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[r,i]:e.mutableSourceEagerHydrationData.push(r,i);return new Oy(e)};Gn.render=function(t,e,r){if(!Iy(e))throw Error(D(200));return Sy(null,t,e,!1,r)};Gn.unmountComponentAtNode=function(t){if(!Iy(t))throw Error(D(40));return t._reactRootContainer?($l(function(){Sy(null,null,t,!1,function(){t._reactRootContainer=null,t[Da]=null})}),!0):!1};Gn.unstable_batchedUpdates=fw;Gn.unstable_renderSubtreeIntoContainer=function(t,e,r,n){if(!Iy(r))throw Error(D(200));if(t==null||t._reactInternals===void 0)throw Error(D(38));return Sy(t,e,r,!1,n)};Gn.version="18.3.1-next-f1338f8080-20240426"});var GW=p((NTe,FW)=>{"use strict";function qW(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(qW)}catch(t){console.error(t)}}qW(),FW.exports=UW()});var YW=p(_w=>{"use strict";var VW=GW();_w.createRoot=VW.createRoot,_w.hydrateRoot=VW.hydrateRoot;var DTe});var $W=p(zW=>{"use strict";Object.defineProperty(zW,"__esModule",{value:!0})});var KW=p(Wd=>{"use strict";Object.defineProperty(Wd,"__esModule",{value:!0});Wd.DEFAULT_NARRATIVE_SETTINGS=void 0;Wd.buildNarrativeSettings=F9;Wd.DEFAULT_NARRATIVE_SETTINGS={perspective:"2nd",tense:"present"};function F9(t){return{...Wd.DEFAULT_NARRATIVE_SETTINGS,...t||{},perspective:t?.perspective||"2nd"}}});var bw=p(Hd=>{"use strict";Object.defineProperty(Hd,"__esModule",{value:!0});Hd.buildNarrativeSettings=Hd.DEFAULT_NARRATIVE_SETTINGS=void 0;var QW=KW();Object.defineProperty(Hd,"DEFAULT_NARRATIVE_SETTINGS",{enumerable:!0,get:function(){return QW.DEFAULT_NARRATIVE_SETTINGS}});Object.defineProperty(Hd,"buildNarrativeSettings",{enumerable:!0,get:function(){return QW.buildNarrativeSettings}})});var XW=p(Ay=>{"use strict";Object.defineProperty(Ay,"__esModule",{value:!0});Ay.EventEmitter=void 0;var Ow=class{constructor(){d(this,"handlers",new Map)}on(e,r){let n=this.handlers.get(e)||[];n.push(r),this.handlers.set(e,n)}off(e,r){let n=this.handlers.get(e);if(n){let i=n.indexOf(r);i!==-1&&n.splice(i,1)}}emit(e){let r=[],n=this.handlers.get(e.type)||[];for(let i of n){let o=i(e);o&&r.push(...o)}return r}clear(e){e?this.handlers.delete(e):this.handlers.clear()}listenerCount(e){return this.handlers.get(e)?.length||0}};Ay.EventEmitter=Ow});var ZW=p(cp=>{"use strict";Object.defineProperty(cp,"__esModule",{value:!0});cp.StoryWithEvents=void 0;cp.validateStoryConfig=V9;var G9=XW(),Iw=class{constructor(e){d(this,"config");d(this,"eventEmitter");this.config=e,this.eventEmitter=new G9.EventEmitter}on(e,r){this.eventEmitter.on(e,r)}off(e,r){this.eventEmitter.off(e,r)}emit(e){return this.eventEmitter.emit(e)}initializeWorld(e){throw new Error("initializeWorld must be implemented")}createPlayer(e){throw new Error("createPlayer must be implemented")}};cp.StoryWithEvents=Iw;function V9(t){if(!t.id||!t.title||!t.author||!t.version)throw new Error("Missing required story configuration fields");if(!/^\d+\.\d+\.\d+$/.test(t.version))throw new Error("Invalid version format. Must be semantic version (e.g., 1.0.0)")}});var lp=p(Ud=>{"use strict";Object.defineProperty(Ud,"__esModule",{value:!0});Ud.eventSequencer=Ud.EventSequenceUtils=void 0;var Sw=class{constructor(){d(this,"counter",Date.now())}next(){return++this.counter}resetTurn(e){}sequence(e,r){return{...e,sequence:this.next(),timestamp:new Date,turn:r,scope:"turn"}}sequenceAll(e,r){return e.map(n=>this.sequence(n,r))}},Aw=class{static sort(e){return[...e].sort((r,n)=>r.sequence-n.sequence)}static filterByType(e,r){return e.filter(n=>n.type===r)}static filterByTurn(e,r){return e.filter(n=>n.turn===r)}static filterByScope(e,r){return e.filter(n=>n.scope===r)}static groupByType(e){let r={};for(let n of e)r[n.type]||(r[n.type]=[]),r[n.type].push(n);return r}static groupByTurn(e){let r={};for(let n of e)r[n.turn]||(r[n.turn]=[]),r[n.turn].push(n);return r}static getLatestByType(e,r){let n=this.filterByType(e,r);if(n.length!==0)return n.reduce((i,o)=>o.sequence>i.sequence?o:i)}static countByType(e){let r={};for(let n of e)r[n.type]=(r[n.type]||0)+1;return r}static getInRange(e,r,n,i=!0){return i?e.filter(o=>o.sequence>=r&&o.sequence<=n):e.filter(o=>o.sequence>r&&o.sequence<n)}};Ud.EventSequenceUtils=Aw;Ud.eventSequencer=new Sw});var eH=p(JW=>{"use strict";Object.defineProperty(JW,"__esModule",{value:!0})});var rH=p(tH=>{"use strict";Object.defineProperty(tH,"__esModule",{value:!0})});var iH=p(nH=>{"use strict";Object.defineProperty(nH,"__esModule",{value:!0})});var oH=p(qd=>{"use strict";Object.defineProperty(qd,"__esModule",{value:!0});qd.Result=void 0;qd.Result={ok(t){return{success:!0,value:t}},fail(t){return{success:!1,error:t}},isOk(t){return t.success},isFail(t){return!t.success},map(t,e){return t.success?qd.Result.ok(e(t.value)):t},mapError(t,e){return t.success?t:qd.Result.fail(e(t.error))},flatMap(t,e){return t.success?e(t.value):t},unwrap(t){if(t.success)return t.value;throw t.error},unwrapOr(t,e){return t.success?t.value:e}}});var sH=p(aH=>{"use strict";Object.defineProperty(aH,"__esModule",{value:!0})});var cH=p(Yi=>{"use strict";var Y9=Yi&&Yi.__createBinding||(Object.create?(function(t,e,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}):(function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]})),up=Yi&&Yi.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&Y9(e,t,r)};Object.defineProperty(Yi,"__esModule",{value:!0});up(eH(),Yi);up(rH(),Yi);up(iH(),Yi);up(oH(),Yi);up(sH(),Yi)});var uH=p(dp=>{"use strict";Object.defineProperty(dp,"__esModule",{value:!0});dp.generateIfid=$9;dp.validateIfid=lH;dp.normalizeIfid=K9;var z9=/^[A-Z0-9-]{8,63}$/;function $9(){return globalThis.crypto.randomUUID().toUpperCase()}function lH(t){return z9.test(t)}function K9(t){let e=t.toUpperCase();return lH(e)?e:null}});var dH=p(Ec=>{"use strict";Object.defineProperty(Ec,"__esModule",{value:!0});Ec.normalizeIfid=Ec.validateIfid=Ec.generateIfid=void 0;var Rw=uH();Object.defineProperty(Ec,"generateIfid",{enumerable:!0,get:function(){return Rw.generateIfid}});Object.defineProperty(Ec,"validateIfid",{enumerable:!0,get:function(){return Rw.validateIfid}});Object.defineProperty(Ec,"normalizeIfid",{enumerable:!0,get:function(){return Rw.normalizeIfid}})});var fH=p(mH=>{"use strict";Object.defineProperty(mH,"__esModule",{value:!0})});var gH=p(pH=>{"use strict";Object.defineProperty(pH,"__esModule",{value:!0})});var ww=p(Tc=>{"use strict";Object.defineProperty(Tc,"__esModule",{value:!0});Tc.EventCategories=Tc.StandardEventTags=Tc.StandardEventTypes=void 0;Tc.StandardEventTypes={ACTION:"action",SYSTEM:"system",NARRATIVE:"narrative",ERROR:"error"};Tc.StandardEventTags={SUCCESS:"success",FAILURE:"failure",INFO:"info",WARNING:"warning",ERROR:"error"};Tc.EventCategories={ACTION:"action",SYSTEM:"system",NARRATIVE:"narrative"}});var hH=p(Fd=>{"use strict";Object.defineProperty(Fd,"__esModule",{value:!0});Fd.Subsystems=void 0;Fd.createSystemEvent=Q9;Fd.isSystemEvent=J9;Fd.Subsystems={PARSER:"parser",VALIDATOR:"validator",EXECUTOR:"executor",WORLD_MODEL:"world-model",TEXT_SERVICE:"text-service",EVENT_PROCESSOR:"event-processor",RULE_ENGINE:"rule-engine"};function Q9(t,e,r,n){return{id:Z9(),timestamp:Date.now(),subsystem:t,type:e,data:r,...n}}var X9=0;function Z9(){return`sys_${Date.now()}_${++X9}`}function J9(t){return typeof t=="object"&&t!==null&&"id"in t&&"timestamp"in t&&"subsystem"in t&&"type"in t&&"data"in t}});var yH=p(ee=>{"use strict";Object.defineProperty(ee,"__esModule",{value:!0});ee.PlatformEventType=void 0;ee.isPlatformEvent=Cw;ee.isPlatformRequestEvent=e7;ee.isPlatformCompletionEvent=t7;ee.createPlatformEvent=sn;ee.createSaveRequestedEvent=r7;ee.createRestoreRequestedEvent=n7;ee.createQuitRequestedEvent=i7;ee.createRestartRequestedEvent=o7;ee.createSaveCompletedEvent=a7;ee.createRestoreCompletedEvent=s7;ee.createQuitConfirmedEvent=c7;ee.createQuitCancelledEvent=l7;ee.createRestartCompletedEvent=u7;ee.createUndoRequestedEvent=d7;ee.createUndoCompletedEvent=m7;ee.createAgainRequestedEvent=f7;ee.createAgainFailedEvent=p7;ee.PlatformEventType={SAVE_REQUESTED:"platform.save_requested",RESTORE_REQUESTED:"platform.restore_requested",QUIT_REQUESTED:"platform.quit_requested",RESTART_REQUESTED:"platform.restart_requested",UNDO_REQUESTED:"platform.undo_requested",AGAIN_REQUESTED:"platform.again_requested",SAVE_COMPLETED:"platform.save_completed",RESTORE_COMPLETED:"platform.restore_completed",QUIT_CONFIRMED:"platform.quit_confirmed",RESTART_COMPLETED:"platform.restart_completed",UNDO_COMPLETED:"platform.undo_completed",SAVE_FAILED:"platform.save_failed",RESTORE_FAILED:"platform.restore_failed",QUIT_CANCELLED:"platform.quit_cancelled",RESTART_CANCELLED:"platform.restart_cancelled",UNDO_FAILED:"platform.undo_failed",AGAIN_FAILED:"platform.again_failed"};function Cw(t){return"requiresClientAction"in t&&t.requiresClientAction===!0}function e7(t){return Cw(t)&&(t.type===ee.PlatformEventType.SAVE_REQUESTED||t.type===ee.PlatformEventType.RESTORE_REQUESTED||t.type===ee.PlatformEventType.QUIT_REQUESTED||t.type===ee.PlatformEventType.RESTART_REQUESTED||t.type===ee.PlatformEventType.UNDO_REQUESTED||t.type===ee.PlatformEventType.AGAIN_REQUESTED)}function t7(t){return Cw(t)&&(t.type===ee.PlatformEventType.SAVE_COMPLETED||t.type===ee.PlatformEventType.RESTORE_COMPLETED||t.type===ee.PlatformEventType.QUIT_CONFIRMED||t.type===ee.PlatformEventType.RESTART_COMPLETED||t.type===ee.PlatformEventType.UNDO_COMPLETED||t.type===ee.PlatformEventType.SAVE_FAILED||t.type===ee.PlatformEventType.RESTORE_FAILED||t.type===ee.PlatformEventType.QUIT_CANCELLED||t.type===ee.PlatformEventType.RESTART_CANCELLED||t.type===ee.PlatformEventType.UNDO_FAILED||t.type===ee.PlatformEventType.AGAIN_FAILED)}function sn(t,e,r){return{id:`platform-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,type:t,timestamp:Date.now(),requiresClientAction:!0,entities:{},payload:{context:e,...r}}}function r7(t){return sn(ee.PlatformEventType.SAVE_REQUESTED,t)}function n7(t){return sn(ee.PlatformEventType.RESTORE_REQUESTED,t)}function i7(t){return sn(ee.PlatformEventType.QUIT_REQUESTED,t)}function o7(t){return sn(ee.PlatformEventType.RESTART_REQUESTED,t)}function a7(t,e){return sn(t?ee.PlatformEventType.SAVE_COMPLETED:ee.PlatformEventType.SAVE_FAILED,void 0,{success:t,error:e})}function s7(t,e){return sn(t?ee.PlatformEventType.RESTORE_COMPLETED:ee.PlatformEventType.RESTORE_FAILED,void 0,{success:t,error:e})}function c7(){return sn(ee.PlatformEventType.QUIT_CONFIRMED,void 0,{success:!0})}function l7(){return sn(ee.PlatformEventType.QUIT_CANCELLED,void 0,{success:!1})}function u7(t){return sn(t?ee.PlatformEventType.RESTART_COMPLETED:ee.PlatformEventType.RESTART_CANCELLED,void 0,{success:t})}function d7(t){return sn(ee.PlatformEventType.UNDO_REQUESTED,t)}function m7(t,e,r){return sn(t?ee.PlatformEventType.UNDO_COMPLETED:ee.PlatformEventType.UNDO_FAILED,void 0,{success:t,restoredToTurn:e,error:r})}function f7(t){return sn(ee.PlatformEventType.AGAIN_REQUESTED,t)}function p7(t){return sn(ee.PlatformEventType.AGAIN_FAILED,void 0,{success:!1,error:t})}});var vH=p(J=>{"use strict";Object.defineProperty(J,"__esModule",{value:!0});J.GameEventType=void 0;J.isGameEvent=g7;J.isGameStartSequenceEvent=h7;J.isGameEndSequenceEvent=y7;J.createGameEvent=Vn;J.createGameInitializingEvent=E7;J.createGameInitializedEvent=T7;J.createStoryLoadingEvent=_7;J.createStoryLoadedEvent=b7;J.createGameStartingEvent=O7;J.createGameStartedEvent=I7;J.createGameEndingEvent=S7;J.createGameEndedEvent=A7;J.createGameWonEvent=R7;J.createGameLostEvent=w7;J.createGameQuitEvent=C7;J.createGameAbortedEvent=N7;J.isGameStartedEvent=D7;J.isGameEndedEvent=P7;J.isGameWonEvent=L7;J.isGameLostEvent=M7;J.isGameQuitEvent=k7;J.isGameAbortedEvent=x7;J.GameEventType={GAME_INITIALIZING:"game.initializing",GAME_INITIALIZED:"game.initialized",STORY_LOADING:"game.story_loading",STORY_LOADED:"game.story_loaded",GAME_STARTING:"game.starting",GAME_STARTED:"game.started",GAME_ENDING:"game.ending",GAME_ENDED:"game.ended",GAME_WON:"game.won",GAME_LOST:"game.lost",GAME_QUIT:"game.quit",GAME_ABORTED:"game.aborted",SESSION_SAVING:"game.session_saving",SESSION_SAVED:"game.session_saved",SESSION_RESTORING:"game.session_restoring",SESSION_RESTORED:"game.session_restored",INITIALIZATION_FAILED:"game.initialization_failed",STORY_LOAD_FAILED:"game.story_load_failed",FATAL_ERROR:"game.fatal_error"};function g7(t){return Object.values(J.GameEventType).includes(t.type)}function h7(t){return t.type===J.GameEventType.GAME_INITIALIZING||t.type===J.GameEventType.GAME_INITIALIZED||t.type===J.GameEventType.STORY_LOADING||t.type===J.GameEventType.STORY_LOADED||t.type===J.GameEventType.GAME_STARTING||t.type===J.GameEventType.GAME_STARTED}function y7(t){return t.type===J.GameEventType.GAME_ENDING||t.type===J.GameEventType.GAME_ENDED||t.type===J.GameEventType.GAME_WON||t.type===J.GameEventType.GAME_LOST||t.type===J.GameEventType.GAME_QUIT||t.type===J.GameEventType.GAME_ABORTED}function v7(){return`game-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}function Vn(t,e){return{id:v7(),type:t,timestamp:Date.now(),entities:{},data:e||{}}}function E7(){return Vn(J.GameEventType.GAME_INITIALIZING,{gameState:"initializing"})}function T7(){return Vn(J.GameEventType.GAME_INITIALIZED,{gameState:"ready"})}function _7(t){return Vn(J.GameEventType.STORY_LOADING,{story:{id:t}})}function b7(t){return Vn(J.GameEventType.STORY_LOADED,{story:t,gameState:"ready"})}function O7(t){return Vn(J.GameEventType.GAME_STARTING,{story:t,gameState:"ready"})}function I7(t,e,r,n){return Vn(J.GameEventType.GAME_STARTED,{story:t,engineVersion:r,clientVersion:n,gameState:"running",session:{startTime:e||Date.now(),turns:0,moves:0}})}function S7(t,e){return Vn(J.GameEventType.GAME_ENDING,{gameState:"ending",session:e,ending:{reason:t}})}function A7(t,e,r){return Vn(J.GameEventType.GAME_ENDED,{gameState:"ended",session:{...e,endTime:Date.now()},ending:{...r,type:t}})}function R7(t,e){return Vn(J.GameEventType.GAME_WON,{gameState:"ended",session:{...t,endTime:Date.now()},ending:{...e,type:"victory"}})}function w7(t,e){return Vn(J.GameEventType.GAME_LOST,{gameState:"ended",session:{...e,endTime:Date.now()},ending:{type:"defeat",reason:t}})}function C7(t){return Vn(J.GameEventType.GAME_QUIT,{gameState:"ended",session:{...t,endTime:Date.now()},ending:{type:"quit",reason:"Player quit"}})}function N7(t,e){return Vn(J.GameEventType.GAME_ABORTED,{gameState:"ended",session:{...e,endTime:Date.now()},ending:{type:"abort",reason:t},error:{message:t}})}function D7(t){return t.type===J.GameEventType.GAME_STARTED}function P7(t){return t.type===J.GameEventType.GAME_ENDED}function L7(t){return t.type===J.GameEventType.GAME_WON}function M7(t){return t.type===J.GameEventType.GAME_LOST}function k7(t){return t.type===J.GameEventType.GAME_QUIT}function x7(t){return t.type===J.GameEventType.GAME_ABORTED}});var TH=p(EH=>{"use strict";Object.defineProperty(EH,"__esModule",{value:!0})});var _H=p(Nw=>{"use strict";Object.defineProperty(Nw,"__esModule",{value:!0});Nw.isKnownEvent=B7;function B7(t){return t.type in{}}});var OH=p(Gd=>{"use strict";Object.defineProperty(Gd,"__esModule",{value:!0});Gd.createTypedEvent=Dw;Gd.createMessageEvent=j7;Gd.createEmptyEvent=W7;Gd.resetEventCounter=H7;var bH=0;function Dw(t,e,r={}){return{id:r.id??`evt-${Date.now()}-${++bH}`,type:t,timestamp:Date.now(),data:e,entities:r.entities??{},tags:r.tags,priority:r.priority,narrate:r.narrate}}function j7(t,e,r,n){let i=`message.${t}`;return Dw(i,{messageId:e,params:r},n)}function W7(t,e){return Dw(t,{},e)}function H7(){bH=0}});var IH=p(ka=>{"use strict";Object.defineProperty(ka,"__esModule",{value:!0});ka.isEventType=U7;ka.hasEventPrefix=q7;ka.getEventData=F7;ka.getEventDataWithDefaults=G7;ka.requireEventData=V7;ka.getEventProperty=Y7;ka.getUntypedEventData=z7;function U7(t,e){return t.type===e}function q7(t,e){return t.type.startsWith(e)}function F7(t,e){if(t.type===e)return t.data}function G7(t,e,r){return t.type===e&&t.data?{...r,...t.data}:r}function V7(t,e){if(t.type!==e)throw new Error(`Expected event type '${e}', got '${t.type}'`);return t.data}function Y7(t,e,r){if(t.type===e&&t.data)return t.data[r]}function z7(t){return t.data&&typeof t.data=="object"?t.data:{}}});var Pw=p(mp=>{"use strict";Object.defineProperty(mp,"__esModule",{value:!0});mp.SimpleEventSource=void 0;mp.createEventSource=$7;var Ry=class{constructor(){d(this,"handlers",[])}emit(e){[...this.handlers].forEach(n=>{try{n(e)}catch(i){console.error("Error in event handler:",i)}})}subscribe(e){return this.handlers.push(e),()=>{let r=this.handlers.indexOf(e);r>-1&&this.handlers.splice(r,1)}}get subscriberCount(){return this.handlers.length}clear(){this.handlers=[]}};mp.SimpleEventSource=Ry;function $7(){return new Ry}});var Cy=p(Vd=>{"use strict";Object.defineProperty(Vd,"__esModule",{value:!0});Vd.SemanticEventSourceImpl=void 0;Vd.createSemanticEventSource=SH;Vd.createEventSource=Q7;var K7=Pw(),wy=class extends K7.SimpleEventSource{constructor(){super();d(this,"events",[]);d(this,"eventEmitter");d(this,"lastProcessedIndex",0);this.eventEmitter=new Lw,this.subscribe(r=>{this.eventEmitter.emit(r)})}addEvent(r){this.events.push(r),this.emit(r)}getAllEvents(){return[...this.events]}getEventsByType(r){return this.events.filter(n=>n.type===r)}getEventsByEntity(r){return this.events.filter(n=>{let i=n.entities;return i.actor===r||i.target===r||i.instrument===r||i.location===r||i.others&&i.others.includes(r)})}getEventsByTag(r){return this.events.filter(n=>n.tags&&n.tags.includes(r))}filter(r){return this.events.filter(r)}clearEvents(){this.events=[]}getEmitter(){return this.eventEmitter}getEventsSince(r){if(!r)return this.getAllEvents();let n=this.events.findIndex(i=>i.id===r);return n===-1?this.getAllEvents():this.events.slice(n+1)}getUnprocessedEvents(){let r=this.events.slice(this.lastProcessedIndex);return this.lastProcessedIndex=this.events.length,r}};Vd.SemanticEventSourceImpl=wy;var Lw=class{constructor(){d(this,"listeners",new Map);d(this,"globalListeners",new Set)}on(e,r){if(e==="*"){this.globalListeners.add(r);return}this.listeners.has(e)||this.listeners.set(e,new Set),this.listeners.get(e).add(r)}off(e,r){if(e==="*"){this.globalListeners.delete(r);return}let n=this.listeners.get(e);n&&(n.delete(r),n.size===0&&this.listeners.delete(e))}emit(e){let r=this.listeners.get(e.type);if(r)for(let n of r)try{n(e)}catch(i){console.error(`Error in event listener for ${e.type}:`,i)}for(let n of this.globalListeners)try{n(e)}catch(i){console.error("Error in global event listener:",i)}}};function SH(){return new wy}function Q7(){return SH()}});var kw=p(Yd=>{"use strict";Object.defineProperty(Yd,"__esModule",{value:!0});Yd.EventSourceImpl=void 0;Yd.createEvent=Z7;Yd.createEventSource=tZ;var X7=Cy();function Z7(t,e,r,n){let i=n?.tags||[],o=n?.priority??0,a=n?.narrate??!0,s=n?{...n}:void 0;s&&(delete s.tags,delete s.priority,delete s.narrate);let c={id:eZ(),type:t,timestamp:Date.now(),entities:r||{},data:e||{},tags:i,priority:o,narrate:a};return s&&Object.keys(s).length>0&&(c.metadata=s),c}var J7=Cy();Object.defineProperty(Yd,"EventSourceImpl",{enumerable:!0,get:function(){return J7.SemanticEventSourceImpl}});var Mw=0;function eZ(){Mw=(Mw+1)%1e4;let e=Math.floor(Math.random()*1e3)+Mw*1e3;return`evt_${Date.now()}_${e}`}function tZ(){return(0,X7.createSemanticEventSource)()}});var Bw=p(je=>{"use strict";var rZ=je&&je.__createBinding||(Object.create?(function(t,e,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}):(function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]})),xa=je&&je.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&rZ(e,t,r)};Object.defineProperty(je,"__esModule",{value:!0});je.createEventSource=je.EventSourceImpl=je.createEvent=je.createSemanticEventSource=je.SemanticEventSourceImpl=je.createGenericEventSource=je.SimpleEventSource=void 0;xa(gH(),je);xa(ww(),je);xa(hH(),je);xa(yH(),je);xa(vH(),je);xa(TH(),je);xa(_H(),je);xa(OH(),je);xa(IH(),je);var AH=Pw();Object.defineProperty(je,"SimpleEventSource",{enumerable:!0,get:function(){return AH.SimpleEventSource}});Object.defineProperty(je,"createGenericEventSource",{enumerable:!0,get:function(){return AH.createEventSource}});var RH=Cy();Object.defineProperty(je,"SemanticEventSourceImpl",{enumerable:!0,get:function(){return RH.SemanticEventSourceImpl}});Object.defineProperty(je,"createSemanticEventSource",{enumerable:!0,get:function(){return RH.createSemanticEventSource}});var xw=kw();Object.defineProperty(je,"createEvent",{enumerable:!0,get:function(){return xw.createEvent}});Object.defineProperty(je,"EventSourceImpl",{enumerable:!0,get:function(){return xw.EventSourceImpl}});Object.defineProperty(je,"createEventSource",{enumerable:!0,get:function(){return xw.createEventSource}})});var CH=p(Ny=>{"use strict";Object.defineProperty(Ny,"__esModule",{value:!0});Ny.ExtensionType=void 0;var wH;(function(t){t.COMMAND="command",t.ABILITY="ability",t.EVENT="event",t.PARSER="parser"})(wH||(Ny.ExtensionType=wH={}))});var DH=p(NH=>{"use strict";Object.defineProperty(NH,"__esModule",{value:!0})});var Py=p(fp=>{"use strict";Object.defineProperty(fp,"__esModule",{value:!0});fp.SimpleRuleSystemImpl=void 0;fp.createSimpleRuleSystem=nZ;var PH=kw(),LH=ww(),Dy=class{constructor(){d(this,"rules",new Map)}addRule(e){this.rules.set(e.id,e)}removeRule(e){this.rules.delete(e)}getRules(){return Array.from(this.rules.values())}processEvent(e,r){let n=this.getMatchingRules(e);n.sort((c,l)=>(l.priority||0)-(c.priority||0));let i=!1,o,a=[],s=[];for(let c of n){if(c.condition&&!c.condition(e,r))continue;let l;try{l=c.action(e,r)}catch(u){console.error(`Error executing rule ${c.id}:`,u);continue}if(l.prevent&&!i){i=!0,o=l.message,l.message&&a.push((0,PH.createEvent)(LH.StandardEventTypes.NARRATIVE,{message:l.message},{actor:e.entities.actor,location:e.entities.location}));break}l.events&&a.push(...l.events),l.message&&!l.prevent&&(o||(o=l.message),a.push((0,PH.createEvent)(LH.StandardEventTypes.NARRATIVE,{message:l.message},{actor:e.entities.actor,location:e.entities.location}))),l.changes&&s.push(...l.changes)}for(let c of s)r.getEntity(c.entityId)&&r.updateEntity(c.entityId,{[c.attribute]:c.value});return{prevent:i,message:o,events:a,changes:s}}getMatchingRules(e){return Array.from(this.rules.values()).filter(r=>{if(r.eventType==="*")return!0;if(r.eventType.endsWith(":*")){let n=r.eventType.split(":")[0];return e.type.startsWith(`${n}:`)}return r.eventType===e.type})}};fp.SimpleRuleSystemImpl=Dy;function nZ(){return new Dy}});var xH=p(Yn=>{"use strict";Object.defineProperty(Yn,"__esModule",{value:!0});Yn.getTargetItem=Ww;Yn.getActor=iZ;Yn.entityIs=MH;Yn.getAttribute=jw;Yn.hasAbility=kH;Yn.giveAbility=oZ;Yn.removeAbility=aZ;Yn.setAttribute=sZ;Yn.itemTooHeavy=cZ;Yn.isTaking=lZ;Yn.playerHasAbility=uZ;function Ww(t,e){let r=t.entities.target||t.data?.itemId;if(typeof r=="string")return e.getEntity(r)}function iZ(t,e){let r=t.entities.actor;return r?e.getEntity(r):void 0}function MH(t,e){return t?.id===e||t?.attributes?.name===e}function jw(t,e){return t?.attributes?.[e]}function kH(t,e){return t?.attributes?.[`ability_${e}`]===!0}function oZ(t,e){return{entityId:t,attribute:`ability_${e}`,value:!0}}function aZ(t,e){return{entityId:t,attribute:`ability_${e}`,value:void 0}}function sZ(t,e,r){return{entityId:t,attribute:e,value:r}}function cZ(t,e){let r=Ww(t,e),n=e.getPlayer(),i=jw(r,"weight")||0,o=jw(n,"strength")||10;return i>o}function lZ(t){return(e,r)=>{let n=Ww(e,r);return MH(n,t)}}function uZ(t){return(e,r)=>{let n=r.getPlayer();return kH(n,t)}}});var Hw=p(pp=>{"use strict";Object.defineProperty(pp,"__esModule",{value:!0});pp.SimpleRuleWorldAdapter=void 0;pp.createSimpleRuleWorld=dZ;var Ly=class{constructor(e,r="player",n){d(this,"worldState");d(this,"playerId");d(this,"currentLocationId");this.worldState=e,this.playerId=r,this.currentLocationId=n}getEntity(e){return this.worldState.entities?.[e]||this.worldState[e]}updateEntity(e,r){let n=this.getEntity(e);n&&(n.attributes?Object.assign(n.attributes,r):Object.assign(n,r))}getPlayer(){return this.getEntity(this.playerId)}getCurrentLocation(){return this.currentLocationId?this.getEntity(this.currentLocationId):void 0}setPlayerId(e){this.playerId=e}setCurrentLocationId(e){this.currentLocationId=e}};pp.SimpleRuleWorldAdapter=Ly;function dZ(t,e="player",r){return new Ly(t,e,r)}});var Uw=p(gp=>{"use strict";Object.defineProperty(gp,"__esModule",{value:!0});gp.RuleSystemAdapter=void 0;gp.createRuleSystem=pZ;var mZ=Py(),My=class{constructor(e){d(this,"simpleRuleSystem");this.simpleRuleSystem=e}processEvent(e,r){let n=fZ(r),i=this.simpleRuleSystem.processEvent(e,n);return{prevented:i.prevent||!1,preventMessage:i.message,events:i.events||[],context:r}}};gp.RuleSystemAdapter=My;function fZ(t){return{getEntity:e=>t.getEntity(e),updateEntity:(e,r)=>{let n=t.getEntity(e);n&&(n.attributes?Object.assign(n.attributes,r):Object.assign(n,r))},getPlayer:()=>t.player,getCurrentLocation:()=>t.currentLocation}}function pZ(){let t=new mZ.SimpleRuleSystemImpl;return new My(t)}});var BH=p(Qt=>{"use strict";var gZ=Qt&&Qt.__createBinding||(Object.create?(function(t,e,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}):(function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]})),hp=Qt&&Qt.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&gZ(e,t,r)};Object.defineProperty(Qt,"__esModule",{value:!0});Qt.createRuleSystem=Qt.createSimpleRuleWorld=Qt.createSimpleRuleSystem=void 0;hp(DH(),Qt);hp(Py(),Qt);hp(xH(),Qt);hp(Hw(),Qt);hp(Uw(),Qt);var hZ=Py();Object.defineProperty(Qt,"createSimpleRuleSystem",{enumerable:!0,get:function(){return hZ.createSimpleRuleSystem}});var yZ=Hw();Object.defineProperty(Qt,"createSimpleRuleWorld",{enumerable:!0,get:function(){return yZ.createSimpleRuleWorld}});var vZ=Uw();Object.defineProperty(Qt,"createRuleSystem",{enumerable:!0,get:function(){return vZ.createRuleSystem}})});var jH=p(ky=>{"use strict";Object.defineProperty(ky,"__esModule",{value:!0});ky.DebugEventTypes=void 0;ky.DebugEventTypes={parser:{TOKEN_ANALYSIS:"token_analysis",PATTERN_MATCH:"pattern_match",CANDIDATE_SCORING:"candidate_scoring"},validator:{ENTITY_RESOLUTION:"entity_resolution",SCOPE_CHECK:"scope_check",AMBIGUITY_RESOLUTION:"ambiguity_resolution",VALIDATION_ERROR:"validation_error"},executor:{ACTION_START:"action_start",ACTION_COMPLETE:"action_complete",ACTION_ERROR:"action_error"},worldModel:{ENTITY_CHANGE:"entity_change",RELATION_CHANGE:"relation_change",PROPERTY_CHANGE:"property_change"},textService:{TEMPLATE_SELECTION:"template_selection",TEXT_GENERATION:"text_generation",CHANNEL_ROUTING:"channel_routing"}}});var WH=p(Xl=>{"use strict";var EZ=Xl&&Xl.__createBinding||(Object.create?(function(t,e,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}):(function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]})),TZ=Xl&&Xl.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&EZ(e,t,r)};Object.defineProperty(Xl,"__esModule",{value:!0});TZ(jH(),Xl)});var qw=p(_c=>{"use strict";Object.defineProperty(_c,"__esModule",{value:!0});_c.StandardValidators=_c.QueryType=_c.QuerySource=void 0;var HH;(function(t){t.SYSTEM="system",t.DISAMBIGUATION="disambiguation",t.NPC="npc",t.GAME_MECHANIC="mechanic",t.NARRATIVE="narrative"})(HH||(_c.QuerySource=HH={}));var UH;(function(t){t.YES_NO="yes_no",t.MULTIPLE_CHOICE="multiple_choice",t.FREE_TEXT="free_text",t.NUMERIC="numeric",t.DISAMBIGUATION="disambiguation"})(UH||(_c.QueryType=UH={}));_c.StandardValidators={yesNo:t=>{let e=t.toLowerCase().trim(),r=["yes","y","yeah","yep","sure","ok","okay"],n=["no","n","nope","nah","cancel"];return r.includes(e)?{valid:!0,normalized:!0}:n.includes(e)?{valid:!0,normalized:!1}:{valid:!1,message:"Please answer yes or no.",hint:"You can also use y/n"}},numeric:(t,e,r)=>{let n=parseInt(t.trim(),10);return isNaN(n)?{valid:!1,message:"Please enter a number."}:e!==void 0&&n<e?{valid:!1,message:`Please enter a number at least ${e}.`}:r!==void 0&&n>r?{valid:!1,message:`Please enter a number no more than ${r}.`}:{valid:!0,normalized:n}},multipleChoice:(t,e)=>{let r=t.trim(),n=parseInt(r,10);if(!isNaN(n)&&n>=1&&n<=e.length)return{valid:!0,normalized:n-1};let i=e.findIndex(o=>o.toLowerCase().includes(r.toLowerCase())||r.toLowerCase().includes(o.toLowerCase()));return i>=0?{valid:!0,normalized:i}:{valid:!1,message:`Please choose a number 1-${e.length} or type part of an option.`}}}});var FH=p((S_e,Fw)=>{"use strict";var _Z=Object.prototype.hasOwnProperty,Cr="~";function yp(){}Object.create&&(yp.prototype=Object.create(null),new yp().__proto__||(Cr=!1));function bZ(t,e,r){this.fn=t,this.context=e,this.once=r||!1}function qH(t,e,r,n,i){if(typeof r!="function")throw new TypeError("The listener must be a function");var o=new bZ(r,n||t,i),a=Cr?Cr+e:e;return t._events[a]?t._events[a].fn?t._events[a]=[t._events[a],o]:t._events[a].push(o):(t._events[a]=o,t._eventsCount++),t}function xy(t,e){--t._eventsCount===0?t._events=new yp:delete t._events[e]}function dr(){this._events=new yp,this._eventsCount=0}dr.prototype.eventNames=function(){var e=[],r,n;if(this._eventsCount===0)return e;for(n in r=this._events)_Z.call(r,n)&&e.push(Cr?n.slice(1):n);return Object.getOwnPropertySymbols?e.concat(Object.getOwnPropertySymbols(r)):e};dr.prototype.listeners=function(e){var r=Cr?Cr+e:e,n=this._events[r];if(!n)return[];if(n.fn)return[n.fn];for(var i=0,o=n.length,a=new Array(o);i<o;i++)a[i]=n[i].fn;return a};dr.prototype.listenerCount=function(e){var r=Cr?Cr+e:e,n=this._events[r];return n?n.fn?1:n.length:0};dr.prototype.emit=function(e,r,n,i,o,a){var s=Cr?Cr+e:e;if(!this._events[s])return!1;var c=this._events[s],l=arguments.length,u,m;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),l){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,r),!0;case 3:return c.fn.call(c.context,r,n),!0;case 4:return c.fn.call(c.context,r,n,i),!0;case 5:return c.fn.call(c.context,r,n,i,o),!0;case 6:return c.fn.call(c.context,r,n,i,o,a),!0}for(m=1,u=new Array(l-1);m<l;m++)u[m-1]=arguments[m];c.fn.apply(c.context,u)}else{var f=c.length,g;for(m=0;m<f;m++)switch(c[m].once&&this.removeListener(e,c[m].fn,void 0,!0),l){case 1:c[m].fn.call(c[m].context);break;case 2:c[m].fn.call(c[m].context,r);break;case 3:c[m].fn.call(c[m].context,r,n);break;case 4:c[m].fn.call(c[m].context,r,n,i);break;default:if(!u)for(g=1,u=new Array(l-1);g<l;g++)u[g-1]=arguments[g];c[m].fn.apply(c[m].context,u)}}return!0};dr.prototype.on=function(e,r,n){return qH(this,e,r,n,!1)};dr.prototype.once=function(e,r,n){return qH(this,e,r,n,!0)};dr.prototype.removeListener=function(e,r,n,i){var o=Cr?Cr+e:e;if(!this._events[o])return this;if(!r)return xy(this,o),this;var a=this._events[o];if(a.fn)a.fn===r&&(!i||a.once)&&(!n||a.context===n)&&xy(this,o);else{for(var s=0,c=[],l=a.length;s<l;s++)(a[s].fn!==r||i&&!a[s].once||n&&a[s].context!==n)&&c.push(a[s]);c.length?this._events[o]=c.length===1?c[0]:c:xy(this,o)}return this};dr.prototype.removeAllListeners=function(e){var r;return e?(r=Cr?Cr+e:e,this._events[r]&&xy(this,r)):(this._events=new yp,this._eventsCount=0),this};dr.prototype.off=dr.prototype.removeListener;dr.prototype.addListener=dr.prototype.on;dr.prefixed=Cr;dr.EventEmitter=dr;typeof Fw<"u"&&(Fw.exports=dr)});var GH=p(bc=>{"use strict";var OZ=bc&&bc.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(bc,"__esModule",{value:!0});bc.QueryManager=void 0;bc.createQueryManager=AZ;bc.isQueryEvent=RZ;var IZ=OZ(FH()),Gw=qw(),SZ=Bw(),By=class extends IZ.default{constructor(){super();d(this,"state",{queryStack:[],history:[],interceptingInput:!1});d(this,"handlers",new Map);d(this,"validators",new Map);d(this,"timeouts",new Map);d(this,"eventSource",(0,SZ.createSemanticEventSource)());this.registerValidator("yes_no",Gw.StandardValidators.yesNo),this.registerValidator("numeric",(r,n)=>{let i=n.context.min,o=n.context.max;return Gw.StandardValidators.numeric(r,i,o)}),this.registerValidator("multiple_choice",(r,n)=>Gw.StandardValidators.multipleChoice(r,n.options||[]))}registerHandler(r,n){this.handlers.set(r,n)}registerValidator(r,n){this.validators.set(r,n)}async askQuery(r){if(this.state.pendingQuery)if(r.priority&&r.priority>(this.state.pendingQuery.priority||0))this.state.queryStack.unshift(this.state.pendingQuery),this.state.pendingQuery=r;else return this.state.queryStack.push(r),null;else this.state.pendingQuery=r;if(this.state.interceptingInput=!0,this.emit("query:pending",r),r.timeout){let n=setTimeout(()=>{this.handleTimeout(r)},r.timeout);this.timeouts.set(r.id,n)}return new Promise(n=>{let i=(s,c)=>{c.id===r.id&&(this.off("query:answered",i),this.off("query:timeout",o),this.off("query:cancelled",a),n(s))},o=s=>{s.id===r.id&&(this.off("query:answered",i),this.off("query:timeout",o),this.off("query:cancelled",a),n(null))},a=s=>{s.id===r.id&&(this.off("query:answered",i),this.off("query:timeout",o),this.off("query:cancelled",a),n(null))};this.on("query:answered",i),this.on("query:timeout",o),this.on("query:cancelled",a)})}processInput(r){if(!this.state.pendingQuery||!this.state.interceptingInput)return"pass";let n=this.state.pendingQuery;if(this.looksLikeCommand(r)&&n.allowInterruption)return this.interruptQuery(n,r),"interrupt";let i={valid:!0,normalized:r};if(n.validator){let c=this.validators.get(n.validator);c&&(i=c(r,n))}else if(n.type==="multiple_choice"&&n.options){let c=r.trim().toLowerCase(),l=parseInt(c,10)-1;!isNaN(l)&&l>=0&&l<n.options.length?i={valid:!0,normalized:l}:n.options.some(u=>u.toLowerCase()===c)?i={valid:!0,normalized:c}:i={valid:!1,message:`Please select one of the available options: ${n.options.join(", ")}`,hint:"You can enter the option number or text"}}if(!i.valid){this.emit("query:invalid",r,i,n);let c={queryId:n.id,input:r,message:i.message||"Invalid response",hint:i.hint},l={id:`evt_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:"query.invalid",timestamp:Date.now(),entities:{},data:c};return this.eventSource.emit(l),"handled"}let o={queryId:n.id,rawInput:r,response:i.normalized||r,selectedIndex:typeof i.normalized=="number"?i.normalized:void 0,wasInterrupted:!1,timestamp:Date.now()},a=this.timeouts.get(n.id);if(a&&(clearTimeout(a),this.timeouts.delete(n.id)),this.state.history.push({query:n,response:o,result:"answered"}),this.state.pendingQuery=void 0,this.state.queryStack.length>0){let c=this.state.queryStack.shift();this.state.pendingQuery=c,this.emit("query:pending",c)}else this.state.interceptingInput=!1;this.emit("query:answered",o,n);let s=this.findHandler(n);return s&&s.handleResponse(o,n),"handled"}cancelCurrentQuery(){if(!this.state.pendingQuery)return;let r=this.state.pendingQuery,n=this.timeouts.get(r.id);if(n&&(clearTimeout(n),this.timeouts.delete(r.id)),this.state.history.push({query:r,result:"cancelled"}),this.state.pendingQuery=void 0,this.state.queryStack.length>0){let o=this.state.queryStack.shift();this.state.pendingQuery=o,this.emit("query:pending",o)}else this.state.interceptingInput=!1;this.emit("query:cancelled",r);let i=this.findHandler(r);i&&i.handleCancel&&i.handleCancel(r)}getState(){return{...this.state}}getEventSource(){return this.eventSource}hasPendingQuery(){return!!this.state.pendingQuery}getCurrentQuery(){return this.state.pendingQuery}clearAll(){this.state.pendingQuery&&this.cancelCurrentQuery(),this.state.queryStack=[],this.state.interceptingInput=!1;for(let[,r]of this.timeouts)clearTimeout(r);this.timeouts.clear()}handleTimeout(r){if(this.state.pendingQuery?.id!==r.id)return;if(this.state.history.push({query:r,result:"timeout"}),this.state.pendingQuery=void 0,this.timeouts.delete(r.id),this.state.queryStack.length>0){let i=this.state.queryStack.shift();this.state.pendingQuery=i,this.emit("query:pending",i)}else this.state.interceptingInput=!1;this.emit("query:timeout",r);let n=this.findHandler(r);n&&n.handleTimeout&&n.handleTimeout(r)}interruptQuery(r,n){let i=this.timeouts.get(r.id);i&&(clearTimeout(i),this.timeouts.delete(r.id)),this.state.history.push({query:r,result:"cancelled"}),this.state.pendingQuery=void 0,this.state.interceptingInput=!1,this.emit("query:interrupted",r,n)}findHandler(r){for(let[,n]of this.handlers)if(n.canHandle(r))return n}looksLikeCommand(r){return[/^(look|take|drop|go|examine|inventory|save|load|help)/i,/^(n|s|e|w|ne|nw|se|sw|up|down|in|out)$/i,/^x\s+/i,/^g\s+/i,/^l$/i].some(i=>i.test(r.trim()))}};bc.QueryManager=By;function AZ(){return new By}function RZ(t,e){return t===e}});var YH=p(Oc=>{"use strict";var wZ=Oc&&Oc.__createBinding||(Object.create?(function(t,e,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}):(function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]})),VH=Oc&&Oc.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&wZ(e,t,r)};Object.defineProperty(Oc,"__esModule",{value:!0});VH(qw(),Oc);VH(GH(),Oc)});var zH=p(Vw=>{"use strict";Object.defineProperty(Vw,"__esModule",{value:!0});Vw.createSeededRandom=CZ;function CZ(t){let e=t??Date.now(),r=1103515245,n=12345,i=2**31;function o(){return e=(r*e+n)%i,e/i}function a(f,g){return Math.floor(o()*(g-f+1))+f}function s(f){return o()<f}function c(f){if(f.length===0)throw new Error("Cannot pick from empty array");return f[a(0,f.length-1)]}function l(f){let g=[...f];for(let h=g.length-1;h>0;h--){let y=a(0,h);[g[h],g[y]]=[g[y],g[h]]}return g}function u(){return e}function m(f){e=f}return{next:o,int:a,chance:s,pick:c,shuffle:l,getSeed:u,setSeed:m}}});var $H=p(jy=>{"use strict";Object.defineProperty(jy,"__esModule",{value:!0});jy.createSeededRandom=void 0;var NZ=zH();Object.defineProperty(jy,"createSeededRandom",{enumerable:!0,get:function(){return NZ.createSeededRandom}})});var Je=p(Nr=>{"use strict";var DZ=Nr&&Nr.__createBinding||(Object.create?(function(t,e,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}):(function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]})),Ba=Nr&&Nr.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&DZ(e,t,r)};Object.defineProperty(Nr,"__esModule",{value:!0});Ba(cH(),Nr);Ba(dH(),Nr);Ba(fH(),Nr);Ba(Bw(),Nr);Ba(CH(),Nr);Ba(BH(),Nr);Ba(WH(),Nr);Ba(YH(),Nr);Ba($H(),Nr)});var vp=p(zd=>{"use strict";Object.defineProperty(zd,"__esModule",{value:!0});zd.isEngineAwareParser=PZ;zd.hasWorldContext=LZ;zd.hasPronounContext=MZ;zd.hasPlatformEventEmitter=kZ;function PZ(t){return"setWorldContext"in t||"setPlatformEventEmitter"in t||"updatePronounContext"in t||"resetPronounContext"in t}function LZ(t){return"setWorldContext"in t&&typeof t.setWorldContext=="function"}function MZ(t){return"updatePronounContext"in t&&"resetPronounContext"in t&&typeof t.updatePronounContext=="function"&&typeof t.resetPronounContext=="function"}function kZ(t){return"setPlatformEventEmitter"in t&&typeof t.setPlatformEventEmitter=="function"}});var Hy=p(Wy=>{"use strict";Object.defineProperty(Wy,"__esModule",{value:!0});Wy.SharedDataKeys=void 0;Wy.SharedDataKeys={INFERENCE_PERFORMED:"inferencePerformed",ORIGINAL_TARGET:"originalTarget",INFERRED_TARGET:"inferredTarget",IMPLICIT_TAKE_EVENTS:"implicitTakeEvents",VALIDATION_RESULT:"validationResult"}});var Yw=p(Ic=>{"use strict";Object.defineProperty(Ic,"__esModule",{value:!0});Ic.EventTypes=Ic.MessageNamespaces=Ic.ScopeErrors=void 0;Ic.ScopeErrors={NOT_KNOWN:"scope.not_known",NOT_VISIBLE:"scope.not_visible",NOT_REACHABLE:"scope.not_reachable",NOT_CARRIED:"scope.not_carried",OUT_OF_SCOPE:"scope.out_of_scope"};Ic.MessageNamespaces={SYSTEM:"if.system",ACTION:"if.action",ERROR:"if.error",GAME:"if.game",STORY:"story",EXTENSION:"ext"};Ic.EventTypes={TEXT:"text",ACTION_SUCCESS:"action.success",ACTION_ERROR:"action.error",ACTION_FAILED:"action.failed",GAME_MESSAGE:"game.message",SYSTEM_MESSAGE:"system.message"}});var zw=p(Ep=>{"use strict";Object.defineProperty(Ep,"__esModule",{value:!0});Ep.TraitRegistry=void 0;Ep.isTrait=xZ;function xZ(t){return t&&typeof t=="object"&&"type"in t&&typeof t.type=="string"}var Uy=class{static register(e){if(this.traits.has(e.type))throw new Error(`Trait type '${e.type}' is already registered`);this.traits.set(e.type,e)}static get(e){return this.traits.get(e)}static has(e){return this.traits.has(e)}static clear(){this.traits.clear()}static getAll(){return new Map(this.traits)}};d(Uy,"traits",new Map);Ep.TraitRegistry=Uy});var te=p(B=>{"use strict";Object.defineProperty(B,"__esModule",{value:!0});B.TRAIT_CATEGORIES=B.TraitCategory=B.TraitType=void 0;B.isValidTraitType=BZ;B.getTraitCategory=jZ;B.getTraitsByCategory=WZ;B.getAllTraitTypes=HZ;B.registerTraitType=UZ;B.TraitType={IDENTITY:"identity",CONTAINER:"container",SUPPORTER:"supporter",ROOM:"room",WEARABLE:"wearable",CLOTHING:"clothing",EDIBLE:"edible",SCENERY:"scenery",OPENABLE:"openable",LOCKABLE:"lockable",SWITCHABLE:"switchable",READABLE:"readable",LIGHT_SOURCE:"lightSource",PULLABLE:"pullable",ATTACHED:"attached",PUSHABLE:"pushable",BUTTON:"button",MOVEABLE_SCENERY:"moveableScenery",DOOR:"door",CLIMBABLE:"climbable",ACTOR:"actor",EXIT:"exit",WEAPON:"weapon",BREAKABLE:"breakable",DESTRUCTIBLE:"destructible",COMBATANT:"combatant",EQUIPPED:"equipped",NPC:"npc",VEHICLE:"vehicle",ENTERABLE:"enterable"};B.TraitCategory={STANDARD:"standard",INTERACTIVE:"interactive",ADVANCED:"advanced"};B.TRAIT_CATEGORIES={[B.TraitType.IDENTITY]:B.TraitCategory.STANDARD,[B.TraitType.CONTAINER]:B.TraitCategory.STANDARD,[B.TraitType.SUPPORTER]:B.TraitCategory.STANDARD,[B.TraitType.ROOM]:B.TraitCategory.STANDARD,[B.TraitType.WEARABLE]:B.TraitCategory.STANDARD,[B.TraitType.CLOTHING]:B.TraitCategory.STANDARD,[B.TraitType.EDIBLE]:B.TraitCategory.STANDARD,[B.TraitType.SCENERY]:B.TraitCategory.STANDARD,[B.TraitType.OPENABLE]:B.TraitCategory.INTERACTIVE,[B.TraitType.LOCKABLE]:B.TraitCategory.INTERACTIVE,[B.TraitType.SWITCHABLE]:B.TraitCategory.INTERACTIVE,[B.TraitType.READABLE]:B.TraitCategory.INTERACTIVE,[B.TraitType.LIGHT_SOURCE]:B.TraitCategory.INTERACTIVE,[B.TraitType.PULLABLE]:B.TraitCategory.INTERACTIVE,[B.TraitType.ATTACHED]:B.TraitCategory.INTERACTIVE,[B.TraitType.PUSHABLE]:B.TraitCategory.INTERACTIVE,[B.TraitType.BUTTON]:B.TraitCategory.INTERACTIVE,[B.TraitType.MOVEABLE_SCENERY]:B.TraitCategory.INTERACTIVE,[B.TraitType.DOOR]:B.TraitCategory.STANDARD,[B.TraitType.CLIMBABLE]:B.TraitCategory.INTERACTIVE,[B.TraitType.EXIT]:B.TraitCategory.STANDARD,[B.TraitType.ACTOR]:B.TraitCategory.STANDARD,[B.TraitType.WEAPON]:B.TraitCategory.INTERACTIVE,[B.TraitType.BREAKABLE]:B.TraitCategory.INTERACTIVE,[B.TraitType.DESTRUCTIBLE]:B.TraitCategory.INTERACTIVE,[B.TraitType.COMBATANT]:B.TraitCategory.INTERACTIVE,[B.TraitType.EQUIPPED]:B.TraitCategory.INTERACTIVE,[B.TraitType.NPC]:B.TraitCategory.STANDARD,[B.TraitType.VEHICLE]:B.TraitCategory.INTERACTIVE,[B.TraitType.ENTERABLE]:B.TraitCategory.INTERACTIVE};function BZ(t){return Object.values(B.TraitType).includes(t)}function jZ(t){return B.TRAIT_CATEGORIES[t]}function WZ(t){return Object.entries(B.TRAIT_CATEGORIES).filter(([e,r])=>r===t).map(([e,r])=>e)}function HZ(){return Object.values(B.TraitType)}function UZ(t,e,r=B.TraitCategory.STANDARD){B.TraitType[t]=e,B.TRAIT_CATEGORIES[e]=r}});var $d=p(qy=>{"use strict";Object.defineProperty(qy,"__esModule",{value:!0});qy.IFEntity=void 0;var qZ=zw(),et=te(),$w=class t{constructor(e,r,n){d(this,"id");d(this,"type");d(this,"attributes");d(this,"relationships");d(this,"traits");d(this,"scopePriorities",new Map);d(this,"minimumScopes",new Map);d(this,"on");this.id=e,this.type=r,this.attributes=n?.attributes?{...n.attributes}:{},this.relationships=n?.relationships||{},this.traits=new Map}has(e){return this.traits.has(e)}get(e){let r=typeof e=="string"?e:typeof e=="function"?e.type:e;return this.traits.get(r)}getTrait(e){return this.get(e)}add(e){if(!(0,qZ.isTrait)(e))throw new Error("Invalid trait: must have a type property");return this.traits.has(e.type)?(console.warn(`Entity "${this.id}" already has trait: ${e.type} - ignoring duplicate add`),this):(this.traits.set(e.type,e),this)}remove(e){return this.traits.delete(e)}hasAll(...e){return e.every(r=>this.traits.has(r))}hasAny(...e){return e.some(r=>this.traits.has(r))}getTraits(){return Array.from(this.traits.values())}getTraitTypes(){return Array.from(this.traits.keys())}clearTraits(){this.traits.clear()}scope(e,r){return r!==void 0&&this.scopePriorities.set(e,r),this.scopePriorities.get(e)??100}clearScope(e){this.scopePriorities.delete(e)}clearAllScopes(){this.scopePriorities.clear()}getScopePriorities(){return Object.fromEntries(this.scopePriorities)}setMinimumScope(e,r){if(r&&r.length>0)for(let n of r)this.minimumScopes.set(n,e);else this.minimumScopes.set("*",e);return this}getMinimumScope(e){return e&&this.minimumScopes.has(e)?this.minimumScopes.get(e):this.minimumScopes.has("*")?this.minimumScopes.get("*"):0}clearMinimumScope(e){if(e&&e.length>0)for(let r of e)this.minimumScopes.delete(r);else this.minimumScopes.clear()}getMinimumScopes(){return Object.fromEntries(this.minimumScopes)}clone(e){let r=new t(e,this.type,{attributes:JSON.parse(JSON.stringify(this.attributes)),relationships:JSON.parse(JSON.stringify(this.relationships))});for(let[n,i]of this.traits)r.traits.set(n,JSON.parse(JSON.stringify(i)));for(let[n,i]of this.scopePriorities)r.scopePriorities.set(n,i);for(let[n,i]of this.minimumScopes)r.minimumScopes.set(n,i);return r}toJSON(){let e={id:this.id,type:this.type,attributes:this.attributes,relationships:this.relationships,traits:Array.from(this.traits.entries()).map(([r,n])=>({...n})),version:3};return this.scopePriorities.size>0&&(e.scopePriorities=Object.fromEntries(this.scopePriorities)),this.minimumScopes.size>0&&(e.minimumScopes=Object.fromEntries(this.minimumScopes)),e}static fromJSON(e){let r=e.type||"object";if(!e.version&&e.attributes){if(e.attributes.entityType)r=e.attributes.entityType;else if(e.id&&e.id.match(/^[a-z][0-9a-z]{2}$/)){let i=e.id[0];r={r:"room",d:"door",i:"item",a:"actor",c:"container",s:"supporter",y:"scenery",e:"exit",o:"object"}[i]||"object"}}let n=new t(e.id,r,{attributes:e.attributes,relationships:e.relationships});if(e.traits&&Array.isArray(e.traits))for(let i of e.traits)n.traits.set(i.type,i);if(e.scopePriorities&&typeof e.scopePriorities=="object")for(let[i,o]of Object.entries(e.scopePriorities))n.scopePriorities.set(i,o);if(e.minimumScopes&&typeof e.minimumScopes=="object")for(let[i,o]of Object.entries(e.minimumScopes))n.minimumScopes.set(i,o);return n}get isRoom(){return this.has(et.TraitType.ROOM)}get canContain(){return this.has(et.TraitType.CONTAINER)||this.has(et.TraitType.SUPPORTER)||this.has(et.TraitType.ROOM)||this.has(et.TraitType.ACTOR)}get isTakeable(){return!this.has(et.TraitType.SCENERY)&&!this.has(et.TraitType.ROOM)&&!this.has(et.TraitType.DOOR)}get isScenery(){return this.has(et.TraitType.SCENERY)}get isOpenable(){return this.has(et.TraitType.OPENABLE)}get isOpen(){let e=this.get(et.TraitType.OPENABLE);return e?e.isOpen:!1}get isLockable(){return this.has(et.TraitType.LOCKABLE)}get isLocked(){let e=this.get(et.TraitType.LOCKABLE);return e?e.isLocked:!1}get isContainer(){return this.has(et.TraitType.CONTAINER)}get isSupporter(){return this.has(et.TraitType.SUPPORTER)}get isDoor(){return this.has(et.TraitType.DOOR)}get isActor(){return this.has(et.TraitType.ACTOR)}get isPlayer(){let e=this.get(et.TraitType.ACTOR);return e?e.isPlayer:!1}get providesLight(){let e=this.get(et.TraitType.LIGHT_SOURCE);return e?e.isLit:!1}get isSwitchable(){return this.has(et.TraitType.SWITCHABLE)}get enterable(){return this.has(et.TraitType.ENTERABLE)||this.has(et.TraitType.VEHICLE)}get isOn(){let e=this.get(et.TraitType.SWITCHABLE);return e?e.isOn:!1}get name(){if(this.attributes.displayName)return this.attributes.displayName;let e=this.get(et.TraitType.IDENTITY);return e&&e.name?e.name:this.attributes.name?this.attributes.name:this.id}get description(){let e=this.get(et.TraitType.IDENTITY);return e?e.description:void 0}get weight(){return this.attributes.weight||0}hasTrait(e){return this.has(e)}};qy.IFEntity=$w});var KH=p(Fy=>{"use strict";Object.defineProperty(Fy,"__esModule",{value:!0});Fy.EntityStore=void 0;var FZ=$d(),Kw=class t{constructor(){d(this,"ifEntities");this.ifEntities=new Map}add(e){this.ifEntities.set(e.id,e)}get(e){return this.ifEntities.get(e)}has(e){return this.ifEntities.has(e)}remove(e){let r=this.ifEntities.get(e);return r&&r.clearTraits(),this.ifEntities.delete(e)}getAll(){return Array.from(this.ifEntities.values())}getByType(e){return this.getAll().filter(r=>r.type===e)}findWithTrait(e){return this.getAll().filter(r=>r.has(e))}findWithAllTraits(...e){return this.getAll().filter(r=>r.hasAll(...e))}findWithAnyTraits(...e){return this.getAll().filter(r=>r.hasAny(...e))}clear(){for(let e of this.ifEntities.values())e.clearTraits();this.ifEntities.clear()}get size(){return this.ifEntities.size}[Symbol.iterator](){return this.ifEntities.values()}toJSON(){return this.getAll().map(e=>e.toJSON())}static fromJSON(e){let r=new t;if(Array.isArray(e))for(let n of e){let i=FZ.IFEntity.fromJSON(n);r.add(i)}return r}};Fy.EntityStore=Kw});var Qw=p(mr=>{"use strict";Object.defineProperty(mr,"__esModule",{value:!0});mr.EntityType=void 0;mr.isEntityType=GZ;mr.getEntityTypePrefix=VZ;mr.EntityType={ROOM:"room",DOOR:"door",ITEM:"item",ACTOR:"actor",CONTAINER:"container",SUPPORTER:"supporter",SCENERY:"scenery",EXIT:"exit",OBJECT:"object"};function GZ(t){return Object.values(mr.EntityType).includes(t)}function VZ(t){return{[mr.EntityType.ROOM]:"r",[mr.EntityType.DOOR]:"d",[mr.EntityType.ITEM]:"i",[mr.EntityType.ACTOR]:"a",[mr.EntityType.CONTAINER]:"c",[mr.EntityType.SUPPORTER]:"s",[mr.EntityType.SCENERY]:"y",[mr.EntityType.EXIT]:"e",[mr.EntityType.OBJECT]:"o"}[t]||"o"}});var QH=p(Ei=>{"use strict";Object.defineProperty(Ei,"__esModule",{value:!0});Ei.getEntityTypePrefix=Ei.isEntityType=Ei.EntityType=Ei.EntityStore=Ei.IFEntity=void 0;var YZ=$d();Object.defineProperty(Ei,"IFEntity",{enumerable:!0,get:function(){return YZ.IFEntity}});var zZ=KH();Object.defineProperty(Ei,"EntityStore",{enumerable:!0,get:function(){return zZ.EntityStore}});var Xw=Qw();Object.defineProperty(Ei,"EntityType",{enumerable:!0,get:function(){return Xw.EntityType}});Object.defineProperty(Ei,"isEntityType",{enumerable:!0,get:function(){return Xw.isEntityType}});Object.defineProperty(Ei,"getEntityTypePrefix",{enumerable:!0,get:function(){return Xw.getEntityTypePrefix}})});var qt=p(Tp=>{"use strict";Object.defineProperty(Tp,"__esModule",{value:!0});Tp.Behavior=void 0;Tp.isWorldAwareBehavior=$Z;var Gy=class{static require(e,r){if(!e.has(r))throw new Error(`Entity "${e.id}" missing required trait: ${r}`);return e.get(r)}static optional(e,r){if(e.has(r))return e.get(r)}static validateEntity(e){return this.requiredTraits.every(r=>e.has(r))}static getMissingTraits(e){return this.requiredTraits.filter(r=>!e.has(r))}};d(Gy,"requiredTraits",[]);Tp.Behavior=Gy;function $Z(t){return"setWorldContext"in t}});var _p=p(Vy=>{"use strict";Object.defineProperty(Vy,"__esModule",{value:!0});Vy.IdentityBehavior=void 0;var KZ=qt(),cn=te(),ln=class ln extends KZ.Behavior{static validateIdentity(e){let r=ln.require(e,cn.TraitType.IDENTITY);if(!r.name||!r.name.trim())throw new Error(`Entity ${e.id} has no name`);if(r.properName&&r.article&&(r.article=""),r.weight!==void 0&&r.weight<0)throw new Error(`Entity ${e.id} has negative weight`);if(r.volume!==void 0&&r.volume<0)throw new Error(`Entity ${e.id} has negative volume`);let n=["tiny","small","medium","large","huge"];if(r.size!==void 0&&!n.includes(r.size))throw new Error(`Entity ${e.id} has invalid size: ${r.size}`)}static formatName(e,r){let n=ln.require(e,cn.TraitType.IDENTITY),i;return n.properName||!n.article?i=n.name:i=`${n.article} ${n.name}`,r?.definite&&!n.properName&&n.article!=="the"&&(i=`the ${n.name}`),r?.capitalize&&(i=i.charAt(0).toUpperCase()+i.slice(1)),i}static getPossessiveName(e){let r=ln.formatName(e);return r.endsWith("s")?`${r}'`:`${r}'s`}static matchesName(e,r){let n=ln.require(e,cn.TraitType.IDENTITY),i=r.toLowerCase();return n.name.toLowerCase()===i?!0:n.aliases.some(o=>o.toLowerCase()===i)}static isConcealed(e){return ln.require(e,cn.TraitType.IDENTITY).concealed}static setConcealed(e,r){let n=ln.require(e,cn.TraitType.IDENTITY);n.concealed=r}static reveal(e){ln.setConcealed(e,!1)}static conceal(e){ln.setConcealed(e,!0)}static getWeight(e){return e.has(cn.TraitType.IDENTITY)&&e.get(cn.TraitType.IDENTITY)?.weight||0}static getVolume(e){return e.has(cn.TraitType.IDENTITY)&&e.get(cn.TraitType.IDENTITY)?.volume||0}static getSize(e){return ln.require(e,cn.TraitType.IDENTITY).size}static getTotalWeight(e,r){let i=ln.require(e,cn.TraitType.IDENTITY).weight||0;if(r&&(e.has(cn.TraitType.CONTAINER)||e.has(cn.TraitType.SUPPORTER))){let o=r(e.id);for(let a of o)i+=ln.getTotalWeight(a,r)}return i}};d(ln,"requiredTraits",[cn.TraitType.IDENTITY]);var Zw=ln;Vy.IdentityBehavior=Zw});var bp=p(zy=>{"use strict";Object.defineProperty(zy,"__esModule",{value:!0});zy.WearableBehavior=void 0;var Wo=te(),Yy=class{static canWear(e,r){let n=e.get(Wo.TraitType.WEARABLE);return!(!n||n.worn)}static canRemove(e,r){let n=e.get(Wo.TraitType.WEARABLE);return!(!n||!n.worn||n.wornBy!==r.id)}static wear(e,r){let n=e.get(Wo.TraitType.WEARABLE);return n?n.worn?n.wornBy===r.id?{success:!1,alreadyWorn:!0}:{success:!1,wornByOther:n.wornBy}:(n.worn=!0,n.wornBy=r.id,{success:!0,slot:n.slot,layer:n.layer,wearMessage:n.wearMessage}):{success:!1}}static remove(e,r){let n=e.get(Wo.TraitType.WEARABLE);return n?n.worn?n.wornBy!==r.id?{success:!1,wornByOther:n.wornBy}:(n.worn=!1,n.wornBy=void 0,{success:!0,removeMessage:n.removeMessage}):{success:!1,notWorn:!0}:{success:!1}}static isWorn(e){let r=e.get(Wo.TraitType.WEARABLE);return r?r.worn:!1}static getWearer(e){return e.get(Wo.TraitType.WEARABLE)?.wornBy}static getSlot(e){let r=e.get(Wo.TraitType.WEARABLE);return r?r.slot:"clothing"}static getLayer(e){let r=e.get(Wo.TraitType.WEARABLE);return r?r.layer:1}static getBlockedSlots(e){let r=e.get(Wo.TraitType.WEARABLE);return r?[...r.blocksSlots]:[]}};d(Yy,"requiredTraits",[Wo.TraitType.WEARABLE]);zy.WearableBehavior=Yy});var Qy=p(Ky=>{"use strict";Object.defineProperty(Ky,"__esModule",{value:!0});Ky.ContainerBehavior=void 0;var QZ=qt(),fr=te(),$y=_p(),XZ=bp(),Ti=class Ti extends QZ.Behavior{static canAccept(e,r,n){let i=Ti.require(e,fr.TraitType.CONTAINER);if(e.has(fr.TraitType.OPENABLE)){let o=e.get(fr.TraitType.OPENABLE);if(o&&!o.isOpen)return!1}if(i.allowedTypes&&i.allowedTypes.length>0){let o=r.type||"object";if(!i.allowedTypes.includes(o))return!1}if(i.excludedTypes&&i.excludedTypes.length>0){let o=r.type||"object";if(i.excludedTypes.includes(o))return!1}return!(r.has(fr.TraitType.ACTOR)&&!i.enterable||i.capacity&&!this.checkCapacity(e,r,n))}static checkCapacity(e,r,n){let o=Ti.require(e,fr.TraitType.CONTAINER).capacity;if(!o)return!0;if(o.maxItems!==void 0&&n.getContents(e.id).filter(c=>!XZ.WearableBehavior.isWorn(c)).length>=o.maxItems)return!1;if(o.maxWeight!==void 0){let a=this.getTotalWeight(e,n),s=$y.IdentityBehavior.getWeight(r);if(a+s>o.maxWeight)return!1}if(o.maxVolume!==void 0){let a=this.getTotalVolume(e,n),s=$y.IdentityBehavior.getVolume(r);if(a+s>o.maxVolume)return!1}return!0}static getTotalWeight(e,r){return r.getContents(e.id).reduce((i,o)=>i+$y.IdentityBehavior.getWeight(o),0)}static getTotalVolume(e,r){return r.getContents(e.id).reduce((i,o)=>i+$y.IdentityBehavior.getVolume(o),0)}static getRemainingCapacity(e,r){let n=Ti.require(e,fr.TraitType.CONTAINER),i={};if(n.capacity?.maxItems!==void 0){let o=r.getContents(e.id).length;i.items=n.capacity.maxItems-o}return n.capacity?.maxWeight!==void 0&&(i.weight=n.capacity.maxWeight-this.getTotalWeight(e,r)),n.capacity?.maxVolume!==void 0&&(i.volume=n.capacity.maxVolume-this.getTotalVolume(e,r)),i}static isTransparent(e){return Ti.require(e,fr.TraitType.CONTAINER).isTransparent||!1}static isEnterable(e){return Ti.require(e,fr.TraitType.CONTAINER).enterable||!1}static getAllowedTypes(e){return Ti.require(e,fr.TraitType.CONTAINER).allowedTypes}static getExcludedTypes(e){return Ti.require(e,fr.TraitType.CONTAINER).excludedTypes}static addItem(e,r,n){let i=Ti.require(e,fr.TraitType.CONTAINER);if(e.has(fr.TraitType.OPENABLE)){let a=e.get(fr.TraitType.OPENABLE);if(a&&!a.isOpen)return{success:!1,containerClosed:!0,stateChanged:!1}}if(n.getLocation(r.id)===e.id)return{success:!1,alreadyContains:!0,stateChanged:!1};if(i.allowedTypes&&i.allowedTypes.length>0){let a=r.type||"object";if(!i.allowedTypes.includes(a))return{success:!1,wrongType:!0,stateChanged:!1}}if(i.excludedTypes&&i.excludedTypes.length>0){let a=r.type||"object";if(i.excludedTypes.includes(a))return{success:!1,wrongType:!0,stateChanged:!1}}return Ti.checkCapacity(e,r,n)?{success:!0,stateChanged:!0}:{success:!1,containerFull:!0,stateChanged:!1}}static removeItem(e,r,n){if(e.has(fr.TraitType.OPENABLE)){let o=e.get(fr.TraitType.OPENABLE);if(o&&!o.isOpen)return{success:!1,containerClosed:!0,stateChanged:!1}}return n.getLocation(r.id)!==e.id?{success:!1,notContained:!0,stateChanged:!1}:{success:!0,stateChanged:!0}}};d(Ti,"requiredTraits",[fr.TraitType.CONTAINER]);var Jw=Ti;Ky.ContainerBehavior=Jw});var eC=p(Jy=>{"use strict";Object.defineProperty(Jy,"__esModule",{value:!0});Jy.SceneryBehavior=void 0;var Xy=te(),Zy=class{static getUntakeableReason(e){let r=e.get(Xy.TraitType.SCENERY);return r?r.cantTakeMessage?"custom_message":"fixed_in_place":"not_scenery"}static getCantTakeMessage(e){return e.get(Xy.TraitType.SCENERY)?.cantTakeMessage}static isMentioned(e){let r=e.get(Xy.TraitType.SCENERY);return r?r.mentioned:!0}};d(Zy,"requiredTraits",[Xy.TraitType.SCENERY]);Jy.SceneryBehavior=Zy});var tC=p(tv=>{"use strict";Object.defineProperty(tv,"__esModule",{value:!0});tv.ReadableBehavior=void 0;var ja=te(),Kd=Je(),ev=class{static getText(e){let r=e.get(ja.TraitType.READABLE);return r?r.pageContent&&r.currentPage&&r.pageContent[r.currentPage-1]||r.text:""}static markAsRead(e){let r=e.get(ja.TraitType.READABLE);return!r||r.hasBeenRead?[]:(r.hasBeenRead=!0,[(0,Kd.createEvent)("if.readable.read",{reader:"player",readable:e.id,firstTime:!0})])}static canRead(e,r){let n=e.get(ja.TraitType.READABLE);return!n||!n.isReadable?!1:n.requiresAbility?r===n.requiredAbility:!0}static turnToPage(e,r){let n=e.get(ja.TraitType.READABLE);if(!n||!n.pageContent||!n.pages)return[];if(r<1||r>n.pages)return[(0,Kd.createEvent)("if.action.failed",{action:"turn_page",reason:"invalid_page",entity:e.id})];let i=n.currentPage||1;return n.currentPage=r,[(0,Kd.createEvent)("if.readable.page_turned",{readable:e.id,fromPage:i,toPage:r,totalPages:n.pages})]}static nextPage(e){let r=e.get(ja.TraitType.READABLE);return!r||!r.currentPage||!r.pages?[]:this.turnToPage(e,r.currentPage+1)}static previousPage(e){let r=e.get(ja.TraitType.READABLE);return!r||!r.currentPage||!r.pages?[]:this.turnToPage(e,r.currentPage-1)}static getPreview(e){let r=e.get(ja.TraitType.READABLE);if(!r)return"";if(r.preview)return r.preview;let n=this.getText(e);if(n.length<=50)return n;let i=n.substring(0,50),o=i.lastIndexOf(" ");return o>30?i.substring(0,o)+"...":i+"..."}static read(e,r){let n=r.get(ja.TraitType.READABLE);if(!n)return[(0,Kd.createEvent)("if.action.failed",{action:"read",reason:"not_readable",actor:e.id,target:r.id})];if(!this.canRead(r))return[(0,Kd.createEvent)("if.action.failed",{action:"read",reason:n.requiresAbility?"requires_ability":"cannot_read",actor:e.id,target:r.id,requiredAbility:n.requiredAbility,message:n.cannotReadMessage})];let i=[];return n.hasBeenRead||i.push(...this.markAsRead(r)),i.push((0,Kd.createEvent)("if.readable.read",{reader:e.id,readable:r.id,text:this.getText(r),page:n.currentPage,totalPages:n.pages,language:n.language,readableType:n.readableType})),i}};d(ev,"requiredTraits",[ja.TraitType.READABLE]);tv.ReadableBehavior=ev});var XH=p(Qd=>{"use strict";Object.defineProperty(Qd,"__esModule",{value:!0});Qd.IFEventCategory=Qd.IFEvents=void 0;Qd.IFEvents={TAKEN:"taken",DROPPED:"dropped",MOVED:"moved",EXAMINED:"examined",PUT_IN:"put_in",PUT_ON:"put_on",REMOVED_FROM:"removed_from",ITEM_PUT_ON:"item_put_on",ITEM_REMOVED_FROM:"item_removed_from",CONTAINER_EMPTIED:"container_emptied",CONTAINER_NOT_OPEN:"container_not_open",NOT_A_CONTAINER:"not_a_container",NOT_A_SUPPORTER:"not_a_supporter",DOESNT_FIT:"doesnt_fit",OPENED:"opened",CLOSED:"closed",NOT_OPENABLE:"not_openable",LOCKED:"locked",UNLOCKED:"unlocked",CONTAINER_LOCKED:"container_locked",CONTAINER_UNLOCKED:"container_unlocked",ALREADY_LOCKED:"already_locked",ALREADY_UNLOCKED:"already_unlocked",UNLOCK_FAILED:"unlock_failed",NOT_LOCKABLE:"not_lockable",SWITCHED_ON:"switched_on",SWITCHED_OFF:"switched_off",DEVICE_SWITCHED_ON:"device_switched_on",DEVICE_SWITCHED_OFF:"device_switched_off",DEVICE_ACTIVATED:"device_activated",WORN:"worn",REMOVED:"removed",EATEN:"eaten",DRUNK:"drunk",ITEM_EATEN:"item_eaten",ITEM_DRUNK:"item_drunk",ITEM_DESTROYED:"item_destroyed",ACTOR_MOVED:"actor_moved",ACTOR_ENTERED:"actor_entered",ACTOR_EXITED:"actor_exited",MOVEMENT_BLOCKED:"movement_blocked",ENTERED:"entered",EXITED:"exited",EVACUATED:"evacuated",CLIMBED:"climbed",ROOM_ENTERED:"room_entered",ROOM_EXITED:"room_exited",ROOM_DESCRIBED:"room_described",ROOM_FIRST_ENTERED:"room_first_entered",ROOM_ILLUMINATED:"room_illuminated",ROOM_DARKENED:"room_darkened",NEW_EXIT_REVEALED:"new_exit_revealed",LIGHT_CHANGED:"light_changed",LOCATION_ILLUMINATED:"location_illuminated",LOCATION_DARKENED:"location_darkened",FUEL_DEPLETED:"fuel_depleted",FUEL_LOW:"fuel_low",REFUELED:"refueled",READ:"read",SEARCHED:"searched",LISTENED:"listened",SMELLED:"smelled",TOUCHED:"touched",GIVEN:"given",SHOWN:"shown",THROWN:"thrown",PUSHED:"pushed",PULLED:"pulled",TURNED:"turned",USED:"used",CUSTOM_MESSAGE:"custom_message",VISIBILITY_CHANGED:"visibility_changed",ACTION_PREVENTED:"action_prevented",ACTION_FAILED:"action_failed",ACTION_SUCCEEDED:"action_succeeded",WAITED:"waited",SCORE_DISPLAYED:"score_displayed",HELP_DISPLAYED:"help_displayed",ABOUT_DISPLAYED:"about_displayed",SCORE_GAINED:"if.event.score_gained",SCORE_LOST:"if.event.score_lost"};Qd.IFEventCategory={MANIPULATION:"manipulation",MOVEMENT:"movement",STATE_CHANGE:"state_change",PERCEPTION:"perception",META:"meta"}});var JH=p(ZH=>{"use strict";Object.defineProperty(ZH,"__esModule",{value:!0})});var tU=p(eU=>{"use strict";Object.defineProperty(eU,"__esModule",{value:!0})});var nU=p(rU=>{"use strict";Object.defineProperty(rU,"__esModule",{value:!0})});var oU=p(iU=>{"use strict";Object.defineProperty(iU,"__esModule",{value:!0})});var sU=p(aU=>{"use strict";Object.defineProperty(aU,"__esModule",{value:!0})});var lU=p(cU=>{"use strict";Object.defineProperty(cU,"__esModule",{value:!0})});var dU=p(rv=>{"use strict";Object.defineProperty(rv,"__esModule",{value:!0});rv.ParseErrorType=void 0;var uU;(function(t){t.NO_VERB="NO_VERB",t.UNKNOWN_VERB="UNKNOWN_VERB",t.UNKNOWN_WORD="UNKNOWN_WORD",t.AMBIGUOUS="AMBIGUOUS",t.INCOMPLETE="INCOMPLETE",t.PATTERN_MISMATCH="PATTERN_MISMATCH"})(uU||(rv.ParseErrorType=uU={}))});var mU=p(nv=>{"use strict";Object.defineProperty(nv,"__esModule",{value:!0});nv.ParserFactory=void 0;var Ho=new Map,rC=class{static registerParser(e,r){let n=e.toLowerCase();Ho.set(n,r);let i=n.split("-")[0];i!==n&&!Ho.has(i)&&Ho.set(i,r)}static createParser(e,r){let n=e.toLowerCase(),i=Ho.get(n);if(!i){let o=n.split("-")[0];i=Ho.get(o)}if(!i){let o=Array.from(Ho.keys()).sort();throw new Error(`No parser registered for language: ${e}. Available languages: ${o.join(", ")}. Register a parser using ParserFactory.registerParser().`)}return new i(r)}static getRegisteredLanguages(){return Array.from(Ho.keys()).sort()}static isLanguageRegistered(e){let r=e.toLowerCase();if(Ho.has(r))return!0;let n=r.split("-")[0];return Ho.has(n)}static clearRegistry(){Ho.clear()}};nv.ParserFactory=rC});var fU=p(Wa=>{"use strict";var ZZ=Wa&&Wa.__createBinding||(Object.create?(function(t,e,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}):(function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]})),nC=Wa&&Wa.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&ZZ(e,t,r)};Object.defineProperty(Wa,"__esModule",{value:!0});nC(lU(),Wa);nC(dU(),Wa);nC(mU(),Wa)});var iC=p(Xd=>{"use strict";Object.defineProperty(Xd,"__esModule",{value:!0});Xd.GrammarPatterns=Xd.PartOfSpeech=void 0;Xd.PartOfSpeech={VERB:"verb",NOUN:"noun",ADJECTIVE:"adjective",PREPOSITION:"preposition",ARTICLE:"article",PRONOUN:"pronoun",DIRECTION:"direction",SPECIAL:"special",DETERMINER:"determiner",CONJUNCTION:"conjunction",NUMBER:"number"};Xd.GrammarPatterns=Object.freeze({VERB_ONLY:Object.freeze({name:"verb_only",elements:Object.freeze(["VERB"]),example:"look"}),VERB_NOUN:Object.freeze({name:"verb_noun",elements:Object.freeze(["VERB","NOUN"]),example:"take sword"}),VERB_NOUN_PREP_NOUN:Object.freeze({name:"verb_noun_prep_noun",elements:Object.freeze(["VERB","NOUN","PREP","NOUN"]),example:"put sword in chest"}),VERB_PREP_NOUN:Object.freeze({name:"verb_prep_noun",elements:Object.freeze(["VERB","PREP","NOUN"]),example:"look at painting"}),VERB_DIRECTION:Object.freeze({name:"verb_direction",elements:Object.freeze(["VERB","DIRECTION"]),example:"go north"}),DIRECTION_ONLY:Object.freeze({name:"direction_only",elements:Object.freeze(["DIRECTION"]),example:"north"})})});var pU=p(Zd=>{"use strict";Object.defineProperty(Zd,"__esModule",{value:!0});Zd.vocabularyRegistry=Zd.VocabularyRegistry=void 0;var un=iC(),iv=class{constructor(){d(this,"providers",new Map);d(this,"entityVocabulary",new Map);d(this,"cachedVocabulary",null);d(this,"dirtyCache",!0)}registerProvider(e){this.providers.set(e.id,e),this.dirtyCache=!0}unregisterProvider(e){this.providers.delete(e),this.dirtyCache=!0}registerEntity(e){this.entityVocabulary.set(e.entityId,e),this.dirtyCache=!0}unregisterEntity(e){this.entityVocabulary.delete(e),this.dirtyCache=!0}updateEntityScope(e,r){let n=this.entityVocabulary.get(e);n&&(n.inScope=r)}getVocabulary(){if(!this.dirtyCache&&this.cachedVocabulary)return this.cachedVocabulary;let e=[],r=new Map,n=new Map,i=Array.from(this.providers.values()).sort((o,a)=>(a.priority||0)-(o.priority||0));for(let o of i){let a=o.getVocabulary();e.push(...a)}for(let[o,a]of this.entityVocabulary){for(let s of a.nouns)e.push({word:s.toLowerCase(),partOfSpeech:un.PartOfSpeech.NOUN,mapsTo:o,source:"entity",priority:a.priority,metadata:{inScope:a.inScope}});for(let s of a.adjectives)e.push({word:s.toLowerCase(),partOfSpeech:un.PartOfSpeech.ADJECTIVE,mapsTo:o,source:"entity",priority:a.priority,metadata:{inScope:a.inScope}})}for(let o of e){let a=o.word.toLowerCase();r.has(a)||r.set(a,[]);let s=r.get(a);s&&s.push(o),n.has(o.partOfSpeech)||n.set(o.partOfSpeech,[]);let c=n.get(o.partOfSpeech);c&&c.push(o)}for(let o of r.values())o.sort((a,s)=>(s.priority||0)-(a.priority||0));return this.cachedVocabulary={entries:e,byWord:r,byPartOfSpeech:n},this.dirtyCache=!1,this.cachedVocabulary}lookup(e,r){let i=this.getVocabulary().byWord.get(e.toLowerCase())||[];return r?i.filter(o=>o.partOfSpeech===r):i}getByPartOfSpeech(e){return this.getVocabulary().byPartOfSpeech.get(e)||[]}hasWord(e,r){return this.lookup(e,r).length>0}getInScopeEntities(){return Array.from(this.entityVocabulary.values()).filter(e=>e.inScope)}clear(){this.providers.clear(),this.entityVocabulary.clear(),this.cachedVocabulary=null,this.dirtyCache=!0}registerVerbs(e){let r=[];for(let n of e)for(let i of n.verbs)r.push({word:i.toLowerCase(),partOfSpeech:un.PartOfSpeech.VERB,mapsTo:n.actionId,source:"base",metadata:{pattern:n.pattern,prepositions:n.prepositions}});this.registerProvider({id:"standard-verbs",getVocabulary:()=>r,priority:100})}registerDynamicVerbs(e,r="story"){let n=[];for(let i of e)for(let o of i.verbs)n.push({word:o.toLowerCase(),partOfSpeech:un.PartOfSpeech.VERB,mapsTo:i.actionId,source:r,priority:80,metadata:{pattern:i.pattern,prepositions:i.prepositions}});this.registerProvider({id:`dynamic-verbs-${r}`,getVocabulary:()=>n,priority:80})}registerDirections(e){let r=[];for(let n of e){for(let i of n.words)r.push({word:i.toLowerCase(),partOfSpeech:un.PartOfSpeech.DIRECTION,mapsTo:n.direction,source:"base"});if(n.abbreviations)for(let i of n.abbreviations)r.push({word:i.toLowerCase(),partOfSpeech:un.PartOfSpeech.DIRECTION,mapsTo:n.direction,source:"base",priority:90})}this.registerProvider({id:"standard-directions",getVocabulary:()=>r,priority:100})}registerPrepositions(e){let r=[];for(let n of e)r.push({word:n.toLowerCase(),partOfSpeech:un.PartOfSpeech.PREPOSITION,mapsTo:n.toUpperCase(),source:"base"});this.registerProvider({id:"standard-prepositions",getVocabulary:()=>r,priority:100})}registerDeterminers(e){let r=[];for(let n of e)r.push({word:n.toLowerCase(),partOfSpeech:un.PartOfSpeech.DETERMINER,mapsTo:n.toUpperCase(),source:"base"});this.registerProvider({id:"standard-determiners",getVocabulary:()=>r,priority:100})}registerConjunctions(e){let r=[];for(let n of e)r.push({word:n.toLowerCase(),partOfSpeech:un.PartOfSpeech.CONJUNCTION,mapsTo:n.toUpperCase(),source:"base"});this.registerProvider({id:"standard-conjunctions",getVocabulary:()=>r,priority:100})}registerNumbers(e){let r=[];for(let n of e)r.push({word:n.toLowerCase(),partOfSpeech:un.PartOfSpeech.NUMBER,mapsTo:n,source:"base"});this.registerProvider({id:"standard-numbers",getVocabulary:()=>r,priority:100})}registerSpecial(e){let r=[];for(let n of e.pronouns)r.push({word:n.toLowerCase(),partOfSpeech:un.PartOfSpeech.PRONOUN,mapsTo:"IT",source:"base"});for(let n of e.articles)r.push({word:n.toLowerCase(),partOfSpeech:un.PartOfSpeech.ARTICLE,mapsTo:"ARTICLE",source:"base"});for(let n of e.allWords)r.push({word:n.toLowerCase(),partOfSpeech:un.PartOfSpeech.SPECIAL,mapsTo:"ALL",source:"base"});for(let n of e.exceptWords)r.push({word:n.toLowerCase(),partOfSpeech:un.PartOfSpeech.SPECIAL,mapsTo:"EXCEPT",source:"base"});this.registerProvider({id:"special-vocabulary",getVocabulary:()=>r,priority:100})}};Zd.VocabularyRegistry=iv;Zd.vocabularyRegistry=new iv});var gU=p(Op=>{"use strict";Object.defineProperty(Op,"__esModule",{value:!0});Op.adaptVerbVocabulary=JZ;Op.adaptDirectionVocabulary=eJ;Op.adaptSpecialVocabulary=tJ;function JZ(t){if(t.getVerbs)return t.getVerbs();let e=[],r=t.getVerbMappings?.()||{};for(let[n,i]of Object.entries(r))Array.isArray(i)&&e.push({actionId:n,verbs:i,pattern:t.getVerbPattern?.(n)});return e}function eJ(t){if(t.getDirections)return t.getDirections();let e=[],r=t.getDirectionMappings?.()||{};for(let[n,i]of Object.entries(r))if(Array.isArray(i)){let o=i.filter(s=>s.length>2),a=i.filter(s=>s.length<=2);e.push({direction:n,words:o.length>0?o:i,abbreviations:a.length>0?a:void 0})}return e}function tJ(t){return t.getSpecialVocabulary?t.getSpecialVocabulary():{pronouns:t.getPronouns?.()||["it","them"],allWords:t.getAllWords?.()||["all","everything"],exceptWords:t.getExceptWords?.()||["except","but"],articles:t.getArticles?.()||["a","an","the"]}}});var hU=p(Ha=>{"use strict";var rJ=Ha&&Ha.__createBinding||(Object.create?(function(t,e,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}):(function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]})),oC=Ha&&Ha.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&rJ(e,t,r)};Object.defineProperty(Ha,"__esModule",{value:!0});oC(iC(),Ha);oC(pU(),Ha);oC(gU(),Ha)});var aC=p(ov=>{"use strict";Object.defineProperty(ov,"__esModule",{value:!0});ov.SlotType=void 0;var yU;(function(t){t.ENTITY="entity",t.TEXT="text",t.TEXT_GREEDY="text_greedy",t.INSTRUMENT="instrument",t.DIRECTION="direction",t.NUMBER="number",t.ORDINAL="ordinal",t.TIME="time",t.MANNER="manner",t.QUOTED_TEXT="quoted_text",t.TOPIC="topic",t.VOCABULARY="vocabulary",t.ADJECTIVE="adjective",t.NOUN="noun"})(yU||(ov.SlotType=yU={}))});var vU=p(av=>{"use strict";Object.defineProperty(av,"__esModule",{value:!0});av.PatternSyntaxError=void 0;var sC=class extends Error{constructor(r,n,i){super(r);d(this,"pattern");d(this,"position");this.pattern=n,this.position=i,this.name="PatternSyntaxError"}};av.PatternSyntaxError=sC});var EU=p(sv=>{"use strict";Object.defineProperty(sv,"__esModule",{value:!0});sv.GrammarEngine=void 0;var Pt=aC(),cC=class{constructor(e){d(this,"rules",[]);d(this,"rulesByAction",new Map);d(this,"compiler");this.compiler=e}addRule(e){e.compiledPattern||(e.compiledPattern=this.compiler.compile(e.pattern)),this.rules.push(e);let r=this.rulesByAction.get(e.action)||[];r.push(e),this.rulesByAction.set(e.action,r),this.sortRules()}addRules(e){e.forEach(r=>this.addRule(r))}getBestMatch(e,r,n){let i=this.findMatches(e,r,n);return i.length>0?i[0]:null}clear(){this.rules=[],this.rulesByAction.clear()}getRules(){return[...this.rules]}getRulesForAction(e){return this.rulesByAction.get(e)||[]}sortRules(){this.rules.sort((e,r)=>r.priority-e.priority),this.rulesByAction.forEach(e=>{e.sort((r,n)=>n.priority-r.priority)})}createBuilder(){let e=this;return{define(r){let n={id:`rule_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,pattern:r,slots:new Map,priority:100},i={hasTrait(o,a){let s=n.slots.get(o)||{name:o,constraints:[],traitFilters:[]};return s.traitFilters||(s.traitFilters=[]),s.traitFilters.push(a),n.slots.set(o,s),i},where(o,a){let s=n.slots.get(o)||{name:o,constraints:[]};return s.constraints.push(a),n.slots.set(o,s),i},text(o){let a=n.slots.get(o)||{name:o,constraints:[]};return a.slotType=Pt.SlotType.TEXT,n.slots.set(o,a),i},instrument(o){let a=n.slots.get(o)||{name:o,constraints:[]};return a.slotType=Pt.SlotType.INSTRUMENT,n.slots.set(o,a),i},mapsTo(o){return n.action=o,i},withPriority(o){return n.priority=o,i},withSemanticVerbs(o){return n.semantics||(n.semantics={}),n.semantics.verbs=o,i},withSemanticPrepositions(o){return n.semantics||(n.semantics={}),n.semantics.prepositions=o,i},withSemanticDirections(o){return n.semantics||(n.semantics={}),n.semantics.directions=o,i},withDefaultSemantics(o){return n.defaultSemantics=o,i},number(o){let a=n.slots.get(o)||{name:o,constraints:[]};return a.slotType=Pt.SlotType.NUMBER,n.slots.set(o,a),i},ordinal(o){let a=n.slots.get(o)||{name:o,constraints:[]};return a.slotType=Pt.SlotType.ORDINAL,n.slots.set(o,a),i},time(o){let a=n.slots.get(o)||{name:o,constraints:[]};return a.slotType=Pt.SlotType.TIME,n.slots.set(o,a),i},direction(o){let a=n.slots.get(o)||{name:o,constraints:[]};return a.slotType=Pt.SlotType.DIRECTION,n.slots.set(o,a),i},manner(o){let a=n.slots.get(o)||{name:o,constraints:[]};return a.slotType=Pt.SlotType.MANNER,n.slots.set(o,a),i},fromVocabulary(o,a){let s=n.slots.get(o)||{name:o,constraints:[]};return s.slotType=Pt.SlotType.VOCABULARY,s.vocabularyCategory=a,n.slots.set(o,s),i},adjective(o){let a=n.slots.get(o)||{name:o,constraints:[]};return a.slotType=Pt.SlotType.ADJECTIVE,n.slots.set(o,a),i},noun(o){let a=n.slots.get(o)||{name:o,constraints:[]};return a.slotType=Pt.SlotType.NOUN,n.slots.set(o,a),i},quotedText(o){let a=n.slots.get(o)||{name:o,constraints:[]};return a.slotType=Pt.SlotType.QUOTED_TEXT,n.slots.set(o,a),i},topic(o){let a=n.slots.get(o)||{name:o,constraints:[]};return a.slotType=Pt.SlotType.TOPIC,n.slots.set(o,a),i},build(){if(!n.action)throw new Error("Grammar rule must have an action (use .mapsTo())");return e.addRule(n),n}};return i},forAction(r){let n=[],i=[],o={},a=new Map,s=new Map,c=new Map,l=100,u,m={verbs(f){return n.push(...f),m},pattern(f){return i.push(f),m},patterns(f){return i.push(...f),m},directions(f){return Object.assign(o,f),m},hasTrait(f,g){let h=s.get(f)||[];return h.push(g),s.set(f,h),m},where(f,g){let h=a.get(f)||[];return h.push({constraint:g}),a.set(f,h),m},withPriority(f){return l=f,m},withDefaultSemantics(f){return u=f,m},slotType(f,g){return c.set(f,g),m},build(){if(n.length>0&&i.length>0)for(let f of n)for(let g of i){let h=g.trim()?`${f} ${g}`:f,y=e.createBuilder().define(h);y=y.mapsTo(r),y=y.withPriority(l),u&&(y=y.withDefaultSemantics(u));for(let[_,v]of a)for(let{constraint:E}of v)y=y.where(_,E);for(let[_,v]of s)for(let E of v)y=y.hasTrait(_,E);for(let[_,v]of c)switch(v){case Pt.SlotType.TEXT:y=y.text(_);break;case Pt.SlotType.INSTRUMENT:y=y.instrument(_);break;case Pt.SlotType.NUMBER:y=y.number(_);break;case Pt.SlotType.ORDINAL:y=y.ordinal(_);break;case Pt.SlotType.TIME:y=y.time(_);break;case Pt.SlotType.DIRECTION:y=y.direction(_);break;case Pt.SlotType.MANNER:y=y.manner(_);break}y.build()}if(n.length>0&&i.length===0)for(let f of n){let g=e.createBuilder().define(f);g=g.mapsTo(r),g=g.withPriority(l),u&&(g=g.withDefaultSemantics(u)),g.build()}for(let[f,g]of Object.entries(o))for(let h of g){let y=e.createBuilder().define(h);y=y.mapsTo(r),y=y.withPriority(h.length===1?90:l),y=y.withDefaultSemantics({direction:f}),y.build()}}};return m},getRules(){return e.getRules()},clear(){e.clear()}}}};sv.GrammarEngine=cC});var TU=p(Ip=>{"use strict";Object.defineProperty(Ip,"__esModule",{value:!0});Ip.ScopeBuilderImpl=void 0;Ip.scope=nJ;var cv=class{constructor(){d(this,"constraint",{base:"all",filters:[],traitFilters:[],explicitEntities:[],includeRules:[]})}visible(){return this.constraint.base="visible",this}touchable(){return this.constraint.base="touchable",this}carried(){return this.constraint.base="carried",this}nearby(){return this.constraint.base="nearby",this}matching(e){return this.constraint.filters.push(e),this}kind(e){return this.constraint.filters.push({kind:e}),this}orExplicitly(e){return this.constraint.explicitEntities.push(...e),this}orRule(e){return this.constraint.includeRules.push(e),this}hasTrait(e){return this.constraint.traitFilters.push(e),this}build(){return{...this.constraint}}};Ip.ScopeBuilderImpl=cv;function nJ(){return new cv}});var _U=p(lv=>{"use strict";Object.defineProperty(lv,"__esModule",{value:!0});lv.GrammarVocabularyProvider=void 0;var lC=class{constructor(){d(this,"categories",new Map)}define(e,r){if(this.categories.has(e))throw new Error(`Vocabulary category '${e}' already exists. Use extend() to add words.`);let n=new Set(r.words.map(i=>i.toLowerCase()));this.categories.set(e,{words:n,when:r.when})}extend(e,r){let n=this.categories.get(e);if(!n)throw new Error(`Vocabulary category '${e}' does not exist. Use define() first.`);for(let i of r)n.words.add(i.toLowerCase())}match(e,r,n){let i=this.categories.get(e);return!i||i.when&&!i.when(n)?!1:i.words.has(r.toLowerCase())}getWords(e){let r=this.categories.get(e);return r?new Set(r.words):new Set}isActive(e,r){let n=this.categories.get(e);return n?n.when?n.when(r):!0:!1}hasCategory(e){return this.categories.has(e)}getCategories(){return Array.from(this.categories.keys())}removeCategory(e){return this.categories.delete(e)}clear(){this.categories.clear()}};lv.GrammarVocabularyProvider=lC});var bU=p(zi=>{"use strict";var iJ=zi&&zi.__createBinding||(Object.create?(function(t,e,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}):(function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]})),Sp=zi&&zi.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&iJ(e,t,r)};Object.defineProperty(zi,"__esModule",{value:!0});Sp(aC(),zi);Sp(vU(),zi);Sp(EU(),zi);Sp(TU(),zi);Sp(_U(),zi)});var Xt=p(Dr=>{"use strict";var oJ=Dr&&Dr.__createBinding||(Object.create?(function(t,e,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}):(function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]})),Ua=Dr&&Dr.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&oJ(e,t,r)};Object.defineProperty(Dr,"__esModule",{value:!0});Ua(XH(),Dr);Ua(JH(),Dr);Ua(tU(),Dr);Ua(nU(),Dr);Ua(oU(),Dr);Ua(sU(),Dr);Ua(fU(),Dr);Ua(hU(),Dr);Ua(bU(),Dr)});var em=p(Jd=>{"use strict";Object.defineProperty(Jd,"__esModule",{value:!0});Jd.IFEventCategory=Jd.IFEvents=void 0;var OU=Xt();Object.defineProperty(Jd,"IFEvents",{enumerable:!0,get:function(){return OU.IFEvents}});Object.defineProperty(Jd,"IFEventCategory",{enumerable:!0,get:function(){return OU.IFEventCategory}})});var dv=p(uv=>{"use strict";Object.defineProperty(uv,"__esModule",{value:!0});uv.SwitchableBehavior=void 0;var aJ=qt(),$i=te(),uC=em(),zn=class zn extends aJ.Behavior{static canSwitchOn(e){let r=zn.require(e,$i.TraitType.SWITCHABLE);return!(r.isOn||r.requiresPower&&!r.hasPower)}static canSwitchOff(e){return zn.require(e,$i.TraitType.SWITCHABLE).isOn}static switchOn(e){let r=zn.require(e,$i.TraitType.SWITCHABLE);return r.isOn?{success:!1,wasOn:!0}:r.requiresPower&&!r.hasPower?{success:!1,noPower:!0}:(r.isOn=!0,r.autoOffTime>0&&(r.autoOffCounter=r.autoOffTime),{success:!0,autoOffTime:r.autoOffTime>0?r.autoOffTime:void 0,powerConsumption:r.powerConsumption,runningSound:r.runningSound,onSound:r.onSound,onMessage:r.onMessage})}static switchOff(e){let r=zn.require(e,$i.TraitType.SWITCHABLE);return r.isOn?(r.isOn=!1,r.autoOffCounter=0,{success:!0,offSound:r.offSound,offMessage:r.offMessage}):{success:!1,wasOff:!0}}static toggle(e){return zn.require(e,$i.TraitType.SWITCHABLE).isOn?this.switchOff(e):this.switchOn(e)}static setPower(e,r){let n=zn.require(e,$i.TraitType.SWITCHABLE),i=n.hasPower;return n.hasPower=r,!r&&n.isOn&&n.requiresPower?(n.isOn=!1,n.autoOffCounter=0,[{id:`${Date.now()}-${Math.random()}`,timestamp:Date.now(),type:uC.IFEvents.DEVICE_SWITCHED_OFF,entities:{target:e.id},data:{reason:"power_loss",customMessage:"The device powers down as it loses power."}}]):r&&!i?[{id:`${Date.now()}-${Math.random()}`,timestamp:Date.now(),type:uC.IFEvents.DEVICE_ACTIVATED,entities:{target:e.id},data:{reason:"power_restored",customMessage:"Power is restored to the device."}}]:[]}static updateTurn(e){let r=zn.require(e,$i.TraitType.SWITCHABLE);return r.isOn&&r.autoOffCounter>0&&(r.autoOffCounter--,r.autoOffCounter===0)?(r.isOn=!1,[{id:`${Date.now()}-${Math.random()}`,timestamp:Date.now(),type:uC.IFEvents.DEVICE_SWITCHED_OFF,entities:{target:e.id},data:{reason:"auto_off",customMessage:"The device automatically switches off."}}]):[]}static isOn(e){return zn.require(e,$i.TraitType.SWITCHABLE).isOn}static getTimeRemaining(e){let r=zn.require(e,$i.TraitType.SWITCHABLE);return r.isOn?r.autoOffCounter:0}static getPowerConsumption(e){let r=zn.require(e,$i.TraitType.SWITCHABLE);return r.isOn?r.powerConsumption:0}};d(zn,"requiredTraits",[$i.TraitType.SWITCHABLE]);var dC=zn;uv.SwitchableBehavior=dC});var fC=p(mv=>{"use strict";Object.defineProperty(mv,"__esModule",{value:!0});mv.LightSourceBehavior=void 0;var sJ=qt(),Ki=te(),cJ=dv(),_i=class _i extends sJ.Behavior{static light(e){let r=_i.require(e,Ki.TraitType.LIGHT_SOURCE);return r.fuelRemaining!==void 0&&r.fuelRemaining<=0?!1:(r.isLit=!0,!0)}static extinguish(e){let r=_i.require(e,Ki.TraitType.LIGHT_SOURCE);r.isLit=!1}static isLit(e){let r=_i.require(e,Ki.TraitType.LIGHT_SOURCE);return r.isLit!==void 0?r.isLit:e.hasTrait(Ki.TraitType.SWITCHABLE)?cJ.SwitchableBehavior.isOn(e):!0}static getBrightness(e){return _i.require(e,Ki.TraitType.LIGHT_SOURCE).brightness}static getFuelRemaining(e){return _i.require(e,Ki.TraitType.LIGHT_SOURCE).fuelRemaining}static hasFuel(e){let r=_i.require(e,Ki.TraitType.LIGHT_SOURCE);return r.fuelRemaining===void 0||r.fuelRemaining>0}static consumeFuel(e,r){let n=_i.require(e,Ki.TraitType.LIGHT_SOURCE);if(n.fuelRemaining===void 0)return!0;let i=r??n.fuelConsumptionRate??1;return n.fuelRemaining<i?(n.fuelRemaining=0,n.isLit=!1,!1):(n.fuelRemaining-=i,!0)}static refuel(e,r){let n=_i.require(e,Ki.TraitType.LIGHT_SOURCE);n.fuelRemaining!==void 0&&(r===void 0&&n.maxFuel!==void 0?n.fuelRemaining=n.maxFuel:r!==void 0&&(n.fuelRemaining=n.fuelRemaining+r,n.maxFuel!==void 0&&n.fuelRemaining>n.maxFuel&&(n.fuelRemaining=n.maxFuel)))}static getFuelPercentage(e){let r=_i.require(e,Ki.TraitType.LIGHT_SOURCE);if(!(r.fuelRemaining===void 0||r.maxFuel===void 0))return Math.round(r.fuelRemaining/r.maxFuel*100)}};d(_i,"requiredTraits",[Ki.TraitType.LIGHT_SOURCE]);var mC=_i;mv.LightSourceBehavior=mC});var gv=p(pv=>{"use strict";Object.defineProperty(pv,"__esModule",{value:!0});pv.ExitTrait=void 0;var IU=te(),fv=class{constructor(e){d(this,"type",IU.TraitType.EXIT);d(this,"from");d(this,"to");d(this,"direction");d(this,"command");d(this,"aliases");d(this,"visible",!0);d(this,"listed",!0);d(this,"bidirectional",!1);d(this,"reverseCommand");d(this,"reverseDirection");d(this,"useMessage");d(this,"blockedMessage");d(this,"conditional",!1);d(this,"conditionId");if(!e.from||!e.to||!e.command)throw new Error("ExitTrait requires from, to, and command");this.from=e.from,this.to=e.to,this.command=e.command,e.direction!==void 0&&(this.direction=e.direction),e.aliases!==void 0&&(this.aliases=e.aliases),e.visible!==void 0&&(this.visible=e.visible),e.listed!==void 0&&(this.listed=e.listed),e.bidirectional!==void 0&&(this.bidirectional=e.bidirectional),e.reverseCommand!==void 0&&(this.reverseCommand=e.reverseCommand),e.reverseDirection!==void 0&&(this.reverseDirection=e.reverseDirection),e.useMessage!==void 0&&(this.useMessage=e.useMessage),e.blockedMessage!==void 0&&(this.blockedMessage=e.blockedMessage),e.conditional!==void 0&&(this.conditional=e.conditional),e.conditionId!==void 0&&(this.conditionId=e.conditionId)}};d(fv,"type",IU.TraitType.EXIT);pv.ExitTrait=fv});var pC=p(Ev=>{"use strict";Object.defineProperty(Ev,"__esModule",{value:!0});Ev.ExitBehavior=void 0;var SU=$d(),Pr=te(),AU=gv(),hv=Je(),yv=em(),vv=class{static matchesCommand(e,r){let n=e.get(Pr.TraitType.EXIT);return n?n.command.toLowerCase()===r.toLowerCase()||n.direction&&n.direction.toLowerCase()===r.toLowerCase()?!0:n.aliases?n.aliases.some(i=>i.toLowerCase()===r.toLowerCase()):!1:!1}static canUse(e,r,n){let i=e.get(Pr.TraitType.EXIT);if(!i||!i.visible)return!1;if(i.conditional&&i.conditionId)return!0;if(e.has(Pr.TraitType.OPENABLE)){let o=e.get(Pr.TraitType.OPENABLE);if(o&&!o.isOpen)return!1}if(e.has(Pr.TraitType.LOCKABLE)){let o=e.get(Pr.TraitType.LOCKABLE);if(o&&o.isLocked)return!1}return!0}static use(e,r,n){let i=e.get(Pr.TraitType.EXIT);if(!i)return[(0,hv.createEvent)(yv.IFEvents.ACTION_FAILED,{action:"use_exit",reason:"not_an_exit"},{target:e.id,actor:r.id})];if(!this.canUse(e,r,n)){let a=this.getBlockedReason(e);return[(0,hv.createEvent)(yv.IFEvents.ACTION_FAILED,{action:"use_exit",reason:a,message:i.blockedMessage},{target:e.id,actor:r.id})]}let o=[];return i.useMessage&&o.push((0,hv.createEvent)(yv.IFEvents.CUSTOM_MESSAGE,{message:i.useMessage},{actor:r.id})),o.push((0,hv.createEvent)(yv.IFEvents.MOVED,{from:i.from,to:i.to,via:e.id,direction:i.direction,command:i.command},{actor:r.id})),o}static getBlockedReason(e){let r=e.get(Pr.TraitType.EXIT);if(!r)return"not_an_exit";if(!r.visible)return"exit_not_visible";if(e.has(Pr.TraitType.LOCKABLE)){let n=e.get(Pr.TraitType.LOCKABLE);if(n&&n.isLocked)return"exit_locked"}if(e.has(Pr.TraitType.OPENABLE)){let n=e.get(Pr.TraitType.OPENABLE);if(n&&!n.isOpen)return"exit_closed"}return r.conditional?"condition_not_met":"exit_blocked"}static getExitsFrom(e,r){return[]}static getVisibleExitsFrom(e,r){return this.getExitsFrom(e,r).filter(n=>{let i=n.get(Pr.TraitType.EXIT);return i&&i.visible})}static getListedExitsFrom(e,r){return this.getExitsFrom(e,r).filter(n=>{let i=n.get(Pr.TraitType.EXIT);return i&&i.visible&&i.listed})}static createBidirectional(e,r){if(!e.from||!e.to||!e.command)throw new Error("Bidirectional exit requires from, to, and command");let n=`${e.from}-to-${e.to}`,i=new SU.IFEntity(n,"exit");i.add(new AU.ExitTrait({...e,bidirectional:!0}));let o=`${e.to}-to-${e.from}`,a=new SU.IFEntity(o,"exit"),s={from:e.to,to:e.from,command:e.reverseCommand||this.getReverseCommand(e.command),direction:e.reverseDirection||this.getReverseDirection(e.direction),visible:e.visible,listed:e.listed,bidirectional:!0};return a.add(new AU.ExitTrait(s)),[i,a]}static getReverseDirection(e){return e?{north:"south",south:"north",east:"west",west:"east",northeast:"southwest",northwest:"southeast",southeast:"northwest",southwest:"northeast",up:"down",down:"up",in:"out",out:"in"}[e.toLowerCase()]:void 0}static getReverseCommand(e){let r=e.replace(/^go\s+/,""),n=this.getReverseDirection(r);return n?e.startsWith("go ")?`go ${n}`:n:"go back"}};d(vv,"requiredTraits",[Pr.TraitType.EXIT]);Ev.ExitBehavior=vv});var hC=p(Tv=>{"use strict";Object.defineProperty(Tv,"__esModule",{value:!0});Tv.ClimbableBehavior=void 0;var Sc=te(),gC=class{static isClimbable(e){return e.has(Sc.TraitType.CLIMBABLE)?e.get(Sc.TraitType.CLIMBABLE).canClimb:!1}static climb(e){if(!e.has(Sc.TraitType.CLIMBABLE))return{success:!1,blocked:!0,blockedReason:"not_climbable"};let r=e.get(Sc.TraitType.CLIMBABLE);return r.canClimb?{success:!0,destination:r.destination,direction:r.direction,successMessage:r.successMessage}:{success:!1,blocked:!0,blockedReason:r.blockedMessage||"cant_climb"}}static getDirection(e){return e.has(Sc.TraitType.CLIMBABLE)?e.get(Sc.TraitType.CLIMBABLE).direction:void 0}static getDestination(e){return e.has(Sc.TraitType.CLIMBABLE)?e.get(Sc.TraitType.CLIMBABLE).destination:void 0}};Tv.ClimbableBehavior=gC});var vC=p(_v=>{"use strict";Object.defineProperty(_v,"__esModule",{value:!0});_v.OpenableBehavior=void 0;var lJ=qt(),Ac=te(),bi=class bi extends lJ.Behavior{static canOpen(e){return!bi.require(e,Ac.TraitType.OPENABLE).isOpen}static canClose(e){let r=bi.require(e,Ac.TraitType.OPENABLE);return r.isOpen&&r.canClose}static open(e){let r=bi.require(e,Ac.TraitType.OPENABLE);return r.isOpen?{success:!1,alreadyOpen:!0,stateChanged:!1}:(r.isOpen=!0,{success:!0,stateChanged:!0,openMessage:r.openMessage,openSound:r.openSound,revealsContents:r.revealsContents})}static close(e){let r=bi.require(e,Ac.TraitType.OPENABLE);return r.isOpen?r.canClose?(r.isOpen=!1,{success:!0,stateChanged:!0,closeMessage:r.closeMessage,closeSound:r.closeSound}):{success:!1,cantClose:!0,stateChanged:!1}:{success:!1,alreadyClosed:!0,stateChanged:!1}}static toggle(e){return bi.require(e,Ac.TraitType.OPENABLE).isOpen?bi.close(e):bi.open(e)}static isOpen(e){return bi.require(e,Ac.TraitType.OPENABLE).isOpen}static revealsContents(e){return bi.require(e,Ac.TraitType.OPENABLE).revealsContents}};d(bi,"requiredTraits",[Ac.TraitType.OPENABLE]);var yC=bi;_v.OpenableBehavior=yC});var TC=p(bv=>{"use strict";Object.defineProperty(bv,"__esModule",{value:!0});bv.LockableBehavior=void 0;var uJ=qt(),pr=te(),gr=class gr extends uJ.Behavior{static canUnlockWith(e,r){let n=gr.require(e,pr.TraitType.LOCKABLE);return!!(n.keyId===r||n.keyIds&&n.keyIds.includes(r))}static canLockWith(e,r){return this.canUnlockWith(e,r)}static requiresKey(e){let r=gr.require(e,pr.TraitType.LOCKABLE);return!!(r.keyId||r.keyIds?.length)}static canLock(e){let r=gr.require(e,pr.TraitType.LOCKABLE);return e.has(pr.TraitType.OPENABLE)&&e.get(pr.TraitType.OPENABLE).isOpen?!1:!r.isLocked}static canUnlock(e){return gr.require(e,pr.TraitType.LOCKABLE).isLocked}static lock(e,r){let n=gr.require(e,pr.TraitType.LOCKABLE);if(n.isLocked)return{success:!1,alreadyLocked:!0,stateChanged:!1};if(e.has(pr.TraitType.OPENABLE)&&e.get(pr.TraitType.OPENABLE).isOpen)return{success:!1,notClosed:!0,stateChanged:!1};if(gr.requiresKey(e)){if(!r)return{success:!1,noKey:!0,stateChanged:!1};if(!this.canLockWith(e,r.id))return{success:!1,wrongKey:!0,stateChanged:!1}}return n.isLocked=!0,{success:!0,stateChanged:!0,lockMessage:n.lockMessage,lockSound:n.lockSound}}static unlock(e,r){let n=gr.require(e,pr.TraitType.LOCKABLE);if(!n.isLocked)return{success:!1,alreadyUnlocked:!0,stateChanged:!1};if(gr.requiresKey(e)){if(!r)return{success:!1,noKey:!0,stateChanged:!1};if(!this.canUnlockWith(e,r.id))return{success:!1,wrongKey:!0,stateChanged:!1}}return n.isLocked=!1,{success:!0,stateChanged:!0,unlockMessage:n.unlockMessage,unlockSound:n.unlockSound}}static forceUnlock(e){let r=gr.require(e,pr.TraitType.LOCKABLE);r.isLocked=!1}static isLocked(e){return gr.require(e,pr.TraitType.LOCKABLE).isLocked}static handleClose(e){let r=gr.require(e,pr.TraitType.LOCKABLE);return r.autoLock&&!r.isLocked?this.lock(e):null}static canOpen(e){return!gr.require(e,pr.TraitType.LOCKABLE).isLocked}static getLockedMessage(e){return gr.require(e,pr.TraitType.LOCKABLE).lockedMessage}};d(gr,"requiredTraits",[pr.TraitType.LOCKABLE]);var EC=gr;bv.LockableBehavior=EC});var bC=p(Ov=>{"use strict";Object.defineProperty(Ov,"__esModule",{value:!0});Ov.WeaponBehavior=void 0;var dJ=qt(),Uo=te(),tm=class tm extends dJ.Behavior{static calculateDamage(e){if(!e.has(Uo.TraitType.WEAPON))throw new Error(`Entity "${e.id}" is not a weapon`);let r=e.get(Uo.TraitType.WEAPON),n=r.maxDamage-r.minDamage,i=r.minDamage+Math.floor(Math.random()*(n+1)),o=Math.random()<.1,a=o?i*2:i,s=!1;return r.breakable&&r.durability!==void 0&&(r.durability--,r.durability<=0&&(s=!0)),{damage:a,weaponType:r.weaponType,criticalHit:o,weaponBroke:s}}static canDamage(e,r){if(!e.has(Uo.TraitType.WEAPON))return!1;if(!r)return!0;let n=e.get(Uo.TraitType.WEAPON);switch(r){case"ghost":case"spirit":return n.weaponType==="magic"||n.weaponType==="blessed";case"armor":case"metal":return n.weaponType==="piercing"||n.weaponType==="magic";default:return!0}}static getWeaponType(e){return tm.require(e,Uo.TraitType.WEAPON).weaponType}static isTwoHanded(e){return tm.require(e,Uo.TraitType.WEAPON).twoHanded}static repair(e){let r=tm.require(e,Uo.TraitType.WEAPON);return r.breakable?(r.durability=r.maxDurability,!0):!1}static isBroken(e){if(!e.has(Uo.TraitType.WEAPON))return!1;let r=e.get(Uo.TraitType.WEAPON);return r.breakable?r.durability!==void 0&&r.durability<=0:!1}};d(tm,"requiredTraits",[Uo.TraitType.WEAPON]);var _C=tm;Ov.WeaponBehavior=_C});var OC=p(Sv=>{"use strict";Object.defineProperty(Sv,"__esModule",{value:!0});Sv.BreakableBehavior=void 0;var mJ=qt(),Zl=te(),Iv=class extends mJ.Behavior{static canBreak(e){return e.has(Zl.TraitType.BREAKABLE)?!e.get(Zl.TraitType.BREAKABLE).broken:!1}static break(e,r){if(!e.has(Zl.TraitType.BREAKABLE))return{success:!1,message:"Entity is not breakable"};let n=e.get(Zl.TraitType.BREAKABLE);if(n.broken)return{success:!1,alreadyBroken:!0};n.broken=!0;let i={success:!0};return i.itemRemoved=!1,i}static isBroken(e){return e.has(Zl.TraitType.BREAKABLE)?e.get(Zl.TraitType.BREAKABLE).broken:!1}};d(Iv,"requiredTraits",[Zl.TraitType.BREAKABLE]);Sv.BreakableBehavior=Iv});var SC=p(Av=>{"use strict";Object.defineProperty(Av,"__esModule",{value:!0});Av.DestructibleBehavior=void 0;var fJ=qt(),qa=te(),Ap=class Ap extends fJ.Behavior{static canDamage(e,r){if(!e.has(qa.TraitType.DESTRUCTIBLE))return!1;let n=e.get(qa.TraitType.DESTRUCTIBLE);return!(n.invulnerable||n.hitPoints<=0||n.requiresWeapon&&!r||n.requiresType&&r!==n.requiresType)}static damage(e,r,n,i){if(!e.has(qa.TraitType.DESTRUCTIBLE))return{success:!1,damage:0,destroyed:!1,remainingHitPoints:0,message:"Entity is not destructible"};let o=e.get(qa.TraitType.DESTRUCTIBLE);if(o.invulnerable)return{success:!1,damage:0,destroyed:!1,remainingHitPoints:o.hitPoints,invulnerable:!0};if(o.requiresWeapon&&!n)return{success:!1,damage:0,destroyed:!1,remainingHitPoints:o.hitPoints,requiresWeapon:!0};if(o.requiresType&&n!==o.requiresType)return{success:!1,damage:0,destroyed:!1,remainingHitPoints:o.hitPoints,wrongWeaponType:!0};let a=Math.max(1,r-o.armor);o.hitPoints=Math.max(0,o.hitPoints-a);let s={success:!0,damage:a,destroyed:o.hitPoints<=0,remainingHitPoints:o.hitPoints,message:o.hitPoints>0?o.damageMessage:o.destroyMessage};if(o.hitPoints<=0){if(o.transformTo){let c=i.getLocation(e.id),l=`transformed ${e.id}`,u=i.createEntity(l,o.transformTo);c&&u&&(i.moveEntity(u.id,c),s.transformedTo=u.id,i.removeEntity(e.id))}o.revealExit&&(s.exitRevealed=o.revealExit)}return s}static isDestroyed(e){return e.has(qa.TraitType.DESTRUCTIBLE)?e.get(qa.TraitType.DESTRUCTIBLE).hitPoints<=0:!1}static getHitPoints(e){return Ap.require(e,qa.TraitType.DESTRUCTIBLE).hitPoints}static repair(e){let r=Ap.require(e,qa.TraitType.DESTRUCTIBLE);return r.hitPoints>=r.maxHitPoints?!1:(r.hitPoints=r.maxHitPoints,!0)}};d(Ap,"requiredTraits",[qa.TraitType.DESTRUCTIBLE]);var IC=Ap;Av.DestructibleBehavior=IC});var RC=p(Rv=>{"use strict";Object.defineProperty(Rv,"__esModule",{value:!0});Rv.CombatBehavior=void 0;var pJ=qt(),Lr=te(),Jl=class Jl extends pJ.Behavior{static canAttack(e){if(!e.has(Lr.TraitType.COMBATANT))return!1;let r=e.get(Lr.TraitType.COMBATANT);return r.isAlive&&r.health>0}static attack(e,r,n){if(!e.has(Lr.TraitType.COMBATANT))return{success:!1,damage:0,killed:!1,remainingHealth:0,message:"Entity is not a combatant"};let i=e.get(Lr.TraitType.COMBATANT);if(!i.isAlive||i.health<=0)return{success:!1,damage:0,killed:!1,remainingHealth:0};let o=Math.max(1,r-i.armor);i.health=Math.max(0,i.health-o);let a={success:!0,damage:o,killed:i.health<=0,remainingHealth:i.health,message:i.hitMessage,retaliated:i.canRetaliate&&i.health>0};if(i.health<=0&&(i.isAlive=!1,a.deathMessage=i.deathMessage,i.dropsInventory)){let s=n.getLocation(e.id),c=n.getContents(e.id),l=[];if(s)for(let u of c)n.moveEntity(u.id,s),l.push(u.id);l.length>0&&(a.droppedItems=l)}return a}static heal(e,r){if(!e.has(Lr.TraitType.COMBATANT))return 0;let n=e.get(Lr.TraitType.COMBATANT);if(!n.isAlive)return 0;let i=n.health;return n.health=Math.min(n.maxHealth,n.health+r),n.health-i}static resurrect(e){if(!e.has(Lr.TraitType.COMBATANT))return!1;let r=e.get(Lr.TraitType.COMBATANT);return r.isAlive?!1:(r.isAlive=!0,r.health=r.maxHealth,!0)}static isAlive(e){if(!e.has(Lr.TraitType.COMBATANT))return!0;let r=e.get(Lr.TraitType.COMBATANT);return r.isAlive&&r.health>0}static getHealth(e){return Jl.require(e,Lr.TraitType.COMBATANT).health}static getHealthPercentage(e){let r=Jl.require(e,Lr.TraitType.COMBATANT);return r.health/r.maxHealth*100}static isHostile(e){return Jl.require(e,Lr.TraitType.COMBATANT).hostile}static setHostile(e,r){let n=Jl.require(e,Lr.TraitType.COMBATANT);n.hostile=r}};d(Jl,"requiredTraits",[Lr.TraitType.COMBATANT]);var AC=Jl;Rv.CombatBehavior=AC});var RU=p(wv=>{"use strict";Object.defineProperty(wv,"__esModule",{value:!0});wv.AttackBehavior=void 0;var dn=te(),gJ=bC(),hJ=OC(),yJ=SC(),vJ=RC(),wC=class{static attack(e,r,n){let i=1,o,a;if(r&&r.has(dn.TraitType.WEAPON)&&(a=gJ.WeaponBehavior.calculateDamage(r),i=a.damage,o=a.weaponType),e.has(dn.TraitType.BREAKABLE)){let s=hJ.BreakableBehavior.break(e,n);if(s.success)return{success:!0,type:"broke",damage:i,targetDestroyed:!0,debrisCreated:s.debrisCreated,weaponBroke:a?.weaponBroke,message:s.message}}if(e.has(dn.TraitType.DESTRUCTIBLE)){let s=yJ.DestructibleBehavior.damage(e,i,o,n);return s.success?{success:!0,type:s.destroyed?"destroyed":"damaged",damage:s.damage,remainingHitPoints:s.remainingHitPoints,targetDestroyed:s.destroyed,transformedTo:s.transformedTo,exitRevealed:s.exitRevealed,weaponBroke:a?.weaponBroke,message:s.message}:{success:!1,type:"ineffective",damage:0,message:s.requiresWeapon?"You need a weapon to damage that.":s.wrongWeaponType?"That weapon won't work on this target.":s.invulnerable?"That cannot be damaged.":"Your attack has no effect."}}if(e.has(dn.TraitType.COMBATANT)){let s=vJ.CombatBehavior.attack(e,i,n);if(s.success)return{success:!0,type:s.killed?"killed":"hit",damage:s.damage,remainingHitPoints:s.remainingHealth,targetKilled:s.killed,itemsDropped:s.droppedItems,weaponBroke:a?.weaponBroke,message:s.killed?s.deathMessage:s.message}}return{success:!1,type:"ineffective",damage:0,message:"Your attack has no effect on that."}}static canAttack(e,r){return e.has(dn.TraitType.BREAKABLE)||e.has(dn.TraitType.DESTRUCTIBLE)||e.has(dn.TraitType.COMBATANT)}static inferWeapon(e){let r=e.filter(i=>i.has(dn.TraitType.WEAPON));if(r.length===0)return;let n=r.filter(i=>{if(!i.has(dn.TraitType.EQUIPPED))return!1;let o=i.get(dn.TraitType.EQUIPPED);return o&&o.isEquipped});return n.length>0?n.reduce((i,o)=>{let a=i.get(dn.TraitType.WEAPON),s=o.get(dn.TraitType.WEAPON);if(!a||!s)return i;let c=a.maxDamage||0;return(s.maxDamage||0)>c?o:i}):r.reduce((i,o)=>{let a=i.get(dn.TraitType.WEAPON),s=o.get(dn.TraitType.WEAPON);if(!a||!s)return i;let c=a.maxDamage||0;return(s.maxDamage||0)>c?o:i})}};wv.AttackBehavior=wC});var CU=p(_e=>{"use strict";Object.defineProperty(_e,"__esModule",{value:!0});_e.AttackBehavior=_e.CombatBehavior=_e.DestructibleBehavior=_e.BreakableBehavior=_e.WeaponBehavior=_e.LockableBehavior=_e.OpenableBehavior=_e.ClimbableBehavior=_e.ExitBehavior=_e.LightSourceBehavior=_e.ReadableBehavior=_e.WearableBehavior=_e.SceneryBehavior=_e.ContainerBehavior=_e.isWorldAwareBehavior=_e.Behavior=void 0;var wU=qt();Object.defineProperty(_e,"Behavior",{enumerable:!0,get:function(){return wU.Behavior}});Object.defineProperty(_e,"isWorldAwareBehavior",{enumerable:!0,get:function(){return wU.isWorldAwareBehavior}});var EJ=Qy();Object.defineProperty(_e,"ContainerBehavior",{enumerable:!0,get:function(){return EJ.ContainerBehavior}});var TJ=eC();Object.defineProperty(_e,"SceneryBehavior",{enumerable:!0,get:function(){return TJ.SceneryBehavior}});var _J=bp();Object.defineProperty(_e,"WearableBehavior",{enumerable:!0,get:function(){return _J.WearableBehavior}});var bJ=tC();Object.defineProperty(_e,"ReadableBehavior",{enumerable:!0,get:function(){return bJ.ReadableBehavior}});var OJ=fC();Object.defineProperty(_e,"LightSourceBehavior",{enumerable:!0,get:function(){return OJ.LightSourceBehavior}});var IJ=pC();Object.defineProperty(_e,"ExitBehavior",{enumerable:!0,get:function(){return IJ.ExitBehavior}});var SJ=hC();Object.defineProperty(_e,"ClimbableBehavior",{enumerable:!0,get:function(){return SJ.ClimbableBehavior}});var AJ=vC();Object.defineProperty(_e,"OpenableBehavior",{enumerable:!0,get:function(){return AJ.OpenableBehavior}});var RJ=TC();Object.defineProperty(_e,"LockableBehavior",{enumerable:!0,get:function(){return RJ.LockableBehavior}});var wJ=bC();Object.defineProperty(_e,"WeaponBehavior",{enumerable:!0,get:function(){return wJ.WeaponBehavior}});var CJ=OC();Object.defineProperty(_e,"BreakableBehavior",{enumerable:!0,get:function(){return CJ.BreakableBehavior}});var NJ=SC();Object.defineProperty(_e,"DestructibleBehavior",{enumerable:!0,get:function(){return NJ.DestructibleBehavior}});var DJ=RC();Object.defineProperty(_e,"CombatBehavior",{enumerable:!0,get:function(){return DJ.CombatBehavior}});var PJ=RU();Object.defineProperty(_e,"AttackBehavior",{enumerable:!0,get:function(){return PJ.AttackBehavior}})});var CC=p(Cv=>{"use strict";Object.defineProperty(Cv,"__esModule",{value:!0});Cv.ActionFailureReason=void 0;Cv.ActionFailureReason={NOT_VISIBLE:"not_visible",NOT_REACHABLE:"not_reachable",NOT_IN_SCOPE:"not_in_scope",FIXED_IN_PLACE:"fixed_in_place",ALREADY_OPEN:"already_open",ALREADY_CLOSED:"already_closed",NOT_OPENABLE:"not_openable",LOCKED:"locked",NOT_LOCKABLE:"not_lockable",ALREADY_LOCKED:"already_locked",ALREADY_UNLOCKED:"already_unlocked",CONTAINER_FULL:"container_full",CONTAINER_CLOSED:"container_closed",NOT_A_CONTAINER:"not_a_container",NOT_A_SUPPORTER:"not_a_supporter",ALREADY_IN_CONTAINER:"already_in_container",NOT_WEARABLE:"not_wearable",ALREADY_WEARING:"already_wearing",NOT_WEARING:"not_wearing",WORN_BY_OTHER:"worn_by_other",TOO_HEAVY:"too_heavy",CARRYING_TOO_MUCH:"carrying_too_much",WRONG_KEY:"wrong_key",NO_KEY_SPECIFIED:"no_key_specified",NOT_A_KEY:"not_a_key",ALREADY_ON:"already_on",ALREADY_OFF:"already_off",NOT_SWITCHABLE:"not_switchable",NO_POWER:"no_power",NO_EXIT_THAT_WAY:"no_exit_that_way",CANT_GO_THAT_WAY:"cant_go_that_way",DOOR_CLOSED:"door_closed",DOOR_LOCKED:"door_locked",CANT_DO_THAT:"cant_do_that",NOT_IMPLEMENTED:"not_implemented",INVALID_TARGET:"invalid_target",NOTHING_HAPPENS:"nothing_happens",ACTOR_CANT_SEE:"actor_cant_see",ACTOR_CANT_REACH:"actor_cant_reach",ACTOR_BUSY:"actor_busy",NOT_EDIBLE:"not_edible",NOTHING_LEFT:"nothing_left",NOT_READABLE:"not_readable",NOTHING_WRITTEN:"nothing_written"}});var NU=p(be=>{"use strict";Object.defineProperty(be,"__esModule",{value:!0});be.DirectionOpposites=be.Direction=void 0;be.getOppositeDirection=LJ;be.isDirection=MJ;be.Direction={NORTH:"NORTH",SOUTH:"SOUTH",EAST:"EAST",WEST:"WEST",NORTHEAST:"NORTHEAST",NORTHWEST:"NORTHWEST",SOUTHEAST:"SOUTHEAST",SOUTHWEST:"SOUTHWEST",UP:"UP",DOWN:"DOWN",IN:"IN",OUT:"OUT"};be.DirectionOpposites={[be.Direction.NORTH]:be.Direction.SOUTH,[be.Direction.SOUTH]:be.Direction.NORTH,[be.Direction.EAST]:be.Direction.WEST,[be.Direction.WEST]:be.Direction.EAST,[be.Direction.NORTHEAST]:be.Direction.SOUTHWEST,[be.Direction.NORTHWEST]:be.Direction.SOUTHEAST,[be.Direction.SOUTHEAST]:be.Direction.NORTHWEST,[be.Direction.SOUTHWEST]:be.Direction.NORTHEAST,[be.Direction.UP]:be.Direction.DOWN,[be.Direction.DOWN]:be.Direction.UP,[be.Direction.IN]:be.Direction.OUT,[be.Direction.OUT]:be.Direction.IN};function LJ(t){return be.DirectionOpposites[t]}function MJ(t){return typeof t=="string"&&Object.values(be.Direction).includes(t)}});var DU=p(Fa=>{"use strict";var kJ=Fa&&Fa.__createBinding||(Object.create?(function(t,e,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}):(function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]})),NC=Fa&&Fa.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&kJ(e,t,r)};Object.defineProperty(Fa,"__esModule",{value:!0});NC(CC(),Fa);NC(em(),Fa);NC(NU(),Fa)});var LU=p(Nv=>{"use strict";Object.defineProperty(Nv,"__esModule",{value:!0});Nv.PartOfSpeech=void 0;var PU;(function(t){t.VERB="VERB",t.NOUN="NOUN",t.ADJECTIVE="ADJECTIVE",t.ARTICLE="ARTICLE",t.PREPOSITION="PREPOSITION",t.PRONOUN="PRONOUN",t.DETERMINER="DETERMINER",t.CONJUNCTION="CONJUNCTION",t.UNKNOWN="UNKNOWN"})(PU||(Nv.PartOfSpeech=PU={}))});var kU=p(MU=>{"use strict";Object.defineProperty(MU,"__esModule",{value:!0})});var BU=p(xU=>{"use strict";Object.defineProperty(xU,"__esModule",{value:!0})});var jU=p(Ga=>{"use strict";var xJ=Ga&&Ga.__createBinding||(Object.create?(function(t,e,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}):(function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]})),DC=Ga&&Ga.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&xJ(e,t,r)};Object.defineProperty(Ga,"__esModule",{value:!0});DC(LU(),Ga);DC(kU(),Ga);DC(BU(),Ga)});var HU=p(WU=>{"use strict";Object.defineProperty(WU,"__esModule",{value:!0})});var qU=p(UU=>{"use strict";Object.defineProperty(UU,"__esModule",{value:!0})});var GU=p(FU=>{"use strict";Object.defineProperty(FU,"__esModule",{value:!0})});var YU=p(VU=>{"use strict";Object.defineProperty(VU,"__esModule",{value:!0})});var zU=p(qo=>{"use strict";var BJ=qo&&qo.__createBinding||(Object.create?(function(t,e,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}):(function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]})),Dv=qo&&qo.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&BJ(e,t,r)};Object.defineProperty(qo,"__esModule",{value:!0});Dv(HU(),qo);Dv(qU(),qo);Dv(GU(),qo);Dv(YU(),qo)});var PC=p(Lv=>{"use strict";Object.defineProperty(Lv,"__esModule",{value:!0});Lv.IdentityTrait=void 0;var $U=te(),Pv=class{constructor(e){d(this,"type",$U.TraitType.IDENTITY);d(this,"name","");d(this,"description","");d(this,"nameId");d(this,"descriptionId");d(this,"aliases",[]);d(this,"brief");d(this,"properName",!1);d(this,"article","a");d(this,"concealed",!1);d(this,"weight");d(this,"volume");d(this,"size");d(this,"grammaticalNumber");d(this,"adjectives",[]);d(this,"nounType");e&&Object.assign(this,e)}};d(Pv,"type",$U.TraitType.IDENTITY);Lv.IdentityTrait=Pv});var LC=p(kv=>{"use strict";Object.defineProperty(kv,"__esModule",{value:!0});kv.ContainerTrait=void 0;var KU=te(),Mv=class{constructor(e){d(this,"type",KU.TraitType.CONTAINER);d(this,"capacity");d(this,"isTransparent");d(this,"enterable");d(this,"allowedTypes");d(this,"excludedTypes");this.isTransparent=!1,this.enterable=!1,e&&(e.capacity!==void 0&&(this.capacity=e.capacity),e.isTransparent!==void 0&&(this.isTransparent=e.isTransparent),e.enterable!==void 0&&(this.enterable=e.enterable),e.allowedTypes!==void 0&&(this.allowedTypes=e.allowedTypes),e.excludedTypes!==void 0&&(this.excludedTypes=e.excludedTypes))}};d(Mv,"type",KU.TraitType.CONTAINER);kv.ContainerTrait=Mv});var MC=p(Bv=>{"use strict";Object.defineProperty(Bv,"__esModule",{value:!0});Bv.SupporterTrait=void 0;var QU=te(),xv=class{constructor(e){d(this,"type",QU.TraitType.SUPPORTER);d(this,"capacity");d(this,"enterable",!1);d(this,"allowedTypes");d(this,"excludedTypes");e&&Object.assign(this,e)}};d(xv,"type",QU.TraitType.SUPPORTER);Bv.SupporterTrait=xv});var kC=p(Wv=>{"use strict";Object.defineProperty(Wv,"__esModule",{value:!0});Wv.RoomTrait=void 0;var XU=te(),jv=class{constructor(e={}){d(this,"type",XU.TraitType.ROOM);d(this,"visited");d(this,"exits");d(this,"blockedExits");d(this,"outdoor");d(this,"isDark");d(this,"isOutdoors");d(this,"isUnderground");d(this,"initialDescription");d(this,"initialDescriptionId");d(this,"ambientSound");d(this,"ambientSmell");d(this,"region");d(this,"tags");d(this,"capacity");d(this,"allowedTypes");d(this,"excludedTypes");d(this,"isTransparent",!0);d(this,"enterable",!0);this.visited=e.visited??!1,this.exits=e.exits??{},this.blockedExits=e.blockedExits,this.outdoor=e.outdoor??!1,this.isDark=e.isDark??!1,this.isOutdoors=e.isOutdoors??!1,this.isUnderground=e.isUnderground??!1,this.initialDescription=e.initialDescription,this.initialDescriptionId=e.initialDescriptionId,this.ambientSound=e.ambientSound,this.ambientSmell=e.ambientSmell,this.region=e.region,this.tags=e.tags??[],this.capacity=e.capacity,this.allowedTypes=e.allowedTypes,this.excludedTypes=e.excludedTypes}};d(jv,"type",XU.TraitType.ROOM);Wv.RoomTrait=jv});var xC=p(Uv=>{"use strict";Object.defineProperty(Uv,"__esModule",{value:!0});Uv.WearableTrait=void 0;var ZU=te(),Hv=class{constructor(e={}){d(this,"type",ZU.TraitType.WEARABLE);d(this,"worn",!1);d(this,"wornBy");d(this,"slot");d(this,"layer");d(this,"wearMessage");d(this,"removeMessage");d(this,"wearableOver");d(this,"blocksSlots");d(this,"weight");d(this,"bulk");d(this,"canRemove");d(this,"bodyPart");this.worn=e.isWorn??!1,this.wornBy=e.wornBy,this.slot=e.slot??"clothing",this.layer=e.layer??1,this.wearMessage=e.wearMessage,this.removeMessage=e.removeMessage,this.wearableOver=e.wearableOver??!0,this.blocksSlots=e.blocksSlots??[],this.weight=e.weight??1,this.bulk=e.bulk??1,this.canRemove=e.canRemove??!0,this.bodyPart=e.bodyPart??"torso"}get isWorn(){return this.worn}set isWorn(e){this.worn=e}};d(Hv,"type",ZU.TraitType.WEARABLE);Uv.WearableTrait=Hv});var BC=p(Fv=>{"use strict";Object.defineProperty(Fv,"__esModule",{value:!0});Fv.ClothingTrait=void 0;var JU=te(),qv=class{constructor(e={}){d(this,"type",JU.TraitType.CLOTHING);d(this,"worn",!1);d(this,"wornBy");d(this,"slot");d(this,"layer");d(this,"wearMessage");d(this,"removeMessage");d(this,"wearableOver");d(this,"blocksSlots");d(this,"weight");d(this,"bulk");d(this,"canRemove");d(this,"bodyPart");d(this,"material");d(this,"style");d(this,"damageable");d(this,"condition");this.worn=e.isWorn??!1,this.wornBy=e.wornBy,this.slot=e.slot??"clothing",this.layer=e.layer??1,this.wearMessage=e.wearMessage,this.removeMessage=e.removeMessage,this.wearableOver=e.wearableOver??!0,this.blocksSlots=e.blocksSlots??[],this.weight=e.weight??1,this.bulk=e.bulk??1,this.canRemove=e.canRemove??!0,this.bodyPart=e.bodyPart??"torso",this.material=e.material??"fabric",this.style=e.style??"casual",this.damageable=e.damageable??!0,this.condition=e.condition??"good"}get isWorn(){return this.worn}set isWorn(e){this.worn=e}};d(qv,"type",JU.TraitType.CLOTHING);Fv.ClothingTrait=qv});var jC=p(Vv=>{"use strict";Object.defineProperty(Vv,"__esModule",{value:!0});Vv.EdibleTrait=void 0;var eq=te(),Gv=class{constructor(e={}){d(this,"type",eq.TraitType.EDIBLE);d(this,"nutrition");d(this,"servings");d(this,"liquid");d(this,"consumeMessage");d(this,"remainsType");d(this,"hasEffect");d(this,"effectDescription");d(this,"weight");d(this,"bulk");d(this,"taste");d(this,"effects");d(this,"satisfiesHunger");let r=e.servings??e.portions??1;this.servings=e.consumed?0:r,this.nutrition=e.nutrition??1,this.liquid=e.liquid??e.isDrink??!1,this.consumeMessage=e.consumeMessage,this.remainsType=e.remainsType,this.hasEffect=e.hasEffect??(e.effects&&e.effects.length>0)??!1,this.effectDescription=e.effectDescription,this.weight=e.weight??1,this.bulk=e.bulk??1,this.taste=e.taste,this.effects=e.effects,this.satisfiesHunger=e.satisfiesHunger}};d(Gv,"type",eq.TraitType.EDIBLE);Vv.EdibleTrait=Gv});var WC=p(zv=>{"use strict";Object.defineProperty(zv,"__esModule",{value:!0});zv.SceneryTrait=void 0;var tq=te(),Yv=class{constructor(e){d(this,"type",tq.TraitType.SCENERY);d(this,"cantTakeMessage");d(this,"mentioned",!0);d(this,"visible",!0);e&&Object.assign(this,e)}};d(Yv,"type",tq.TraitType.SCENERY);zv.SceneryTrait=Yv});var Qv=p(Kv=>{"use strict";Object.defineProperty(Kv,"__esModule",{value:!0});Kv.OpenableTrait=void 0;var rq=te(),$v=class{constructor(e={}){d(this,"type",rq.TraitType.OPENABLE);d(this,"isOpen");d(this,"startsOpen");d(this,"openMessage");d(this,"closeMessage");d(this,"alreadyOpenMessage");d(this,"alreadyClosedMessage");d(this,"revealsContents");d(this,"canClose");d(this,"openSound");d(this,"closeSound");this.startsOpen=e.startsOpen??!1,this.isOpen=e.isOpen??this.startsOpen,this.openMessage=e.openMessage,this.closeMessage=e.closeMessage,this.alreadyOpenMessage=e.alreadyOpenMessage,this.alreadyClosedMessage=e.alreadyClosedMessage,this.revealsContents=e.revealsContents??!0,this.canClose=e.canClose??!0,this.openSound=e.openSound,this.closeSound=e.closeSound}};d($v,"type",rq.TraitType.OPENABLE);Kv.OpenableTrait=$v});var Jv=p(Zv=>{"use strict";Object.defineProperty(Zv,"__esModule",{value:!0});Zv.LockableTrait=void 0;var nq=te(),Xv=class{constructor(e={}){d(this,"type",nq.TraitType.LOCKABLE);d(this,"isLocked");d(this,"startsLocked");d(this,"keyId");d(this,"keyIds");d(this,"acceptsMasterKey");d(this,"lockMessage");d(this,"unlockMessage");d(this,"alreadyLockedMessage");d(this,"alreadyUnlockedMessage");d(this,"lockedMessage");d(this,"wrongKeyMessage");d(this,"autoLock");d(this,"lockSound");d(this,"unlockSound");this.startsLocked=e.startsLocked??!1,this.isLocked=e.isLocked??this.startsLocked,this.keyId=e.keyId,this.keyIds=e.keyIds,this.acceptsMasterKey=e.acceptsMasterKey??!0,this.lockMessage=e.lockMessage,this.unlockMessage=e.unlockMessage,this.alreadyLockedMessage=e.alreadyLockedMessage,this.alreadyUnlockedMessage=e.alreadyUnlockedMessage,this.lockedMessage=e.lockedMessage,this.wrongKeyMessage=e.wrongKeyMessage,this.autoLock=e.autoLock??!1,this.lockSound=e.lockSound,this.unlockSound=e.unlockSound}};d(Xv,"type",nq.TraitType.LOCKABLE);Zv.LockableTrait=Xv});var HC=p(tE=>{"use strict";Object.defineProperty(tE,"__esModule",{value:!0});tE.SwitchableTrait=void 0;var iq=te(),eE=class{constructor(e={}){d(this,"type",iq.TraitType.SWITCHABLE);d(this,"isOn");d(this,"startsOn");d(this,"powerConsumption");d(this,"requiresPower");d(this,"hasPower");d(this,"onMessage");d(this,"offMessage");d(this,"alreadyOnMessage");d(this,"alreadyOffMessage");d(this,"noPowerMessage");d(this,"onSound");d(this,"offSound");d(this,"runningSound");d(this,"autoOffTime");d(this,"autoOffCounter");this.startsOn=e.startsOn??!1,this.requiresPower=e.requiresPower??!1,this.hasPower=e.hasPower??!0,this.isOn=e.isOn??(this.startsOn&&this.hasPower),this.powerConsumption=e.powerConsumption??1,this.onMessage=e.onMessage,this.offMessage=e.offMessage,this.alreadyOnMessage=e.alreadyOnMessage,this.alreadyOffMessage=e.alreadyOffMessage,this.noPowerMessage=e.noPowerMessage,this.onSound=e.onSound,this.offSound=e.offSound,this.runningSound=e.runningSound,this.autoOffTime=e.autoOffTime??0,this.autoOffCounter=e.autoOffCounter??(this.isOn&&this.autoOffTime>0?this.autoOffTime:0)}};d(eE,"type",iq.TraitType.SWITCHABLE);tE.SwitchableTrait=eE});var UC=p(nE=>{"use strict";Object.defineProperty(nE,"__esModule",{value:!0});nE.ReadableTrait=void 0;var oq=te(),rE=class{constructor(e){d(this,"type",oq.TraitType.READABLE);d(this,"text","");d(this,"preview");d(this,"isReadable",!0);d(this,"language","common");d(this,"requiresAbility",!1);d(this,"requiredAbility");d(this,"cannotReadMessage");d(this,"hasBeenRead",!1);d(this,"readableType","text");d(this,"pages");d(this,"currentPage");d(this,"pageContent");e&&Object.assign(this,e),this.pageContent&&this.pageContent.length>0&&!this.currentPage&&(this.currentPage=1,this.pages=this.pageContent.length)}};d(rE,"type",oq.TraitType.READABLE);nE.ReadableTrait=rE});var qC=p(oE=>{"use strict";Object.defineProperty(oE,"__esModule",{value:!0});oE.LightSourceTrait=void 0;var aq=te(),iE=class{constructor(e){d(this,"type",aq.TraitType.LIGHT_SOURCE);d(this,"brightness",5);d(this,"isLit");d(this,"fuelRemaining");d(this,"maxFuel");d(this,"fuelConsumptionRate");e&&Object.assign(this,e)}};d(iE,"type",aq.TraitType.LIGHT_SOURCE);oE.LightSourceTrait=iE});var FC=p(sE=>{"use strict";Object.defineProperty(sE,"__esModule",{value:!0});sE.DoorTrait=void 0;var sq=te(),aE=class{constructor(e){d(this,"type",sq.TraitType.DOOR);d(this,"room1");d(this,"room2");d(this,"bidirectional",!0);if(e&&Object.assign(this,e),!this.room1||!this.room2)throw new Error("Door must connect two rooms")}};d(aE,"type",sq.TraitType.DOOR);sE.DoorTrait=aE});var VC=p(rm=>{"use strict";Object.defineProperty(rm,"__esModule",{value:!0});rm.ClimbableTrait=void 0;rm.isClimbableTrait=jJ;rm.createClimbableTrait=WJ;var GC=te(),Rp=class{constructor(e={}){d(this,"type",GC.TraitType.CLIMBABLE);d(this,"canClimb");d(this,"blockedMessage");d(this,"direction");d(this,"destination");d(this,"successMessage");this.canClimb=e.canClimb??!0,this.blockedMessage=e.blockedMessage,this.direction=e.direction??"both",this.destination=e.destination,this.successMessage=e.successMessage}};d(Rp,"type",GC.TraitType.CLIMBABLE);rm.ClimbableTrait=Rp;function jJ(t){return t.type===GC.TraitType.CLIMBABLE}function WJ(t={}){return new Rp(t)}});var YC=p(Va=>{"use strict";Object.defineProperty(Va,"__esModule",{value:!0});Va.ActorTrait=Va.HONORIFICS=Va.PRONOUNS=void 0;var cq=te();Va.PRONOUNS={HE_HIM:{subject:"he",object:"him",possessive:"his",possessiveAdj:"his",reflexive:"himself",verbForm:"singular"},SHE_HER:{subject:"she",object:"her",possessive:"hers",possessiveAdj:"her",reflexive:"herself",verbForm:"singular"},THEY_THEM:{subject:"they",object:"them",possessive:"theirs",possessiveAdj:"their",reflexive:"themselves",verbForm:"plural"},XE_XEM:{subject:"xe",object:"xem",possessive:"xyrs",possessiveAdj:"xyr",reflexive:"xemself",verbForm:"singular"},ZE_ZIR:{subject:"ze",object:"zir",possessive:"zirs",possessiveAdj:"zir",reflexive:"zirself",verbForm:"singular"},ZE_HIR:{subject:"ze",object:"hir",possessive:"hirs",possessiveAdj:"hir",reflexive:"hirself",verbForm:"singular"},EY_EM:{subject:"ey",object:"em",possessive:"eirs",possessiveAdj:"eir",reflexive:"emself",verbForm:"singular"},FAE_FAER:{subject:"fae",object:"faer",possessive:"faers",possessiveAdj:"faer",reflexive:"faerself",verbForm:"singular"}};Va.HONORIFICS={MR:"Mr.",MRS:"Mrs.",MS:"Ms.",MX:"Mx.",MISS:"Miss",DR:"Dr.",PROF:"Prof."};var cE=class{constructor(e){d(this,"type",cq.TraitType.ACTOR);d(this,"isPlayer",!1);d(this,"isPlayable",!0);d(this,"state");d(this,"pronouns",Va.PRONOUNS.THEY_THEM);d(this,"honorific");d(this,"grammaticalGender");d(this,"briefDescription");d(this,"capacity");d(this,"allowedTypes");d(this,"excludedTypes");d(this,"isTransparent",!1);d(this,"enterable",!1);d(this,"customProperties");e&&(this.isPlayer=e.isPlayer??this.isPlayer,this.isPlayable=e.isPlayable??this.isPlayable,this.state=e.state,this.customProperties=e.customProperties,e.pronouns&&(this.pronouns=e.pronouns),this.honorific=e.honorific,this.grammaticalGender=e.grammaticalGender,this.briefDescription=e.briefDescription,this.capacity=e.capacity,this.allowedTypes=e.allowedTypes,this.excludedTypes=e.excludedTypes)}getPrimaryPronouns(){return Array.isArray(this.pronouns)?this.pronouns[0]:this.pronouns}setPronouns(e){this.pronouns=e}setInventoryLimit(e){this.capacity={...this.capacity,...e}}makePlayer(){this.isPlayer=!0,this.isPlayable=!0}setCustomProperty(e,r){this.customProperties||(this.customProperties={}),this.customProperties[e]=r}getCustomProperty(e){return this.customProperties?.[e]}};d(cE,"type",cq.TraitType.ACTOR);Va.ActorTrait=cE});var zC=p(uE=>{"use strict";Object.defineProperty(uE,"__esModule",{value:!0});uE.PullableTrait=void 0;var lq=te(),lE=class{constructor(e={}){d(this,"type",lq.TraitType.PULLABLE);d(this,"pullType");d(this,"activates");d(this,"linkedTo");d(this,"pullSound");d(this,"requiresStrength");d(this,"repeatable");d(this,"state");d(this,"pullCount");d(this,"maxPulls");d(this,"detachesOnPull");d(this,"effects");this.pullType=e.pullType??"lever",this.activates=e.activates,this.linkedTo=e.linkedTo,this.pullSound=e.pullSound,this.requiresStrength=e.requiresStrength,this.repeatable=e.repeatable??!0,this.state=e.state??"default",this.pullCount=e.pullCount??0,this.maxPulls=e.maxPulls,this.detachesOnPull=e.detachesOnPull??!1,this.effects=e.effects}};d(lE,"type",lq.TraitType.PULLABLE);uE.PullableTrait=lE});var $C=p(mE=>{"use strict";Object.defineProperty(mE,"__esModule",{value:!0});mE.AttachedTrait=void 0;var uq=te(),dE=class{constructor(e={}){d(this,"type",uq.TraitType.ATTACHED);d(this,"attachedTo");d(this,"attachmentType");d(this,"detachable");d(this,"detachForce");d(this,"loose");d(this,"detachSound");d(this,"onDetach");this.attachedTo=e.attachedTo,this.attachmentType=e.attachmentType??"stuck",this.detachable=e.detachable??!1,this.detachForce=e.detachForce,this.loose=e.loose??!1,this.detachSound=e.detachSound,this.onDetach=e.onDetach}};d(dE,"type",uq.TraitType.ATTACHED);mE.AttachedTrait=dE});var KC=p(pE=>{"use strict";Object.defineProperty(pE,"__esModule",{value:!0});pE.PushableTrait=void 0;var dq=te(),fE=class{constructor(e={}){d(this,"type",dq.TraitType.PUSHABLE);d(this,"pushType");d(this,"revealsPassage");d(this,"pushSound");d(this,"requiresStrength");d(this,"repeatable");d(this,"state");d(this,"pushCount");d(this,"maxPushes");d(this,"pushDirection");d(this,"activates");d(this,"effects");this.pushType=e.pushType??"button",this.revealsPassage=e.revealsPassage,this.pushSound=e.pushSound,this.requiresStrength=e.requiresStrength,this.repeatable=e.repeatable??!0,this.state=e.state??"default",this.pushCount=e.pushCount??0,this.maxPushes=e.maxPushes,this.pushDirection=e.pushDirection,this.activates=e.activates,this.effects=e.effects}};d(fE,"type",dq.TraitType.PUSHABLE);pE.PushableTrait=fE});var QC=p(hE=>{"use strict";Object.defineProperty(hE,"__esModule",{value:!0});hE.ButtonTrait=void 0;var mq=te(),gE=class{constructor(e={}){d(this,"type",mq.TraitType.BUTTON);d(this,"latching");d(this,"color");d(this,"size");d(this,"shape");d(this,"material");d(this,"label");d(this,"pressed");this.latching=e.latching??!1,this.color=e.color,this.size=e.size,this.shape=e.shape,this.material=e.material,this.label=e.label,this.pressed=e.pressed??!1}};d(gE,"type",mq.TraitType.BUTTON);hE.ButtonTrait=gE});var XC=p(vE=>{"use strict";Object.defineProperty(vE,"__esModule",{value:!0});vE.MoveableSceneryTrait=void 0;var fq=te(),yE=class{constructor(e={}){d(this,"type",fq.TraitType.MOVEABLE_SCENERY);d(this,"weightClass");d(this,"revealsWhenMoved");d(this,"reveals");d(this,"blocksExits");d(this,"blockedExits");d(this,"moved");d(this,"originalRoom");d(this,"moveSound");d(this,"requiresMultiplePeople");d(this,"peopleRequired");this.weightClass=e.weightClass??"heavy",this.revealsWhenMoved=e.revealsWhenMoved??!1,this.reveals=e.reveals,this.blocksExits=e.blocksExits??!1,this.blockedExits=e.blockedExits,this.moved=e.moved??!1,this.originalRoom=e.originalRoom,this.moveSound=e.moveSound,this.requiresMultiplePeople=e.requiresMultiplePeople??!1,this.peopleRequired=e.peopleRequired}};d(yE,"type",fq.TraitType.MOVEABLE_SCENERY);vE.MoveableSceneryTrait=yE});var pq=p(TE=>{"use strict";Object.defineProperty(TE,"__esModule",{value:!0});TE.WeaponTrait=void 0;var EE=class{constructor(e={}){d(this,"type","weapon");d(this,"damage");d(this,"skillBonus");d(this,"isBlessed");d(this,"glowsNearDanger");d(this,"isGlowing");d(this,"requiredTrait");d(this,"minDamage");d(this,"maxDamage");d(this,"weaponType");d(this,"twoHanded");d(this,"attackMessage");d(this,"hitSound");d(this,"breakable");d(this,"durability");d(this,"maxDurability");this.damage=e.damage??e.maxDamage??1,this.skillBonus=e.skillBonus??0,this.isBlessed=e.isBlessed??!1,this.glowsNearDanger=e.glowsNearDanger??!1,this.isGlowing=e.isGlowing??!1,this.requiredTrait=e.requiredTrait,this.minDamage=e.minDamage??1,this.maxDamage=e.maxDamage??e.minDamage??1,this.weaponType=e.weaponType??"blunt",this.twoHanded=e.twoHanded??!1,this.attackMessage=e.attackMessage,this.hitSound=e.hitSound,this.breakable=e.breakable??!1,this.durability=e.durability,this.maxDurability=e.maxDurability}setGlowing(e){this.isGlowing=e}};d(EE,"type","weapon");TE.WeaponTrait=EE});var gq=p(bE=>{"use strict";Object.defineProperty(bE,"__esModule",{value:!0});bE.BreakableTrait=void 0;var _E=class{constructor(e={}){d(this,"type","breakable");d(this,"broken");this.broken=e.broken??!1}};d(_E,"type","breakable");bE.BreakableTrait=_E});var hq=p(IE=>{"use strict";Object.defineProperty(IE,"__esModule",{value:!0});IE.DestructibleTrait=void 0;var OE=class{constructor(e={}){d(this,"type","destructible");d(this,"hitPoints");d(this,"maxHitPoints");d(this,"requiresWeapon");d(this,"requiresType");d(this,"transformTo");d(this,"revealExit");d(this,"damageMessage");d(this,"destroyMessage");d(this,"invulnerable");d(this,"armor");this.hitPoints=e.hitPoints??e.maxHitPoints??3,this.maxHitPoints=e.maxHitPoints??3,this.requiresWeapon=e.requiresWeapon??!1,this.requiresType=e.requiresType,this.transformTo=e.transformTo,this.revealExit=e.revealExit,this.damageMessage=e.damageMessage,this.destroyMessage=e.destroyMessage,this.invulnerable=e.invulnerable??!1,this.armor=e.armor??0}};d(OE,"type","destructible");IE.DestructibleTrait=OE});var yq=p(AE=>{"use strict";Object.defineProperty(AE,"__esModule",{value:!0});AE.CombatantTrait=void 0;var SE=class{constructor(e={}){d(this,"type","combatant");d(this,"health");d(this,"maxHealth");d(this,"skill");d(this,"baseDamage");d(this,"isConscious");d(this,"recoveryTurns");d(this,"armor");d(this,"attackPower");d(this,"defense");d(this,"isAlive");d(this,"hitMessage");d(this,"deathMessage");d(this,"attackMessage");d(this,"hostile");d(this,"canRetaliate");d(this,"dropsInventory");d(this,"experienceValue");this.health=e.health??e.maxHealth??10,this.maxHealth=e.maxHealth??10,this.skill=e.skill??30,this.baseDamage=e.baseDamage??e.attackPower??1,this.isConscious=e.isConscious??!0,this.recoveryTurns=e.recoveryTurns,this.armor=e.armor??0,this.attackPower=e.attackPower??1,this.defense=e.defense??0,this.isAlive=e.isAlive??!0,this.hitMessage=e.hitMessage,this.deathMessage=e.deathMessage,this.attackMessage=e.attackMessage,this.hostile=e.hostile??!1,this.canRetaliate=e.canRetaliate??!0,this.dropsInventory=e.dropsInventory??!0,this.experienceValue=e.experienceValue??0}get alive(){return this.health>0}get canAct(){return this.isAlive&&this.isConscious}knockOut(e){this.isConscious=!1,e!==void 0&&(this.recoveryTurns=e)}wakeUp(){this.isAlive&&(this.isConscious=!0,this.recoveryTurns=void 0)}kill(){this.health=0,this.isAlive=!1,this.isConscious=!1}takeDamage(e){let r=Math.max(0,e-this.armor);return this.health=Math.max(0,this.health-r),this.health<=0?(this.kill(),!0):(this.health<=this.maxHealth*.2&&this.knockOut(),!1)}heal(e){this.isAlive&&(this.health=Math.min(this.maxHealth,this.health+e),this.health>this.maxHealth*.2&&this.wakeUp())}};d(SE,"type","combatant");AE.CombatantTrait=SE});var vq=p(wE=>{"use strict";Object.defineProperty(wE,"__esModule",{value:!0});wE.EquippedTrait=void 0;var RE=class{constructor(e={}){d(this,"type","equipped");d(this,"slot");d(this,"isEquipped");d(this,"equipMessage");d(this,"unequipMessage");d(this,"quickEquip");d(this,"modifiers");this.slot=e.slot??"accessory",this.isEquipped=e.isEquipped??!1,this.equipMessage=e.equipMessage,this.unequipMessage=e.unequipMessage,this.quickEquip=e.quickEquip??!1,this.modifiers=e.modifiers}};d(RE,"type","equipped");wE.EquippedTrait=RE});var ZC=p(NE=>{"use strict";Object.defineProperty(NE,"__esModule",{value:!0});NE.NpcTrait=void 0;var CE=class{constructor(e={}){d(this,"type","npc");d(this,"isAlive");d(this,"isConscious");d(this,"isHostile");d(this,"canMove");d(this,"allowedRooms");d(this,"forbiddenRooms");d(this,"behaviorId");d(this,"conversationState");d(this,"knowledge");d(this,"goals");d(this,"customProperties");this.isAlive=e.isAlive??!0,this.isConscious=e.isConscious??!0,this.isHostile=e.isHostile??!1,this.canMove=e.canMove??!1,this.allowedRooms=e.allowedRooms,this.forbiddenRooms=e.forbiddenRooms,this.behaviorId=e.behaviorId,this.conversationState=e.conversationState,this.knowledge=e.knowledge,this.goals=e.goals,this.customProperties=e.customProperties}get canAct(){return this.isAlive&&this.isConscious}canEnterRoom(e){return!(!this.canMove||this.forbiddenRooms?.includes(e)||this.allowedRooms&&!this.allowedRooms.includes(e))}makeHostile(){this.isHostile=!0}makePassive(){this.isHostile=!1}knockOut(){this.isConscious=!1}wakeUp(){this.isAlive&&(this.isConscious=!0)}kill(){this.isAlive=!1,this.isConscious=!1}revive(){this.isAlive=!0,this.isConscious=!0}setKnowledge(e,r){this.knowledge||(this.knowledge={}),this.knowledge[e]=r}getKnowledge(e){return this.knowledge?.[e]}knows(e){return this.knowledge?.[e]!==void 0}addGoal(e){this.goals||(this.goals=[]),this.goals.includes(e)||this.goals.push(e)}removeGoal(e){this.goals&&(this.goals=this.goals.filter(r=>r!==e))}hasGoal(e){return this.goals?.includes(e)??!1}setCustomProperty(e,r){this.customProperties||(this.customProperties={}),this.customProperties[e]=r}getCustomProperty(e){return this.customProperties?.[e]}};d(CE,"type","npc");NE.NpcTrait=CE});var eN=p(nm=>{"use strict";Object.defineProperty(nm,"__esModule",{value:!0});nm.VehicleTrait=void 0;nm.isVehicleTrait=HJ;nm.createVehicleTrait=UJ;var JC=te(),wp=class{constructor(e={}){d(this,"type",JC.TraitType.VEHICLE);d(this,"vehicleType");d(this,"movesWithContents",!0);d(this,"blocksWalkingMovement");d(this,"requiresExitBeforeLeaving");d(this,"currentPosition");d(this,"positionRooms");d(this,"isOperational");d(this,"notOperationalReason");d(this,"transparent");this.vehicleType=e.vehicleType??"generic",this.blocksWalkingMovement=e.blocksWalkingMovement??!0,this.requiresExitBeforeLeaving=e.requiresExitBeforeLeaving??!0,this.currentPosition=e.currentPosition,this.positionRooms=e.positionRooms,this.isOperational=e.isOperational??!0,this.notOperationalReason=e.notOperationalReason,this.transparent=e.transparent??!0}};d(wp,"type",JC.TraitType.VEHICLE);nm.VehicleTrait=wp;function HJ(t){return t.type===JC.TraitType.VEHICLE}function UJ(t={}){return new wp(t)}});var Eq=p(im=>{"use strict";Object.defineProperty(im,"__esModule",{value:!0});im.EnterableTrait=void 0;im.isEnterableTrait=qJ;im.createEnterableTrait=FJ;var tN=te(),Cp=class{constructor(e){d(this,"type",tN.TraitType.ENTERABLE);d(this,"preposition");this.preposition=e?.preposition??"in"}};d(Cp,"type",tN.TraitType.ENTERABLE);im.EnterableTrait=Cp;function qJ(t){return t.type===tN.TraitType.ENTERABLE}function FJ(t){return new Cp(t)}});var Qq=p(z=>{"use strict";Object.defineProperty(z,"__esModule",{value:!0});z.EnterableTrait=z.VehicleTrait=z.NpcTrait=z.EquippedTrait=z.CombatantTrait=z.DestructibleTrait=z.BreakableTrait=z.WeaponTrait=z.MoveableSceneryTrait=z.ButtonTrait=z.PushableTrait=z.AttachedTrait=z.PullableTrait=z.ClimbableTrait=z.ExitTrait=z.ActorTrait=z.DoorTrait=z.LightSourceTrait=z.ReadableTrait=z.SwitchableTrait=z.LockableTrait=z.OpenableTrait=z.SceneryTrait=z.EdibleTrait=z.ClothingTrait=z.WearableTrait=z.RoomTrait=z.SupporterTrait=z.ContainerTrait=z.IdentityTrait=z.TRAIT_IMPLEMENTATIONS=void 0;z.getTraitImplementation=GJ;z.createTrait=VJ;var Le=te(),Tq=PC();Object.defineProperty(z,"IdentityTrait",{enumerable:!0,get:function(){return Tq.IdentityTrait}});var _q=LC();Object.defineProperty(z,"ContainerTrait",{enumerable:!0,get:function(){return _q.ContainerTrait}});var bq=MC();Object.defineProperty(z,"SupporterTrait",{enumerable:!0,get:function(){return bq.SupporterTrait}});var Oq=kC();Object.defineProperty(z,"RoomTrait",{enumerable:!0,get:function(){return Oq.RoomTrait}});var Iq=xC();Object.defineProperty(z,"WearableTrait",{enumerable:!0,get:function(){return Iq.WearableTrait}});var Sq=BC();Object.defineProperty(z,"ClothingTrait",{enumerable:!0,get:function(){return Sq.ClothingTrait}});var Aq=jC();Object.defineProperty(z,"EdibleTrait",{enumerable:!0,get:function(){return Aq.EdibleTrait}});var Rq=WC();Object.defineProperty(z,"SceneryTrait",{enumerable:!0,get:function(){return Rq.SceneryTrait}});var wq=Qv();Object.defineProperty(z,"OpenableTrait",{enumerable:!0,get:function(){return wq.OpenableTrait}});var Cq=Jv();Object.defineProperty(z,"LockableTrait",{enumerable:!0,get:function(){return Cq.LockableTrait}});var Nq=HC();Object.defineProperty(z,"SwitchableTrait",{enumerable:!0,get:function(){return Nq.SwitchableTrait}});var Dq=UC();Object.defineProperty(z,"ReadableTrait",{enumerable:!0,get:function(){return Dq.ReadableTrait}});var Pq=qC();Object.defineProperty(z,"LightSourceTrait",{enumerable:!0,get:function(){return Pq.LightSourceTrait}});var Lq=FC();Object.defineProperty(z,"DoorTrait",{enumerable:!0,get:function(){return Lq.DoorTrait}});var Mq=VC();Object.defineProperty(z,"ClimbableTrait",{enumerable:!0,get:function(){return Mq.ClimbableTrait}});var kq=YC();Object.defineProperty(z,"ActorTrait",{enumerable:!0,get:function(){return kq.ActorTrait}});var xq=gv();Object.defineProperty(z,"ExitTrait",{enumerable:!0,get:function(){return xq.ExitTrait}});var Bq=zC();Object.defineProperty(z,"PullableTrait",{enumerable:!0,get:function(){return Bq.PullableTrait}});var jq=$C();Object.defineProperty(z,"AttachedTrait",{enumerable:!0,get:function(){return jq.AttachedTrait}});var Wq=KC();Object.defineProperty(z,"PushableTrait",{enumerable:!0,get:function(){return Wq.PushableTrait}});var Hq=QC();Object.defineProperty(z,"ButtonTrait",{enumerable:!0,get:function(){return Hq.ButtonTrait}});var Uq=XC();Object.defineProperty(z,"MoveableSceneryTrait",{enumerable:!0,get:function(){return Uq.MoveableSceneryTrait}});var qq=pq();Object.defineProperty(z,"WeaponTrait",{enumerable:!0,get:function(){return qq.WeaponTrait}});var Fq=gq();Object.defineProperty(z,"BreakableTrait",{enumerable:!0,get:function(){return Fq.BreakableTrait}});var Gq=hq();Object.defineProperty(z,"DestructibleTrait",{enumerable:!0,get:function(){return Gq.DestructibleTrait}});var Vq=yq();Object.defineProperty(z,"CombatantTrait",{enumerable:!0,get:function(){return Vq.CombatantTrait}});var Yq=vq();Object.defineProperty(z,"EquippedTrait",{enumerable:!0,get:function(){return Yq.EquippedTrait}});var zq=ZC();Object.defineProperty(z,"NpcTrait",{enumerable:!0,get:function(){return zq.NpcTrait}});var $q=eN();Object.defineProperty(z,"VehicleTrait",{enumerable:!0,get:function(){return $q.VehicleTrait}});var Kq=Eq();Object.defineProperty(z,"EnterableTrait",{enumerable:!0,get:function(){return Kq.EnterableTrait}});z.TRAIT_IMPLEMENTATIONS={[Le.TraitType.IDENTITY]:Tq.IdentityTrait,[Le.TraitType.CONTAINER]:_q.ContainerTrait,[Le.TraitType.SUPPORTER]:bq.SupporterTrait,[Le.TraitType.ROOM]:Oq.RoomTrait,[Le.TraitType.WEARABLE]:Iq.WearableTrait,[Le.TraitType.CLOTHING]:Sq.ClothingTrait,[Le.TraitType.EDIBLE]:Aq.EdibleTrait,[Le.TraitType.SCENERY]:Rq.SceneryTrait,[Le.TraitType.OPENABLE]:wq.OpenableTrait,[Le.TraitType.LOCKABLE]:Cq.LockableTrait,[Le.TraitType.SWITCHABLE]:Nq.SwitchableTrait,[Le.TraitType.READABLE]:Dq.ReadableTrait,[Le.TraitType.LIGHT_SOURCE]:Pq.LightSourceTrait,[Le.TraitType.DOOR]:Lq.DoorTrait,[Le.TraitType.CLIMBABLE]:Mq.ClimbableTrait,[Le.TraitType.ACTOR]:kq.ActorTrait,[Le.TraitType.EXIT]:xq.ExitTrait,[Le.TraitType.PULLABLE]:Bq.PullableTrait,[Le.TraitType.ATTACHED]:jq.AttachedTrait,[Le.TraitType.PUSHABLE]:Wq.PushableTrait,[Le.TraitType.BUTTON]:Hq.ButtonTrait,[Le.TraitType.MOVEABLE_SCENERY]:Uq.MoveableSceneryTrait,[Le.TraitType.WEAPON]:qq.WeaponTrait,[Le.TraitType.BREAKABLE]:Fq.BreakableTrait,[Le.TraitType.DESTRUCTIBLE]:Gq.DestructibleTrait,[Le.TraitType.COMBATANT]:Vq.CombatantTrait,[Le.TraitType.EQUIPPED]:Yq.EquippedTrait,[Le.TraitType.NPC]:zq.NpcTrait,[Le.TraitType.VEHICLE]:$q.VehicleTrait,[Le.TraitType.ENTERABLE]:Kq.EnterableTrait};function GJ(t){return z.TRAIT_IMPLEMENTATIONS[t]}function VJ(t,e){let r=z.TRAIT_IMPLEMENTATIONS[t];if(!r)throw new Error(`Unknown trait type: ${t}`);return new r(e)}});var Zq=p(Rc=>{"use strict";var YJ=Rc&&Rc.__createBinding||(Object.create?(function(t,e,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}):(function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]})),Xq=Rc&&Rc.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&YJ(e,t,r)};Object.defineProperty(Rc,"__esModule",{value:!0});Xq(PC(),Rc);Xq(_p(),Rc)});var rN=p(om=>{"use strict";Object.defineProperty(om,"__esModule",{value:!0});om.isContainerCapable=DE;om.canContain=zJ;om.getContainerTrait=$J;om.hasContainerProperties=KJ;var Oi=te();function DE(t){return t.type===Oi.TraitType.CONTAINER||t.type===Oi.TraitType.ROOM||t.type===Oi.TraitType.ACTOR}function zJ(t){return t.type==="room"||t.type==="actor"?!0:t.hasTrait(Oi.TraitType.CONTAINER)||t.hasTrait(Oi.TraitType.ROOM)||t.hasTrait(Oi.TraitType.ACTOR)||t.hasTrait(Oi.TraitType.SUPPORTER)}function $J(t){let e=t.getTrait(Oi.TraitType.CONTAINER);if(e&&DE(e))return e;let r=t.getTrait(Oi.TraitType.ROOM);if(r&&DE(r))return r;let n=t.getTrait(Oi.TraitType.ACTOR);if(n&&DE(n))return n;if(t.type==="room"||t.type==="actor")return{type:t.type==="room"?Oi.TraitType.ROOM:Oi.TraitType.ACTOR,isTransparent:t.type==="room",enterable:t.type==="room",capacity:void 0}}function KJ(t){return typeof t=="object"&&t!==null&&typeof t.isTransparent=="boolean"&&typeof t.enterable=="boolean"}});var nN=p(mn=>{"use strict";Object.defineProperty(mn,"__esModule",{value:!0});mn.hasContainerProperties=mn.isContainerCapable=mn.getContainerTrait=mn.canContain=mn.ContainerBehavior=mn.ContainerTrait=void 0;var QJ=LC();Object.defineProperty(mn,"ContainerTrait",{enumerable:!0,get:function(){return QJ.ContainerTrait}});var XJ=Qy();Object.defineProperty(mn,"ContainerBehavior",{enumerable:!0,get:function(){return XJ.ContainerBehavior}});var PE=rN();Object.defineProperty(mn,"canContain",{enumerable:!0,get:function(){return PE.canContain}});Object.defineProperty(mn,"getContainerTrait",{enumerable:!0,get:function(){return PE.getContainerTrait}});Object.defineProperty(mn,"isContainerCapable",{enumerable:!0,get:function(){return PE.isContainerCapable}});Object.defineProperty(mn,"hasContainerProperties",{enumerable:!0,get:function(){return PE.hasContainerProperties}})});var Jq=p(LE=>{"use strict";Object.defineProperty(LE,"__esModule",{value:!0});LE.RoomBehavior=void 0;var ZJ=qt(),Ft=te(),iN=em(),Ot=class Ot extends ZJ.Behavior{static getExit(e,r){let n=Ot.require(e,Ft.TraitType.ROOM);return n.exits&&n.exits[r]||null}static hasExit(e,r){return this.getExit(e,r)!==void 0}static isExitBlocked(e,r){return Ot.require(e,Ft.TraitType.ROOM).blockedExits?.hasOwnProperty(r)??!1}static getBlockedMessage(e,r){return Ot.require(e,Ft.TraitType.ROOM).blockedExits?.[r]}static setExit(e,r,n,i){let o=Ot.require(e,Ft.TraitType.ROOM);o.exits||(o.exits={}),o.exits[r]={destination:n,via:i},o.blockedExits&&delete o.blockedExits[r]}static blockExit(e,r,n){let i=Ot.require(e,Ft.TraitType.ROOM);return i.blockedExits||(i.blockedExits={}),i.blockedExits[r]=n,[{id:`${Date.now()}-${Math.random()}`,timestamp:Date.now(),type:iN.IFEvents.MOVEMENT_BLOCKED,entities:{location:e.id},data:{direction:r,message:n}}]}static unblockExit(e,r){let n=Ot.require(e,Ft.TraitType.ROOM);return n.blockedExits?n.blockedExits[r]?(delete n.blockedExits[r],[{id:`${Date.now()}-${Math.random()}`,timestamp:Date.now(),type:iN.IFEvents.NEW_EXIT_REVEALED,entities:{location:e.id},data:{direction:r,unblocked:!0}}]):[]:[]}static removeExit(e,r){let n=Ot.require(e,Ft.TraitType.ROOM);n.exits&&delete n.exits[r],n.blockedExits&&delete n.blockedExits[r]}static markVisited(e,r){let n=Ot.require(e,Ft.TraitType.ROOM);return n.visited?[]:(n.visited=!0,[{id:`${Date.now()}-${Math.random()}`,timestamp:Date.now(),type:iN.IFEvents.ROOM_FIRST_ENTERED,entities:{location:e.id,actor:r.id},data:{hasInitialDescription:!!n.initialDescription}}])}static hasBeenVisited(e){return Ot.require(e,Ft.TraitType.ROOM).visited}static getAllExits(e){let r=Ot.require(e,Ft.TraitType.ROOM);return r.exits?new Map(Object.entries(r.exits)):new Map}static getAvailableExits(e){let r=Ot.require(e,Ft.TraitType.ROOM),n=new Map;if(!r.exits)return n;for(let[i,o]of Object.entries(r.exits))this.isExitBlocked(e,i)||n.set(i,o);return n}static isOutdoors(e){return Ot.require(e,Ft.TraitType.ROOM).isOutdoors||!1}static isUnderground(e){return Ot.require(e,Ft.TraitType.ROOM).isUnderground||!1}static getRegion(e){return Ot.require(e,Ft.TraitType.ROOM).region}static hasTag(e,r){return Ot.require(e,Ft.TraitType.ROOM).tags.includes(r.toLowerCase())}static addTag(e,r){let n=Ot.require(e,Ft.TraitType.ROOM),i=r.toLowerCase();n.tags.includes(i)||n.tags.push(i)}static removeTag(e,r){let n=Ot.require(e,Ft.TraitType.ROOM),i=r.toLowerCase(),o=n.tags.indexOf(i);o>=0&&n.tags.splice(o,1)}};d(Ot,"requiredTraits",[Ft.TraitType.ROOM]);var oN=Ot;LE.RoomBehavior=oN});var aN=p(am=>{"use strict";Object.defineProperty(am,"__esModule",{value:!0});am.RoomBehavior=am.RoomTrait=void 0;var JJ=kC();Object.defineProperty(am,"RoomTrait",{enumerable:!0,get:function(){return JJ.RoomTrait}});var eee=Jq();Object.defineProperty(am,"RoomBehavior",{enumerable:!0,get:function(){return eee.RoomBehavior}})});var tF=p(wc=>{"use strict";var tee=wc&&wc.__createBinding||(Object.create?(function(t,e,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}):(function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]})),eF=wc&&wc.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&tee(e,t,r)};Object.defineProperty(wc,"__esModule",{value:!0});eF(Qv(),wc);eF(vC(),wc)});var nF=p(Cc=>{"use strict";var ree=Cc&&Cc.__createBinding||(Object.create?(function(t,e,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}):(function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]})),rF=Cc&&Cc.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&ree(e,t,r)};Object.defineProperty(Cc,"__esModule",{value:!0});rF(Jv(),Cc);rF(TC(),Cc)});var iF=p(sm=>{"use strict";Object.defineProperty(sm,"__esModule",{value:!0});sm.ReadableBehavior=sm.ReadableTrait=void 0;var nee=UC();Object.defineProperty(sm,"ReadableTrait",{enumerable:!0,get:function(){return nee.ReadableTrait}});var iee=tC();Object.defineProperty(sm,"ReadableBehavior",{enumerable:!0,get:function(){return iee.ReadableBehavior}})});var oF=p(cm=>{"use strict";Object.defineProperty(cm,"__esModule",{value:!0});cm.LightSourceBehavior=cm.LightSourceTrait=void 0;var oee=qC();Object.defineProperty(cm,"LightSourceTrait",{enumerable:!0,get:function(){return oee.LightSourceTrait}});var aee=fC();Object.defineProperty(cm,"LightSourceBehavior",{enumerable:!0,get:function(){return aee.LightSourceBehavior}})});var aF=p(lm=>{"use strict";Object.defineProperty(lm,"__esModule",{value:!0});lm.ExitBehavior=lm.ExitTrait=void 0;var see=gv();Object.defineProperty(lm,"ExitTrait",{enumerable:!0,get:function(){return see.ExitTrait}});var cee=pC();Object.defineProperty(lm,"ExitBehavior",{enumerable:!0,get:function(){return cee.ExitBehavior}})});var cF=p(Nc=>{"use strict";var lee=Nc&&Nc.__createBinding||(Object.create?(function(t,e,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}):(function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]})),sF=Nc&&Nc.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&lee(e,t,r)};Object.defineProperty(Nc,"__esModule",{value:!0});sF(VC(),Nc);sF(hC(),Nc)});var sN=p(um=>{"use strict";Object.defineProperty(um,"__esModule",{value:!0});um.SceneryBehavior=um.SceneryTrait=void 0;var uee=WC();Object.defineProperty(um,"SceneryTrait",{enumerable:!0,get:function(){return uee.SceneryTrait}});var dee=eC();Object.defineProperty(um,"SceneryBehavior",{enumerable:!0,get:function(){return dee.SceneryBehavior}})});var lF=p(ME=>{"use strict";Object.defineProperty(ME,"__esModule",{value:!0});ME.SupporterBehavior=void 0;var mee=qt(),Qi=te(),fee=_p(),Xi=class Xi extends mee.Behavior{static canAccept(e,r,n){let i=Xi.require(e,Qi.TraitType.SUPPORTER);if(i.allowedTypes&&i.allowedTypes.length>0){let o=r.type||"object";if(!i.allowedTypes.includes(o))return!1}if(i.excludedTypes&&i.excludedTypes.length>0){let o=r.type||"object";if(i.excludedTypes.includes(o))return!1}return!(r.has(Qi.TraitType.ACTOR)&&!i.enterable||i.capacity&&!this.checkCapacity(e,r,n))}static checkCapacity(e,r,n){let o=Xi.require(e,Qi.TraitType.SUPPORTER).capacity;if(o.maxItems!==void 0&&n.getContents(e.id).length>=o.maxItems)return!1;if(o.maxWeight!==void 0){let a=this.getTotalWeight(e,n),s=this.getItemTotalWeight(r,n);if(a+s>o.maxWeight)return!1}return!0}static getTotalWeight(e,r){return r.getContents(e.id).reduce((i,o)=>i+this.getItemTotalWeight(o,r),0)}static getItemTotalWeight(e,r){let n=fee.IdentityBehavior.getWeight(e);if(e.has(Qi.TraitType.CONTAINER)||e.has(Qi.TraitType.SUPPORTER)){let i=r.getContents(e.id);for(let o of i)n+=this.getItemTotalWeight(o,r)}return n}static getRemainingCapacity(e,r){let n=Xi.require(e,Qi.TraitType.SUPPORTER),i={};if(n.capacity?.maxItems!==void 0){let o=r.getContents(e.id).length;i.items=n.capacity.maxItems-o}return n.capacity?.maxWeight!==void 0&&(i.weight=n.capacity.maxWeight-this.getTotalWeight(e,r)),i}static isEnterable(e){return Xi.require(e,Qi.TraitType.SUPPORTER).enterable||!1}static getAllowedTypes(e){return Xi.require(e,Qi.TraitType.SUPPORTER).allowedTypes}static getExcludedTypes(e){return Xi.require(e,Qi.TraitType.SUPPORTER).excludedTypes}static addItem(e,r,n){if(n.getLocation(r.id)===e.id)return{success:!1,alreadyThere:!0,stateChanged:!1};if(!Xi.canAccept(e,r,n)){let o=Xi.require(e,Qi.TraitType.SUPPORTER);if(o.allowedTypes&&o.allowedTypes.length>0){let a=r.type||"object";if(!o.allowedTypes.includes(a))return{success:!1,wrongType:!0,stateChanged:!1}}if(o.excludedTypes&&o.excludedTypes.length>0){let a=r.type||"object";if(o.excludedTypes.includes(a))return{success:!1,wrongType:!0,stateChanged:!1}}return{success:!1,noSpace:!0,stateChanged:!1}}return{success:!0,stateChanged:!0}}static removeItem(e,r,n){return n.getLocation(r.id)!==e.id?{success:!1,notThere:!0,stateChanged:!1}:{success:!0,stateChanged:!0}}};d(Xi,"requiredTraits",[Qi.TraitType.SUPPORTER]);var cN=Xi;ME.SupporterBehavior=cN});var lN=p(dm=>{"use strict";Object.defineProperty(dm,"__esModule",{value:!0});dm.SupporterBehavior=dm.SupporterTrait=void 0;var pee=MC();Object.defineProperty(dm,"SupporterTrait",{enumerable:!0,get:function(){return pee.SupporterTrait}});var gee=lF();Object.defineProperty(dm,"SupporterBehavior",{enumerable:!0,get:function(){return gee.SupporterBehavior}})});var dF=p(Dc=>{"use strict";var hee=Dc&&Dc.__createBinding||(Object.create?(function(t,e,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}):(function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]})),uF=Dc&&Dc.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&hee(e,t,r)};Object.defineProperty(Dc,"__esModule",{value:!0});uF(HC(),Dc);uF(dv(),Dc)});var fF=p(Pc=>{"use strict";var yee=Pc&&Pc.__createBinding||(Object.create?(function(t,e,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}):(function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]})),mF=Pc&&Pc.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&yee(e,t,r)};Object.defineProperty(Pc,"__esModule",{value:!0});mF(xC(),Pc);mF(bp(),Pc)});var pF=p(xE=>{"use strict";Object.defineProperty(xE,"__esModule",{value:!0});xE.EdibleBehavior=void 0;var vee=qt(),Zi=te(),uN=Je(),kE=em(),Eee=CC(),fn=class fn extends vee.Behavior{static canConsume(e){let r=fn.require(e,Zi.TraitType.EDIBLE);return r.consumed===!0?!1:(r.servings??r.portions??1)>0}static consume(e,r){let n=fn.require(e,Zi.TraitType.EDIBLE),i=n.servings??n.portions??1,o=n.liquid||n.isDrink||!1;if(i<=0||n.consumed===!0)return[(0,uN.createEvent)(kE.IFEvents.ACTION_FAILED,{action:o?"drink":"eat",reason:Eee.ActionFailureReason.NOTHING_LEFT,customMessage:"There's nothing left."},{target:e.id,actor:r.id})];i--,n.servings=i,n.portions!==void 0&&(n.portions=i),i<=0&&(n.consumed=!0);let a=[(0,uN.createEvent)(o?kE.IFEvents.ITEM_DRUNK:kE.IFEvents.ITEM_EATEN,{nutrition:n.nutrition,servingsLeft:i,customMessage:n.consumeMessage,hasEffect:n.hasEffect,effectDescription:n.effectDescription},{target:e.id,actor:r.id})];return i<=0&&a.push((0,uN.createEvent)(kE.IFEvents.ITEM_DESTROYED,{reason:"consumed",remainsType:n.remainsType},{target:e.id,actor:r.id})),a}static isEmpty(e){let r=fn.require(e,Zi.TraitType.EDIBLE);return r.consumed===!0?!0:(r.servings??r.portions??1)<=0}static isLiquid(e){let r=fn.require(e,Zi.TraitType.EDIBLE);return r.liquid||r.isDrink||!1}static getNutrition(e){return fn.require(e,Zi.TraitType.EDIBLE).nutrition}static getServings(e){let r=fn.require(e,Zi.TraitType.EDIBLE);return r.consumed===!0?0:r.servings??r.portions??1}static hasEffect(e){return fn.require(e,Zi.TraitType.EDIBLE).hasEffect}static getTaste(e){return fn.require(e,Zi.TraitType.EDIBLE).taste}static getEffects(e){return fn.require(e,Zi.TraitType.EDIBLE).effects}static hasSpecificEffect(e,r){return fn.getEffects(e)?.includes(r)??!1}static satisfiesHunger(e){return fn.require(e,Zi.TraitType.EDIBLE).satisfiesHunger}};d(fn,"requiredTraits",[Zi.TraitType.EDIBLE]);var dN=fn;xE.EdibleBehavior=dN});var hF=p(Lc=>{"use strict";var Tee=Lc&&Lc.__createBinding||(Object.create?(function(t,e,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}):(function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]})),gF=Lc&&Lc.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&Tee(e,t,r)};Object.defineProperty(Lc,"__esModule",{value:!0});gF(jC(),Lc);gF(pF(),Lc)});var yF=p(BE=>{"use strict";Object.defineProperty(BE,"__esModule",{value:!0});BE.DoorBehavior=void 0;var _ee=qt(),Mc=te(),Fo=class Fo extends _ee.Behavior{static getRooms(e){let r=Fo.require(e,Mc.TraitType.DOOR);return[r.room1,r.room2]}static getOtherRoom(e,r){let n=Fo.require(e,Mc.TraitType.DOOR);if(n.room1===r)return n.room2;if(n.room2===r)return n.bidirectional?n.room1:void 0}static isBidirectional(e){return Fo.require(e,Mc.TraitType.DOOR).bidirectional}static connects(e,r,n){let i=Fo.require(e,Mc.TraitType.DOOR);return i.room1===r&&i.room2===n||i.room1===n&&i.room2===r}static connectsTo(e,r){let n=Fo.require(e,Mc.TraitType.DOOR);return n.room1===r||n.room2===r}static getEntryRoom(e){return Fo.require(e,Mc.TraitType.DOOR).room1}static getExitRoom(e){return Fo.require(e,Mc.TraitType.DOOR).room2}};d(Fo,"requiredTraits",[Mc.TraitType.DOOR]);var mN=Fo;BE.DoorBehavior=mN});var vF=p(mm=>{"use strict";Object.defineProperty(mm,"__esModule",{value:!0});mm.DoorBehavior=mm.DoorTrait=void 0;var bee=FC();Object.defineProperty(mm,"DoorTrait",{enumerable:!0,get:function(){return bee.DoorTrait}});var Oee=yF();Object.defineProperty(mm,"DoorBehavior",{enumerable:!0,get:function(){return Oee.DoorBehavior}})});var TF=p(WE=>{"use strict";Object.defineProperty(WE,"__esModule",{value:!0});WE.ActorBehavior=void 0;var Iee=qt(),Mr=te(),See=Qy(),jE=_p(),EF=bp(),Et=class Et extends Iee.Behavior{static isPlayer(e){return Et.require(e,Mr.TraitType.ACTOR).isPlayer||!1}static isPlayable(e){return Et.require(e,Mr.TraitType.ACTOR).isPlayable||!1}static getPronouns(e){return Et.require(e,Mr.TraitType.ACTOR).pronouns}static getPronoun(e,r){return Et.getPronouns(e)[r]}static canCarry(e,r,n){let i=Et.require(e,Mr.TraitType.ACTOR);if(i.capacity){let o=i.capacity;if(o.maxItems!==void 0&&n.getContents(e.id).length>=o.maxItems)return!1;if(o.maxWeight!==void 0){let a=Et.getCarriedWeight(e,n),s=jE.IdentityBehavior.getWeight(r);if(a+s>o.maxWeight)return!1}if(o.maxVolume!==void 0){let a=Et.getCarriedVolume(e,n),s=jE.IdentityBehavior.getVolume(r);if(a+s>o.maxVolume)return!1}}return!0}static getCarriedWeight(e,r){return r.getContents(e.id).reduce((i,o)=>i+jE.IdentityBehavior.getWeight(o),0)}static getCarriedVolume(e,r){return r.getContents(e.id).reduce((i,o)=>i+jE.IdentityBehavior.getVolume(o),0)}static getRemainingCapacity(e,r){let n=Et.require(e,Mr.TraitType.ACTOR),i={};if(n.capacity){let o=n.capacity;if(o.maxItems!==void 0){let a=r.getContents(e.id).length;i.items=o.maxItems-a}o.maxWeight!==void 0&&(i.weight=o.maxWeight-Et.getCarriedWeight(e,r)),o.maxVolume!==void 0&&(i.volume=o.maxVolume-Et.getCarriedVolume(e,r))}return i}static isHolding(e,r,n){return n.getLocation(r)===e.id}static getState(e){return Et.require(e,Mr.TraitType.ACTOR).state}static setState(e,r){let n=Et.require(e,Mr.TraitType.ACTOR);n.state=r}static getCustomProperty(e,r){return Et.require(e,Mr.TraitType.ACTOR).customProperties?.[r]}static setCustomProperty(e,r,n){let i=Et.require(e,Mr.TraitType.ACTOR);i.customProperties||(i.customProperties={}),i.customProperties[r]=n}static findPlayer(e){return e.find(r=>r.has(Mr.TraitType.ACTOR)&&Et.isPlayer(r))}static canTakeItem(e,r,n){let i=e.get(Mr.TraitType.ACTOR);if(!i)return!1;if(e.has(Mr.TraitType.CONTAINER))return See.ContainerBehavior.canAccept(e,r,n);if(i?.capacity?.maxWeight!==void 0){let o=i.capacity.maxWeight;if(Et.getCarriedWeight(e,n)+0>o)return!1}return!(!e.has(Mr.TraitType.CONTAINER)&&i?.capacity?.maxItems!==void 0&&n.getContents(e.id).filter(a=>!EF.WearableBehavior.isWorn(a)).length>=i.capacity.maxItems)}static takeItem(e,r,n){let i=n.getLocation(r.id);if(i===e.id)return{success:!1,alreadyHeld:!0,stateChanged:!1};if(!Et.canTakeItem(e,r,n)){let s=e.get(Mr.TraitType.ACTOR);if(s?.capacity?.maxWeight!==void 0){let c=s.capacity.maxWeight;if(Et.getCarriedWeight(e,n)+0>c)return{success:!1,tooHeavy:!0,stateChanged:!1}}return{success:!1,inventoryFull:!0,stateChanged:!1}}let o=!1,a;return i&&(o=!0,a=i),{success:!0,stateChanged:!0,needsRemoval:o,fromContainer:a}}static dropItem(e,r,n){return n.getLocation(r.id)!==e.id?{success:!1,notHeld:!0,stateChanged:!1}:EF.WearableBehavior.isWorn(r)?{success:!1,stillWorn:!0,stateChanged:!1}:{success:!0,stateChanged:!0}}};d(Et,"requiredTraits",[Mr.TraitType.ACTOR]);var fN=Et;WE.ActorBehavior=fN});var gN=p(Go=>{"use strict";Object.defineProperty(Go,"__esModule",{value:!0});Go.ActorBehavior=Go.HONORIFICS=Go.PRONOUNS=Go.ActorTrait=void 0;var pN=YC();Object.defineProperty(Go,"ActorTrait",{enumerable:!0,get:function(){return pN.ActorTrait}});Object.defineProperty(Go,"PRONOUNS",{enumerable:!0,get:function(){return pN.PRONOUNS}});Object.defineProperty(Go,"HONORIFICS",{enumerable:!0,get:function(){return pN.HONORIFICS}});var Aee=TF();Object.defineProperty(Go,"ActorBehavior",{enumerable:!0,get:function(){return Aee.ActorBehavior}})});var _F=p(eu=>{"use strict";var Ree=eu&&eu.__createBinding||(Object.create?(function(t,e,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}):(function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]})),wee=eu&&eu.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&Ree(e,t,r)};Object.defineProperty(eu,"__esModule",{value:!0});wee($C(),eu)});var bF=p(tu=>{"use strict";var Cee=tu&&tu.__createBinding||(Object.create?(function(t,e,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}):(function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]})),Nee=tu&&tu.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&Cee(e,t,r)};Object.defineProperty(tu,"__esModule",{value:!0});Nee(QC(),tu)});var OF=p(ru=>{"use strict";var Dee=ru&&ru.__createBinding||(Object.create?(function(t,e,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}):(function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]})),Pee=ru&&ru.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&Dee(e,t,r)};Object.defineProperty(ru,"__esModule",{value:!0});Pee(BC(),ru)});var IF=p(nu=>{"use strict";var Lee=nu&&nu.__createBinding||(Object.create?(function(t,e,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}):(function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]})),Mee=nu&&nu.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&Lee(e,t,r)};Object.defineProperty(nu,"__esModule",{value:!0});Mee(XC(),nu)});var SF=p(iu=>{"use strict";var kee=iu&&iu.__createBinding||(Object.create?(function(t,e,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}):(function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]})),xee=iu&&iu.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&kee(e,t,r)};Object.defineProperty(iu,"__esModule",{value:!0});xee(zC(),iu)});var AF=p(ou=>{"use strict";var Bee=ou&&ou.__createBinding||(Object.create?(function(t,e,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}):(function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]})),jee=ou&&ou.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&Bee(e,t,r)};Object.defineProperty(ou,"__esModule",{value:!0});jee(KC(),ou)});var RF=p(HE=>{"use strict";Object.defineProperty(HE,"__esModule",{value:!0});HE.NpcTrait=void 0;var Wee=ZC();Object.defineProperty(HE,"NpcTrait",{enumerable:!0,get:function(){return Wee.NpcTrait}})});var wF=p(Vo=>{"use strict";Object.defineProperty(Vo,"__esModule",{value:!0});Vo.isVehicle=hN;Vo.isActorInVehicle=Hee;Vo.getActorVehicle=yN;Vo.getVehicleOccupants=Uee;Vo.moveVehicle=qee;Vo.canVehicleMove=Fee;Vo.canActorLeaveLocation=Gee;Vo.canActorWalkInVehicle=Vee;var fm=te();function hN(t){return t.has(fm.TraitType.VEHICLE)}function Hee(t,e){let r=t.getLocation(e);if(!r)return!1;let n=t.getEntity(r);return n?hN(n):!1}function yN(t,e){let r=t.getLocation(e);if(!r)return;let n=t.getEntity(r);if(n&&hN(n))return n}function Uee(t,e){return t.getContents(e).filter(n=>n.has(fm.TraitType.ACTOR))}function qee(t,e,r){let n=t.getEntity(e);if(!n)return!1;let i=n.get(fm.TraitType.VEHICLE);if(!i)return!1;if(t.moveEntity(e,r),i.positionRooms){let o=Object.entries(i.positionRooms).find(([a,s])=>s===r);o&&(i.currentPosition=o[0])}return!0}function Fee(t){let e=t.get(fm.TraitType.VEHICLE);return e?e.isOperational?{canMove:!0}:{canMove:!1,reason:e.notOperationalReason??"The vehicle is not operational"}:{canMove:!1,reason:"Not a vehicle"}}function Gee(t,e){let r=yN(t,e);if(!r)return{canLeave:!0};let n=r.get(fm.TraitType.VEHICLE);return n?n.requiresExitBeforeLeaving?{canLeave:!1,mustExitVehicle:r}:{canLeave:!0}:{canLeave:!0}}function Vee(t,e){let r=yN(t,e);if(!r)return{canWalk:!0};let n=r.get(fm.TraitType.VEHICLE);return n?n.blocksWalkingMovement?{canWalk:!1,vehicle:r}:{canWalk:!0,vehicle:r}:{canWalk:!1,vehicle:r}}});var NF=p(kc=>{"use strict";var Yee=kc&&kc.__createBinding||(Object.create?(function(t,e,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}):(function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]})),CF=kc&&kc.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&Yee(e,t,r)};Object.defineProperty(kc,"__esModule",{value:!0});CF(eN(),kc);CF(wF(),kc)});var qE=p(UE=>{"use strict";Object.defineProperty(UE,"__esModule",{value:!0});UE.createNamespacedId=zee;UE.parseNamespacedId=$ee;function zee(t,e){return`${t}.${e}`}function $ee(t){let e=t.split(".");if(e.length<2)return null;let r=e.slice(0,-1).join("."),n=e[e.length-1];return{namespace:r,id:n}}});var EN=p(xc=>{"use strict";Object.defineProperty(xc,"__esModule",{value:!0});xc.extensionRegistry=xc.ExtensionRegistry=void 0;xc.getExtensionRegistry=Kee;var vN=qE(),FE=class{constructor(){d(this,"traits",new Map);d(this,"events",new Map);d(this,"actions",new Map);d(this,"namespaces",new Set)}registerTrait(e,r){let n=this.getTraitType(e,r.type);if(this.traits.has(n))throw new Error(`Trait type '${n}' is already registered`);this.traits.set(n,r.implementation),this.namespaces.add(e)}registerEvent(e,r){let n=this.getEventType(e,r.type);if(this.events.has(n))throw new Error(`Event type '${n}' is already registered`);this.events.set(n,r),this.namespaces.add(e)}registerAction(e,r){let n=this.getActionId(e,r.id);if(this.actions.has(n))throw new Error(`Action '${n}' is already registered`);this.actions.set(n,r),this.namespaces.add(e)}getTraitType(e,r){return(0,vN.createNamespacedId)(e,r)}getEventType(e,r){return(0,vN.createNamespacedId)(e,r)}getActionId(e,r){return(0,vN.createNamespacedId)(e,r)}getTrait(e){return this.traits.get(e)}getEvent(e){return this.events.get(e)}getAction(e){return this.actions.get(e)}hasNamespace(e){return this.namespaces.has(e)}getNamespaces(){return Array.from(this.namespaces)}getTraitsByNamespace(e){let r=e+".";return Array.from(this.traits.keys()).filter(n=>n.startsWith(r))}getEventsByNamespace(e){let r=e+".";return Array.from(this.events.keys()).filter(n=>n.startsWith(r))}getActionsByNamespace(e){let r=e+".";return Array.from(this.actions.keys()).filter(n=>n.startsWith(r))}clearNamespace(e){let r=e+".";for(let n of this.traits.keys())n.startsWith(r)&&this.traits.delete(n);for(let n of this.events.keys())n.startsWith(r)&&this.events.delete(n);for(let n of this.actions.keys())n.startsWith(r)&&this.actions.delete(n);this.namespaces.delete(e)}clear(){this.traits.clear(),this.events.clear(),this.actions.clear(),this.namespaces.clear()}getTraits(){return new Map(this.traits)}getEvents(){return new Map(this.events)}getActions(){return new Map(this.actions)}getServices(){return new Map}};xc.ExtensionRegistry=FE;xc.extensionRegistry=new FE;function Kee(){return xc.extensionRegistry}});var DF=p(Bc=>{"use strict";Object.defineProperty(Bc,"__esModule",{value:!0});Bc.extensionLoader=Bc.ExtensionLoader=Bc.ExtensionLoadError=void 0;var Qee=EN(),Ya=class extends Error{constructor(r,n,i){super(r);d(this,"extensionId");d(this,"cause");this.extensionId=n,this.cause=i,this.name="ExtensionLoadError"}};Bc.ExtensionLoadError=Ya;var GE=class{constructor(e=Qee.extensionRegistry){d(this,"extensions",new Map);d(this,"registry");this.registry=e}async loadExtension(e){let{id:r,namespace:n,dependencies:i}=e.metadata;if(this.extensions.has(r))throw new Ya(`Extension '${r}' is already loaded`,r);if(i){for(let o of i)if(!o.optional&&!this.extensions.has(o.id))throw new Ya(`Required dependency '${o.id}' is not loaded`,r)}try{if(e.initialize&&await e.initialize(),e.traits)for(let o of e.traits)this.registry.registerTrait(n,o);if(e.events)for(let o of e.events)this.registry.registerEvent(n,o);if(e.actions)for(let o of e.actions)this.registry.registerAction(n,o);this.extensions.set(r,e)}catch(o){throw this.registry.clearNamespace(n),new Ya(`Failed to load extension '${r}': ${o}`,r,o instanceof Error?o:void 0)}}async unloadExtension(e){let r=this.extensions.get(e);if(!r)throw new Ya(`Extension '${e}' is not loaded`,e);for(let[n,i]of this.extensions){if(n===e)continue;if((i.metadata.dependencies||[]).some(s=>s.id===e&&!s.optional))throw new Ya(`Cannot unload '${e}': extension '${n}' depends on it`,e)}try{r.cleanup&&await r.cleanup(),this.registry.clearNamespace(r.metadata.namespace),this.extensions.delete(e)}catch(n){throw new Ya(`Failed to unload extension '${e}': ${n}`,e,n instanceof Error?n:void 0)}}getExtension(e){return this.extensions.get(e)}getLoadedExtensions(){return Array.from(this.extensions.values())}isLoaded(e){return this.extensions.has(e)}getLoadOrder(){let e=new Set,r=[],n=i=>{if(e.has(i))return;e.add(i);let o=this.extensions.get(i);if(!o)return;let a=o.metadata.dependencies||[];for(let s of a)this.extensions.has(s.id)&&n(s.id);r.push(i)};for(let i of this.extensions.keys())n(i);return r}validateDependencies(e){let r=[],n=e.metadata.dependencies||[];for(let i of n)!i.optional&&!this.extensions.has(i.id)&&r.push(i.id);return r}};Bc.ExtensionLoader=GE;Bc.extensionLoader=new GE});var MF=p(Tt=>{"use strict";var Xee=Tt&&Tt.__createBinding||(Object.create?(function(t,e,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}):(function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]})),Zee=Tt&&Tt.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&Xee(e,t,r)};Object.defineProperty(Tt,"__esModule",{value:!0});Tt.parseNamespacedId=Tt.createNamespacedId=Tt.ExtensionLoadError=Tt.extensionLoader=Tt.ExtensionLoader=Tt.extensionRegistry=Tt.ExtensionRegistry=void 0;Zee(qE(),Tt);var PF=EN();Object.defineProperty(Tt,"ExtensionRegistry",{enumerable:!0,get:function(){return PF.ExtensionRegistry}});Object.defineProperty(Tt,"extensionRegistry",{enumerable:!0,get:function(){return PF.extensionRegistry}});var TN=DF();Object.defineProperty(Tt,"ExtensionLoader",{enumerable:!0,get:function(){return TN.ExtensionLoader}});Object.defineProperty(Tt,"extensionLoader",{enumerable:!0,get:function(){return TN.extensionLoader}});Object.defineProperty(Tt,"ExtensionLoadError",{enumerable:!0,get:function(){return TN.ExtensionLoadError}});var LF=qE();Object.defineProperty(Tt,"createNamespacedId",{enumerable:!0,get:function(){return LF.createNamespacedId}});Object.defineProperty(Tt,"parseNamespacedId",{enumerable:!0,get:function(){return LF.parseNamespacedId}})});var bN=p(VE=>{"use strict";Object.defineProperty(VE,"__esModule",{value:!0});VE.SpatialIndex=void 0;var _N=class{constructor(){d(this,"parentToChildren",new Map);d(this,"childToParent",new Map)}addChild(e,r){let n=this.childToParent.get(r);n&&this.removeChild(n,r),this.parentToChildren.has(e)||this.parentToChildren.set(e,new Set),this.parentToChildren.get(e).add(r),this.childToParent.set(r,e)}removeChild(e,r){let n=this.parentToChildren.get(e);n&&(n.delete(r),n.size===0&&this.parentToChildren.delete(e)),this.childToParent.delete(r)}remove(e){let r=this.childToParent.get(e);r&&this.removeChild(r,e);let n=this.parentToChildren.get(e);n&&(Array.from(n).forEach(o=>{this.childToParent.delete(o)}),this.parentToChildren.delete(e))}getParent(e){return this.childToParent.get(e)}getChildren(e){let r=this.parentToChildren.get(e);return r?Array.from(r):[]}hasChildren(e){let r=this.parentToChildren.get(e);return r?r.size>0:!1}getAllDescendants(e,r=10){let n=[],i=new Set,o=(a,s)=>{if(s>r||i.has(a))return;i.add(a);let c=this.getChildren(a);n.push(...c),c.forEach(l=>o(l,s+1))};return o(e,0),n}getAncestors(e,r=10){let n=[],i=e,o=0;for(;o<r;){let a=this.getParent(i);if(!a)break;n.push(a),i=a,o++}return n}clear(){this.parentToChildren.clear(),this.childToParent.clear()}toJSON(){return{parentToChildren:Array.from(this.parentToChildren.entries()).map(([e,r])=>({parent:e,children:Array.from(r)})),childToParent:Array.from(this.childToParent.entries())}}loadJSON(e){if(this.clear(),e.parentToChildren)for(let{parent:r,children:n}of e.parentToChildren)this.parentToChildren.set(r,new Set(n));if(e.childToParent)for(let[r,n]of e.childToParent)this.childToParent.set(r,n)}};VE.SpatialIndex=_N});var kF=p(ON=>{"use strict";Object.defineProperty(ON,"__esModule",{value:!0});ON.createEffect=Jee;function Jee(t,e){return{type:t,payload:e}}});var BF=p(za=>{"use strict";Object.defineProperty(za,"__esModule",{value:!0});za.registerCapabilityBehavior=ete;za.getBehaviorForCapability=tte;za.getBehaviorBinding=xF;za.hasCapabilityBehavior=rte;za.unregisterCapabilityBehavior=nte;za.clearCapabilityRegistry=ite;za.getAllCapabilityBindings=ote;var au=new Map;function YE(t,e){return`${t}:${e}`}function ete(t,e,r,n){let i=YE(t,e);if(au.has(i))throw new Error(`Behavior already registered for trait "${t}" and capability "${e}"`);au.set(i,{traitType:t,capability:e,behavior:r,priority:n?.priority??0,resolution:n?.resolution,mode:n?.mode,validateBinding:n?.validateBinding})}function tte(t,e){return xF(t,e)?.behavior}function xF(t,e){let r=t.constructor.type,n=YE(r,e),i=au.get(n);if(i){if(i.validateBinding&&!i.validateBinding(t))throw new Error(`Behavior validation failed for trait "${r}", capability "${e}"`);return i}}function rte(t,e){return au.has(YE(t,e))}function nte(t,e){au.delete(YE(t,e))}function ite(){au.clear()}function ote(){return new Map(au)}});var jF=p(su=>{"use strict";Object.defineProperty(su,"__esModule",{value:!0});su.defineCapabilityDefaults=ate;su.getCapabilityConfig=ste;su.hasCapabilityDefaults=cte;su.clearCapabilityDefaults=lte;su.getAllCapabilityDefaults=ute;var IN={resolution:"first-wins",mode:"blocking"},Np=new Map;function ate(t,e){Np.set(t,{resolution:e.resolution??IN.resolution,mode:e.mode??IN.mode})}function ste(t){return Np.get(t)??{...IN}}function cte(t){return Np.has(t)}function lte(){Np.clear()}function ute(){return new Map(Np)}});var HF=p(cu=>{"use strict";Object.defineProperty(cu,"__esModule",{value:!0});cu.findTraitWithCapability=WF;cu.hasCapability=dte;cu.getEntityCapabilities=mte;cu.traitHasCapability=fte;cu.getCapableTraits=pte;function WF(t,e){for(let r of t.traits.values())if(r.constructor.capabilities?.includes(e))return r}function dte(t,e){return WF(t,e)!==void 0}function mte(t){let e=[];for(let r of t.traits.values()){let n=r.constructor;n.capabilities&&e.push(...n.capabilities)}return e}function fte(t,e,r){let i=t.constructor.capabilities?.includes(e)??!1;return r?i&&t instanceof r:i}function pte(t){return Array.from(t.traits.values()).filter(e=>{let r=e.constructor;return r.capabilities&&r.capabilities.length>0})}});var UF=p(Dp=>{"use strict";Object.defineProperty(Dp,"__esModule",{value:!0});Dp.EntityBuilder=void 0;Dp.buildEntity=gte;var zE=class{constructor(e){d(this,"entity");d(this,"claimedCaps",new Set);this.entity=e}add(e){let r=e.constructor,n=r.capabilities??[];for(let i of n){if(this.claimedCaps.has(i)){let o=this.findTraitWithCapability(i),a=o?o.constructor.type:"unknown";throw new Error(`Entity "${this.entity.id}": capability "${i}" already claimed by trait "${a}". New trait "${r.type}" cannot also claim it.`)}this.claimedCaps.add(i)}return this.entity.add(e),this}build(){return this.entity}getClaimedCapabilities(){return Array.from(this.claimedCaps)}findTraitWithCapability(e){for(let r of this.entity.traits.values())if(r.constructor.capabilities?.includes(e))return r}};Dp.EntityBuilder=zE;function gte(t){return new zE(t)}});var SN=p(fe=>{"use strict";Object.defineProperty(fe,"__esModule",{value:!0});fe.buildEntity=fe.EntityBuilder=fe.getCapableTraits=fe.traitHasCapability=fe.getEntityCapabilities=fe.hasCapability=fe.findTraitWithCapability=fe.getAllCapabilityDefaults=fe.clearCapabilityDefaults=fe.hasCapabilityDefaults=fe.getCapabilityConfig=fe.defineCapabilityDefaults=fe.getAllCapabilityBindings=fe.clearCapabilityRegistry=fe.unregisterCapabilityBehavior=fe.hasCapabilityBehavior=fe.getBehaviorBinding=fe.getBehaviorForCapability=fe.registerCapabilityBehavior=fe.createEffect=void 0;var hte=kF();Object.defineProperty(fe,"createEffect",{enumerable:!0,get:function(){return hte.createEffect}});var lu=BF();Object.defineProperty(fe,"registerCapabilityBehavior",{enumerable:!0,get:function(){return lu.registerCapabilityBehavior}});Object.defineProperty(fe,"getBehaviorForCapability",{enumerable:!0,get:function(){return lu.getBehaviorForCapability}});Object.defineProperty(fe,"getBehaviorBinding",{enumerable:!0,get:function(){return lu.getBehaviorBinding}});Object.defineProperty(fe,"hasCapabilityBehavior",{enumerable:!0,get:function(){return lu.hasCapabilityBehavior}});Object.defineProperty(fe,"unregisterCapabilityBehavior",{enumerable:!0,get:function(){return lu.unregisterCapabilityBehavior}});Object.defineProperty(fe,"clearCapabilityRegistry",{enumerable:!0,get:function(){return lu.clearCapabilityRegistry}});Object.defineProperty(fe,"getAllCapabilityBindings",{enumerable:!0,get:function(){return lu.getAllCapabilityBindings}});var Pp=jF();Object.defineProperty(fe,"defineCapabilityDefaults",{enumerable:!0,get:function(){return Pp.defineCapabilityDefaults}});Object.defineProperty(fe,"getCapabilityConfig",{enumerable:!0,get:function(){return Pp.getCapabilityConfig}});Object.defineProperty(fe,"hasCapabilityDefaults",{enumerable:!0,get:function(){return Pp.hasCapabilityDefaults}});Object.defineProperty(fe,"clearCapabilityDefaults",{enumerable:!0,get:function(){return Pp.clearCapabilityDefaults}});Object.defineProperty(fe,"getAllCapabilityDefaults",{enumerable:!0,get:function(){return Pp.getAllCapabilityDefaults}});var Lp=HF();Object.defineProperty(fe,"findTraitWithCapability",{enumerable:!0,get:function(){return Lp.findTraitWithCapability}});Object.defineProperty(fe,"hasCapability",{enumerable:!0,get:function(){return Lp.hasCapability}});Object.defineProperty(fe,"getEntityCapabilities",{enumerable:!0,get:function(){return Lp.getEntityCapabilities}});Object.defineProperty(fe,"traitHasCapability",{enumerable:!0,get:function(){return Lp.traitHasCapability}});Object.defineProperty(fe,"getCapableTraits",{enumerable:!0,get:function(){return Lp.getCapableTraits}});var qF=UF();Object.defineProperty(fe,"EntityBuilder",{enumerable:!0,get:function(){return qF.EntityBuilder}});Object.defineProperty(fe,"buildEntity",{enumerable:!0,get:function(){return qF.buildEntity}})});var AN=p(pn=>{"use strict";Object.defineProperty(pn,"__esModule",{value:!0});pn.VisibilityBehavior=pn.VISIBILITY_CAPABILITY=void 0;var yte=qt(),se=te(),vte=dv(),jc=SN();pn.VISIBILITY_CAPABILITY="if.scope.visible";var $E=class extends yte.Behavior{static isDark(e,r){let n=e.getTrait(se.TraitType.ROOM);return!n||!n.isDark?!1:!this.hasLightSource(e,r)}static isLightActive(e){let r=e.getTrait(se.TraitType.LIGHT_SOURCE);return r?.isLit!==void 0?r.isLit===!0:e.hasTrait(se.TraitType.SWITCHABLE)?vte.SwitchableBehavior.isOn(e):!0}static canSee(e,r,n){if(e.id===r.id)return!0;let i=r.getTrait(se.TraitType.SCENERY);if(i&&i.visible===!1)return!1;let o=(0,jc.findTraitWithCapability)(r,pn.VISIBILITY_CAPABILITY);if(o){let u=(0,jc.getBehaviorForCapability)(o,pn.VISIBILITY_CAPABILITY);if(u&&!u.validate(r,n,e.id,{}).valid)return!1}let a=n.getContainingRoom(e.id),s=n.getContainingRoom(r.id);if(r.hasTrait(se.TraitType.ROOM))return a?.id===r.id;if(!a||a.id!==s?.id)return!1;let c=a.getTrait(se.TraitType.ROOM);return c&&c.isDark&&!this.hasLightSource(a,n)?!!(r.hasTrait(se.TraitType.LIGHT_SOURCE)&&r.getTrait(se.TraitType.LIGHT_SOURCE)?.isLit===!0||n.getLocation(r.id)===e.id):this.hasLineOfSight(e.id,r.id,n)}static getVisible(e,r){let n=[],i=new Set,o=r.getContainingRoom(e.id);if(!o)return n;this.canSee(e,o,r)&&(n.push(o),i.add(o.id));let a=o.getTrait(se.TraitType.ROOM),s=a&&a.isDark,c=this.hasLightSource(o,r);if(s&&!c){let m=r.getContents(e.id);for(let g of m)i.has(g.id)||(n.push(g),i.add(g.id));let f=r.getAllContents(o.id,{recursive:!0});for(let g of f)if(g.hasTrait(se.TraitType.LIGHT_SOURCE)){let h=g.getTrait(se.TraitType.LIGHT_SOURCE);h&&h.isLit===!0&&!i.has(g.id)&&(n.push(g),i.add(g.id))}return n}let l=r.getContents(o.id);for(let m of l)if(m.id!==e.id&&!i.has(m.id)){let f=m.getTrait(se.TraitType.SCENERY);if(f&&f.visible===!1)continue;let g=(0,jc.findTraitWithCapability)(m,pn.VISIBILITY_CAPABILITY);if(g){let h=(0,jc.getBehaviorForCapability)(g,pn.VISIBILITY_CAPABILITY);if(h&&!h.validate(m,r,e.id,{}).valid)continue}n.push(m),i.add(m.id),(m.hasTrait(se.TraitType.CONTAINER)||m.hasTrait(se.TraitType.SUPPORTER)||m.hasTrait(se.TraitType.ACTOR))&&this.addVisibleContents(m,n,i,r)}let u=r.getContents(e.id);for(let m of u)i.has(m.id)||(n.push(m),i.add(m.id),(m.hasTrait(se.TraitType.CONTAINER)||m.hasTrait(se.TraitType.SUPPORTER))&&this.addVisibleContents(m,n,i,r));return n}static addVisibleContents(e,r,n,i){if(e.hasTrait(se.TraitType.CONTAINER)&&!(e.getTrait(se.TraitType.CONTAINER)?.isTransparent??!1)&&e.hasTrait(se.TraitType.OPENABLE)&&!(e.getTrait(se.TraitType.OPENABLE)?.isOpen??!1))return;let o=i.getContents(e.id,{includeWorn:!0});for(let a of o)if(!n.has(a.id)){let s=a.getTrait(se.TraitType.SCENERY);if(s&&s.visible===!1)continue;let c=(0,jc.findTraitWithCapability)(a,pn.VISIBILITY_CAPABILITY);if(c){let l=(0,jc.getBehaviorForCapability)(c,pn.VISIBILITY_CAPABILITY);if(l&&!l.validate(a,i,e.id,{}).valid)continue}r.push(a),n.add(a.id),(a.hasTrait(se.TraitType.CONTAINER)||a.hasTrait(se.TraitType.SUPPORTER)||a.hasTrait(se.TraitType.ACTOR))&&this.addVisibleContents(a,r,n,i)}}static hasLightSource(e,r){let n=r.getAllContents(e.id,{recursive:!0,includeWorn:!0});for(let i of n)if(i.hasTrait(se.TraitType.LIGHT_SOURCE)&&this.isLightActive(i)&&this.isAccessible(i.id,e.id,r))return!0;return!1}static isAccessible(e,r,n){let i=e;for(;i!==r;){let o=n.getLocation(i);if(!o)return!1;let a=n.getEntity(o);if(!a)return!1;if(a.hasTrait(se.TraitType.ACTOR)){i=o;continue}if(a.hasTrait(se.TraitType.CONTAINER)&&!(a.getTrait(se.TraitType.CONTAINER)?.isTransparent??!1)&&a.hasTrait(se.TraitType.OPENABLE)&&!(a.getTrait(se.TraitType.OPENABLE)?.isOpen??!1))return!1;i=o}return!0}static hasLineOfSight(e,r,n){let i=this.getContainmentPath(r,n);for(let o=0;o<i.length-1;o++){let a=i[o],s=i[o+1],c=n.getEntity(s);if(!c)return!1;if(!c.hasTrait(se.TraitType.ACTOR)&&c.hasTrait(se.TraitType.CONTAINER)&&!(c.getTrait(se.TraitType.CONTAINER)?.isTransparent??!1)&&c.hasTrait(se.TraitType.OPENABLE)&&!(c.getTrait(se.TraitType.OPENABLE)?.isOpen??!1))return!1}return!0}static getContainmentPath(e,r){let n=[e],i=e,o=0,a=10;for(;o<a;){let s=r.getLocation(i);if(!s||(n.push(s),r.getEntity(s)?.hasTrait(se.TraitType.ROOM)))break;i=s,o++}return n}static isVisible(e,r){let n=e.getTrait(se.TraitType.SCENERY);if(n&&n.visible===!1)return!1;let i=(0,jc.findTraitWithCapability)(e,pn.VISIBILITY_CAPABILITY);if(i){let a=(0,jc.getBehaviorForCapability)(i,pn.VISIBILITY_CAPABILITY);if(a&&!a.validate(e,r,"",{}).valid)return!1}let o=e.id;for(;;){let a=r.getLocation(o);if(!a)break;let s=r.getEntity(a);if(!s)break;if(s.hasTrait(se.TraitType.ACTOR)){o=a;continue}if(s.hasTrait(se.TraitType.CONTAINER)&&!(s.getTrait(se.TraitType.CONTAINER)?.isTransparent??!1)&&s.hasTrait(se.TraitType.OPENABLE)&&!(s.getTrait(se.TraitType.OPENABLE)?.isOpen??!1))return!1;o=a}return!0}static getDescribableLocation(e,r){let n=r.getLocation(e.id);if(!n)return{location:e,immediateContainer:null};let i=r.getEntity(n);if(!i)return{location:e,immediateContainer:null};if(i.hasTrait(se.TraitType.ROOM))return{location:i,immediateContainer:null};if(i.hasTrait(se.TraitType.VEHICLE)){if(i.getTrait(se.TraitType.VEHICLE).transparent){let a=r.getContainingRoom(e.id);if(a)return{location:a,immediateContainer:i}}return{location:i,immediateContainer:null}}if(i.hasTrait(se.TraitType.CONTAINER)){if(i.hasTrait(se.TraitType.OPENABLE)&&i.getTrait(se.TraitType.OPENABLE)?.isOpen){let a=r.getContainingRoom(e.id);if(a)return{location:a,immediateContainer:i}}return{location:i,immediateContainer:null}}return{location:i,immediateContainer:null}}};d($E,"requiredTraits",[]);pn.VisibilityBehavior=$E});var wN=p(KE=>{"use strict";Object.defineProperty(KE,"__esModule",{value:!0});KE.ScopeRegistry=void 0;var RN=class{constructor(){d(this,"rules",new Map);d(this,"rulesByLocation",new Map);d(this,"rulesByAction",new Map);d(this,"globalRules",new Set)}addRule(e){if(!e.id)throw new Error("Scope rule must have an id");if(e.priority=e.priority??100,e.enabled=e.enabled??!0,e.source=e.source??"core",this.rules.set(e.id,e),e.fromLocations==="*")this.globalRules.add(e.id);else for(let r of e.fromLocations)this.rulesByLocation.has(r)||this.rulesByLocation.set(r,new Set),this.rulesByLocation.get(r).add(e.id);if(e.forActions&&e.forActions!=="*")for(let r of e.forActions)this.rulesByAction.has(r)||this.rulesByAction.set(r,new Set),this.rulesByAction.get(r).add(e.id)}removeRule(e){let r=this.rules.get(e);if(!r)return!1;if(this.rules.delete(e),r.fromLocations==="*")this.globalRules.delete(e);else for(let n of r.fromLocations)this.rulesByLocation.get(n)?.delete(e);if(r.forActions&&r.forActions!=="*")for(let n of r.forActions)this.rulesByAction.get(n)?.delete(e);return!0}getRule(e){return this.rules.get(e)}getAllRules(){return Array.from(this.rules.values())}getApplicableRules(e){let r=new Set;for(let o of this.globalRules)r.add(o);let n=this.rulesByLocation.get(e.currentLocation);if(n)for(let o of n)r.add(o);let i=[];for(let o of r){let a=this.rules.get(o);!a||!a.enabled||e.actionId&&a.forActions&&a.forActions!=="*"&&!a.forActions.includes(e.actionId)||i.push(a)}return i.sort((o,a)=>(a.priority||0)-(o.priority||0))}setRuleEnabled(e,r){let n=this.rules.get(e);return n?(n.enabled=r,!0):!1}clear(){this.rules.clear(),this.rulesByLocation.clear(),this.rulesByAction.clear(),this.globalRules.clear()}getRulesBySource(e){return Array.from(this.rules.values()).filter(r=>r.source===e)}getStats(){let e={totalRules:this.rules.size,enabledRules:0,disabledRules:0,globalRules:this.globalRules.size,locationSpecificRules:0,actionSpecificRules:0,rulesBySource:new Map};for(let r of this.rules.values()){r.enabled?e.enabledRules++:e.disabledRules++,r.fromLocations!=="*"&&e.locationSpecificRules++,r.forActions&&r.forActions!=="*"&&e.actionSpecificRules++;let n=r.source||"unknown";e.rulesBySource.set(n,(e.rulesBySource.get(n)||0)+1)}return e}};KE.ScopeRegistry=RN});var NN=p(QE=>{"use strict";Object.defineProperty(QE,"__esModule",{value:!0});QE.ScopeEvaluator=void 0;var CN=class{constructor(e){d(this,"registry");d(this,"cache",new Map);this.registry=e}evaluate(e,r={}){let n=Date.now(),i=this.getCacheKey(e);if(r.cache&&this.cache.has(i)){let u=this.cache.get(i);return u.metrics&&(u.metrics.cacheHits=(u.metrics.cacheHits||0)+1),u}let o=this.registry.getApplicableRules(e);r.ruleFilter&&(o=o.filter(r.ruleFilter)),r.maxRules&&o.length>r.maxRules&&(o=o.slice(0,r.maxRules));let a=new Set,s=[],c=[];for(let u of o){let m=this.evaluateRule(u,e);if(m.conditionMet){for(let f of m.includedEntities)a.add(f);s.push(m)}else r.debug&&c.push(u)}let l={entityIds:a,appliedRules:s,metrics:{rulesEvaluated:o.length,totalTime:Date.now()-n,cacheHits:0}};return r.debug&&(l.skippedRules=c),r.cache&&this.cache.set(i,l),l}evaluateRule(e,r){if(!(!e.condition||e.condition(r)))return{rule:e,includedEntities:[],conditionMet:!1};let i=[];if(e.includeEntities&&(typeof e.includeEntities=="function"?i=e.includeEntities(r):i=[...e.includeEntities]),e.includeLocations&&r.world)for(let a of e.includeLocations){let s=this.getEntitiesInLocation(r.world,a);i.push(...s)}let o;return e.message&&(typeof e.message=="function"?o=e.message(i[0]||"",r.actionId||""):o=e.message),{rule:e,includedEntities:i,conditionMet:!0,message:o}}getEntitiesInLocation(e,r){let n=[];if(e.getEntity(r)&&n.push(r),e.getContents){let i=e.getContents(r)||[];n.push(...i.map(o=>o.id));for(let o of i)if(e.getAllContents){let a=e.getAllContents(o.id)||[];n.push(...a.map(s=>s.id))}}return n}getCacheKey(e){return`${e.actorId}:${e.currentLocation}:${e.actionId||"any"}`}clearCache(){this.cache.clear()}getVisibleEntities(e){let r={...e,actionId:e.actionId||"examining"},n=this.evaluate(r);return Array.from(n.entityIds)}getTouchableEntities(e){return this.getVisibleEntities(e)}isEntityInScope(e,r){return this.evaluate(r).entityIds.has(e)}getScopeWithDetails(e){let r=this.evaluate(e,{debug:!0}),n=new Map;for(let i of r.appliedRules)n.set(i.rule.id,{rule:i.rule,entities:i.includedEntities,message:i.message});return{entities:Array.from(r.entityIds),ruleDetails:n}}};QE.ScopeEvaluator=CN});var VF=p(XE=>{"use strict";Object.defineProperty(XE,"__esModule",{value:!0});XE.WorldModel=void 0;var DN=$d(),Wc=Qw(),gn=te(),Ete=aN(),Tte=nN(),_te=lN(),bte=gN(),Ote=sN(),Ite=bN(),FF=AN(),Ste=rN(),Ate=Xt(),Rte=wN(),wte=NN(),GF={room:"r",door:"d",item:"i",actor:"a",container:"c",supporter:"s",scenery:"y",exit:"e",object:"o"},PN=class{constructor(e={},r){d(this,"entities",new Map);d(this,"state",{});d(this,"playerId");d(this,"spatialIndex");d(this,"config");d(this,"capabilities",{});d(this,"idCounters",new Map);d(this,"eventHandlers",new Map);d(this,"eventValidators",new Map);d(this,"eventPreviewers",new Map);d(this,"appliedEvents",[]);d(this,"eventProcessorWiring",null);d(this,"maxEventHistory",1e3);d(this,"eventChains",new Map);d(this,"platformEvents");d(this,"scopeRegistry");d(this,"scopeEvaluator");d(this,"grammarVocabularyProvider");d(this,"relationships",new Map);this.config={enableSpatialIndex:!0,maxDepth:10,strictMode:!1,...e},this.spatialIndex=new Ite.SpatialIndex,this.platformEvents=r,this.scopeRegistry=new Rte.ScopeRegistry,this.scopeEvaluator=new wte.ScopeEvaluator(this.scopeRegistry),this.grammarVocabularyProvider=new Ate.GrammarVocabularyProvider,this.registerDefaultScopeRules()}emitPlatformEvent(e,r){this.platformEvents&&this.platformEvents.addEvent({id:`world_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,timestamp:Date.now(),type:`platform.world.${e}`,entities:{},data:{subsystem:"world",...r},tags:["platform","world","debug"],priority:0,narrate:!1})}registerCapability(e,r={}){if(this.capabilities[e]){if(this.config.strictMode)throw new Error(`Capability '${e}' is already registered`);return}let n={};if(r.schema)for(let[i,o]of Object.entries(r.schema))o.default!==void 0&&(n[i]=o.default);r.initialData&&Object.assign(n,r.initialData),this.capabilities[e]={data:n,schema:r.schema}}updateCapability(e,r){let n=this.capabilities[e];if(!n){if(this.config.strictMode)throw new Error(`Capability '${e}' is not registered`);return}if(n.schema)for(let[i,o]of Object.entries(r)){let a=n.schema[i];if(a){let s=Array.isArray(o)?"array":typeof o;if(s!==a.type&&o!==null&&o!==void 0&&this.config.strictMode)throw new Error(`Invalid type for capability '${e}' field '${i}': expected ${a.type}, got ${s}`)}}Object.assign(n.data,r)}getCapability(e){return this.capabilities[e]?.data}hasCapability(e){return e in this.capabilities}generateId(e){let r=GF[e]||GF.object,i=(this.idCounters.get(r)||0)+1;if(i>1295)throw new Error(`ID overflow for type '${e}' (prefix '${r}'). Maximum 1296 entities per type.`);this.idCounters.set(r,i);let o=i.toString(36).padStart(2,"0");return`${r}${o}`}createEntity(e,r="object"){if(!(0,Wc.isEntityType)(r))throw new Error(`Unknown entity type: '${r}'. Valid types are: ${Object.values(Wc.EntityType).join(", ")}`);let n=this.generateId(r),i=new DN.IFEntity(n,r,{attributes:{displayName:e,name:e,entityType:r}});return this.entities.set(n,i),i}createEntityWithTraits(e){let r=this.generateId(e),n=new DN.IFEntity(r,e);switch(e){case Wc.EntityType.ROOM:n.add(new Ete.RoomTrait({}));break;case Wc.EntityType.CONTAINER:n.add(new Tte.ContainerTrait);break;case Wc.EntityType.SUPPORTER:n.add(new _te.SupporterTrait);break;case Wc.EntityType.ACTOR:n.add(new bte.ActorTrait);break;case Wc.EntityType.DOOR:break;case Wc.EntityType.SCENERY:n.add(new Ote.SceneryTrait);break}return this.entities.set(r,n),n}getEntity(e){return this.entities.get(e)}hasEntity(e){return this.entities.has(e)}removeEntity(e){return this.entities.get(e)?(this.spatialIndex.remove(e),this.getLocation(e)&&this.moveEntity(e,null),this.entities.delete(e)):!1}getAllEntities(){return Array.from(this.entities.values())}updateEntity(e,r){let n=this.getEntity(e);if(!n){if(this.config.strictMode)throw new Error(`Cannot update non-existent entity: ${e}`);return}r(n)}getLocation(e){return this.spatialIndex.getParent(e)}getContents(e,r={}){let i=this.spatialIndex.getChildren(e).map(o=>this.getEntity(o)).filter(o=>o!==void 0);return r.visibleOnly&&(i=i.filter(o=>{let a=o.getTrait(gn.TraitType.SCENERY);return!a||a.visible!==!1})),r.includeWorn||(i=i.filter(o=>{let a=o.getTrait(gn.TraitType.WEARABLE),s=o.getTrait(gn.TraitType.CLOTHING),c=a&&a.isWorn,l=s&&s.isWorn;return!(c||l)})),i}moveEntity(e,r){if(!this.canMoveEntity(e,r))return this.emitPlatformEvent("move_entity_failed",{entityId:e,targetId:r,reason:"cannot_move"}),!1;let n=this.getLocation(e);return n&&this.spatialIndex.removeChild(n,e),r&&this.spatialIndex.addChild(r,e),this.emitPlatformEvent("entity_moved",{entityId:e,fromLocation:n,toLocation:r}),!0}canMoveEntity(e,r){if(!this.getEntity(e))return!1;if(r===null)return!0;let i=this.getEntity(r);if(!i||this.wouldCreateLoop(e,r)||!(0,Ste.canContain)(i))return!1;if(i.hasTrait(gn.TraitType.CONTAINER)&&i.hasTrait(gn.TraitType.OPENABLE)){let o=i.getTrait(gn.TraitType.OPENABLE);if(o&&!o.isOpen)return!1}return!0}getContainingRoom(e){let r=e,n=0;for(;r&&n<this.config.maxDepth;){let i=this.getLocation(r);if(!i)return;let o=this.getEntity(i);if(o?.hasTrait(gn.TraitType.ROOM))return o;r=i,n++}}getAllContents(e,r={}){let n=[],i=new Set,o=(a,s=0,c=!1)=>{if(i.has(a)||s>this.config.maxDepth)return;i.add(a);let l=c?{visibleOnly:r.visibleOnly,includeWorn:r.includeWorn}:{visibleOnly:r.visibleOnly,includeWorn:!0},u=this.getContents(a,l);n.push(...u),r.recursive&&u.forEach(m=>o(m.id,s+1,!1))};return o(e,0,!0),n}getState(){return{...this.state}}setState(e){this.state={...e}}getStateValue(e){return this.state[e]}setStateValue(e,r){this.state[e]=r}findByTrait(e){return this.findWhere(r=>r.hasTrait(e))}findByType(e){return this.findWhere(r=>r.type===e)}findWhere(e){return Array.from(this.entities.values()).filter(e)}getRelated(e,r){let n=this.relationships.get(e);if(!n)return[];let i=n.get(r);return i?Array.from(i):[]}areRelated(e,r,n){return this.getRelated(e,n).includes(r)}addRelationship(e,r,n){if(!this.hasEntity(e)||!this.hasEntity(r)){if(this.config.strictMode)throw new Error("Cannot add relationship between non-existent entities");return}this.relationships.has(e)||this.relationships.set(e,new Map);let i=this.relationships.get(e);i.has(n)||i.set(n,new Set),i.get(n).add(r)}removeRelationship(e,r,n){let i=this.relationships.get(e);if(!i)return;let o=i.get(n);o&&(o.delete(r),o.size===0&&i.delete(n)),i.size===0&&this.relationships.delete(e)}getTotalWeight(e){let r=this.getEntity(e);if(!r)return 0;let n=r.weight||0,i=this.getAllContents(e,{recursive:!0});for(let o of i)n+=o.weight||0;return n}wouldCreateLoop(e,r){if(e===r)return!0;let n=r,i=new Set;for(;n;){if(i.has(n))return!1;if(n===e)return!0;i.add(n),n=this.getLocation(n)||""}return!1}findPath(e,r){if(e===r)return[];let n=this.getEntity(e),i=this.getEntity(r);if(!n?.hasTrait(gn.TraitType.ROOM)||!i?.hasTrait(gn.TraitType.ROOM))return null;let o=[{roomId:e,path:[]}],a=new Set;for(;o.length>0;){let{roomId:s,path:c}=o.shift();if(a.has(s))continue;a.add(s);let l=this.getEntity(s);if(!l)continue;let u=l.getTrait(gn.TraitType.ROOM)?.exits||{};for(let[m,f]of Object.entries(u)){let g,h;if(typeof f=="string")g=f,h=f;else if(typeof f=="object")if(f.via){let y=this.getEntity(f.via);if(!y)continue;if(h=f.via,y.hasTrait(gn.TraitType.DOOR)){let _=y.getTrait(gn.TraitType.DOOR);g=_?.room1===s?_?.room2:_?.room1}else if(y.hasTrait(gn.TraitType.EXIT))g=y.getTrait(gn.TraitType.EXIT)?.to;else continue}else f.destination&&(g=f.destination,h=g);if(!(!g||!h)){if(g===r)return h===g&&c.length===0?[]:[...c,h];if(!a.has(g)){let y=h===g?c:[...c,h];o.push({roomId:g,path:y})}}}}return null}getPlayer(){return this.playerId?this.getEntity(this.playerId):void 0}setPlayer(e){if(!this.hasEntity(e))throw new Error(`Cannot set player to non-existent entity: ${e}`);this.playerId=e}toJSON(){let e={entities:Array.from(this.entities.entries()).map(([r,n])=>({id:r,entity:n.toJSON()})),state:this.state,playerId:this.playerId,spatialIndex:this.spatialIndex.toJSON(),relationships:Array.from(this.relationships.entries()).map(([r,n])=>({entityId:r,relationships:Array.from(n.entries()).map(([i,o])=>({type:i,related:Array.from(o)}))})),idCounters:Array.from(this.idCounters.entries()),capabilities:Object.entries(this.capabilities).map(([r,n])=>({name:r,data:n.data,schema:n.schema}))};return JSON.stringify(e,null,2)}loadJSON(e){let r=JSON.parse(e);this.clear();for(let{id:n,entity:i}of r.entities){let o=DN.IFEntity.fromJSON(i);this.entities.set(n,o)}if(this.state=r.state||{},this.playerId=r.playerId,r.spatialIndex&&this.spatialIndex.loadJSON(r.spatialIndex),r.relationships)for(let{entityId:n,relationships:i}of r.relationships){let o=new Map;for(let{type:a,related:s}of i)o.set(a,new Set(s));this.relationships.set(n,o)}if(r.idCounters?this.idCounters=new Map(r.idCounters):this.rebuildIdCounters(),r.capabilities)for(let{name:n,data:i,schema:o}of r.capabilities)this.capabilities[n]={data:i,schema:o}}clear(){this.entities.clear(),this.state={},this.playerId=void 0,this.spatialIndex.clear(),this.relationships.clear(),this.appliedEvents=[],this.idCounters.clear(),this.capabilities={},this.grammarVocabularyProvider.clear(),this.eventChains.clear()}registerEventHandler(e,r){this.eventHandlers.set(e,r),this.eventProcessorWiring&&this.wireHandlerToProcessor(e,r)}unregisterEventHandler(e){this.eventHandlers.delete(e)}registerEventValidator(e,r){this.eventValidators.set(e,r)}registerEventPreviewer(e,r){this.eventPreviewers.set(e,r)}connectEventProcessor(e){this.eventProcessorWiring=e;for(let[r,n]of this.eventHandlers)this.wireHandlerToProcessor(r,n);for(let r of this.eventChains.keys())this.wireChainToProcessor(r)}wireHandlerToProcessor(e,r){if(!this.eventProcessorWiring)return;let n=i=>(r(i,this),[]);this.eventProcessorWiring.registerHandler(e,n)}chainEvent(e,r,n={}){let{mode:i="cascade",key:o,priority:a=100}=n,s={handler:r,key:o,priority:a};this.eventChains.has(e)||this.eventChains.set(e,[]);let c=this.eventChains.get(e);if(i==="override")this.eventChains.set(e,[s]);else if(o){let l=c.findIndex(u=>u.key===o);l>=0?c[l]=s:c.push(s)}else c.push(s);c.sort((l,u)=>l.priority-u.priority),this.eventProcessorWiring&&this.wireChainToProcessor(e)}wireChainToProcessor(e){this.eventProcessorWiring&&this.eventProcessorWiring.registerHandler(e,r=>this.executeChains(e,r).map(i=>({type:"emit",event:i})))}executeChains(e,r){let n=this.eventChains.get(e)||[],i=[],o=r.data||{},a=o._chainDepth||0,s=o._transactionId;for(let c of n){let l=c.handler(r,this);if(l){let u=Array.isArray(l)?l:[l];for(let m of u){let f=a+1;if(f>10){console.warn(`Chain depth exceeded for ${m.type}, skipping`);continue}let g=m.data||{},h={id:m.id||`chain-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,type:m.type,timestamp:m.timestamp||Date.now(),entities:m.entities||{},data:{...g,_chainedFrom:r.type,_chainSourceId:r.id,_chainDepth:f,...s?{_transactionId:s}:{}}};i.push(h)}}}return i}applyEvent(e){if(!this.canApplyEvent(e))throw new Error(`Cannot apply event of type '${e.type}': validation failed`);let r=this.eventHandlers.get(e.type);r&&r(e,this),this.appliedEvents.push(e),this.appliedEvents.length>this.maxEventHistory&&(this.appliedEvents=this.appliedEvents.slice(-this.maxEventHistory))}canApplyEvent(e){let r=this.eventValidators.get(e.type);return r?r(e,this):!0}previewEvent(e){let r=this.eventPreviewers.get(e.type);return r?r(e,this):[]}getAppliedEvents(){return[...this.appliedEvents]}getEventsSince(e){return this.appliedEvents.filter(r=>r.timestamp>e)}clearEventHistory(){this.appliedEvents=[]}rebuildIdCounters(){this.idCounters.clear();for(let e of this.entities.values()){let r=e.id;if(r.length>=3){let n=r[0],i=r.substring(1),o=parseInt(i,36);if(!isNaN(o)){let a=this.idCounters.get(n)||0;o>a&&this.idCounters.set(n,o)}}}}getDataStore(){return{entities:this.entities,spatialIndex:this.spatialIndex,state:this.state,playerId:this.playerId,relationships:this.relationships,idCounters:this.idCounters,capabilities:this.capabilities}}getScopeRegistry(){return this.scopeRegistry}getGrammarVocabularyProvider(){return this.grammarVocabularyProvider}addScopeRule(e){this.scopeRegistry.addRule(e),this.emitPlatformEvent("scope_rule_added",{ruleId:e.id,fromLocations:e.fromLocations,forActions:e.forActions})}removeScopeRule(e){let r=this.scopeRegistry.removeRule(e);return r&&this.emitPlatformEvent("scope_rule_removed",{ruleId:e}),r}evaluateScope(e,r){if(!this.getEntity(e))return console.warn("evaluateScope: No actor found for ID:",e),[];let i=this.getLocation(e);if(!i)return console.warn("evaluateScope: No location found for actor:",e),[];let o={world:this,actorId:e,actionId:r,currentLocation:i},a=this.scopeEvaluator.evaluate(o);return Array.from(a.entityIds)}registerDefaultScopeRules(){this.addScopeRule({id:"default_room_visibility",fromLocations:"*",includeEntities:e=>{if(!this.getEntity(e.currentLocation))return console.warn("No room found for location:",e.currentLocation),[];let n=this.getContents(e.currentLocation),i=n.map(o=>o.id);i.push(e.currentLocation);for(let o of n){let a=this.getAllContents(o.id);i.push(...a.map(s=>s.id))}return i},priority:50,source:"core"}),this.addScopeRule({id:"default_inventory_visibility",fromLocations:"*",includeEntities:e=>{let r=this.getContents(e.actorId),n=r.map(i=>i.id);for(let i of r){let o=this.getAllContents(i.id);n.push(...o.map(a=>a.id))}return n},priority:100,source:"core"})}getVisible(e){let r=this.getEntity(e);return r?FF.VisibilityBehavior.getVisible(r,this):[]}getInScope(e){return this.evaluateScope(e).map(n=>this.getEntity(n)).filter(n=>n!==void 0)}canSee(e,r){let n=this.getEntity(e),i=this.getEntity(r);return!n||!i?!1:FF.VisibilityBehavior.canSee(n,i,this)}};XE.WorldModel=PN});var zF=p(ZE=>{"use strict";Object.defineProperty(ZE,"__esModule",{value:!0});ZE.AuthorModel=void 0;var Cte=$d(),YF=te(),Nte=Qv(),Dte=Jv(),LN=class{constructor(e,r){d(this,"dataStore");d(this,"worldModel");d(this,"eventHandlers",new Map);this.dataStore=e,this.worldModel=r}getDataStore(){return this.dataStore}createEntity(e,r="object",n=!1){let i=this.generateId(r),o=new Cte.IFEntity(i,r,{attributes:{displayName:e,name:e,entityType:r}});return this.dataStore.entities.set(i,o),n&&this.emitEvent("author:entity:created",{entityId:i,name:e,entityType:r}),o}removeEntity(e,r=!1){if(this.dataStore.entities.get(e)){this.dataStore.spatialIndex.remove(e),this.dataStore.relationships.delete(e);for(let[,i]of this.dataStore.relationships)for(let[,o]of i)o.delete(e);this.dataStore.entities.delete(e),r&&this.emitEvent("author:entity:removed",{entityId:e,name})}}moveEntity(e,r,n=!1){let i=this.dataStore.spatialIndex.getParent(e);i&&this.dataStore.spatialIndex.removeChild(i,e),r!==null&&this.dataStore.spatialIndex.addChild(r,e),n&&this.emitEvent("author:entity:moved",{entityId:e,from:i,to:r})}getEntity(e){return this.dataStore.entities.get(e)}setEntityProperty(e,r,n,i=!1){let o=this.dataStore.entities.get(e);o&&(o.attributes[r]=n,i&&this.emitEvent("author:entity:property:changed",{entityId:e,property:r,value:n}))}addTrait(e,r,n=!1){let i=this.dataStore.entities.get(e);i&&(i.add(r),n&&this.emitEvent("author:entity:trait:added",{entityId:e,traitType:r.type}))}removeTrait(e,r,n=!1){let i=this.dataStore.entities.get(e);i&&(i.remove(r),n&&this.emitEvent("author:entity:trait:removed",{entityId:e,traitType:r}))}populate(e,r,n=!1){for(let i of r)this.moveEntity(i,e,n)}connect(e,r,n,i=!1){let o=this.dataStore.entities.get(e),a=this.dataStore.entities.get(r);if(!o||!a)return;let c={north:"south",south:"north",east:"west",west:"east",northeast:"southwest",northwest:"southeast",southeast:"northwest",southwest:"northeast",up:"down",down:"up",in:"out",out:"in"}[n]||n;o.attributes.exits||(o.attributes.exits={}),a.attributes.exits||(a.attributes.exits={}),o.attributes.exits[n]=r,a.attributes.exits[c]=e,i&&this.emitEvent("author:rooms:connected",{room1Id:e,room2Id:r,direction:n,opposite:c})}fillContainer(e,r,n=!1){for(let i of r){let o=this.createEntity(i.name,i.type||"item",n);if(i.attributes&&Object.assign(o.attributes,i.attributes),i.traits)for(let a of i.traits);this.moveEntity(o.id,e,n)}}placeActor(e,r,n=!1){this.moveEntity(e,r,n)}setupContainer(e,r,n,i,o=!1){let a=this.dataStore.entities.get(e);if(a){if(r!==void 0){let s=a.getTrait(YF.TraitType.OPENABLE);if(s)s.isOpen=r;else{let c=new Nte.OpenableTrait;c.isOpen=r,this.addTrait(e,c,o)}}if(n!==void 0){let s=a.getTrait(YF.TraitType.LOCKABLE);if(s)s.isLocked=n,i&&(s.requiredKey=i);else{let c=new Dte.LockableTrait;c.isLocked=n,i&&(c.requiredKey=i),this.addTrait(e,c,o)}}}}setStateValue(e,r,n=!1){this.dataStore.state[e]=r,n&&this.emitEvent("author:state:changed",{key:e,value:r})}setPlayer(e,r=!1){this.dataStore.entities.has(e)||console.warn(`Setting player to non-existent entity: ${e}`),this.worldModel?this.worldModel.playerId=e:this.dataStore.playerId=e,r&&this.emitEvent("author:player:set",{playerId:e})}clear(e=!1){this.dataStore.entities.clear(),this.dataStore.spatialIndex.clear();for(let r in this.dataStore.state)delete this.dataStore.state[r];this.worldModel?this.worldModel.playerId=void 0:this.dataStore.playerId=void 0,this.dataStore.relationships.clear(),this.dataStore.idCounters.clear(),this.dataStore.capabilities={},e&&this.emitEvent("author:world:cleared",{})}import(e,r=!1){r&&this.emitEvent("author:world:imported",{entityCount:this.dataStore.entities.size})}generateId(e){let r={room:"r",door:"d",item:"i",actor:"a",container:"c",supporter:"s",scenery:"y",exit:"e",object:"o"},n=r[e]||r.object,o=(this.dataStore.idCounters.get(n)||0)+1;if(o>1295)throw new Error(`ID overflow for type '${e}' (prefix '${n}')`);this.dataStore.idCounters.set(n,o);let a=o.toString(36).padStart(2,"0");return`${n}${a}`}emitEvent(e,r){let n=this.eventHandlers.get(e);if(n){let i={type:e,timestamp:Date.now(),...r};n(i)}}registerEventHandler(e,r){this.eventHandlers.set(e,r)}unregisterEventHandler(e){this.eventHandlers.delete(e)}};ZE.AuthorModel=LN});var $F=p(JE=>{"use strict";Object.defineProperty(JE,"__esModule",{value:!0});JE.StandardCapabilities=void 0;JE.StandardCapabilities={SCORING:"scoring",SAVE_RESTORE:"saveRestore",CONVERSATION:"conversation",GAME_META:"gameMeta",COMMAND_HISTORY:"commandHistory",DEBUG:"debug"}});var KF=p(hn=>{"use strict";Object.defineProperty(hn,"__esModule",{value:!0});hn.StandardCapabilities=hn.AuthorModel=hn.VisibilityBehavior=hn.SpatialIndex=hn.GrammarVocabularyProvider=hn.WorldModel=void 0;var Pte=VF();Object.defineProperty(hn,"WorldModel",{enumerable:!0,get:function(){return Pte.WorldModel}});var Lte=Xt();Object.defineProperty(hn,"GrammarVocabularyProvider",{enumerable:!0,get:function(){return Lte.GrammarVocabularyProvider}});var Mte=bN();Object.defineProperty(hn,"SpatialIndex",{enumerable:!0,get:function(){return Mte.SpatialIndex}});var kte=AN();Object.defineProperty(hn,"VisibilityBehavior",{enumerable:!0,get:function(){return kte.VisibilityBehavior}});var xte=zF();Object.defineProperty(hn,"AuthorModel",{enumerable:!0,get:function(){return xte.AuthorModel}});var Bte=$F();Object.defineProperty(hn,"StandardCapabilities",{enumerable:!0,get:function(){return Bte.StandardCapabilities}})});var QF=p(eT=>{"use strict";Object.defineProperty(eT,"__esModule",{value:!0});eT.ScopeService=void 0;var MN=class{constructor(e){d(this,"world");this.world=e}canSee(e,r){return!0}canReach(e,r){return!0}};eT.ScopeService=MN});var XF=p(tT=>{"use strict";Object.defineProperty(tT,"__esModule",{value:!0});tT.ScopeService=void 0;var jte=QF();Object.defineProperty(tT,"ScopeService",{enumerable:!0,get:function(){return jte.ScopeService}})});var JF=p(ZF=>{"use strict";Object.defineProperty(ZF,"__esModule",{value:!0})});var eG=p($a=>{"use strict";var Wte=$a&&$a.__createBinding||(Object.create?(function(t,e,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}):(function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]})),kN=$a&&$a.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&Wte(e,t,r)};Object.defineProperty($a,"__esModule",{value:!0});kN(JF(),$a);kN(wN(),$a);kN(NN(),$a)});var rG=p(tG=>{"use strict";Object.defineProperty(tG,"__esModule",{value:!0})});var b=p(ue=>{"use strict";var Hte=ue&&ue.__createBinding||(Object.create?(function(t,e,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}):(function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]})),ge=ue&&ue.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&Hte(e,t,r)};Object.defineProperty(ue,"__esModule",{value:!0});ge(QH(),ue);ge(CU(),ue);ge(DU(),ue);ge(jU(),ue);ge(zU(),ue);ge(zw(),ue);ge(te(),ue);ge(Qq(),ue);ge(Zq(),ue);ge(nN(),ue);ge(aN(),ue);ge(tF(),ue);ge(nF(),ue);ge(iF(),ue);ge(oF(),ue);ge(aF(),ue);ge(cF(),ue);ge(sN(),ue);ge(lN(),ue);ge(dF(),ue);ge(fF(),ue);ge(hF(),ue);ge(vF(),ue);ge(gN(),ue);ge(_F(),ue);ge(bF(),ue);ge(OF(),ue);ge(IF(),ue);ge(SF(),ue);ge(AF(),ue);ge(RF(),ue);ge(NF(),ue);ge(MF(),ue);ge(KF(),ue);ge(XF(),ue);ge(eG(),ue);ge(rG(),ue);ge(SN(),ue)});var Ce=p(Yo=>{"use strict";Object.defineProperty(Yo,"__esModule",{value:!0});Yo.WitnessLevel=Yo.SenseType=Yo.ScopeLevelStrings=Yo.ScopeLevel=void 0;var nG;(function(t){t[t.UNAWARE=0]="UNAWARE",t[t.AWARE=1]="AWARE",t[t.VISIBLE=2]="VISIBLE",t[t.REACHABLE=3]="REACHABLE",t[t.CARRIED=4]="CARRIED"})(nG||(Yo.ScopeLevel=nG={}));Yo.ScopeLevelStrings={CARRIED:"carried",REACHABLE:"reachable",VISIBLE:"visible",AUDIBLE:"audible",DETECTABLE:"detectable",OUT_OF_SCOPE:"out_of_scope"};var iG;(function(t){t.SIGHT="sight",t.HEARING="hearing",t.SMELL="smell",t.TOUCH="touch",t.VIBE="vibe"})(iG||(Yo.SenseType=iG={}));var oG;(function(t){t.FULL="full",t.PARTIAL="partial",t.PERIPHERAL="peripheral",t.INFERRED="inferred"})(oG||(Yo.WitnessLevel=oG={}))});var kp=p(Mp=>{"use strict";Object.defineProperty(Mp,"__esModule",{value:!0});Mp.StandardScopeResolver=void 0;Mp.createScopeResolver=Ute;var De=b(),Hc=Ce(),rT=class{constructor(e){d(this,"world");this.world=e}getScope(e,r){let n=this.calculatePhysicalScope(e,r),i=this.getContainingRoom(e.id),o=r.getMinimumScope(i?.id??null);return Math.max(n,o)}calculatePhysicalScope(e,r){return this.isCarried(e,r)?Hc.ScopeLevel.CARRIED:this.canReach(e,r)?Hc.ScopeLevel.REACHABLE:this.canSee(e,r)?Hc.ScopeLevel.VISIBLE:this.canHear(e,r)||this.canSmell(e,r)?Hc.ScopeLevel.AWARE:Hc.ScopeLevel.UNAWARE}canSee(e,r){let n=this.world.getLocation(e.id),i=this.world.getLocation(r.id);if(!n||!i)return!1;let o=this.getContainingRoom(e.id),a=this.getContainingRoom(r.id);return!o||!a||this.isInDarkness(o)&&!this.hasLightSource(e)||o.id!==a.id?!1:this.isVisibleInContainer(r.id,e.id)}canReach(e,r){if(!this.canSee(e,r))return!1;if(this.isCarried(e,r))return!0;let n=this.world.getLocation(e.id),i=this.world.getLocation(r.id);if(n===i)return!0;let o=i?this.world.getEntity(i):null;if(o){if(o.has(De.TraitType.SUPPORTER))return!0;if(o.has(De.TraitType.CONTAINER)){let a=o.getTrait(De.TraitType.CONTAINER);if(o.has(De.TraitType.OPENABLE)){let s=o.getTrait(De.TraitType.OPENABLE);if(s&&!s.isOpen)return!1}return!0}}return!0}canHear(e,r){let n=this.world.getLocation(e.id),i=this.world.getLocation(r.id);if(!n||!i)return!1;let o=this.getContainingRoom(e.id),a=this.getContainingRoom(r.id);if(!o||!a)return!1;if(o.id===a.id){if(this.isInClosedContainer(r.id)){let c=r.get(De.TraitType.IDENTITY);return(c&&typeof c=="object"&&"customProperties"in c&&c.customProperties?.loud===!0)===!0}return!0}let s=this.getRoomConnection(o,a);return s?(s.isOpen,!0):!1}canSmell(e,r){let n=this.world.getLocation(e.id),i=this.world.getLocation(r.id);if(!n||!i)return!1;let o=this.getContainingRoom(e.id),a=this.getContainingRoom(r.id);if(!o||!a)return!1;if(o.id===a.id){if(this.isInClosedContainer(r.id)){let c=r.get(De.TraitType.IDENTITY);return(c&&typeof c=="object"&&"customProperties"in c&&c.customProperties?.verySmelly===!0)===!0&&this.hasScent(r)}return this.hasScent(r)}let s=this.getRoomConnection(o,a);return s&&s.isOpen?this.hasScent(r):!1}getVisible(e){let r=[],n=this.world.getAllEntities(),i=this.getContainingRoom(e.id);for(let o of n){if(o.id===e.id)continue;if(this.canSee(e,o)){r.push(o);continue}o.getMinimumScope(i?.id??null)>=Hc.ScopeLevel.VISIBLE&&r.push(o)}return r}getReachable(e){let r=[],n=this.world.getAllEntities(),i=this.getContainingRoom(e.id);for(let o of n){if(o.id===e.id)continue;if(this.canReach(e,o)){r.push(o);continue}o.getMinimumScope(i?.id??null)>=Hc.ScopeLevel.REACHABLE&&r.push(o)}return r}getAudible(e){let r=[],n=this.world.getAllEntities(),i=this.getContainingRoom(e.id);for(let o of n){if(o.id===e.id)continue;if(this.canHear(e,o)){r.push(o);continue}o.getMinimumScope(i?.id??null)>=Hc.ScopeLevel.AWARE&&r.push(o)}return r}isCarried(e,r){return this.world.getLocation(r.id)===e.id}getContainingRoom(e){let r=e,n=10;for(;r&&n-- >0;){let i=this.world.getEntity(r);if(!i)return null;if(i.has(De.TraitType.ROOM))return i;let o=this.world.getLocation(r);if(!o)return null;r=o}return null}isVisibleInContainer(e,r){let n=e,i=10;for(;n&&i-- >0;){let o=this.world.getLocation(n);if(!o)return!1;let a=this.world.getEntity(o);if(!a)return!1;if(a.has(De.TraitType.ROOM))return!0;if(a.has(De.TraitType.CONTAINER)&&a.has(De.TraitType.OPENABLE)){let s=a.getTrait(De.TraitType.OPENABLE);if(s&&!s.isOpen)return!1}a.has(De.TraitType.SUPPORTER),n=o}return!1}getRoomConnection(e,r){let n=this.world.getAllEntities().filter(s=>this.world.getLocation(s.id)===e.id),i=this.world.getAllEntities().filter(s=>this.world.getLocation(s.id)===r.id),o=s=>{for(let c of s)if(c.has(De.TraitType.DOOR)){let l=c.get(De.TraitType.DOOR);if(l.room1===e.id&&l.room2===r.id||l.room1===r.id&&l.room2===e.id)return c.has(De.TraitType.OPENABLE)?{isOpen:c.get(De.TraitType.OPENABLE).isOpen}:{isOpen:!0}}return null},a=o(n);return a||o(i)}hasScent(e){let r=e.get(De.TraitType.IDENTITY);if(r&&typeof r=="object"&&"customProperties"in r){let n=r.customProperties;if(n?.smelly||n?.verySmelly)return!0}return!!(e.has(De.TraitType.EDIBLE)||e.has(De.TraitType.ACTOR))}isInDarkness(e){let r=e.get(De.TraitType.IDENTITY);return r&&typeof r=="object"&&"customProperties"in r?r.customProperties?.isDark===!0:!1}hasLightSource(e){let r=this.world.getAllEntities().filter(i=>this.world.getLocation(i.id)===e.id);for(let i of r)if(this.isLightSource(i))return!0;let n=e.get(De.TraitType.IDENTITY);return!!(n&&typeof n=="object"&&"customProperties"in n&&n.customProperties?.providesLight)}isLightSource(e){if(e.has(De.TraitType.LIGHT_SOURCE)){let n=e.getTrait(De.TraitType.LIGHT_SOURCE);if(e.has(De.TraitType.SWITCHABLE)){let i=e.getTrait(De.TraitType.SWITCHABLE);return i?i.isOn===!0:!1}return!0}let r=e.get(De.TraitType.IDENTITY);return!!(r&&typeof r=="object"&&"customProperties"in r&&r.customProperties?.isLit)}isInClosedContainer(e){let r=e,n=10;for(;r&&n-- >0;){let i=this.world.getLocation(r);if(!i)return!1;let o=this.world.getEntity(i);if(!o||o.has(De.TraitType.ROOM))return!1;if(o.has(De.TraitType.CONTAINER)&&o.has(De.TraitType.OPENABLE)){let a=o.getTrait(De.TraitType.OPENABLE);if(a&&!a.isOpen)return!0}r=i}return!1}};Mp.StandardScopeResolver=rT;function Ute(t){return new rT(t)}});var ce=p(pm=>{"use strict";Object.defineProperty(pm,"__esModule",{value:!0});pm.IFActions=pm.ActionIDs=void 0;pm.ActionIDs={GOING:"if.action.going",LOOKING:"if.action.looking",EXAMINING:"if.action.examining",TAKING:"if.action.taking",DROPPING:"if.action.dropping",OPENING:"if.action.opening",INVENTORY:"if.action.inventory"};pm.IFActions={GOING:"if.action.going",ENTERING:"if.action.entering",EXITING:"if.action.exiting",CLIMBING:"if.action.climbing",JUMPING:"if.action.jumping",LOOKING:"if.action.looking",EXAMINING:"if.action.examining",SEARCHING:"if.action.searching",LOOKING_UNDER:"if.action.looking_under",LOOKING_BEHIND:"if.action.looking_behind",LISTENING:"if.action.listening",SMELLING:"if.action.smelling",TOUCHING:"if.action.touching",TASTING:"if.action.tasting",TAKING:"if.action.taking",DROPPING:"if.action.dropping",PUTTING:"if.action.putting",INSERTING:"if.action.inserting",REMOVING:"if.action.removing",THROWING:"if.action.throwing",OPENING:"if.action.opening",CLOSING:"if.action.closing",EMPTYING:"if.action.emptying",LOCKING:"if.action.locking",UNLOCKING:"if.action.unlocking",WEARING:"if.action.wearing",TAKING_OFF:"if.action.taking_off",SWITCHING_ON:"if.action.switching_on",SWITCHING_OFF:"if.action.switching_off",PUSHING:"if.action.pushing",PULLING:"if.action.pulling",TURNING:"if.action.turning",SETTING:"if.action.setting",EATING:"if.action.eating",DRINKING:"if.action.drinking",TALKING:"if.action.talking",ASKING:"if.action.asking",TELLING:"if.action.telling",ANSWERING:"if.action.answering",SHOWING:"if.action.showing",GIVING:"if.action.giving",ATTACKING:"if.action.attacking",KISSING:"if.action.kissing",WAVING:"if.action.waving",LOWERING:"if.action.lowering",RAISING:"if.action.raising",CONSULTING:"if.action.consulting",READING:"if.action.reading",INVENTORY:"if.action.inventory",WAITING:"if.action.waiting",SLEEPING:"if.action.sleeping",WAKING:"if.action.waking",SAVING:"if.action.saving",RESTORING:"if.action.restoring",RESTARTING:"if.action.restarting",QUITTING:"if.action.quitting",UNDOING:"if.action.undoing",AGAIN:"if.action.again",SCORING:"if.action.scoring",VERIFYING:"if.action.verifying",VERSION:"if.action.version",HELP:"if.action.help",HINTS:"if.action.hints",ABOUT:"if.action.about"}});var aG=p(nT=>{"use strict";Object.defineProperty(nT,"__esModule",{value:!0});nT.TakingMessages=void 0;nT.TakingMessages={NO_TARGET:"no_target",CANT_TAKE_SELF:"cant_take_self",ALREADY_HAVE:"already_have",CANT_TAKE_ROOM:"cant_take_room",FIXED_IN_PLACE:"fixed_in_place",CONTAINER_FULL:"container_full",TOO_HEAVY:"too_heavy",CANNOT_TAKE:"cannot_take",CANT_TAKE:"cant_take",NOTHING_TO_TAKE:"nothing_to_take",TAKEN:"taken",TAKEN_FROM:"taken_from",TAKEN_MULTI:"taken_multi"}});var lG=p(Uc=>{"use strict";Object.defineProperty(Uc,"__esModule",{value:!0});Uc.isWearableTrait=qte;Uc.isContainerTrait=sG;Uc.hasCapacityLimit=Fte;Uc.isTakingSharedData=cG;Uc.getTakingSharedData=Gte;Uc.setTakingSharedData=Vte;function qte(t){if(!t||typeof t!="object")return!1;let e=t;return"isWorn"in e&&typeof e.isWorn=="boolean"||"worn"in e&&typeof e.worn=="boolean"}function sG(t){return t!==null&&typeof t=="object"&&("capacity"in t||"isTransparent"in t||"enterable"in t)}function Fte(t){return sG(t)&&t.capacity!==void 0&&typeof t.capacity=="object"}function cG(t){return typeof t=="object"&&t!==null}function Gte(t){return cG(t.sharedData)||(t.sharedData={}),t.sharedData}function Vte(t,e){Object.assign(t.sharedData,e)}});var xp=p(uu=>{"use strict";Object.defineProperty(uu,"__esModule",{value:!0});uu.isMultiObjectCommand=Yte;uu.isAllCommand=zte;uu.isListCommand=$te;uu.getExcludedNames=dG;uu.expandMultiObject=Kte;var iT=b(),uG=kp();function Yte(t){let e=t.command.parsed.structure.directObject;return!!(e?.isAll||e?.isList)}function zte(t){return t.command.parsed.structure.directObject?.isAll===!0}function $te(t){return t.command.parsed.structure.directObject?.isList===!0}function dG(t){let e=t.command.parsed.excluded;return!e||e.length===0?[]:e.map(r=>r.head||r.text).map(r=>r.toLowerCase())}function Kte(t,e={}){let r=t.command.parsed.structure.directObject,n=t.world,i=t.player;if(r?.isAll)return Qte(t,e);if(r?.isList&&r.items)return Xte(t,r.items,e);let o=t.command.directObject?.entity;return o?[{entity:o}]:[]}function Qte(t,e){let r=t.world,n=t.player,i=new uG.StandardScopeResolver(r),o;switch(e.scope){case"carried":o=r.getContents(n.id);break;case"visible":o=i.getVisible(n);break;default:o=i.getReachable(n);break}e.filter&&(o=o.filter(s=>e.filter(s,r))),o=o.filter(s=>Zte(s));let a=dG(t);return a.length>0&&(o=o.filter(s=>{let c=s.name.toLowerCase(),l=mG(s).map(u=>u.toLowerCase());return!a.includes(c)&&!l.some(u=>a.includes(u))})),o.map(s=>({entity:s}))}function Xte(t,e,r){let n=t.world,i=t.player,o=new uG.StandardScopeResolver(n),a=[],s;switch(r.scope){case"carried":s=n.getContents(i.id);break;case"visible":s=o.getVisible(i);break;default:s=o.getReachable(i);break}for(let c of e){let l=(c.head||c.text).toLowerCase(),u=s.find(m=>{let f=m.name.toLowerCase(),g=mG(m).map(h=>h.toLowerCase());return f===l||g.includes(l)});u&&(!r.filter||r.filter(u,n))&&a.push({entity:u,nounPhrase:c})}return a}function Zte(t){return!(t.has(iT.TraitType.ROOM)||t.has(iT.TraitType.SCENERY)||t.has(iT.TraitType.ACTOR))}function mG(t){let e=t.get(iT.TraitType.IDENTITY);if(e&&typeof e=="object"&&"aliases"in e){let r=e.aliases;if(Array.isArray(r))return r.map(String)}return[]}});var BN=p(oT=>{"use strict";Object.defineProperty(oT,"__esModule",{value:!0});oT.takingAction=void 0;var $n=b(),Jte=ce(),xN=Ce(),Ii=aG(),gm=lG(),gG=xp();function hG(t,e){let r=t.player,n=t.requireScope(e,xN.ScopeLevel.REACHABLE);if(!n.ok)return n.error;if(e.id===r.id)return{valid:!1,error:Ii.TakingMessages.CANT_TAKE_SELF};if(t.world.getLocation(e.id)===r.id)return{valid:!1,error:Ii.TakingMessages.ALREADY_HAVE,params:{item:e.name}};if(e.has($n.TraitType.ROOM))return{valid:!1,error:Ii.TakingMessages.CANT_TAKE_ROOM,params:{item:e.name}};if(e.has($n.TraitType.SCENERY))return{valid:!1,error:$n.SceneryBehavior.getCantTakeMessage(e)||Ii.TakingMessages.FIXED_IN_PLACE,params:{item:e.name}};if(!$n.ActorBehavior.canTakeItem(r,e,t.world)){if(r.has($n.TraitType.CONTAINER)){let o=r.get($n.TraitType.CONTAINER);if((0,gm.hasCapacityLimit)(o)){if(o.capacity.maxItems!==void 0&&t.world.getContents(r.id).filter(c=>{if(!c.has||!c.has($n.TraitType.WEARABLE))return!0;let l=c.get($n.TraitType.WEARABLE);return!(0,gm.isWearableTrait)(l)||!l.isWorn&&!l.worn}).length>=o.capacity.maxItems)return{valid:!1,error:Ii.TakingMessages.CONTAINER_FULL};if(o.capacity.maxWeight!==void 0){let a=$n.ContainerBehavior.getTotalWeight(r,t.world),s=$n.IdentityBehavior.getWeight(e);if(a+s>o.capacity.maxWeight)return{valid:!1,error:Ii.TakingMessages.TOO_HEAVY}}}}return{valid:!1,error:Ii.TakingMessages.CANNOT_TAKE,params:{item:e.name}}}return{valid:!0}}function ere(t){let e=t.player.id,r=(0,gG.expandMultiObject)(t,{scope:"reachable",filter:(a,s)=>s.getLocation(a.id)!==e});if(r.length===0)return{valid:!1,error:Ii.TakingMessages.NOTHING_TO_TAKE};let n=r.map(a=>{let s=hG(t,a.entity);return{entity:a.entity,success:s.valid,error:s.valid?void 0:s.error}}),i=(0,gm.getTakingSharedData)(t);return i.multiObjectResults=n,n.some(a=>a.success)?{valid:!0}:{valid:!1,error:n[0].error}}function fG(t,e,r){let n=t.player,i=t.world.getLocation(e.id);if(r.previousLocation=i,e.has($n.TraitType.WEARABLE)){let o=e.get($n.TraitType.WEARABLE);if((0,gm.isWearableTrait)(o)&&(o.isWorn||o.worn)){r.implicitlyRemoved=!0,r.wasWorn=!0;let a=i?t.world.getEntity(i):null;a&&$n.WearableBehavior.remove(e,a)}}t.world.moveEntity(e.id,n.id)}function pG(t,e,r,n,i=!1){let o=t.player;if(r.implicitlyRemoved){let m=r.previousLocation,f=m?t.world.getEntity(m):null;n.push(t.event("if.event.removed",{implicit:!0,item:e.name,container:f?.name}))}let a=r.previousLocation,s=a&&a!==t.world.getLocation(o.id),c=a?t.world.getEntity(a):null,l;i?l=Ii.TakingMessages.TAKEN_MULTI:s?l=Ii.TakingMessages.TAKEN_FROM:l=Ii.TakingMessages.TAKEN;let u={item:e.name,itemId:e.id,actor:o.name,actorId:o.id,previousLocation:r.previousLocation,container:c?.name||""};n.push(t.event("if.event.taken",{messageId:`${t.action.id}.${l}`,params:u,...u}))}function tre(t,e,r,n){n.push(t.event("if.event.take_blocked",{messageId:`${t.action.id}.${r}`,params:{item:e.name},item:e.name,itemId:e.id,reason:r}))}oT.takingAction={id:Jte.IFActions.TAKING,defaultScope:{target:xN.ScopeLevel.REACHABLE},requiredMessages:["no_target","cant_take_self","already_have","cant_take_room","fixed_in_place","container_full","too_heavy","taken","taken_from","nothing_to_take"],metadata:{requiresDirectObject:!0,requiresIndirectObject:!1,directObjectScope:xN.ScopeLevel.REACHABLE},validate(t){if((0,gG.isMultiObjectCommand)(t))return ere(t);let e=t.command.directObject?.entity;return e?hG(t,e):{valid:!1,error:Ii.TakingMessages.NO_TARGET}},execute(t){let e=(0,gm.getTakingSharedData)(t);if(e.multiObjectResults){for(let n of e.multiObjectResults)n.success&&fG(t,n.entity,n);return}let r=t.command.directObject.entity;fG(t,r,e)},report(t){let e=(0,gm.getTakingSharedData)(t),r=[];if(e.multiObjectResults){let i=e.multiObjectResults.length>1;for(let o of e.multiObjectResults)o.success?pG(t,o.entity,o,r,i):tre(t,o.entity,o.error,r);return r}let n=t.command.directObject.entity;return pG(t,n,e,r,!1),r},blocked(t,e){let r=t.command.directObject?.entity;return[t.event("if.event.take_blocked",{messageId:`${t.action.id}.${e.error}`,params:{...e.params,item:r?.name},item:r?.name,itemId:r?.id,reason:e.error})]},group:"object_manipulation"}});var HN=p(sT=>{"use strict";Object.defineProperty(sT,"__esModule",{value:!0});sT.createActionContext=yG;sT.createMockActionContext=nre;var aT=Je(),jN=b(),Bp=Yw(),Si=Ce(),rre=kp(),du=BN(),WN=class t{constructor(e,r,n,i,o,a){d(this,"world");d(this,"player");d(this,"currentLocation");d(this,"action");d(this,"command");d(this,"sequenceCounter",0);d(this,"scopeResolver");d(this,"sharedData",{});this.world=e,this.player=r,this.currentLocation=n,this.action=i,this.command=o,this.scopeResolver=a||new rre.StandardScopeResolver(e)}canSee(e){return this.scopeResolver.canSee(this.player,e)}canReach(e){return this.scopeResolver.canReach(this.player,e)}canTake(e){return!e.has(jN.TraitType.SCENERY)&&!e.has(jN.TraitType.ROOM)&&!e.has(jN.TraitType.DOOR)}isInScope(e){return this.scopeResolver.getScope(this.player,e)>=Si.ScopeLevel.AWARE}getVisible(){return this.scopeResolver.getVisible(this.player)}getInScope(){let e=this.scopeResolver.getVisible(this.player),r=this.scopeResolver.getAudible(this.player),n=this.scopeResolver.getReachable(this.player),i=new Map;return[...e,...r,...n].forEach(o=>{i.set(o.id,o)}),Array.from(i.values())}getEntityScope(e){return this.scopeResolver.getScope(this.player,e)}getSlotScope(e){let r=this.getEntityFromSlot(e);return r?this.getEntityScope(r):Si.ScopeLevel.UNAWARE}requireScope(e,r){let n=this.getEntityScope(e);return n>=r?{ok:!0,actualScope:n}:{ok:!1,error:this.getScopeError(r,n,e),actualScope:n}}requireSlotScope(e,r){let n=this.getEntityFromSlot(e);return n?this.requireScope(n,r):{ok:!1,error:{valid:!1,error:"no_target",params:{slot:e}}}}requireCarriedOrImplicitTake(e){let r=this.getEntityScope(e);if(r>=Si.ScopeLevel.CARRIED)return{ok:!0};if(r<Si.ScopeLevel.REACHABLE)return{ok:!1,error:this.getScopeError(Si.ScopeLevel.REACHABLE,r,e)};if(!this.canTake(e))return{ok:!1,error:{valid:!1,error:"fixed_in_place",params:{item:e.name}}};let n={parsed:{rawInput:`take ${e.name}`,action:du.takingAction.id,tokens:[],structure:{verb:{tokens:[0],text:"take",head:"take"}},pattern:"VERB_NOUN",confidence:1},actionId:du.takingAction.id,directObject:{entity:e,parsed:{text:e.name,candidates:[e.name]}}},i=new t(this.world,this.player,this.currentLocation,du.takingAction,n,this.scopeResolver),o=du.takingAction.validate(i);if(!o.valid)return{ok:!1,error:{valid:!1,error:o.error||"cannot_take",params:o.params}};du.takingAction.execute(i);let a=du.takingAction.report?du.takingAction.report(i):[],c=[this.event("if.event.implicit_take",{item:e.id,itemName:e.name}),...a];return this.sharedData.implicitTakeEvents||(this.sharedData.implicitTakeEvents=[]),this.sharedData.implicitTakeEvents.push(...c),{ok:!0,implicitTakeEvents:c}}getEntityFromSlot(e){switch(e){case"target":case"directObject":return this.command.directObject?.entity??null;case"item":return this.command.directObject?.entity??null;case"container":case"recipient":case"instrument":case"indirectObject":return this.command.indirectObject?.entity??null;default:return this.command.directObject?.entity??null}}getScopeError(e,r,n){let i={item:n.name};return r===Si.ScopeLevel.UNAWARE?{valid:!1,error:Bp.ScopeErrors.NOT_KNOWN,params:i}:e>=Si.ScopeLevel.VISIBLE&&r<Si.ScopeLevel.VISIBLE?{valid:!1,error:Bp.ScopeErrors.NOT_VISIBLE,params:i}:e>=Si.ScopeLevel.REACHABLE&&r<Si.ScopeLevel.REACHABLE?{valid:!1,error:Bp.ScopeErrors.NOT_REACHABLE,params:i}:e>=Si.ScopeLevel.CARRIED&&r<Si.ScopeLevel.CARRIED?{valid:!1,error:Bp.ScopeErrors.NOT_CARRIED,params:i}:{valid:!1,error:Bp.ScopeErrors.OUT_OF_SCOPE,params:i}}event(e,r){return this.createEventInternal(e,r)}createEventInternal(e,r){if(e==="action.error"||e==="action.success"||e==="action.blocked"){let o={...r,timestamp:r.timestamp||Date.now()},a=this.getEventEntities();return(0,aT.createEvent)(e,o,a)}if(e.startsWith("if.")){let o=this.getEventEntities();return(0,aT.createEvent)(e,r,o)}if(r&&typeof r=="object"&&"data"in r){let{actionId:o,reason:a,data:s,timestamp:c}=r,l={actionId:o||this.action.id,timestamp:c||Date.now(),...a&&{reason:a},data:s||{}},u=this.getEventEntities();return(0,aT.createEvent)(e,l,u)}let n={actionId:this.action.id,timestamp:Date.now(),data:r},i=this.getEventEntities();return(0,aT.createEvent)(e,n,i)}getEventEntities(){let e={};return this.player?.id&&(e.actor=this.player.id),this.command?.directObject?.entity?.id&&(e.target=this.command.directObject.entity.id),this.command?.indirectObject?.entity?.id&&(e.instrument=this.command.indirectObject.entity.id),this.currentLocation?.id&&(e.location=this.currentLocation.id),e}createSubContext(e){let r=new t(this.world,this.player,this.currentLocation,e,this.command,this.scopeResolver);return r.sharedData=this.sharedData,r}};function yG(t,e,r,n,i){let o=t.getLocation(e.id),a=o?t.getEntity(o):null;if(!a)throw new Error("Player has no valid location");return new WN(t,e,a,r,n,i)}function nre(t,e,r,n,i){if(!t)throw new Error("createMockActionContext: world is required");if(!e)throw new Error("createMockActionContext: player is required");if(!r)throw new Error("createMockActionContext: action is required");let o={parsed:{rawInput:"test",action:r.id,tokens:[],structure:{verb:{tokens:[0],text:"test",head:"test"}},pattern:"VERB_ONLY",confidence:1},actionId:r.id,...n};return yG(t,e,r,o,i)}});var UN=p(cT=>{"use strict";Object.defineProperty(cT,"__esModule",{value:!0});cT.MetaCommandRegistry=void 0;var jp=class{static register(e){if(!e){console.warn("MetaCommandRegistry: Attempted to register empty action ID");return}this.metaCommands.add(e)}static unregister(e){return this.metaCommands.delete(e)}static isMeta(e){return e?this.metaCommands.has(e):!1}static getAll(){return Array.from(this.metaCommands).sort()}static clear(){this.metaCommands.clear(),this.reset()}static reset(){this.metaCommands=new Set(["if.action.saving","if.action.restoring","if.action.quitting","if.action.restarting","if.action.undoing","if.action.scoring","if.action.version","if.action.about","if.action.help","if.action.again","transcript","transcript_on","transcript_off","undo","verbose","brief","superbrief","notify"])}static count(){return this.metaCommands.size}static hasCustomCommands(){let e=new Set(["if.action.saving","if.action.restoring","if.action.quitting","if.action.restarting","if.action.undoing","if.action.scoring","if.action.version","if.action.about","if.action.help","if.action.again","transcript","transcript_on","transcript_off","undo","verbose","brief","superbrief","notify"]);for(let r of this.metaCommands)if(!e.has(r))return!0;return!1}static isNonUndoable(e){let n=e.trim().toLowerCase().split(/\s+/)[0];return this.nonUndoableVerbs.has(n)}};d(jp,"metaCommands",new Set(["if.action.saving","if.action.restoring","if.action.quitting","if.action.restarting","if.action.scoring","if.action.version","if.action.about","if.action.help","transcript","transcript_on","transcript_off","if.action.again","if.action.undoing","undo","verbose","brief","superbrief","notify"])),d(jp,"nonUndoableVerbs",new Set(["undo","save","restore","restart","quit","score","version","about","help","verbose","brief","superbrief","notify","again","g","look","l","examine","x","inventory","i"]));cT.MetaCommandRegistry=jp});var FN=p(lT=>{"use strict";Object.defineProperty(lT,"__esModule",{value:!0});lT.MetaAction=void 0;var ire=UN(),qN=class{constructor(){d(this,"descriptionMessageId");d(this,"examplesMessageId");d(this,"group");d(this,"priority")}validate(e){return{valid:!0}}ensureRegistered(){this.id?ire.MetaCommandRegistry.register(this.id):console.warn("MetaAction: Cannot register without an id")}};lT.MetaAction=qN});var vG=p(uT=>{"use strict";Object.defineProperty(uT,"__esModule",{value:!0});uT.ReadOnlyActionContext=void 0;var qc=Ce(),GN=class{constructor(e,r,n,i,o,a){d(this,"world");d(this,"player");d(this,"currentLocation");d(this,"command");d(this,"action");d(this,"scopeResolver");d(this,"sharedData",{});this.world=e,this.player=r,this.currentLocation=n,this.command=i,this.action=o||{id:"unknown",validate:()=>({valid:!0}),execute:()=>[]},this.scopeResolver=a||{}}canSee(e){return this.world.canSee(this.player.id,e.id)}canReach(e){let r=this.world.getLocation(e.id);if(r===this.player.id||r===this.currentLocation.id)return!0;if(r){let n=this.world.getEntity(r);if(n){let i=this.world.getLocation(n.id);if(i===this.currentLocation.id){if(n.has("container")){let o=n.get("openable");if(!o||o.isOpen)return!0}if(n.has("supporter"))return!0}if(i===this.player.id&&n.has("container")){let o=n.get("openable");if(!o||o.isOpen)return!0}}}return!1}canTake(e){return!(!this.canSee(e)||!this.canReach(e)||e.has("room")||e.has("scenery")||this.world.getLocation(e.id)===this.player.id)}isInScope(e){return this.world.getInScope(this.player.id).some(n=>n.id===e.id)}getVisible(){return this.world.getVisible(this.player.id)}getInScope(){return this.world.getInScope(this.player.id)}getCapability(e){return this.world.getCapability(e)}event(e,r){throw new Error("ReadOnlyActionContext does not support event creation. Use createActionContext from enhanced-context.ts instead.")}getEntityScope(e){let r=this.world.getLocation(e.id);return r===this.player.id?qc.ScopeLevel.CARRIED:r===this.currentLocation.id||this.canReach(e)?qc.ScopeLevel.REACHABLE:this.canSee(e)?qc.ScopeLevel.VISIBLE:qc.ScopeLevel.UNAWARE}getSlotScope(e){let n={target:"directObject",item:"directObject",container:"indirectObject",recipient:"indirectObject"}[e]||e,o=this.command[n]?.entity;return o?this.getEntityScope(o):qc.ScopeLevel.UNAWARE}requireScope(e,r){let n=this.getEntityScope(e);if(n>=r)return{ok:!0,actualScope:n};let i;return r===qc.ScopeLevel.CARRIED?i="scope.not_carried":r===qc.ScopeLevel.REACHABLE?i="scope.not_reachable":r===qc.ScopeLevel.VISIBLE?i="scope.not_visible":i="scope.out_of_scope",{ok:!1,actualScope:n,error:{valid:!1,error:i,params:{entityId:e.id,entityName:e.name,required:r,actual:n}}}}requireSlotScope(e,r){let i={target:"directObject",item:"directObject",container:"indirectObject",recipient:"indirectObject"}[e]||e,a=this.command[i]?.entity;return a?this.requireScope(a,r):{ok:!1,error:{valid:!1,error:"scope.not_found",params:{slot:e}}}}requireCarriedOrImplicitTake(e){throw new Error("ReadOnlyActionContext does not support implicit takes. Use createActionContext from enhanced-context.ts instead.")}};uT.ReadOnlyActionContext=GN});var EG=p(dT=>{"use strict";Object.defineProperty(dT,"__esModule",{value:!0});dT.StandardActionRegistry=void 0;var VN=class{constructor(){d(this,"actions",new Map);d(this,"actionsByPattern",new Map);d(this,"actionsByGroup",new Map);d(this,"languageProvider",null)}setLanguageProvider(e){this.languageProvider=e,this.rebuildPatternMappings()}register(e){if(this.actions.set(e.id,e),e.group){let r=this.actionsByGroup.get(e.group)||[];r.push(e),this.actionsByGroup.set(e.group,r)}if("aliases"in e&&Array.isArray(e.aliases)){let r=e.aliases;for(let n of r){let i=n.toLowerCase();this.actionsByPattern.set(i,[e])}}this.languageProvider&&this.updatePatternMappingsForAction(e)}registerMany(e){for(let r of e)this.register(r)}get(e){return this.actions.get(e)}getAll(){return Array.from(this.actions.values())}has(e){return this.actions.has(e)}findByPattern(e){return this.actionsByPattern.get(e.toLowerCase())||[]}getByGroup(e){return this.actionsByGroup.get(e)||[]}find(e){let r=this.get(e);return r||this.findByPattern(e)[0]}registerMessages(e,r){}updatePatternMappingsForAction(e){if(!this.languageProvider)return;let r=this.languageProvider.getActionPatterns(e.id);if(r)for(let n of r){let i=n.toLowerCase(),o=this.actionsByPattern.get(i)||[];o.includes(e)||(o.push(e),o.sort((a,s)=>(s.priority||0)-(a.priority||0)),this.actionsByPattern.set(i,o))}}rebuildPatternMappings(){this.actionsByPattern.clear();for(let e of this.actions.values())this.updatePatternMappingsForAction(e)}};dT.StandardActionRegistry=VN});var YN=p(mT=>{"use strict";Object.defineProperty(mT,"__esModule",{value:!0});mT.takingAction=void 0;var ore=BN();Object.defineProperty(mT,"takingAction",{enumerable:!0,get:function(){return ore.takingAction}})});var hm=p(Fc=>{"use strict";Object.defineProperty(Fc,"__esModule",{value:!0});Fc.actionDataRegistry=Fc.ActionDataRegistry=void 0;Fc.buildEventData=TG;Fc.buildValidationErrorData=are;function TG(t,e,r,n){let i=t.builder(e,r,n);if(t.extension){let o=t.extension(i,e,r,n);if(t.protectedFields)for(let a of t.protectedFields)a in i&&(o[a]=i[a]);i=o}return i}function are(t,e,r){let n={actionId:t.action.id,error:e,messageId:e,params:r||{}};return t.command.directObject?.entity&&(n.params.target=t.command.directObject.entity.name,n.params.targetId=t.command.directObject.entity.id),t.command.indirectObject?.entity&&(n.params.indirectTarget=t.command.indirectObject.entity.name,n.params.indirectTargetId=t.command.indirectObject.entity.id),n}var fT=class{constructor(){d(this,"builders",new Map)}register(e,r){this.builders.set(e,r)}get(e){return this.builders.get(e)}has(e){return this.builders.has(e)}buildData(e,r,n,i){let o=this.get(e);if(o)return TG(o,r,n,i)}};Fc.ActionDataRegistry=fT;Fc.actionDataRegistry=new fT});var _G=p(pT=>{"use strict";Object.defineProperty(pT,"__esModule",{value:!0});pT.DroppingMessages=void 0;pT.DroppingMessages={NO_TARGET:"no_target",NOT_HELD:"not_held",STILL_WORN:"still_worn",CONTAINER_NOT_OPEN:"container_not_open",CONTAINER_FULL:"container_full",CANT_DROP_HERE:"cant_drop_here",CANT_DROP:"cant_drop",NOTHING_TO_DROP:"nothing_to_drop",DROPPED:"dropped",DROPPED_IN:"dropped_in",DROPPED_ON:"dropped_on",DROPPED_QUIETLY:"dropped_quietly",DROPPED_CARELESSLY:"dropped_carelessly",DROPPED_MULTI:"dropped_multi"}});var zo=p(mu=>{"use strict";Object.defineProperty(mu,"__esModule",{value:!0});mu.captureEntitySnapshot=gT;mu.captureRoomSnapshot=sre;mu.captureEntitySnapshots=cre;mu.createEntityReference=bG;mu.createEntityReferences=lre;function gT(t,e,r=!0){let n=t.get?.("identity"),i=t.get?.("physical"),o=t.get?.("openable"),a=t.get?.("lockable"),s=t.get?.("container"),c=t.get?.("supporter"),l=t.get?.("wearable"),u=t.get?.("edible"),m=t.get?.("pushable"),f=t.get?.("scenery"),g={id:t.id,name:n?.name||t.id,description:n?.description,shortDescription:n?.shortDescription,nameId:n?.nameId,descriptionId:n?.descriptionId,location:e.getLocation(t.id)};if(i&&(g.isPortable=i.portable!==!1),o!==void 0&&(g.isOpenable=!0,g.isOpen=o.isOpen===!0),a!==void 0&&(g.isLockable=!0,g.isLocked=a.isLocked===!0),s!==void 0&&(g.isContainer=!0),c!==void 0&&(g.isSupporter=!0),l!==void 0&&(g.isWearable=!0,g.isWorn=l.isWorn===!0),u!==void 0&&(g.isEdible=!0),m!==void 0&&(g.isPushable=!0),f!==void 0&&(g.isScenery=!0),r&&(s||c)){let _=e.getContents(t.id);_.length>0&&(g.contents=_.map(v=>gT(v,e,!1)))}let h=["identity","physical","openable","lockable","container","supporter","wearable","edible","pushable","scenery"],y={};for(let[_,v]of Object.entries(t))!h.includes(_)&&_!=="id"&&_!=="type"&&(y[_]=v);return Object.keys(y).length>0&&(g.traits=y),g}function sre(t,e,r=!0){let n=t.get?.("identity"),i=t.get?.("room"),o=t.get?.("darkness"),a={id:t.id,name:n?.name||t.attributes?.name||t.id,description:n?.description||t.attributes?.description,nameId:n?.nameId,descriptionId:n?.descriptionId};o!==void 0?a.isDark=o.isDark===!0:i?.isDark!==void 0&&(a.isDark=i.isDark===!0),i?.visited!==void 0&&(a.isVisited=i.visited===!0);let s={},c=["north","south","east","west","northeast","northwest","southeast","southwest","up","down","in","out"];for(let m of c){let f=t[m];f&&typeof f=="string"&&(s[m]=f)}if(Object.keys(s).length>0&&(a.exits=s),r){let m=e.getContents(t.id);m.length>0&&(a.contents=m.map(f=>gT(f,e,!0)))}let l=["identity","room","darkness"],u={};for(let[m,f]of Object.entries(t))!l.includes(m)&&!c.includes(m)&&m!=="id"&&m!=="type"&&(u[m]=f);return Object.keys(u).length>0&&(a.traits=u),a}function cre(t,e){return t.map(r=>gT(r,e,!0))}function bG(t){let e=t.get?.("identity");return{id:t.id,name:e?.name||t.id}}function lre(t){return t.map(bG)}});var OG=p(Gc=>{"use strict";Object.defineProperty(Gc,"__esModule",{value:!0});Gc.droppedDataConfig=Gc.buildDroppedData=void 0;Gc.determineDroppingMessage=dre;var ym=b(),zN=zo(),ure=(t,e,r)=>{let n=t.player,i=t.command.directObject?.entity;if(!i)return{item:"",itemName:"nothing",toLocation:"",toLocationName:"nowhere"};let o=t.world.getLocation(n.id),a=o?t.world.getEntity(o):t.currentLocation;if(!a)throw new Error("No valid drop location found");let s=(0,zN.captureEntitySnapshot)(i,t.world,!0),c=(0,zN.captureEntitySnapshot)(n,t.world,!1),l=(0,zN.captureEntitySnapshot)(a,t.world,a.has(ym.TraitType.ROOM)),u={item:i.id,itemName:i.name,toLocation:a.id,toLocationName:a.name,itemSnapshot:s,actorSnapshot:c,locationSnapshot:l};return a.has(ym.TraitType.ROOM)?u.toRoom=!0:a.has(ym.TraitType.CONTAINER)?u.toContainer=!0:a.has(ym.TraitType.SUPPORTER)&&(u.toSupporter=!0),u};Gc.buildDroppedData=ure;function dre(t,e){let r=e.command.directObject?.entity,n=e.world.getEntity(t.toLocation);if(!r||!n)return{messageId:"dropped",params:{item:t.itemName}};let i={item:r.name,location:n.name},o="dropped";if(t.toContainer)o="dropped_in",i.container=n.name;else if(t.toSupporter)o="dropped_on",i.supporter=n.name;else if(t.toRoom){if((e.command.parsed.structure.verb?.text.toLowerCase()||"drop")==="discard")o="dropped_carelessly";else if(r.has(ym.TraitType.IDENTITY)){let s=r.get(ym.TraitType.IDENTITY);s&&s.name?.toLowerCase().includes("glass")&&(o="dropped_quietly")}}return{messageId:o,params:i}}Gc.droppedDataConfig={builder:Gc.buildDroppedData,protectedFields:["item","itemName","toLocation","toLocationName"]}});var SG=p(hT=>{"use strict";Object.defineProperty(hT,"__esModule",{value:!0});hT.isDroppingSharedData=IG;hT.getDroppingSharedData=mre;function IG(t){return typeof t=="object"&&t!==null}function mre(t){return IG(t.sharedData)||(t.sharedData={}),t.sharedData}});var DG=p(yT=>{"use strict";Object.defineProperty(yT,"__esModule",{value:!0});yT.droppingAction=void 0;var Ai=b(),fre=hm(),pre=ce(),AG=Ce(),Ji=_G(),RG=OG(),$N=SG(),wG=xp();function CG(t){let e=t.player,r=t.world.getLocation(e.id);return r?t.world.getEntity(r):t.currentLocation}function NG(t,e){let r=t.player;if(!Ai.ActorBehavior.isHolding(r,e.id,t.world))return{valid:!1,error:Ji.DroppingMessages.NOT_HELD,params:{item:e.name}};if(e.has(Ai.TraitType.WEARABLE)&&Ai.WearableBehavior.isWorn(e))return{valid:!1,error:Ji.DroppingMessages.STILL_WORN,params:{item:e.name}};let n=CG(t);if(!n)return{valid:!1,error:Ji.DroppingMessages.CANT_DROP_HERE};if(n.has(Ai.TraitType.CONTAINER)&&!n.has(Ai.TraitType.ROOM)&&!Ai.ContainerBehavior.canAccept(n,e,t.world)){let i=n.get(Ai.TraitType.CONTAINER);return i.capacity?.maxItems!==void 0&&t.world.getContents(n.id).length>=i.capacity.maxItems?{valid:!1,error:Ji.DroppingMessages.CONTAINER_FULL,params:{item:e.name,container:n.name}}:{valid:!1,error:Ji.DroppingMessages.CANT_DROP_HERE}}return{valid:!0}}function gre(t){let e=(0,wG.expandMultiObject)(t,{scope:"carried"});if(e.length===0)return{valid:!1,error:Ji.DroppingMessages.NOTHING_TO_DROP};let r=e.map(o=>{let a=NG(t,o.entity);return{entity:o.entity,success:a.valid,error:a.valid?void 0:a.error,errorParams:a.valid?void 0:a.params}}),n=(0,$N.getDroppingSharedData)(t);return n.multiObjectResults=r,r.some(o=>o.success)?{valid:!0}:{valid:!1,error:r[0].error,params:r[0].errorParams}}function hre(t,e,r){let n=t.player,i=t.world.getLocation(n.id);r.dropLocation=i,Ai.ActorBehavior.dropItem(n,e,t.world),i&&t.world.moveEntity(e.id,i)}function yre(t,e,r,n,i=!1){let o=t.player,a=r.dropLocation?t.world.getEntity(r.dropLocation):CG(t),s=Ji.DroppingMessages.DROPPED,c={item:e.name,location:a?.name},l=!1,u=!1,m=!1;a&&(a.has(Ai.TraitType.ROOM)?m=!0:a.has(Ai.TraitType.CONTAINER)?l=!0:a.has(Ai.TraitType.SUPPORTER)&&(u=!0)),i?s=Ji.DroppingMessages.DROPPED_MULTI:l?(s=Ji.DroppingMessages.DROPPED_IN,c.container=a?.name):u&&(s=Ji.DroppingMessages.DROPPED_ON,c.supporter=a?.name),n.push(t.event("if.event.dropped",{messageId:`${t.action.id}.${s}`,params:c,item:e.name,itemId:e.id,actorId:o.id,toLocation:a?.id,toLocationName:a?.name,toContainer:l,toSupporter:u,toRoom:m}))}function vre(t,e,r,n,i){i.push(t.event("if.event.drop_blocked",{messageId:`${t.action.id}.${r}`,params:{...n,item:e.name},item:e.name,itemId:e.id,reason:r}))}yT.droppingAction={id:pre.IFActions.DROPPING,defaultScope:{item:AG.ScopeLevel.CARRIED},requiredMessages:["no_target","not_held","still_worn","container_not_open","container_full","dropped","dropped_in","dropped_on","cant_drop_here","dropped_quietly","dropped_carelessly","nothing_to_drop"],metadata:{requiresDirectObject:!0,requiresIndirectObject:!1,directObjectScope:AG.ScopeLevel.CARRIED},validate(t){if((0,wG.isMultiObjectCommand)(t))return gre(t);let e=t.command.directObject?.entity;return e?NG(t,e):{valid:!1,error:Ji.DroppingMessages.NO_TARGET}},execute(t){let e=(0,$N.getDroppingSharedData)(t);if(e.multiObjectResults){for(let a of e.multiObjectResults)a.success&&hre(t,a.entity,a);return}let r=t.player,n=t.command.directObject.entity,i=Ai.ActorBehavior.dropItem(r,n,t.world),o=t.world.getLocation(r.id);o&&t.world.moveEntity(n.id,o),e.dropResult=i},report(t){let e=(0,$N.getDroppingSharedData)(t);if(e.multiObjectResults){let s=[],c=e.multiObjectResults.length>1;for(let l of e.multiObjectResults)l.success?yre(t,l.entity,l,s,c):vre(t,l.entity,l.error,l.errorParams,s);return s}let r=(0,fre.buildEventData)(RG.droppedDataConfig,t),n=t.player,i=t.command.directObject.entity,{messageId:o,params:a}=(0,RG.determineDroppingMessage)(r,t);return[t.event("if.event.dropped",{messageId:`${t.action.id}.${o}`,params:a,...r,item:i.name,itemId:i.id,actorId:n.id})]},blocked(t,e){let r=t.command.directObject?.entity;return[t.event("if.event.drop_blocked",{messageId:`${t.action.id}.${e.error}`,params:{...e.params,item:r?.name},item:r?.name,itemId:r?.id,reason:e.error})]},group:"object_manipulation"}});var KN=p(vT=>{"use strict";Object.defineProperty(vT,"__esModule",{value:!0});vT.droppingAction=void 0;var Ere=DG();Object.defineProperty(vT,"droppingAction",{enumerable:!0,get:function(){return Ere.droppingAction}})});var PG=p(Vc=>{"use strict";Object.defineProperty(Vc,"__esModule",{value:!0});Vc.examiningDataConfig=Vc.buildExaminingData=void 0;Vc.buildExaminingMessageParams=_re;var hr=b(),Wp=b(),QN=zo(),Tre=(t,e,r)=>{let n=t.player,i=t.command.directObject?.entity;if(!i)return{targetId:"",targetName:"nothing"};let o=i.id===n.id,s={target:(0,QN.captureEntitySnapshot)(i,t.world,!0),targetId:i.id,targetName:o?"yourself":i.name};if(o)return s.self=!0,s;if(i.has(hr.TraitType.IDENTITY)){let c=i.get(hr.TraitType.IDENTITY);c&&(s.hasDescription=!!c.description,s.hasBrief=!!c.brief)}if(i.has(hr.TraitType.CONTAINER)){let c=t.world.getContents(i.id),l=(0,QN.captureEntitySnapshots)(c,t.world);s.isContainer=!0,s.hasContents=c.length>0,s.contentCount=c.length,s.contentsSnapshots=l,s.contents=c.map(u=>({id:u.id,name:u.name})),i.has(hr.TraitType.OPENABLE)?(s.isOpenable=!0,s.isOpen=Wp.OpenableBehavior.isOpen(i)):s.isOpen=!0}if(i.has(hr.TraitType.SUPPORTER)){let c=t.world.getContents(i.id),l=(0,QN.captureEntitySnapshots)(c,t.world);s.isSupporter=!0,s.hasContents=c.length>0,s.contentCount=c.length,s.contentsSnapshots=l,s.contents=c.map(u=>({id:u.id,name:u.name}))}if(i.has(hr.TraitType.SWITCHABLE)&&(s.isSwitchable=!0,s.isOn=Wp.SwitchableBehavior.isOn(i)),i.has(hr.TraitType.READABLE)){let c=i.get(hr.TraitType.READABLE);s.isReadable=!0,s.hasText=c?!!c.text:!1}return i.has(hr.TraitType.WEARABLE)&&(s.isWearable=!0,s.isWorn=Wp.WearableBehavior.isWorn(i)),i.has(hr.TraitType.DOOR)&&(s.isDoor=!0,i.has(hr.TraitType.OPENABLE)&&(s.isOpenable=!0,s.isOpen=Wp.OpenableBehavior.isOpen(i)),i.has(hr.TraitType.LOCKABLE)&&(s.isLockable=!0,s.isLocked=Wp.LockableBehavior.isLocked(i))),s};Vc.buildExaminingData=Tre;function _re(t,e){let r={},n=t.self?"examined_self":"examined",i;if(!t.self&&e){if(t.hasDescription&&e.has(hr.TraitType.IDENTITY)){let o=e.get(hr.TraitType.IDENTITY);o?.description&&(r.description=o.description)}if(t.isContainer){if(n="examined_container",r.isOpen=t.isOpen,t.isOpen&&t.hasContents&&t.contents){let a=t.contents.map(s=>s.name).join(", ");i={messageId:"container_contents",params:{container:e.name,items:a}}}}else if(t.isSupporter){if(n="examined_supporter",t.hasContents&&t.contents){let a=t.contents.map(s=>s.name).join(", ");i={messageId:"surface_contents",params:{surface:e.name,items:a}}}}else if(t.isSwitchable)n="examined_switchable",r.isOn=t.isOn;else if(t.isReadable&&t.hasText&&e.has(hr.TraitType.READABLE)){let o=e.get(hr.TraitType.READABLE);o?.text&&(r.text=o.text,n="examined_readable")}else t.isWearable?(n="examined_wearable",r.isWorn=t.isWorn):t.isDoor?(n="examined_door",t.isLocked!==void 0&&(r.isLocked=t.isLocked)):n==="examined"&&(r.target=e.name)}return{messageId:n,params:r,contentsMessage:i}}Vc.examiningDataConfig={builder:Vc.buildExaminingData,protectedFields:["targetId","targetName","target"]}});var LG=p(ET=>{"use strict";Object.defineProperty(ET,"__esModule",{value:!0});ET.ExaminingMessages=void 0;ET.ExaminingMessages={NO_TARGET:"no_target",NOT_VISIBLE:"not_visible",EXAMINED:"examined",EXAMINED_SELF:"examined_self",EXAMINED_CONTAINER:"examined_container",EXAMINED_SUPPORTER:"examined_supporter",EXAMINED_READABLE:"examined_readable",EXAMINED_SWITCHABLE:"examined_switchable",EXAMINED_WEARABLE:"examined_wearable",EXAMINED_DOOR:"examined_door",NOTHING_SPECIAL:"nothing_special",DESCRIPTION:"description",BRIEF_DESCRIPTION:"brief_description"}});var kG=p(TT=>{"use strict";Object.defineProperty(TT,"__esModule",{value:!0});TT.examiningAction=void 0;var bre=ce(),XN=Ce(),Ore=hm(),MG=PG(),Ire=LG();TT.examiningAction={id:bre.IFActions.EXAMINING,defaultScope:{target:XN.ScopeLevel.VISIBLE},requiredMessages:["no_target","not_visible","examined","examined_self","examined_container","examined_supporter","examined_readable","examined_switchable","examined_wearable","examined_door","nothing_special","description","brief_description"],validate(t){let e=t.player,r=t.command.directObject?.entity;if(!r)return{valid:!1,error:Ire.ExaminingMessages.NO_TARGET};if(r.id!==e.id){let n=t.requireScope(r,XN.ScopeLevel.VISIBLE);if(!n.ok)return n.error}return{valid:!0}},execute(t){},report(t){let e=t.command.directObject.entity,r=(0,Ore.buildEventData)(MG.examiningDataConfig,t),{messageId:n,params:i,contentsMessage:o}=(0,MG.buildExaminingMessageParams)(r,e),a=[t.event("if.event.examined",{messageId:`${t.action.id}.${n}`,params:i,...r})];return o&&a.push(t.event("if.event.examined",{messageId:`${t.action.id}.${o.messageId}`,params:o.params,isContentsMessage:!0})),a},blocked(t,e){let r=t.command.directObject?.entity;return[t.event("if.event.examined",{blocked:!0,messageId:`${t.action.id}.${e.error}`,params:{target:r?.name,...e.params},reason:e.error,targetId:r?.id,targetName:r?.name})]},group:"observation",metadata:{requiresDirectObject:!0,requiresIndirectObject:!1,directObjectScope:XN.ScopeLevel.VISIBLE}}});var ZN=p(_T=>{"use strict";Object.defineProperty(_T,"__esModule",{value:!0});_T.examiningAction=void 0;var Sre=kG();Object.defineProperty(_T,"examiningAction",{enumerable:!0,get:function(){return Sre.examiningAction}})});var xG=p(bT=>{"use strict";Object.defineProperty(bT,"__esModule",{value:!0});bT.OpeningMessages=void 0;bT.OpeningMessages={NO_TARGET:"no_target",NOT_OPENABLE:"not_openable",ALREADY_OPEN:"already_open",LOCKED:"locked",CANT_REACH:"cant_reach",CANNOT_OPEN:"cannot_open",OPENED:"opened",REVEALING:"revealing",ITS_EMPTY:"its_empty"}});var BG=p(OT=>{"use strict";Object.defineProperty(OT,"__esModule",{value:!0});OT.openingAction=void 0;var fu=b(),Are=ce(),JN=Ce(),vm=xG();OT.openingAction={id:Are.IFActions.OPENING,defaultScope:{target:JN.ScopeLevel.REACHABLE},targetRequirements:{trait:fu.TraitType.OPENABLE,condition:"not_open",description:"openable"},requiresHolding:!1,requiredMessages:["no_target","not_openable","already_open","locked","opened","revealing","its_empty","cant_reach"],metadata:{requiresDirectObject:!0,requiresIndirectObject:!1,directObjectScope:JN.ScopeLevel.REACHABLE},group:"container_manipulation",validate(t){let e=t.command.directObject?.entity;if(!e)return{valid:!1,error:vm.OpeningMessages.NO_TARGET};let r=t.requireScope(e,JN.ScopeLevel.REACHABLE);return r.ok?e.has(fu.TraitType.OPENABLE)?fu.OpenableBehavior.canOpen(e)?e.has(fu.TraitType.LOCKABLE)&&fu.LockableBehavior.isLocked(e)?{valid:!1,error:vm.OpeningMessages.LOCKED,params:{item:e.name}}:{valid:!0}:{valid:!1,error:vm.OpeningMessages.ALREADY_OPEN,params:{item:e.name}}:{valid:!1,error:vm.OpeningMessages.NOT_OPENABLE,params:{item:e.name}}:r.error},execute(t){let e=t.command.directObject.entity,r=fu.OpenableBehavior.open(e),n={openResult:r};t.sharedData.openResult=r},report(t){let e=t.command.directObject.entity,r=t.sharedData.openResult,n=[],i=e.has(fu.TraitType.CONTAINER),o=i?t.world.getContents(e.id):[],a=vm.OpeningMessages.OPENED,s={item:e.name};return i&&o.length===0&&(a=vm.OpeningMessages.ITS_EMPTY,s={container:e.name}),n.push(t.event("if.event.opened",{messageId:`${t.action.id}.${a}`,params:s,targetId:e.id,targetName:e.name,actorId:t.player.id})),n.push(t.event("opened",{targetId:e.id,targetName:e.name})),n},blocked(t,e){let r=t.command.directObject?.entity;return[t.event("if.event.open_blocked",{messageId:`${t.action.id}.${e.error}`,params:{...e.params,item:r?.name},targetId:r?.id,targetName:r?.name,reason:e.error})]}}});var eD=p(IT=>{"use strict";Object.defineProperty(IT,"__esModule",{value:!0});IT.openingAction=void 0;var Rre=BG();Object.defineProperty(IT,"openingAction",{enumerable:!0,get:function(){return Rre.openingAction}})});var WG=p(pu=>{"use strict";Object.defineProperty(pu,"__esModule",{value:!0});pu.closedDataConfig=pu.buildClosedData=void 0;var jG=zo(),wre=t=>{let e=t.command.directObject?.entity;if(!e)return{target:"nothing"};let r=(0,jG.captureEntitySnapshot)(e,t.world,!1),n=t.world.getContents(e.id),i=(0,jG.captureEntitySnapshots)(n,t.world);return{target:e.name,targetSnapshot:r,contentsSnapshots:i,targetId:e.id}};pu.buildClosedData=wre;pu.closedDataConfig={builder:pu.buildClosedData,protectedFields:["target","targetId"]}});var HG=p(ST=>{"use strict";Object.defineProperty(ST,"__esModule",{value:!0});ST.ClosingMessages=void 0;ST.ClosingMessages={NO_TARGET:"no_target",NOT_CLOSABLE:"not_closable",ALREADY_CLOSED:"already_closed",PREVENTS_CLOSING:"prevents_closing",CANT_CLOSE:"cant_close",CANNOT_CLOSE:"cannot_close",CLOSED:"closed"}});var rD=p(AT=>{"use strict";Object.defineProperty(AT,"__esModule",{value:!0});AT.closingAction=void 0;var Ka=b(),Cre=hm(),Nre=ce(),Dre=WG(),Em=HG(),tD=Ce();function UG(t){return t.sharedData}AT.closingAction={id:Nre.IFActions.CLOSING,defaultScope:{target:tD.ScopeLevel.REACHABLE},targetRequirements:{trait:Ka.TraitType.OPENABLE,condition:"is_open",description:"closable"},requiresHolding:!1,requiredMessages:["no_target","not_closable","already_closed","closed","cant_reach","prevents_closing"],metadata:{requiresDirectObject:!0,requiresIndirectObject:!1,directObjectScope:tD.ScopeLevel.REACHABLE},group:"container_manipulation",validate(t){let e=t.command.directObject?.entity;if(!e)return{valid:!1,error:Em.ClosingMessages.NO_TARGET};let r=t.requireScope(e,tD.ScopeLevel.REACHABLE);if(!r.ok)return r.error;if(!e.has(Ka.TraitType.OPENABLE))return{valid:!1,error:Em.ClosingMessages.NOT_CLOSABLE,params:{item:e.name}};if(!Ka.OpenableBehavior.canClose(e))return Ka.OpenableBehavior.isOpen(e)?{valid:!1,error:Em.ClosingMessages.PREVENTS_CLOSING,params:{item:e.name}}:{valid:!1,error:Em.ClosingMessages.ALREADY_CLOSED,params:{item:e.name}};let n=e.get(Ka.TraitType.OPENABLE);if(n.closeRequirements){let i=n.closeRequirements;if(i.preventedBy)return{valid:!1,error:Em.ClosingMessages.PREVENTS_CLOSING,params:{item:e.name,obstacle:i.preventedBy}}}return{valid:!0}},execute(t){let e=t.command.directObject.entity,r=Ka.OpenableBehavior.close(e),n=UG(t);n.closeResult=r},report(t){let e=t.command.directObject.entity,n=UG(t).closeResult,i=[];i.push(t.event("closed",{targetId:e.id,targetName:e.name,customMessage:n.closeMessage,sound:n.closeSound}));let o=(0,Cre.buildEventData)(Dre.closedDataConfig,t),a=e.has(Ka.TraitType.CONTAINER),s=e.has(Ka.TraitType.DOOR),c=e.has(Ka.TraitType.SUPPORTER),l=!1,u=0,m=[];if(a){let f=t.world.getContents(e.id);l=f.length>0,u=f.length,m=f.map(g=>g.id)}return i.push(t.event("if.event.closed",{messageId:`${t.action.id}.${Em.ClosingMessages.CLOSED}`,params:{item:e.name},...o,targetId:e.id,targetName:e.name,actorId:t.player.id,containerId:e.id,containerName:e.name,isContainer:a,isDoor:s,isSupporter:c,hasContents:l,contentsCount:u,contentsIds:m,item:e.name})),i},blocked(t,e){let r=t.command.directObject?.entity;return[t.event("if.event.close_blocked",{messageId:`${t.action.id}.${e.error}`,params:{...e.params,item:r?.name},targetId:r?.id,targetName:r?.name,reason:e.error})]}}});var qG=p(RT=>{"use strict";Object.defineProperty(RT,"__esModule",{value:!0});RT.GoingMessages=void 0;RT.GoingMessages={NO_DIRECTION:"no_direction",NOT_IN_ROOM:"not_in_room",NO_EXITS:"no_exits",NO_EXIT_THAT_WAY:"no_exit_that_way",MOVEMENT_BLOCKED:"movement_blocked",DOOR_CLOSED:"door_closed",DOOR_LOCKED:"door_locked",DESTINATION_NOT_FOUND:"destination_not_found",TOO_DARK:"too_dark",NEED_LIGHT:"need_light",WENT:"went",ARRIVED:"arrived",CANT_GO:"cant_go"}});var GG=p(Gt=>{"use strict";Object.defineProperty(Gt,"__esModule",{value:!0});Gt.actorEnteredDataConfig=Gt.actorExitedDataConfig=Gt.actorMovedDataConfig=Gt.buildActorEnteredData=Gt.buildActorExitedData=Gt.buildActorMovedData=void 0;Gt.determineGoingMessage=xre;var wT=b(),nD=zo(),Pre=iD();function FG(t,e,r){let i=r.getAllEntities().filter(o=>o.has(wT.TraitType.ROOM));for(let o of i){let a=wT.RoomBehavior.getExit(o,e);if(a&&a.destination===t.id)return o}return t}var Lre=(t,e,r)=>{let n=t.player,i=t.command.parsed.extras?.direction;if(!i&&t.command.directObject?.entity){let h=t.command.directObject.entity.name||t.command.directObject.entity.attributes?.name;h&&(i=h)}let o=(0,wT.getOppositeDirection)(i),a=t.world.getLocation(n.id),s=t.world.getEntity(a),c=FG(s,i,t.world),l=(0,nD.captureRoomSnapshot)(c,t.world,!1),u=(0,nD.captureRoomSnapshot)(s,t.world,!1),m=(0,nD.captureEntitySnapshot)(n,t.world,!0),g=(0,Pre.getGoingSharedData)(t).isFirstVisit===!0;return{actor:m,sourceRoom:l,destinationRoom:u,direction:i,fromRoom:c.id,toRoom:s.id,oppositeDirection:o,firstVisit:g}};Gt.buildActorMovedData=Lre;var Mre=(t,e,r)=>{let n=t.player,i=t.command.parsed.extras?.direction;if(!i&&t.command.directObject?.entity){let s=t.command.directObject.entity.name||t.command.directObject.entity.attributes?.name;s&&(i=s)}let o=t.world.getLocation(n.id),a=t.world.getEntity(o);return{actorId:n.id,direction:i,toRoom:a.id}};Gt.buildActorExitedData=Mre;var kre=(t,e,r)=>{let n=t.player,i=t.command.parsed.extras?.direction;if(!i&&t.command.directObject?.entity){let l=t.command.directObject.entity.name||t.command.directObject.entity.attributes?.name;l&&(i=l)}let o=(0,wT.getOppositeDirection)(i),a=t.world.getLocation(n.id),s=t.world.getEntity(a),c=FG(s,i,t.world);return{actorId:n.id,direction:o,fromRoom:c.id}};Gt.buildActorEnteredData=kre;function xre(t){let e=t.firstVisit?"first_visit":"moved_to",r=t.destinationRoom,n=r?.name||r?.attributes?.name||r?.id||"unknown";return{messageId:e,params:{direction:t.direction,destination:n}}}Gt.actorMovedDataConfig={builder:Gt.buildActorMovedData,protectedFields:["direction","fromRoom","toRoom"]};Gt.actorExitedDataConfig={builder:Gt.buildActorExitedData,protectedFields:["actorId","direction"]};Gt.actorEnteredDataConfig={builder:Gt.buildActorEnteredData,protectedFields:["actorId","direction"]}});var iD=p(Hp=>{"use strict";Object.defineProperty(Hp,"__esModule",{value:!0});Hp.goingAction=void 0;Hp.getGoingSharedData=CT;var yn=b(),Bre=ce(),jre=Ce(),VG=zo(),oD=hm(),Qa=qG(),aD=GG();function CT(t){return t.sharedData}Hp.goingAction={id:Bre.IFActions.GOING,requiredMessages:["no_direction","not_in_room","no_exits","no_exit_that_way","movement_blocked","door_closed","door_locked","destination_not_found","moved","moved_to","first_visit","too_dark","need_light"],validate(t){let e=t.player,r=t.command.parsed.extras?.direction;if(!r&&t.command.directObject?.entity){let c=t.command.directObject.entity.name||t.command.directObject.entity.attributes?.name;c&&(r=c)}if(!r)return{valid:!1,error:Qa.GoingMessages.NO_DIRECTION};let n=(0,yn.canActorWalkInVehicle)(t.world,e.id),i=t.currentLocation;if(n.vehicle){if(!n.canWalk)return{valid:!1,error:Qa.GoingMessages.NOT_IN_ROOM,params:{vehicle:n.vehicle?.name}};let c=t.world.getContainingRoom(e.id);if(c){i=c;let l=CT(t);l.vehicleId=t.world.getLocation(e.id)}}if(!i.has(yn.TraitType.ROOM))return{valid:!1,error:Qa.GoingMessages.NOT_IN_ROOM};let o=yn.RoomBehavior.getExit(i,r);if(!o)return yn.RoomBehavior.getAllExits(i).size===0?{valid:!1,error:Qa.GoingMessages.NO_EXITS}:{valid:!1,error:Qa.GoingMessages.NO_EXIT_THAT_WAY,params:{direction:r}};if(yn.RoomBehavior.isExitBlocked(i,r)){let c=yn.RoomBehavior.getBlockedMessage(i,r)||"You can't go that way.";return{valid:!1,error:Qa.GoingMessages.MOVEMENT_BLOCKED,params:{direction:r,message:c}}}if(o.via){let c=t.world.getEntity(o.via);if(c){let l=c.has(yn.TraitType.LOCKABLE)&&yn.LockableBehavior.isLocked(c),u=c.has(yn.TraitType.OPENABLE)&&!yn.OpenableBehavior.isOpen(c);if(l)return{valid:!1,error:Qa.GoingMessages.DOOR_LOCKED,params:{door:c.name,direction:r,isClosed:u,isLocked:!0}};if(u)return{valid:!1,error:Qa.GoingMessages.DOOR_CLOSED,params:{door:c.name,direction:r}}}}let a=o.destination;return t.world.getEntity(a)?{valid:!0}:{valid:!1,error:Qa.GoingMessages.DESTINATION_NOT_FOUND,params:{direction:r}}},execute(t){let e=t.player,r=CT(t),n=t.currentLocation;if(r.vehicleId){let c=t.world.getContainingRoom(e.id);c&&(n=c)}let i=t.command.parsed.extras?.direction;if(!i&&t.command.directObject?.entity){let c=t.command.directObject.entity.name||t.command.directObject.entity.attributes?.name;c&&(i=c)}let o=yn.RoomBehavior.getExit(n,i),a=t.world.getEntity(o.destination),s=!yn.RoomBehavior.hasBeenVisited(a);r.isFirstVisit=s,r.previousLocation=n.id,r.currentLocation=a.id,r.direction=i,r.vehicleId?t.world.moveEntity(r.vehicleId,a.id):t.world.moveEntity(e.id,a.id),s&&yn.RoomBehavior.markVisited(a,e)},report(t){let e=CT(t),r=t.world.getEntity(e.currentLocation),n=(0,oD.buildEventData)(aD.actorExitedDataConfig,t),i=(0,oD.buildEventData)(aD.actorMovedDataConfig,t),o=(0,oD.buildEventData)(aD.actorEnteredDataConfig,t),a=[t.event("if.event.actor_exited",n),t.event("if.event.actor_moved",i),t.event("if.event.actor_entered",o)];if(yn.VisibilityBehavior.isDark(r,t.world))return a.push(t.event("if.event.went",{messageId:`${t.action.id}.too_dark`,params:{},actorId:t.player.id,destinationId:r.id,isDark:!0})),a;let c=(0,VG.captureRoomSnapshot)(r,t.world,!1),l=t.world.getContents(r.id).filter(f=>f.id!==t.player.id),u=(0,VG.captureEntitySnapshots)(l,t.world),m={room:c,visibleItems:u,roomId:r.id,roomName:r.name,roomDescription:r.description,includeContents:!0,verbose:!0,previousLocation:e.previousLocation,currentLocation:e.currentLocation,isDark:!1,contents:l.map(f=>({id:f.id,name:f.name,description:f.description}))};if(a.push(t.event("if.event.room.description",m)),l.length>0){let f=l.map(g=>g.name).join(", ");a.push(t.event("if.event.list.contents",{messageId:"if.action.looking.contents_list",params:{items:f,count:l.length},locationId:r.id,itemIds:l.map(g=>g.id),itemNames:l.map(g=>g.name)}))}return a},blocked(t,e){return[t.event("if.event.went",{blocked:!0,reason:e.error,messageId:`${t.action.id}.${e.error}`,params:e.params||{},actorId:t.player.id})]},group:"movement",metadata:{requiresDirectObject:!1,requiresIndirectObject:!1,directObjectScope:jre.ScopeLevel.VISIBLE}}});var sD=p(NT=>{"use strict";Object.defineProperty(NT,"__esModule",{value:!0});NT.goingAction=void 0;var Wre=iD();Object.defineProperty(NT,"goingAction",{enumerable:!0,get:function(){return Wre.goingAction}})});var YG=p(Vt=>{"use strict";Object.defineProperty(Vt,"__esModule",{value:!0});Vt.listContentsDataConfig=Vt.roomDescriptionDataConfig=Vt.lookingEventDataConfig=Vt.buildListContentsData=Vt.buildRoomDescriptionData=Vt.buildLookingEventData=void 0;Vt.determineLookingMessage=Gre;var yr=b(),Tm=zo();function Hre(t){let e=t.world.getContainingRoom(t.player.id);return e?yr.VisibilityBehavior.isDark(e,t.world):!1}var Ure=(t,e,r)=>{let n=t.player,{location:i,immediateContainer:o}=yr.VisibilityBehavior.getDescribableLocation(n,t.world),a=t.getVisible().filter(m=>m.id!==i.id&&m.id!==n.id),s=Hre(t),c=(0,Tm.captureRoomSnapshot)(i,t.world,!1),l=(0,Tm.captureEntitySnapshots)(a,t.world),u=i.get?.("identity");return{actorId:n.id,room:c,visibleItems:l,locationId:i.id,locationName:i.name,locationDescription:i.description,locationNameId:u?.nameId,locationDescriptionId:u?.descriptionId,isDark:s,inVehicle:o?.name||null,contents:a.map(m=>({id:m.id,name:m.name,description:m.description})),timestamp:Date.now()}};Vt.buildLookingEventData=Ure;var qre=(t,e,r)=>{let{location:n,immediateContainer:i}=yr.VisibilityBehavior.getDescribableLocation(t.player,t.world),o=t.getVisible().filter(f=>f.id!==n.id&&f.id!==t.player.id),a=(0,Tm.captureRoomSnapshot)(n,t.world,!1),s=(0,Tm.captureEntitySnapshots)(o,t.world),c=t.verboseMode??!0,l=!t.visitedLocations?.includes(n.id),u=c||l,m=n.get?.("identity");return{room:a,visibleItems:s,roomId:n.id,roomName:n.name,roomDescription:n.description,roomNameId:m?.nameId,roomDescriptionId:m?.descriptionId,includeContents:!0,verbose:u,inVehicle:i?.name||null,contents:o.map(f=>({id:f.id,name:f.name,description:f.description})),timestamp:Date.now()}};Vt.buildRoomDescriptionData=qre;var Fre=(t,e,r)=>{let{location:n}=yr.VisibilityBehavior.getDescribableLocation(t.player,t.world),i=t.getVisible().filter(g=>g.id!==n.id&&g.id!==t.player.id);if(i.length===0)return{};let o=(0,Tm.captureRoomSnapshot)(n,t.world,!1),a=(0,Tm.captureEntitySnapshots)(i,t.world),s=i.filter(g=>t.world.getLocation(g.id)===n.id),c=s.filter(g=>g.hasTrait(yr.TraitType.ACTOR)),l=s.filter(g=>g.hasTrait(yr.TraitType.CONTAINER)&&!g.hasTrait(yr.TraitType.ACTOR)),u=s.filter(g=>g.hasTrait(yr.TraitType.SUPPORTER)&&!g.hasTrait(yr.TraitType.CONTAINER)),m=s.filter(g=>!g.hasTrait(yr.TraitType.ACTOR)&&!g.hasTrait(yr.TraitType.CONTAINER)&&!g.hasTrait(yr.TraitType.SUPPORTER)),f=[];for(let g of l){if(g.hasTrait(yr.TraitType.OPENABLE)){let{OpenableBehavior:y}=b();if(!y.isOpen(g))continue}let h=t.world.getContents(g.id);h.length>0&&f.push({containerId:g.id,containerName:g.name,preposition:"in",itemIds:h.map(y=>y.id),itemNames:h.map(y=>y.name)})}for(let g of u){let h=t.world.getContents(g.id);h.length>0&&f.push({containerId:g.id,containerName:g.name,preposition:"on",itemIds:h.map(y=>y.id),itemNames:h.map(y=>y.name)})}return{allItems:a,location:o,items:i.map(g=>g.id),directItems:s.map(g=>g.id),directItemNames:s.map(g=>g.name),npcs:c.map(g=>g.id),containers:l.map(g=>g.id),supporters:u.map(g=>g.id),other:m.map(g=>g.id),openContainerContents:f,context:"room",locationName:n.name,timestamp:Date.now()}};Vt.buildListContentsData=Fre;function Gre(t,e){let{location:r,immediateContainer:n}=yr.VisibilityBehavior.getDescribableLocation(t.player,t.world),i={};if(e)return{messageId:"room_dark",params:{location:r.name}};if(i.name=r.name,i.description=r.description,i.location=r.name,n&&(i.inVehicle=n.name),!n&&r.hasTrait(yr.TraitType.CONTAINER))return{messageId:"in_container",params:{container:r.name,location:r.name}};if(!n&&r.hasTrait(yr.TraitType.SUPPORTER))return{messageId:"on_supporter",params:{supporter:r.name,location:r.name}};let o=t.verboseMode??!0,a=!t.visitedLocations?.includes(r.id),s=!o&&!a?"room_description_brief":"room_description",c=t.getVisible().filter(g=>g.id!==r.id&&g.id!==t.player.id),l=t.command.parsed.structure.verb?.text.toLowerCase()||"look",u=t.command.directObject!==void 0&&t.command.directObject!==null||t.command.parsed.structure.directObject!==void 0&&t.command.parsed.structure.directObject!==null;if(l==="examine"&&!u)return{messageId:"examine_surroundings",params:i};let f=c.filter(g=>t.world.getLocation(g.id)===r.id);if(f.length>0){let g=f.map(h=>h.name).join(", ");return{messageId:s,params:{items:g,count:f.length,hasItems:!0,...i}}}return{messageId:s,params:i}}Vt.lookingEventDataConfig={builder:Vt.buildLookingEventData,protectedFields:["actorId","locationId","timestamp"]};Vt.roomDescriptionDataConfig={builder:Vt.buildRoomDescriptionData,protectedFields:["roomId","timestamp"]};Vt.listContentsDataConfig={builder:Vt.buildListContentsData,protectedFields:["locationName","timestamp"]}});var $G=p(PT=>{"use strict";Object.defineProperty(PT,"__esModule",{value:!0});PT.lookingAction=void 0;var zG=b(),Vre=ce(),cD=hm(),DT=YG();PT.lookingAction={id:Vre.IFActions.LOOKING,requiredMessages:["room_description","room_description_brief","room_dark","contents_list","nothing_special","in_container","on_supporter","cant_see_in_dark","look_around","examine_surroundings"],validate(t){return{valid:!0}},execute(t){let e=t.currentLocation,r=t.world.getContainingRoom(t.player.id);if(r&&r.hasTrait(zG.TraitType.ROOM)){let n=r.getTrait(zG.TraitType.ROOM);n&&!n.visited&&(n.visited=!0)}},report(t){let e=[],r=(0,cD.buildEventData)(DT.lookingEventDataConfig,t),n=r.isDark,{messageId:i,params:o}=(0,DT.determineLookingMessage)(t,n);if(n)return e.push(t.event("if.event.looked",{messageId:`${t.action.id}.${i}`,params:o,...r})),e;e.push(t.event("if.event.looked",r));let a=(0,cD.buildEventData)(DT.roomDescriptionDataConfig,t);e.push(t.event("if.event.room.description",a));let s=(0,cD.buildEventData)(DT.listContentsDataConfig,t);o.hasItems&&e.push(t.event("if.event.list.contents",{messageId:`${t.action.id}.contents_list`,params:o,...s}));let c=s.openContainerContents;if(c&&c.length>0)for(let l of c){let u=l.preposition==="in"?"container_contents":"surface_contents",m=l.preposition==="in"?"container":"surface";e.push(t.event("if.event.list.contents",{messageId:`${t.action.id}.${u}`,params:{[m]:l.containerName,items:l.itemNames.join(", ")},containerId:l.containerId,containerName:l.containerName,preposition:l.preposition,itemIds:l.itemIds,itemNames:l.itemNames}))}return e},blocked(t,e){return[t.event("if.event.looked",{blocked:!0,reason:e.error,messageId:`${t.action.id}.${e.error}`,params:e.params,actorId:t.player.id})]},group:"observation",metadata:{requiresDirectObject:!1,requiresIndirectObject:!1}}});var QG=p(KG=>{"use strict";Object.defineProperty(KG,"__esModule",{value:!0})});var lD=p(Xa=>{"use strict";var Yre=Xa&&Xa.__createBinding||(Object.create?(function(t,e,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}):(function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]})),zre=Xa&&Xa.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&Yre(e,t,r)};Object.defineProperty(Xa,"__esModule",{value:!0});Xa.lookingAction=void 0;var $re=$G();Object.defineProperty(Xa,"lookingAction",{enumerable:!0,get:function(){return $re.lookingAction}});zre(QG(),Xa)});var XG=p(LT=>{"use strict";Object.defineProperty(LT,"__esModule",{value:!0});LT.InventoryMessages=void 0;LT.InventoryMessages={INVENTORY_EMPTY:"inventory_empty",CARRYING:"carrying",WEARING:"wearing",CARRYING_AND_WEARING:"carrying_and_wearing",HOLDING_LIST:"holding_list",WORN_LIST:"worn_list",CHECKING_POCKETS:"checking_pockets",RIFLING_THROUGH_BAG:"rifling_through_bag",INVENTORY_HEADER:"inventory_header",NOTHING_AT_ALL:"nothing_at_all",HANDS_EMPTY:"hands_empty",POCKETS_EMPTY:"pockets_empty",CARRYING_COUNT:"carrying_count",WEARING_COUNT:"wearing_count",BURDEN_LIGHT:"burden_light",BURDEN_HEAVY:"burden_heavy",BURDEN_OVERLOADED:"burden_overloaded"}});var eV=p(MT=>{"use strict";Object.defineProperty(MT,"__esModule",{value:!0});MT.inventoryAction=void 0;var gu=b(),Kre=ce(),ZG=XG();function JG(t){return t.sharedData}function Qre(t){let e=t.player,r=t.currentLocation,n=t.world.getContents(e.id),i=n.filter(_=>_.has(gu.TraitType.WEARABLE)?_.get(gu.TraitType.WEARABLE).worn:!1),o=n.filter(_=>_.has(gu.TraitType.WEARABLE)?!_.get(gu.TraitType.WEARABLE).worn:!0),a=0,s=!1,c=0;if(e.has(gu.TraitType.ACTOR)){let _=e.get(gu.TraitType.ACTOR);_&&_.inventoryLimit?.maxWeight!==void 0&&(s=!0,c=_.inventoryLimit.maxWeight,n.forEach(v=>{let E=v.get(gu.TraitType.IDENTITY);E&&E.weight&&(a+=E.weight)}))}let l={actorId:e.id,locationId:r.id,totalItems:n.length,heldItems:o.length,wornItems:i.length,isEmpty:n.length===0,carried:o.map(_=>({id:_.id,name:_.name})),worn:i.map(_=>({id:_.id,name:_.name})),items:[...o.map(_=>({id:_.id,name:_.name,worn:!1})),...i.map(_=>({id:_.id,name:_.name,worn:!0}))]};if(s&&(l.totalWeight=a,l.maxWeight=c,l.weightLimit=c,l.weightPercentage=Math.round(a/c*100),n.length>0)){let _=a/c*100;_>=90?l.burden="overloaded":_>=75?l.burden="heavy":l.burden="light"}let u=t.command.parsed.structure.verb?.text.toLowerCase()||"inventory";(u==="i"||u==="inv")&&(l.brief=!0);let m={},f="carrying";if(n.length===0){f="inventory_empty";let _=["inventory_empty","nothing_at_all","hands_empty","pockets_empty"];f=_[Math.floor(Math.random()*_.length)]}else o.length>0&&i.length>0?(f="carrying_and_wearing",m.holdingCount=o.length,m.wearingCount=i.length):i.length>0&&o.length===0?(f="wearing",m.wearingCount=i.length):m.holdingCount=o.length;let g=o.length>0?o.map(_=>_.name).join(", "):void 0,h=i.length>0?i.map(_=>_.name).join(", "):void 0,y=l.burden&&n.length>0?`burden_${l.burden}`:void 0;return{holding:o,worn:i,carried:n,eventData:l,messageId:f,params:m,holdingList:g,wornList:h,burdenMessage:y,totalWeight:a,weightLimit:c}}MT.inventoryAction={id:Kre.IFActions.INVENTORY,requiredMessages:["inventory_empty","carrying","wearing","carrying_and_wearing","holding_list","worn_list","checking_pockets","rifling_through_bag","inventory_header","nothing_at_all","hands_empty","pockets_empty","carrying_count","wearing_count","burden_light","burden_heavy","burden_overloaded"],validate(t){return{valid:!0}},execute(t){let e=Qre(t),r=JG(t);r.analysis=e},report(t){let e=[],n=JG(t).analysis;return n&&(e.push(t.event("if.event.inventory",{messageId:`${t.action.id}.${n.messageId}`,params:{...n.params,holdingList:n.holdingList,wornList:n.wornList},...n.eventData})),n.holdingList&&e.push(t.event("if.event.inventory",{messageId:`${t.action.id}.${ZG.InventoryMessages.HOLDING_LIST}`,params:{items:n.holdingList},isHoldingList:!0})),n.wornList&&e.push(t.event("if.event.inventory",{messageId:`${t.action.id}.${ZG.InventoryMessages.WORN_LIST}`,params:{items:n.wornList},isWornList:!0})),n.burdenMessage&&e.push(t.event("if.event.inventory",{messageId:`${t.action.id}.${n.burdenMessage}`,params:{weight:n.totalWeight,limit:n.weightLimit},isBurdenMessage:!0}))),e},blocked(t,e){return[t.event("if.event.inventory",{blocked:!0,messageId:`${t.action.id}.${e.error}`,params:e.params||{},reason:e.error})]},group:"meta",metadata:{requiresDirectObject:!1,requiresIndirectObject:!1}}});var rV=p(tV=>{"use strict";Object.defineProperty(tV,"__esModule",{value:!0})});var uD=p(Za=>{"use strict";var Xre=Za&&Za.__createBinding||(Object.create?(function(t,e,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}):(function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]})),Zre=Za&&Za.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&Xre(e,t,r)};Object.defineProperty(Za,"__esModule",{value:!0});Za.inventoryAction=void 0;var Jre=eV();Object.defineProperty(Za,"inventoryAction",{enumerable:!0,get:function(){return Jre.inventoryAction}});Zre(rV(),Za)});var iV=p(kT=>{"use strict";Object.defineProperty(kT,"__esModule",{value:!0});kT.waitingAction=void 0;var ene=ce();function nV(t){return t.sharedData}kT.waitingAction={id:ene.IFActions.WAITING,requiredMessages:["time_passes"],group:"meta",metadata:{requiresDirectObject:!1,requiresIndirectObject:!1},validate(t){return{valid:!0}},execute(t){let e=t.currentLocation,r=nV(t);r.locationId=e?.id,r.locationName=e?.name},blocked(t,e){return[t.event("if.event.wait_blocked",{blocked:!0,messageId:`${t.action.id}.${e.error}`,params:e.params,reason:e.error})]},report(t){let e=[],r=nV(t);return e.push(t.event("if.event.waited",{messageId:`${t.action.id}.time_passes`,turnsPassed:1,location:r.locationId,locationName:r.locationName})),e}}});var dD=p(xT=>{"use strict";Object.defineProperty(xT,"__esModule",{value:!0});xT.waitingAction=void 0;var tne=iV();Object.defineProperty(xT,"waitingAction",{enumerable:!0,get:function(){return tne.waitingAction}})});var sV=p(BT=>{"use strict";Object.defineProperty(BT,"__esModule",{value:!0});BT.sleepingAction=void 0;var rne=ce();function oV(t){return t.sharedData}function aV(t){let e=t.player,r={turnsPassed:1},n={},i="slept",o=!0,a=t.world.getLocation?.(e.id);if(a){let c=t.world.getEntity(a);c&&(r.location=c.id,r.locationName=c.name)}return{canSleep:o,messageId:i,eventData:r,params:n,wakeRefreshed:!1}}BT.sleepingAction={id:rne.IFActions.SLEEPING,requiredMessages:["slept","dozed_off","fell_asleep","brief_nap","deep_sleep","slept_fitfully","cant_sleep_here","too_dangerous_to_sleep","already_well_rested","woke_refreshed","disturbed_sleep","nightmares","peaceful_sleep"],validate(t){let e=aV(t);return e.canSleep?{valid:!0}:{valid:!1,error:e.messageId,params:e.params}},execute(t){let e=aV(t),r=oV(t);r.messageId=e.messageId,r.eventData=e.eventData,r.params=e.params,r.wakeRefreshed=e.wakeRefreshed},blocked(t,e){return[t.event("if.event.sleep_blocked",{blocked:!0,messageId:`${t.action.id}.${e.error}`,params:e.params,reason:e.error})]},report(t){let e=[],r=oV(t);return e.push(t.event("if.event.slept",{messageId:`${t.action.id}.${r.messageId||"slept"}`,params:r.params,...r.eventData})),r.wakeRefreshed&&e.push(t.event("if.event.slept",{messageId:`${t.action.id}.woke_refreshed`,wakeRefreshed:!0})),e},group:"meta",metadata:{requiresDirectObject:!1,requiresIndirectObject:!1}}});var mD=p(jT=>{"use strict";Object.defineProperty(jT,"__esModule",{value:!0});jT.sleepingAction=void 0;var nne=sV();Object.defineProperty(jT,"sleepingAction",{enumerable:!0,get:function(){return nne.sleepingAction}})});var lV=p(WT=>{"use strict";Object.defineProperty(WT,"__esModule",{value:!0});WT.scoringAction=void 0;var ine=b(),one=ce();function cV(t){return t.sharedData}function ane(t,e){if(e===0)return"Beginner";let r=t/e*100;return r>=90?"Master":r>=75?"Expert":r>=50?"Proficient":r>=25?"Amateur":"Novice"}WT.scoringAction={id:one.IFActions.SCORING,requiredMessages:["no_scoring","score_display","score_simple","score_with_rank","perfect_score","with_achievements","early_game","mid_game","late_game","game_complete"],validate(t){return{valid:!0}},execute(t){let e=cV(t),r=t.world.getCapability(ine.StandardCapabilities.SCORING);if(!r||r.enabled===!1){e.enabled=!1;return}e.enabled=!0;let n=r.scoreValue||0,i=r.maxScore||0,o=r.moves||0,a=r.achievements||[],s=r.rank||ane(n,i),c={score:n,maxScore:i,moves:o},l={score:n,maxScore:i,moves:o,rank:s},u="score_simple";if(i>0){let f=Math.round(n/i*100);c.percentage=f,l.percentage=f,c.rank=s,n===i?u="perfect_score":u="score_with_rank"}else o>0&&(u="score_display");a.length>0&&(c.achievements=a,l.achievements=a.join(", "));let m;if(i>0){let f=n/i*100;f===100?m="game_complete":f>=75?m="late_game":f>=25?m="mid_game":m="early_game",c.progress=m}e.eventData=c,e.params=l,e.messageId=u,e.achievements=a,e.progressMessage=m},blocked(t,e){return[t.event("if.event.score_displayed",{messageId:`if.action.scoring.${e.error}`,params:e.params||{},blocked:!0,reason:e.error})]},report(t){let e=cV(t);if(!e.enabled)return[t.event("if.event.score_displayed",{messageId:"if.action.scoring.no_scoring",params:{},enabled:!1})];if(!e.eventData)return[];let r=`if.action.scoring.${e.messageId||"score_simple"}`;return[t.event("if.event.score_displayed",{messageId:r,params:e.params||{},...e.eventData,hasAchievements:e.achievements&&e.achievements.length>0,achievements:e.achievements,progressMessage:e.progressMessage})]},group:"meta",metadata:{requiresDirectObject:!1,requiresIndirectObject:!1}}});var fD=p(HT=>{"use strict";Object.defineProperty(HT,"__esModule",{value:!0});HT.scoringAction=void 0;var sne=lV();Object.defineProperty(HT,"scoringAction",{enumerable:!0,get:function(){return sne.scoringAction}})});var dV=p(UT=>{"use strict";Object.defineProperty(UT,"__esModule",{value:!0});UT.helpAction=void 0;var cne=ce();function uV(t){return t.sharedData}function lne(t){let e={},r=t.command.parsed.extras?.topic||t.command.indirectObject?.parsed.text||t.command.directObject?.parsed.text||null;if(r)e.specificHelp=!0,e.helpRequest=r;else{e.generalHelp=!0,e.helpType="general";let n=t.world.getSharedData?.()||{};n.helpRequested||(e.firstTime=!0);let o=n.helpSections||["basic_commands","movement","objects","special_commands"];e.sections=o;let a=n.hintsEnabled??!0;e.hintsAvailable=a}return{topic:r,eventData:e}}UT.helpAction={id:cne.IFActions.HELP,group:"meta",metadata:{requiresDirectObject:!1,requiresIndirectObject:!1},requiredMessages:["general_help","help_topic","unknown_topic","help_movement","help_objects","help_special","first_time_help","hints_available","hints_disabled","stuck_help","help_footer"],validate(t){return{valid:!0}},execute(t){let e=lne(t),r=uV(t);r.eventData=e.eventData},blocked(t,e){return[t.event("if.event.help_displayed",{messageId:`if.action.help.${e.error}`,params:e.params||{},blocked:!0,reason:e.error})]},report(t){let e=uV(t);if(e.eventData){let r="if.action.help.general";return e.eventData.specificHelp?r="if.action.help.topic":e.eventData.firstTime&&(r="if.action.help.first_time"),[t.event("if.event.help_displayed",{messageId:r,params:{topic:e.eventData.helpRequest,sections:e.eventData.sections,hintsAvailable:e.eventData.hintsAvailable},...e.eventData})]}return[]}}});var pD=p(qT=>{"use strict";Object.defineProperty(qT,"__esModule",{value:!0});qT.helpAction=void 0;var une=dV();Object.defineProperty(qT,"helpAction",{enumerable:!0,get:function(){return une.helpAction}})});var mV=p(FT=>{"use strict";Object.defineProperty(FT,"__esModule",{value:!0});FT.aboutAction=void 0;var dne=ce();FT.aboutAction={id:dne.IFActions.ABOUT,validate(t){return{valid:!0}},execute(t){},blocked(t,e){return[t.event("if.event.about_displayed",{messageId:`if.action.about.${e.error}`,params:e.params||{},blocked:!0,reason:e.error})]},report(t){let r=t.world.storyConfig||{},n={messageId:"if.action.about.success",params:{title:r.title||"Unknown",author:Array.isArray(r.author)?r.author.join(", "):r.author||"Unknown",version:r.version||"0.0.0",description:r.description||""}};return[t.event("if.event.about_displayed",n)]},group:"meta",metadata:{requiresDirectObject:!1,requiresIndirectObject:!1}}});var gD=p(GT=>{"use strict";Object.defineProperty(GT,"__esModule",{value:!0});GT.aboutAction=void 0;var mne=mV();Object.defineProperty(GT,"aboutAction",{enumerable:!0,get:function(){return mne.aboutAction}})});var fV=p(hu=>{"use strict";Object.defineProperty(hu,"__esModule",{value:!0});hu.versionAction=hu.ENGINE_VERSION=void 0;var fne=ce();hu.ENGINE_VERSION="0.9.43-beta.1";hu.versionAction={id:fne.IFActions.VERSION,validate(t){return{valid:!0}},execute(t){},blocked(t,e){return[t.event("if.event.version_displayed",{messageId:`if.action.version.${e.error}`,params:e.params||{},blocked:!0,reason:e.error})]},report(t){let e=t.world,r=e.storyConfig||{},n=e.versionInfo||{},i=r.title||"Unknown",o=n.version||r.version||"0.0.0",a=n.engineVersion||hu.ENGINE_VERSION,s=n.clientVersion||e.clientVersion||"N/A",c=n.buildDate,l=r.author||"Unknown",m={messageId:c?"if.action.version.version_full":"if.action.version.version_no_date",params:{storyTitle:i,storyVersion:o,engineVersion:a,clientVersion:s,buildDate:c,title:i,version:o,author:Array.isArray(l)?l.join(", "):l},storyTitle:i,storyVersion:o,engineVersion:a,clientVersion:s,buildDate:c};return[t.event("if.event.version_displayed",m)]},group:"meta",metadata:{requiresDirectObject:!1,requiresIndirectObject:!1}}});var hD=p(_m=>{"use strict";Object.defineProperty(_m,"__esModule",{value:!0});_m.ENGINE_VERSION=_m.versionAction=void 0;var pV=fV();Object.defineProperty(_m,"versionAction",{enumerable:!0,get:function(){return pV.versionAction}});Object.defineProperty(_m,"ENGINE_VERSION",{enumerable:!0,get:function(){return pV.ENGINE_VERSION}})});var gV=p(VT=>{"use strict";Object.defineProperty(VT,"__esModule",{value:!0});VT.StandardWitnessSystem=void 0;var pne=b(),gne=Je(),kr=Ce(),yD=class{constructor(e,r){d(this,"world");d(this,"scopeResolver");d(this,"knowledge",new Map);this.world=e,this.scopeResolver=r}recordWitnesses(e){let r=new Map,n=this.world.getAllEntities().filter(o=>o.has(pne.TraitType.ACTOR)&&o.id!==e.actorId);for(let o of n){let a=this.canWitnessChange(o,e);a&&r.set(o.id,a)}let i={change:e,witnesses:r};return this.updateKnowledge(i),i}updateKnowledge(e){for(let[r,n]of e.witnesses){this.knowledge.has(r)||this.knowledge.set(r,new Map);let i=this.knowledge.get(r);switch(e.change.type){case"move":this.updateMovementKnowledge(r,e.change,n);break;case"create":this.updateDiscoveryKnowledge(r,e.change,n);break;case"destroy":this.updateDestructionKnowledge(r,e.change,n);break;case"modify":this.updateModificationKnowledge(r,e.change,n);break;case"action":this.updateActionKnowledge(r,e.change,n);break}this.emitWitnessEvent(r,e.change,n)}}getKnownEntities(e){let r=this.knowledge.get(e);return r?Array.from(r.values()):[]}hasDiscovered(e,r){let n=this.knowledge.get(e);return n?n.get(r)?.exists===!0:!1}getKnowledge(e,r){let n=this.knowledge.get(e);if(n)return n.get(r)}canWitnessChange(e,r){let n=this.world.getEntity(r.entityId);return n?this.scopeResolver.canSee(e,n)?{actorId:e.id,sense:kr.SenseType.SIGHT,level:this.determineWitnessLevel(e,n,kr.SenseType.SIGHT),confidence:"certain"}:this.scopeResolver.canHear(e,n)?{actorId:e.id,sense:kr.SenseType.HEARING,level:this.determineWitnessLevel(e,n,kr.SenseType.HEARING),confidence:"likely"}:this.scopeResolver.canSmell(e,n)?{actorId:e.id,sense:kr.SenseType.SMELL,level:this.determineWitnessLevel(e,n,kr.SenseType.SMELL),confidence:"unsure"}:null:null}determineWitnessLevel(e,r,n){return n===kr.SenseType.SIGHT&&this.scopeResolver.canReach(e,r)?kr.WitnessLevel.FULL:kr.WitnessLevel.PARTIAL}updateMovementKnowledge(e,r,n){let i=this.knowledge.get(e),o=i.get(r.entityId);o||(o=this.createInitialKnowledge(r.entityId,n),i.set(r.entityId,o)),r.to&&(o.lastKnownLocation=r.to),r.from&&r.to&&(o.movementHistory||(o.movementHistory=[]),o.movementHistory.push({from:r.from,to:r.to,witnessedAt:r.timestamp,witnessedBy:n.sense,confidence:n.confidence}),o.movementHistory.length>10&&o.movementHistory.shift()),this.updateSenseTimestamps(o,n,r.timestamp)}updateDiscoveryKnowledge(e,r,n){let i=this.knowledge.get(e),o=this.createInitialKnowledge(r.entityId,n);o.exists=!0,o.discoveredAt=r.timestamp,o.discoveredBy=n.sense,i.set(r.entityId,o)}updateDestructionKnowledge(e,r,n){let o=this.knowledge.get(e).get(r.entityId);o&&(o.exists=!1,this.updateSenseTimestamps(o,n,r.timestamp))}updateModificationKnowledge(e,r,n){let i=this.knowledge.get(e),o=i.get(r.entityId);o||(o=this.createInitialKnowledge(r.entityId,n),i.set(r.entityId,o)),n.sense===kr.SenseType.SIGHT&&r.property&&(o.visualProperties||(o.visualProperties=new Map),o.visualProperties.set(r.property,r.newValue)),this.updateSenseTimestamps(o,n,r.timestamp)}updateActionKnowledge(e,r,n){let i=this.knowledge.get(e);if(r.actorId&&r.actorId!==e){let o=i.get(r.actorId);o||(o=this.createInitialKnowledge(r.actorId,n),i.set(r.actorId,o)),this.updateSenseTimestamps(o,n,r.timestamp)}if(r.target){let o=i.get(r.target);o||(o=this.createInitialKnowledge(r.target,n),i.set(r.target,o)),this.updateSenseTimestamps(o,n,r.timestamp)}}createInitialKnowledge(e,r){return{entityId:e,exists:!0,discoveredAt:Date.now(),discoveredBy:r.sense}}updateSenseTimestamps(e,r,n){switch(r.sense){case kr.SenseType.SIGHT:e.lastSeen=n;break;case kr.SenseType.HEARING:e.lastHeard=n;break;case kr.SenseType.SMELL:e.lastSmelled=n,e.scentStrength="moderate";break}}emitWitnessEvent(e,r,n){let i=this.world.getEntity(e);if(!i)return;let o=null;switch(r.type){case"action":o={type:"if.witness.action",data:{witnessId:e,sense:n.sense,level:n.level,action:r.action||"",actorId:r.actorId||"",targetId:r.target,fromLocation:r.from,toLocation:r.to,timestamp:r.timestamp}};break;case"move":o={type:"if.witness.movement",data:{witnessId:e,sense:n.sense,level:n.level,entityId:n.level===kr.WitnessLevel.FULL?r.entityId:"unknown",fromLocation:r.from||"",toLocation:r.to||"",direction:this.getDirection(r.from,r.to),timestamp:r.timestamp}};break}if(o){let a={actor:i.id};r.entityId&&(a.target=r.entityId),r.target&&(a.target=r.target),(0,gne.createEvent)(o.type,o.data,a)}}getDirection(e,r){}};VT.StandardWitnessSystem=yD});var $o=p(Ja=>{"use strict";var hne=Ja&&Ja.__createBinding||(Object.create?(function(t,e,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}):(function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]})),vD=Ja&&Ja.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&hne(e,t,r)};Object.defineProperty(Ja,"__esModule",{value:!0});vD(Ce(),Ja);vD(kp(),Ja);vD(gV(),Ja)});var ED=p(eo=>{"use strict";Object.defineProperty(eo,"__esModule",{value:!0});eo.LOCK_MESSAGES=void 0;eo.analyzeLockContext=yne;eo.validateKeyRequirements=vne;eo.createLockErrorEvent=Ene;eo.determineLockMessage=Tne;var bm=b();eo.LOCK_MESSAGES={NO_KEY:"no_key",KEY_NOT_HELD:"key_not_held",WRONG_KEY:"wrong_key"};function yne(t,e,r){let n=t.player,i=bm.LockableBehavior.requiresKey(e),o=!1;return r&&(o=t.world.getLocation(r.id)===n.id),{target:e,key:r,isContainer:e.has(bm.TraitType.CONTAINER),isDoor:e.has(bm.TraitType.DOOR),requiresKey:i,keyHeld:o}}function vne(t,e,r,n){if(!bm.LockableBehavior.requiresKey(e))return null;if(!r)return{valid:!1,error:eo.LOCK_MESSAGES.NO_KEY};let i=t.player;return t.world.getLocation(r.id)!==i.id?{valid:!1,error:eo.LOCK_MESSAGES.KEY_NOT_HELD,params:{key:r.name}}:(n?bm.LockableBehavior.canLockWith(e,r.id):bm.LockableBehavior.canUnlockWith(e,r.id))?null:{valid:!1,error:eo.LOCK_MESSAGES.WRONG_KEY,params:{key:r.name,item:e.name}}}function Ene(t,e,r,n,i){let o=t.action.id;if(i){if(e.alreadyLocked)return t.event("action.error",{actionId:o,messageId:"already_locked",reason:"already_locked",params:{item:r.name}});if(e.notClosed)return t.event("action.error",{actionId:o,messageId:"not_closed",reason:"not_closed",params:{item:r.name}})}else if(e.alreadyUnlocked)return t.event("action.error",{actionId:o,messageId:"already_unlocked",reason:"already_unlocked",params:{item:r.name}});return e.noKey?t.event("action.error",{actionId:o,messageId:"no_key",reason:"no_key"}):e.wrongKey?t.event("action.error",{actionId:o,messageId:"wrong_key",reason:"wrong_key",params:{key:n?.name||"key",item:r.name}}):t.event("action.error",{actionId:o,messageId:i?"cannot_lock":"cannot_unlock",reason:i?"cannot_lock":"cannot_unlock",params:{item:r.name}})}function Tne(t,e){return t?e?"locked_with":"locked":e?"unlocked_with":"unlocked"}});var hV=p(YT=>{"use strict";Object.defineProperty(YT,"__esModule",{value:!0});YT.MESSAGES=void 0;YT.MESSAGES={NO_TARGET:"no_target",NOT_LOCKABLE:"not_lockable",NO_KEY:"no_key",WRONG_KEY:"wrong_key",ALREADY_LOCKED:"already_locked",NOT_CLOSED:"not_closed",CANT_REACH:"cant_reach",KEY_NOT_HELD:"key_not_held",LOCKED:"locked",LOCKED_WITH:"locked_with"}});var vV=p(KT=>{"use strict";Object.defineProperty(KT,"__esModule",{value:!0});KT.lockingAction=void 0;var Om=b(),_ne=ce(),zT=$o(),TD=ED(),$T=hV();function yV(t){return t.sharedData}KT.lockingAction={id:_ne.IFActions.LOCKING,defaultScope:{target:zT.ScopeLevel.REACHABLE,key:zT.ScopeLevel.CARRIED},requiredMessages:["no_target","not_lockable","no_key","wrong_key","already_locked","not_closed","locked","locked_with","cant_reach","key_not_held"],group:"lock_manipulation",validate(t){let e=t.command.directObject?.entity,r=t.command.instrument?.entity??t.command.indirectObject?.entity;if(!e)return{valid:!1,error:$T.MESSAGES.NO_TARGET};let n=t.requireScope(e,zT.ScopeLevel.REACHABLE);if(!n.ok)return n.error;if(!e.has(Om.TraitType.LOCKABLE))return{valid:!1,error:$T.MESSAGES.NOT_LOCKABLE,params:{item:e.name}};if(!Om.LockableBehavior.canLock(e)){if(Om.LockableBehavior.isLocked(e))return{valid:!1,error:$T.MESSAGES.ALREADY_LOCKED,params:{item:e.name}};if(e.has(Om.TraitType.OPENABLE)&&Om.OpenableBehavior.isOpen(e))return{valid:!1,error:$T.MESSAGES.NOT_CLOSED,params:{item:e.name}}}let i=(0,TD.validateKeyRequirements)(t,e,r,!0);return i||{valid:!0}},execute(t){let e=t.command.directObject.entity,r=t.command.instrument?.entity??t.command.indirectObject?.entity,n=yV(t),i=(0,TD.analyzeLockContext)(t,e,r),o=Om.LockableBehavior.lock(e,r);if(n.targetId=e.id,n.targetName=e.name,!o.success){n.failed=!0,o.wrongKey?n.errorMessageId="wrong_key":o.noKey?n.errorMessageId="no_key":o.alreadyLocked?n.errorMessageId="already_locked":n.errorMessageId="cant_lock";return}n.failed=!1,i.isContainer&&(n.isContainer=!0),i.isDoor&&(n.isDoor=!0),r&&(n.keyId=r.id,n.keyName=r.name),o.lockSound&&(n.sound=o.lockSound),n.messageId=(0,TD.determineLockMessage)(!0,!!r),n.params={item:e.name},i.isContainer&&(n.params.isContainer=!0),i.isDoor&&(n.params.isDoor=!0),r&&(n.params.key=r.name)},report(t){let e=yV(t);return e.failed?[t.event("if.event.lock_blocked",{messageId:`${t.action.id}.${e.errorMessageId}`,params:{item:e.targetName},targetId:e.targetId,targetName:e.targetName,reason:e.errorMessageId})]:[t.event("if.event.locked",{messageId:`${t.action.id}.${e.messageId}`,params:e.params,targetId:e.targetId,targetName:e.targetName,actorId:t.player.id,isContainer:e.isContainer,isDoor:e.isDoor,keyId:e.keyId,keyName:e.keyName,sound:e.sound})]},blocked(t,e){let r=t.command.directObject?.entity;return[t.event("if.event.lock_blocked",{messageId:`${t.action.id}.${e.error}`,params:e.params||{},targetId:r?.id,targetName:r?.name,reason:e.error})]},metadata:{requiresDirectObject:!0,requiresIndirectObject:!1,directObjectScope:zT.ScopeLevel.REACHABLE}}});var _D=p(QT=>{"use strict";Object.defineProperty(QT,"__esModule",{value:!0});QT.lockingAction=void 0;var bne=vV();Object.defineProperty(QT,"lockingAction",{enumerable:!0,get:function(){return bne.lockingAction}})});var EV=p(XT=>{"use strict";Object.defineProperty(XT,"__esModule",{value:!0});XT.MESSAGES=void 0;XT.MESSAGES={NO_TARGET:"no_target",NOT_LOCKABLE:"not_lockable",NO_KEY:"no_key",WRONG_KEY:"wrong_key",ALREADY_UNLOCKED:"already_unlocked",CANT_REACH:"cant_reach",KEY_NOT_HELD:"key_not_held",UNLOCKED:"unlocked",UNLOCKED_WITH:"unlocked_with"}});var _V=p(JT=>{"use strict";Object.defineProperty(JT,"__esModule",{value:!0});JT.unlockingAction=void 0;var Up=b(),One=ce(),ZT=$o(),bD=ED(),OD=EV();function TV(t){return t.sharedData}JT.unlockingAction={id:One.IFActions.UNLOCKING,defaultScope:{target:ZT.ScopeLevel.REACHABLE,key:ZT.ScopeLevel.CARRIED},requiredMessages:["no_target","not_lockable","no_key","wrong_key","already_unlocked","unlocked","unlocked_with","cant_reach","key_not_held","still_locked"],group:"lock_manipulation",validate(t){let e=t.command.directObject?.entity,r=t.command.instrument?.entity??t.command.indirectObject?.entity;if(!e)return{valid:!1,error:OD.MESSAGES.NO_TARGET};let n=t.requireScope(e,ZT.ScopeLevel.REACHABLE);if(!n.ok)return n.error;if(!e.has(Up.TraitType.LOCKABLE))return{valid:!1,error:OD.MESSAGES.NOT_LOCKABLE,params:{item:e.name}};if(!Up.LockableBehavior.canUnlock(e))return{valid:!1,error:OD.MESSAGES.ALREADY_UNLOCKED,params:{item:e.name}};let i=(0,bD.validateKeyRequirements)(t,e,r,!1);return i||{valid:!0}},execute(t){let e=t.command.directObject.entity,r=t.command.instrument?.entity??t.command.indirectObject?.entity,n=TV(t),i=(0,bD.analyzeLockContext)(t,e,r),o=Up.LockableBehavior.unlock(e,r);if(n.targetId=e.id,n.targetName=e.name,!o.success){n.failed=!0,o.wrongKey?n.errorMessageId="wrong_key":o.noKey?n.errorMessageId="no_key":n.errorMessageId="cant_unlock";return}if(n.failed=!1,i.isContainer){n.isContainer=!0;let a=t.world.getContents(e.id);n.hasContents=a.length>0,n.contentsCount=a.length,n.contentsIds=a.map(s=>s.id)}i.isDoor&&(n.isDoor=!0),r&&(n.keyId=r.id,n.keyName=r.name),o.unlockSound&&(n.sound=o.unlockSound),e.has(Up.TraitType.OPENABLE)&&e.get(Up.TraitType.OPENABLE).autoOpenOnUnlock&&(n.willAutoOpen=!0),n.messageId=(0,bD.determineLockMessage)(!1,!!r),n.params={item:e.name},i.isContainer&&(n.params.isContainer=!0,n.params.hasContents=n.hasContents),i.isDoor&&(n.params.isDoor=!0),r&&(n.params.key=r.name),n.willAutoOpen&&(n.params.willAutoOpen=!0),n.sound&&(n.params.sound=n.sound)},report(t){let e=TV(t);return e.failed?[t.event("if.event.unlock_blocked",{messageId:`${t.action.id}.${e.errorMessageId}`,params:{item:e.targetName},targetId:e.targetId,targetName:e.targetName,reason:e.errorMessageId})]:[t.event("if.event.unlocked",{messageId:`${t.action.id}.${e.messageId}`,params:e.params,targetId:e.targetId,targetName:e.targetName,containerId:e.targetId,containerName:e.targetName,actorId:t.player.id,isContainer:e.isContainer,isDoor:e.isDoor,keyId:e.keyId,keyName:e.keyName,sound:e.sound,willAutoOpen:e.willAutoOpen,hasContents:e.hasContents,contentsCount:e.contentsCount,contentsIds:e.contentsIds})]},blocked(t,e){let r=t.command.directObject?.entity;return[t.event("if.event.unlock_blocked",{messageId:`${t.action.id}.${e.error}`,params:e.params||{},targetId:r?.id,targetName:r?.name,reason:e.error})]},metadata:{requiresDirectObject:!0,requiresIndirectObject:!1,directObjectScope:ZT.ScopeLevel.REACHABLE}}});var ID=p(e_=>{"use strict";Object.defineProperty(e_,"__esModule",{value:!0});e_.unlockingAction=void 0;var Ine=_V();Object.defineProperty(e_,"unlockingAction",{enumerable:!0,get:function(){return Ine.unlockingAction}})});var SD=p(t_=>{"use strict";Object.defineProperty(t_,"__esModule",{value:!0});t_.analyzeSwitchingContext=Sne;t_.determineSwitchingMessage=Ane;var Yc=b();function Sne(t,e){let r=t.player,n={target:e,isLightSource:e.has(Yc.TraitType.LIGHT_SOURCE),otherLightsPresent:!1,isInSameRoom:!1};if(n.isLightSource){let a=e.get(Yc.TraitType.LIGHT_SOURCE);n.lightRadius=a.radius||1,n.lightIntensity=a.intensity||"normal"}let i=t.world.getContainingRoom(r.id),o=t.world.getContainingRoom(e.id);if(i&&o&&i.id===o.id&&(n.isInSameRoom=!0,n.isLightSource)){let s=t.world.getContents(i.id).filter(u=>u.id!==e.id&&u.has(Yc.TraitType.LIGHT_SOURCE)&&u.has(Yc.TraitType.SWITCHABLE)&&u.get(Yc.TraitType.SWITCHABLE).isOn),l=t.world.getContents(r.id).filter(u=>u.id!==e.id&&u.has(Yc.TraitType.LIGHT_SOURCE)&&u.has(Yc.TraitType.SWITCHABLE)&&u.get(Yc.TraitType.SWITCHABLE).isOn);n.otherLightsPresent=s.length>0||l.length>0,n.willAffectDarkness=!n.otherLightsPresent}return n}function Ane(t,e,r,n,i,o){return o?t?"door_opens":"door_closes":n?t?"temporary_activation":"was_temporary":r?"with_sound":e.isLightSource&&e.isInSameRoom?t?e.willAffectDarkness?"illuminates_darkness":"light_on":e.willAffectDarkness?"light_off":"light_off_still_lit":!t&&i?"silence_falls":e.isLightSource?t?"switched_on":"switched_off":t?"device_humming":"device_stops"}});var bV=p(r_=>{"use strict";Object.defineProperty(r_,"__esModule",{value:!0});r_.MESSAGES=void 0;r_.MESSAGES={NO_TARGET:"no_target",NOT_SWITCHABLE:"not_switchable",ALREADY_ON:"already_on",NO_POWER:"no_power",SWITCHED_ON:"switched_on",LIGHT_ON:"light_on",DEVICE_HUMMING:"device_humming",TEMPORARY_ACTIVATION:"temporary_activation",WITH_SOUND:"with_sound",DOOR_OPENS:"door_opens",ILLUMINATES_DARKNESS:"illuminates_darkness"}});var AV=p(i_=>{"use strict";Object.defineProperty(i_,"__esModule",{value:!0});i_.switchingOnAction=void 0;var Ko=b(),Rne=ce(),AD=$o(),OV=SD(),n_=bV(),IV=zo();function SV(t){return t.sharedData}i_.switchingOnAction={id:Rne.IFActions.SWITCHING_ON,defaultScope:{target:AD.ScopeLevel.REACHABLE},requiredMessages:["no_target","not_visible","not_reachable","not_switchable","already_on","no_power","switched_on","light_on","device_humming","temporary_activation","with_sound","door_opens","illuminates_darkness"],validate(t){let e=t.command.directObject?.entity;if(!e)return{valid:!1,error:n_.MESSAGES.NO_TARGET};let r=t.requireScope(e,AD.ScopeLevel.REACHABLE);if(!r.ok)return r.error;if(!e.has(Ko.TraitType.SWITCHABLE))return{valid:!1,error:n_.MESSAGES.NOT_SWITCHABLE,params:{target:e.name}};if(!Ko.SwitchableBehavior.canSwitchOn(e)){let n=e.get(Ko.TraitType.SWITCHABLE);if(n.isOn)return{valid:!1,error:n_.MESSAGES.ALREADY_ON,params:{target:e.name}};if(n.requiresPower&&!n.hasPower)return{valid:!1,error:n_.MESSAGES.NO_POWER,params:{target:e.name}}}return{valid:!0}},execute(t){let e=t.command.directObject.entity,r=SV(t);r.targetId=e.id,r.targetName=e.name;let n=t.world.getContainingRoom(t.player.id),i=n?Ko.VisibilityBehavior.isDark(n,t.world):!1;r.wasDarkBefore=i;let o=Ko.SwitchableBehavior.switchOn(e);if(e.has(Ko.TraitType.LIGHT_SOURCE)&&Ko.LightSourceBehavior.light(e),!o.success){r.failed=!0,o.wasOn?r.errorMessageId="already_on":o.noPower?r.errorMessageId="no_power":r.errorMessageId="not_switchable";return}r.failed=!1;let a=(0,OV.analyzeSwitchingContext)(t,e);if(r.params={target:e.name},a.isLightSource&&(r.isLightSource=!0,r.lightRadius=a.lightRadius,r.lightIntensity=a.lightIntensity,a.isInSameRoom&&a.willAffectDarkness&&(r.willIlluminateLocation=!0)),r.willIlluminateLocation&&r.wasDarkBefore){let c=t.world.getContainingRoom(t.player.id);if(c){r.roomSnapshot=(0,IV.captureRoomSnapshot)(c,t.world,!1);let l=t.world.getContents(c.id).filter(u=>u.id!==t.player.id);r.visibleSnapshots=(0,IV.captureEntitySnapshots)(l,t.world)}}o.autoOffTime&&o.autoOffTime>0&&(r.autoOffTime=o.autoOffTime,r.temporary=!0),o.powerConsumption&&(r.powerConsumption=o.powerConsumption),o.runningSound&&(r.continuousSound=o.runningSound),o.onSound&&(r.sound=o.onSound,r.params.sound=o.onSound);let s=!1;e.has(Ko.TraitType.CONTAINER)&&e.has(Ko.TraitType.OPENABLE)&&(e.get(Ko.TraitType.OPENABLE).isOpen||(r.willOpen=!0,s=!0)),r.messageId=(0,OV.determineSwitchingMessage)(!0,a,o.onSound,!!(o.autoOffTime&&o.autoOffTime>0),void 0,s)},report(t){let e=SV(t);if(e.failed)return[t.event("if.event.switch_on_blocked",{messageId:`${t.action.id}.${e.errorMessageId}`,params:{target:e.targetName},targetId:e.targetId,targetName:e.targetName,reason:e.errorMessageId})];let r=[t.event("if.event.switched_on",{messageId:`${t.action.id}.${e.messageId}`,params:e.params,target:e.targetId,targetName:e.targetName,actorId:t.player.id,isLightSource:e.isLightSource,lightRadius:e.lightRadius,lightIntensity:e.lightIntensity,willIlluminateLocation:e.willIlluminateLocation,temporary:e.temporary,autoOffTime:e.autoOffTime,powerConsumption:e.powerConsumption,continuousSound:e.continuousSound,sound:e.sound,willOpen:e.willOpen})];if(e.willIlluminateLocation&&e.wasDarkBefore&&e.roomSnapshot){let n=e.roomSnapshot,i=t.world.getContents(n.id).filter(o=>o.id!==t.player.id);if(r.push(t.event("if.event.room.description",{room:n,visibleItems:e.visibleSnapshots||[],roomId:n.id,roomName:n.name,roomDescription:n.description,includeContents:!0,verbose:!0})),r.push(t.event("action.success",{actionId:"if.action.looking",messageId:"room_description",params:{name:n.name,description:n.description}})),i.length>0){let o=i.map(a=>a.name).join(", ");r.push(t.event("action.success",{actionId:"if.action.looking",messageId:"contents_list",params:{items:o,count:i.length}}))}}return r},blocked(t,e){let r=t.command.directObject?.entity;return[t.event("if.event.switch_on_blocked",{messageId:`${t.action.id}.${e.error}`,params:e.params||{},targetId:r?.id,targetName:r?.name,reason:e.error})]},group:"device_manipulation",metadata:{requiresDirectObject:!0,requiresIndirectObject:!1,directObjectScope:AD.ScopeLevel.REACHABLE}}});var RD=p(o_=>{"use strict";Object.defineProperty(o_,"__esModule",{value:!0});o_.switchingOnAction=void 0;var wne=AV();Object.defineProperty(o_,"switchingOnAction",{enumerable:!0,get:function(){return wne.switchingOnAction}})});var RV=p(a_=>{"use strict";Object.defineProperty(a_,"__esModule",{value:!0});a_.MESSAGES=void 0;a_.MESSAGES={NO_TARGET:"no_target",NOT_SWITCHABLE:"not_switchable",ALREADY_OFF:"already_off",SWITCHED_OFF:"switched_off",LIGHT_OFF:"light_off",LIGHT_OFF_STILL_LIT:"light_off_still_lit",DEVICE_STOPS:"device_stops",SILENCE_FALLS:"silence_falls",WITH_SOUND:"with_sound",DOOR_CLOSES:"door_closes",WAS_TEMPORARY:"was_temporary"}});var NV=p(s_=>{"use strict";Object.defineProperty(s_,"__esModule",{value:!0});s_.switchingOffAction=void 0;var es=b(),Cne=ce(),wD=$o(),wV=SD(),CD=RV();function CV(t){return t.sharedData}s_.switchingOffAction={id:Cne.IFActions.SWITCHING_OFF,defaultScope:{target:wD.ScopeLevel.REACHABLE},requiredMessages:["no_target","not_visible","not_reachable","not_switchable","already_off","switched_off","light_off","light_off_still_lit","device_stops","silence_falls","with_sound","door_closes","was_temporary"],validate(t){let e=t.command.directObject?.entity;if(!e)return{valid:!1,error:CD.MESSAGES.NO_TARGET};let r=t.requireScope(e,wD.ScopeLevel.REACHABLE);return r.ok?e.has(es.TraitType.SWITCHABLE)?es.SwitchableBehavior.canSwitchOff(e)?{valid:!0}:{valid:!1,error:CD.MESSAGES.ALREADY_OFF,params:{target:e.name}}:{valid:!1,error:CD.MESSAGES.NOT_SWITCHABLE,params:{target:e.name}}:r.error},execute(t){let e=t.command.directObject.entity,r=CV(t);r.targetId=e.id,r.targetName=e.name;let i=e.get(es.TraitType.SWITCHABLE),o=i.autoOffCounter>0,a=i.autoOffCounter,s=i.runningSound,c=i.powerConsumption,l=es.SwitchableBehavior.switchOff(e);if(e.has(es.TraitType.LIGHT_SOURCE)&&es.LightSourceBehavior.extinguish(e),!l.success){r.failed=!0,l.wasOff?r.errorMessageId="already_off":r.errorMessageId="not_switchable";return}r.failed=!1;let u=(0,wV.analyzeSwitchingContext)(t,e);r.params={target:e.name},u.isLightSource&&(r.isLightSource=!0,u.isInSameRoom&&u.willAffectDarkness&&(r.willDarkenLocation=!0)),o&&(r.wasTemporary=!0,r.remainingTime=a,r.params.remainingTime=a),c&&(r.powerFreed=c),l.offSound?(r.sound=l.offSound,r.params.sound=l.offSound):s&&(r.stoppedSound=s);let m=!1;if(e.has(es.TraitType.CONTAINER)&&e.has(es.TraitType.OPENABLE)){let f=e.get(es.TraitType.OPENABLE);f.isOpen&&f.autoCloseOnOff&&(r.willClose=!0,m=!0)}r.messageId=(0,wV.determineSwitchingMessage)(!1,u,l.offSound,o,s,m)},report(t){let e=CV(t);return e.failed?[t.event("if.event.switch_off_blocked",{messageId:`${t.action.id}.${e.errorMessageId}`,params:{target:e.targetName},targetId:e.targetId,targetName:e.targetName,reason:e.errorMessageId})]:[t.event("if.event.switched_off",{messageId:`${t.action.id}.${e.messageId}`,params:e.params,target:e.targetId,targetName:e.targetName,actorId:t.player.id,isLightSource:e.isLightSource,willDarkenLocation:e.willDarkenLocation,wasTemporary:e.wasTemporary,remainingTime:e.remainingTime,powerFreed:e.powerFreed,sound:e.sound,stoppedSound:e.stoppedSound,willClose:e.willClose})]},blocked(t,e){let r=t.command.directObject?.entity;return[t.event("if.event.switch_off_blocked",{messageId:`${t.action.id}.${e.error}`,params:e.params||{},targetId:r?.id,targetName:r?.name,reason:e.error})]},group:"device_manipulation",metadata:{requiresDirectObject:!0,requiresIndirectObject:!1,directObjectScope:wD.ScopeLevel.REACHABLE}}});var ND=p(c_=>{"use strict";Object.defineProperty(c_,"__esModule",{value:!0});c_.switchingOffAction=void 0;var Nne=NV();Object.defineProperty(c_,"switchingOffAction",{enumerable:!0,get:function(){return Nne.switchingOffAction}})});var DV=p(l_=>{"use strict";Object.defineProperty(l_,"__esModule",{value:!0});l_.EnteringMessages=void 0;l_.EnteringMessages={NO_TARGET:"no_target",NOT_ENTERABLE:"not_enterable",ALREADY_INSIDE:"already_inside",CONTAINER_CLOSED:"container_closed",TOO_FULL:"too_full",ENTERED:"entered",ENTERED_ON:"entered_on",CANT_ENTER:"cant_enter",ACTION_FAILED:"action_failed"}});var LV=p(d_=>{"use strict";Object.defineProperty(d_,"__esModule",{value:!0});d_.enteringAction=void 0;var u_=b(),Dne=ce(),yu=DV();function PV(t){return t.sharedData}var DD=Ce();d_.enteringAction={id:Dne.IFActions.ENTERING,defaultScope:{target:DD.ScopeLevel.REACHABLE},requiredMessages:["no_target","not_enterable","already_inside","container_closed","too_full","entered","entered_on","cant_enter"],group:"movement",validate(t){let e=t.player,r=t.command.directObject?.entity;if(!r)return{valid:!1,error:yu.EnteringMessages.NO_TARGET};let n=t.requireScope(r,DD.ScopeLevel.REACHABLE);return n.ok?t.world.getLocation(e.id)===r.id?{valid:!1,error:yu.EnteringMessages.ALREADY_INSIDE,params:{place:r.name}}:r.has(u_.TraitType.ENTERABLE)?r.has(u_.TraitType.OPENABLE)&&!u_.OpenableBehavior.isOpen(r)?{valid:!1,error:yu.EnteringMessages.CONTAINER_CLOSED,params:{container:r.name}}:{valid:!0}:{valid:!1,error:yu.EnteringMessages.NOT_ENTERABLE,params:{place:r.name}}:n.error},execute(t){let e=t.player,r=t.command.directObject.entity,n=t.world.getLocation(e.id),o=r.get(u_.TraitType.ENTERABLE).preposition;t.world.moveEntity(e.id,r.id);let a={targetId:r.id,targetName:r.name,fromLocation:n,preposition:o},s=PV(t);s.enteringState=a},report(t){let r=PV(t).enteringState;if(!r)return[t.event("if.event.entered",{messageId:`${t.action.id}.${yu.EnteringMessages.ACTION_FAILED}`,error:"Missing state from execute phase"})];let n=r.preposition==="on"?yu.EnteringMessages.ENTERED_ON:yu.EnteringMessages.ENTERED;return[t.event("if.event.entered",{messageId:`${t.action.id}.${n}`,params:{place:r.targetName},targetId:r.targetId,targetName:r.targetName,fromLocation:r.fromLocation,preposition:r.preposition})]},blocked(t,e){let r=t.command.directObject?.entity;return[t.event("if.event.entered",{blocked:!0,messageId:`${t.action.id}.${e.error}`,params:{place:r?.name,...e.params},reason:e.error,targetId:r?.id,targetName:r?.name})]},metadata:{requiresDirectObject:!0,requiresIndirectObject:!1,directObjectScope:DD.ScopeLevel.REACHABLE}}});var PD=p(m_=>{"use strict";Object.defineProperty(m_,"__esModule",{value:!0});m_.enteringAction=void 0;var Pne=LV();Object.defineProperty(m_,"enteringAction",{enumerable:!0,get:function(){return Pne.enteringAction}})});var MV=p(f_=>{"use strict";Object.defineProperty(f_,"__esModule",{value:!0});f_.ExitingMessages=void 0;f_.ExitingMessages={NOWHERE_TO_GO:"nowhere_to_go",ALREADY_OUTSIDE:"already_outside",CONTAINER_CLOSED:"container_closed",CANT_EXIT:"cant_exit",EXITED:"exited",EXITED_FROM:"exited_from"}});var xV=p(p_=>{"use strict";Object.defineProperty(p_,"__esModule",{value:!0});p_.exitingAction=void 0;var Im=b(),Lne=ce(),qp=MV();function kV(t){return t.sharedData}var Mne=Ce();p_.exitingAction={id:Lne.IFActions.EXITING,requiredMessages:["already_outside","container_closed","cant_exit","exited","exited_from","nowhere_to_go"],group:"movement",validate(t){let e=t.player,r=t.world.getLocation(e.id);if(!r)return{valid:!1,error:qp.ExitingMessages.NOWHERE_TO_GO};let n=t.world.getEntity(r);return n?n.has(Im.TraitType.ROOM)?{valid:!1,error:qp.ExitingMessages.ALREADY_OUTSIDE}:t.world.getLocation(r)?n.has(Im.TraitType.CONTAINER)&&n.has(Im.TraitType.OPENABLE)&&!Im.OpenableBehavior.isOpen(n)?{valid:!1,error:qp.ExitingMessages.CONTAINER_CLOSED,params:{container:n.name}}:{valid:!0}:{valid:!1,error:qp.ExitingMessages.NOWHERE_TO_GO}:{valid:!1,error:qp.ExitingMessages.NOWHERE_TO_GO}},execute(t){let e=t.player,r=t.world.getLocation(e.id),n=t.world.getEntity(r),i=t.world.getLocation(r),o="from";n.has(Im.TraitType.CONTAINER)?o="out of":n.has(Im.TraitType.SUPPORTER)&&(o="off"),t.world.moveEntity(e.id,i);let a={fromLocation:r,fromLocationName:n.name,toLocation:i,preposition:o},s=kV(t);s.exitingState=a},report(t){let r=kV(t).exitingState;return r?[t.event("if.event.exited",{messageId:`${t.action.id}.exited`,params:{place:r.fromLocationName},fromLocation:r.fromLocation,fromLocationName:r.fromLocationName,toLocation:r.toLocation,preposition:r.preposition})]:[t.event("if.event.exited",{messageId:`${t.action.id}.action_failed`,error:"Missing state from execute phase"})]},blocked(t,e){return[t.event("if.event.exited",{blocked:!0,messageId:`${t.action.id}.${e.error}`,params:e.params||{},reason:e.error})]},metadata:{requiresDirectObject:!1,requiresIndirectObject:!1,directObjectScope:Mne.ScopeLevel.REACHABLE}}});var LD=p(g_=>{"use strict";Object.defineProperty(g_,"__esModule",{value:!0});g_.exitingAction=void 0;var kne=xV();Object.defineProperty(g_,"exitingAction",{enumerable:!0,get:function(){return kne.exitingAction}})});var jV=p(h_=>{"use strict";Object.defineProperty(h_,"__esModule",{value:!0});h_.climbingAction=void 0;var xne=Ce(),vu=b(),Bne=ce();function BV(t){return t.sharedData}h_.climbingAction={id:Bne.IFActions.CLIMBING,requiredMessages:["no_target","not_climbable","cant_go_that_way","climbed_up","climbed_down","climbed_onto","already_there","too_high","too_dangerous"],group:"movement",metadata:{requiresDirectObject:!1,requiresIndirectObject:!1,directObjectScope:xne.ScopeLevel.REACHABLE},validate(t){let e=t.command.directObject?.entity,r=t.command.parsed.extras?.direction;return r&&!e?jne(r,t):e?Wne(e,t):{valid:!1,error:"no_target"}},execute(t){let e=t.command.directObject?.entity,r=t.command.parsed.extras?.direction,n=BV(t);if(n.fromLocationId=t.currentLocation.id,r&&!e){let i=r.toLowerCase();n.mode="directional",n.direction=i;let s=t.currentLocation.get(vu.TraitType.ROOM)?.exits||{};i==="up"&&s.up?n.destinationId=s.up.to||s.up.destination:i==="down"&&s.down&&(n.destinationId=s.down.to||s.down.destination),n.destinationId&&t.world.moveEntity(t.player.id,n.destinationId)}else e&&(n.mode="object",n.targetId=e.id,n.targetName=e.name,t.world.moveEntity(t.player.id,e.id))},blocked(t,e){let r=t.command.directObject?.entity,n=t.command.parsed.extras?.direction;return[t.event("if.event.climbed",{blocked:!0,messageId:`${t.action.id}.${e.error}`,params:{target:r?.name,...e.params},reason:e.error,targetId:r?.id,targetName:r?.name,direction:n})]},report(t){let e=[],r=BV(t);if(r.mode==="directional"){let n=r.direction==="up"?"climbed_up":"climbed_down";e.push(t.event("if.event.climbed",{messageId:`${t.action.id}.${n}`,params:{direction:r.direction},direction:r.direction,method:"directional",destinationId:r.destinationId})),r.destinationId&&e.push(t.event("if.event.moved",{direction:r.direction,fromRoom:r.fromLocationId,toRoom:r.destinationId,method:"climbing"}))}else e.push(t.event("if.event.climbed",{messageId:`${t.action.id}.climbed_onto`,params:{target:r.targetName},targetId:r.targetId,targetName:r.targetName,method:"onto"})),e.push(t.event("if.event.entered",{targetId:r.targetId,method:"climbing",preposition:"onto"}));return e}};function jne(t,e){let r=t.toLowerCase();if(r!=="up"&&r!=="down")return{valid:!1,error:"cant_go_that_way",params:{direction:t}};let n=e.currentLocation;if(!n.has(vu.TraitType.ROOM))return{valid:!1,error:"cant_go_that_way",params:{direction:r}};let i=n.get(vu.TraitType.ROOM);return!i.exits||!i.exits[r]?{valid:!1,error:"cant_go_that_way",params:{direction:r}}:{valid:!0}}function Wne(t,e){let r=!1;return t.has(vu.TraitType.CLIMBABLE)?vu.ClimbableBehavior.climb(t).success&&(r=!0):t.has(vu.TraitType.SUPPORTER)&&t.get(vu.TraitType.SUPPORTER).enterable&&(r=!0),r?e.world.getLocation(e.player.id)===t.id?{valid:!1,error:"already_there",params:{place:t.name}}:{valid:!0}:{valid:!1,error:"not_climbable",params:{object:t.name}}}});var MD=p(y_=>{"use strict";Object.defineProperty(y_,"__esModule",{value:!0});y_.climbingAction=void 0;var Hne=jV();Object.defineProperty(y_,"climbingAction",{enumerable:!0,get:function(){return Hne.climbingAction}})});var WV=p(Am=>{"use strict";Object.defineProperty(Am,"__esModule",{value:!0});Am.analyzeSearchTarget=Une;Am.revealConcealedItems=qne;Am.determineSearchMessage=Fne;Am.buildSearchEventData=Vne;var Sm=b();function Une(t,e){let r=e||t.currentLocation,n=!e,i=t.world.getContents(r.id),o=i.filter(s=>s.has(Sm.TraitType.IDENTITY)?Sm.IdentityBehavior.isConcealed(s):!1),a;return n?a="location":r.has(Sm.TraitType.CONTAINER)?a="container":r.has(Sm.TraitType.SUPPORTER)?a="supporter":a="object",{target:r,contents:i,concealedItems:o,isLocation:n,targetType:a}}function qne(t){t.forEach(e=>{e.has(Sm.TraitType.IDENTITY)&&Sm.IdentityBehavior.reveal(e)})}function Fne(t){let{target:e,contents:r,concealedItems:n,targetType:i}=t,o={target:e.name};if(n.length>0)return o.items=n.map(a=>a.name).join(", "),o.where=Gne(i),{messageId:"found_concealed",params:o};switch(i){case"container":return r.length===0?{messageId:"empty_container",params:o}:(o.items=r.map(a=>a.name).join(", "),{messageId:"container_contents",params:o});case"supporter":return r.length>0?(o.items=r.map(a=>a.name).join(", "),{messageId:"supporter_contents",params:o}):{messageId:"nothing_special",params:o};case"location":return{messageId:"searched_location",params:o};default:return r.length>0?{messageId:"searched_object",params:o}:{messageId:"nothing_special",params:o}}}function Gne(t){switch(t){case"container":return"inside";case"supporter":return"on";default:return"here"}}function Vne(t){return{target:t.target.id,targetName:t.target.name,foundItems:t.concealedItems.map(e=>e.id),foundItemNames:t.concealedItems.map(e=>e.name),searchingLocation:t.isLocation}}});var qV=p(E_=>{"use strict";Object.defineProperty(E_,"__esModule",{value:!0});E_.searchingAction=void 0;var kD=b(),Yne=ce(),HV=Ce(),v_=WV();function UV(t){return t.sharedData}E_.searchingAction={id:Yne.IFActions.SEARCHING,defaultScope:{target:HV.ScopeLevel.REACHABLE},requiredMessages:["not_visible","not_reachable","container_closed","nothing_special","found_items","empty_container","container_contents","supporter_contents","searched_location","searched_object","found_concealed"],metadata:{requiresDirectObject:!0,requiresIndirectObject:!1,directObjectScope:HV.ScopeLevel.REACHABLE},validate(t){let e=t.command.directObject?.entity;return e?e.has(kD.TraitType.CONTAINER)&&e.has(kD.TraitType.OPENABLE)&&!kD.OpenableBehavior.isOpen(e)?{valid:!1,error:"container_closed",params:{target:e.name}}:{valid:!0}:{valid:!0}},execute(t){let e=t.command.directObject?.entity,r=UV(t),n=(0,v_.analyzeSearchTarget)(t,e);n.concealedItems.length>0&&(0,v_.revealConcealedItems)(n.concealedItems);let i=(0,v_.buildSearchEventData)(n),{messageId:o,params:a}=(0,v_.determineSearchMessage)(n);r.eventData=i,r.messageId=o,r.params=a},blocked(t,e){let r=t.command.directObject?.entity;return[t.event("if.event.searched",{blocked:!0,messageId:`${t.action.id}.${e.error}`,params:{target:r?.name,...e.params},reason:e.error,targetId:r?.id,targetName:r?.name})]},report(t){let e=[],r=UV(t);return e.push(t.event("if.event.searched",{messageId:`${t.action.id}.${r.messageId||"nothing_special"}`,params:r.params||{},...r.eventData})),e},group:"sensory"}});var xD=p(T_=>{"use strict";Object.defineProperty(T_,"__esModule",{value:!0});T_.searchingAction=void 0;var zne=qV();Object.defineProperty(T_,"searchingAction",{enumerable:!0,get:function(){return zne.searchingAction}})});var GV=p(__=>{"use strict";Object.defineProperty(__,"__esModule",{value:!0});__.listeningAction=void 0;var Eu=b(),$ne=ce(),Kne=$o();function FV(t){return t.sharedData}function Qne(t){let e=t.command.directObject?.entity,r={},n={},i;if(e){r.target=e.id,n.target=e.name;let o=!1;if(e.has(Eu.TraitType.SWITCHABLE))e.get(Eu.TraitType.SWITCHABLE).isOn?(o=!0,r.hasSound=!0,r.soundType="device",i="device_running"):i="device_off";else if(e.has(Eu.TraitType.CONTAINER)){let a=t.world.getContents(e.id);a.length>0?(r.hasContents=!0,r.contentCount=a.length,i=a.some(c=>c.has(Eu.TraitType.EDIBLE)?c.get(Eu.TraitType.EDIBLE).isDrink:!1)?"liquid_sounds":"container_sounds",o=!0):i="no_sound"}else i="no_sound";!o&&!i&&(i="listened_to")}else{r.listeningToEnvironment=!0;let o=t.currentLocation,s=t.world.getContents(o.id).filter(c=>c.has(Eu.TraitType.SWITCHABLE)?c.get(Eu.TraitType.SWITCHABLE).isOn:!1);s.length>0?(r.soundSources=s.map(c=>c.id),n.devices=s.map(c=>c.name).join(", "),i="active_devices"):i="silence",r.roomId=o.id}return{messageId:i,params:n,eventData:r}}__.listeningAction={id:$ne.IFActions.LISTENING,requiredMessages:["not_visible","silence","ambient_sounds","active_devices","no_sound","device_running","device_off","container_sounds","liquid_sounds","listened_to","listened_environment"],group:"sensory",metadata:{requiresDirectObject:!1,requiresIndirectObject:!1,directObjectScope:Kne.ScopeLevel.AWARE},validate(t){return{valid:!0}},execute(t){let e=Qne(t),r=FV(t);r.messageId=e.messageId,r.params=e.params,r.eventData=e.eventData},blocked(t,e){let r=t.command.directObject?.entity;return[t.event("if.event.listen_blocked",{blocked:!0,messageId:`${t.action.id}.${e.error}`,params:{...e.params,target:r?.name},reason:e.error,targetId:r?.id,targetName:r?.name})]},report(t){let e=[],r=FV(t);return e.push(t.event("if.event.listened",{messageId:`${t.action.id}.${r.messageId||"silence"}`,params:r.params,...r.eventData})),e}}});var YV=p(VV=>{"use strict";Object.defineProperty(VV,"__esModule",{value:!0})});var BD=p(ts=>{"use strict";var Xne=ts&&ts.__createBinding||(Object.create?(function(t,e,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}):(function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]})),Zne=ts&&ts.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&Xne(e,t,r)};Object.defineProperty(ts,"__esModule",{value:!0});ts.listeningAction=void 0;var Jne=GV();Object.defineProperty(ts,"listeningAction",{enumerable:!0,get:function(){return Jne.listeningAction}});Zne(YV(),ts)});var $V=p(b_=>{"use strict";Object.defineProperty(b_,"__esModule",{value:!0});b_.smellingAction=void 0;var to=b(),eie=ce(),tie=Ce();function zV(t){return t.sharedData}function rie(t){let e=t.command.directObject?.entity,r={},n={},i="no_particular_scent",o=!1;if(e){if(r.target=e.id,n.target=e.name,e.has(to.TraitType.EDIBLE))o=!0,r.hasScent=!0,e.get(to.TraitType.EDIBLE).isDrink?(r.scentType="drinkable",i="drink_scent"):(r.scentType="edible",i="food_scent");else if(e.has(to.TraitType.LIGHT_SOURCE))e.get(to.TraitType.LIGHT_SOURCE).isLit&&(o=!0,r.hasScent=!0,r.scentType="burning",i="burning_scent");else if(e.has(to.TraitType.CONTAINER)&&e.has(to.TraitType.OPENABLE)&&e.get(to.TraitType.OPENABLE).isOpen){let c=t.world.getContents(e.id).filter(l=>l.has(to.TraitType.EDIBLE));c.length>0&&(o=!0,r.hasScent=!0,r.scentType="container_contents",r.scentSources=c.map(l=>l.id),i="container_food_scent")}o||(i="no_particular_scent")}else{r.smellingEnvironment=!0;let a=t.currentLocation,s=t.world.getContents(a.id),c=[],l=!1,u=!1;s.forEach(m=>{m.has(to.TraitType.EDIBLE)&&(c.push(m.id),l=!0),m.has(to.TraitType.LIGHT_SOURCE)&&m.get(to.TraitType.LIGHT_SOURCE).isLit&&(c.push(m.id),u=!0)}),c.length>0&&(r.scentSources=c),u?i="smoke_detected":l?i="food_nearby":c.length>0?i="room_scents":i="no_scent",r.roomId=a.id}return{messageId:i,eventData:r,params:n,hasScent:o}}b_.smellingAction={id:eie.IFActions.SMELLING,requiredMessages:["not_visible","too_far","no_scent","room_scents","food_nearby","smoke_detected","no_particular_scent","food_scent","drink_scent","burning_scent","container_food_scent","musty_scent","fresh_scent","smelled","smelled_environment"],metadata:{requiresDirectObject:!0,requiresIndirectObject:!1,directObjectScope:tie.ScopeLevel.AWARE},validate(t){let e=t.player,r=t.command.directObject?.entity;if(r){let n=t.world.getContainingRoom(r.id),i=t.world.getContainingRoom(e.id);if(n&&i&&n.id!==i.id)return{valid:!1,error:"too_far",params:{target:r.name}}}return{valid:!0}},execute(t){let e=rie(t),r=zV(t);r.messageId=e.messageId,r.eventData=e.eventData,r.params=e.params},blocked(t,e){let r=t.command.directObject?.entity;return[t.event("if.event.smell_blocked",{blocked:!0,messageId:`${t.action.id}.${e.error}`,params:{...e.params,target:r?.name},reason:e.error,targetId:r?.id,targetName:r?.name})]},report(t){let e=[],r=zV(t);return e.push(t.event("if.event.smelled",{messageId:`${t.action.id}.${r.messageId||"no_scent"}`,params:r.params,...r.eventData})),e},group:"sensory"}});var QV=p(KV=>{"use strict";Object.defineProperty(KV,"__esModule",{value:!0})});var jD=p(rs=>{"use strict";var nie=rs&&rs.__createBinding||(Object.create?(function(t,e,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}):(function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]})),iie=rs&&rs.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&nie(e,t,r)};Object.defineProperty(rs,"__esModule",{value:!0});rs.smellingAction=void 0;var oie=$V();Object.defineProperty(rs,"smellingAction",{enumerable:!0,get:function(){return oie.smellingAction}});iie(QV(),rs)});var ZV=p(O_=>{"use strict";Object.defineProperty(O_,"__esModule",{value:!0});O_.touchingAction=void 0;var xr=b(),aie=ce(),WD=Ce();function XV(t){return t.sharedData}O_.touchingAction={id:aie.IFActions.TOUCHING,defaultScope:{target:WD.ScopeLevel.REACHABLE},requiredMessages:["no_target","not_visible","not_reachable","feels_normal","feels_warm","feels_hot","feels_cold","feels_soft","feels_hard","feels_smooth","feels_rough","feels_wet","device_vibrating","immovable_object","liquid_container","touched","touched_gently","poked","prodded","patted","stroked"],metadata:{requiresDirectObject:!0,requiresIndirectObject:!1,directObjectScope:WD.ScopeLevel.REACHABLE},validate(t){let e=t.command.directObject?.entity;if(!e)return{valid:!1,error:"no_target",params:{}};let r=t.requireScope(e,WD.ScopeLevel.REACHABLE);return r.ok?{valid:!0}:r.error},execute(t){let e=t.command.directObject?.entity,r=XV(t),n={target:e.id,targetName:e.name},i="feels_normal";e.has(xr.TraitType.LIGHT_SOURCE)&&e.get(xr.TraitType.LIGHT_SOURCE).isLit&&(n.temperature="hot",n.isLit=!0,i="feels_hot"),e.has(xr.TraitType.SWITCHABLE)&&i==="feels_normal"&&e.get(xr.TraitType.SWITCHABLE).isOn&&(n.temperature="warm",n.isActive=!0,e.get(xr.TraitType.IDENTITY)?.description?.toLowerCase().includes("vibrat")?i="device_vibrating":i="feels_warm"),e.has(xr.TraitType.WEARABLE)?(n.texture="soft",i==="feels_normal"&&(i="feels_soft")):e.has(xr.TraitType.DOOR)?(n.texture="smooth",n.material="hard",i==="feels_normal"&&(i="feels_smooth")):e.has(xr.TraitType.CONTAINER)||e.has(xr.TraitType.SUPPORTER)?(n.texture="solid",e.has(xr.TraitType.CONTAINER)&&t.world.getContents(e.id).some(c=>c.has(xr.TraitType.EDIBLE)?c.get(xr.TraitType.EDIBLE).isDrink:!1)&&(i="liquid_container"),i==="feels_normal"&&(i="feels_hard")):e.has(xr.TraitType.EDIBLE)&&e.get(xr.TraitType.EDIBLE).isDrink&&(n.texture="liquid",i==="feels_normal"&&(i="feels_wet")),e.has(xr.TraitType.SCENERY)&&(n.immovable=!0,i==="feels_normal"&&(i="immovable_object"));let o=t.command.parsed.structure.verb?.text.toLowerCase()||"touch";if(i==="feels_normal")switch(o){case"poke":i="poked";break;case"prod":i="prodded";break;case"pat":i="patted";break;case"stroke":i="stroked";break;case"feel":i="touched_gently";break;default:i="touched"}r.targetId=e.id,r.targetName=e.name,r.messageId=i,r.eventData=n},blocked(t,e){let r=t.command.directObject?.entity;return[t.event("if.event.touch_blocked",{blocked:!0,messageId:`${t.action.id}.${e.error}`,params:{...e.params,target:r?.name},reason:e.error,targetId:r?.id,targetName:r?.name})]},report(t){let e=[],r=XV(t);return e.push(t.event("if.event.touched",{messageId:`${t.action.id}.${r.messageId||"touched"}`,params:{target:r.targetName},...r.eventData})),e},group:"sensory"}});var eY=p(JV=>{"use strict";Object.defineProperty(JV,"__esModule",{value:!0})});var HD=p(ns=>{"use strict";var sie=ns&&ns.__createBinding||(Object.create?(function(t,e,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}):(function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]})),cie=ns&&ns.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&sie(e,t,r)};Object.defineProperty(ns,"__esModule",{value:!0});ns.touchingAction=void 0;var lie=ZV();Object.defineProperty(ns,"touchingAction",{enumerable:!0,get:function(){return lie.touchingAction}});cie(eY(),ns)});var tY=p(I_=>{"use strict";Object.defineProperty(I_,"__esModule",{value:!0});I_.PuttingMessages=void 0;I_.PuttingMessages={NO_TARGET:"no_target",NO_DESTINATION:"no_destination",NOT_HELD:"not_held",NOT_CONTAINER:"not_container",NOT_SURFACE:"not_surface",CONTAINER_CLOSED:"container_closed",ALREADY_THERE:"already_there",PUT_IN:"put_in",PUT_ON:"put_on",CANT_PUT_IN_ITSELF:"cant_put_in_itself",CANT_PUT_ON_ITSELF:"cant_put_on_itself",NO_ROOM:"no_room",NO_SPACE:"no_space",CANT_PUT:"cant_put",NOTHING_TO_PUT:"nothing_to_put"}});var rY=p(UD=>{"use strict";Object.defineProperty(UD,"__esModule",{value:!0});UD.getPuttingSharedData=uie;function uie(t){return(typeof t.sharedData!="object"||t.sharedData===null)&&(t.sharedData={}),t.sharedData}});var oY=p(A_=>{"use strict";Object.defineProperty(A_,"__esModule",{value:!0});A_.puttingAction=void 0;var S_=Ce(),ro=b(),zc=zo(),die=ce(),Zt=tY(),qD=rY(),nY=xp();function FD(t,e){let r=e.has(ro.TraitType.CONTAINER),n=e.has(ro.TraitType.SUPPORTER);return t?(t==="in"||t==="into"||t==="inside")&&r?{targetPreposition:"in"}:(t==="on"||t==="onto")&&n?{targetPreposition:"on"}:t==="in"||t==="into"||t==="inside"?{targetPreposition:"in",error:Zt.PuttingMessages.NOT_CONTAINER,params:{destination:e.name}}:{targetPreposition:"on",error:Zt.PuttingMessages.NOT_SURFACE,params:{destination:e.name}}:r?{targetPreposition:"in"}:n?{targetPreposition:"on"}:{targetPreposition:"in",error:Zt.PuttingMessages.NOT_CONTAINER,params:{destination:e.name}}}function iY(t,e,r,n){if(e.id===r.id)return{valid:!1,error:n==="on"?Zt.PuttingMessages.CANT_PUT_ON_ITSELF:Zt.PuttingMessages.CANT_PUT_IN_ITSELF,params:{item:e.name}};if(t.world.getLocation(e.id)===r.id){let s=r.has(ro.TraitType.SUPPORTER)?"on":"in";return{valid:!1,error:Zt.PuttingMessages.ALREADY_THERE,params:{item:e.name,relation:s,destination:r.name}}}let{targetPreposition:i,error:o,params:a}=FD(n,r);if(o)return{valid:!1,error:o,params:a};if(i==="in"){if(r.has(ro.TraitType.OPENABLE)&&!ro.OpenableBehavior.isOpen(r))return{valid:!1,error:Zt.PuttingMessages.CONTAINER_CLOSED,params:{container:r.name}};if(!ro.ContainerBehavior.canAccept(r,e,t.world))return{valid:!1,error:Zt.PuttingMessages.NO_ROOM,params:{container:r.name}}}return i==="on"&&!ro.SupporterBehavior.canAccept(r,e,t.world)?{valid:!1,error:Zt.PuttingMessages.NO_SPACE,params:{surface:r.name}}:{valid:!0,targetPreposition:i}}function mie(t){let e=t.command.indirectObject?.entity,r=t.command.parsed.structure.preposition?.text;if(!e)return{valid:!1,error:Zt.PuttingMessages.NO_DESTINATION};let n=(0,nY.expandMultiObject)(t,{scope:"carried"});if(n.length===0)return{valid:!1,error:Zt.PuttingMessages.NOTHING_TO_PUT};let i=n.map(s=>{let c=iY(t,s.entity,e,r);return{entity:s.entity,success:c.valid,error:c.valid?void 0:c.error,errorParams:c.valid?void 0:c.params,targetPreposition:c.targetPreposition}}),o=(0,qD.getPuttingSharedData)(t);return o.multiObjectResults=i,i.some(s=>s.success)?{valid:!0}:{valid:!1,error:i[0].error,params:i[0].errorParams}}function fie(t,e,r,n,i){if(n.targetPreposition=i,i==="in"){let o=ro.ContainerBehavior.addItem(r,e,t.world);n.putResult=o}else{let o=ro.SupporterBehavior.addItem(r,e,t.world);n.putResult=o}t.world.moveEntity(e.id,r.id)}function pie(t,e,r,n,i){if(n.targetPreposition==="in"){let a={item:e.name,container:r.name};i.push(t.event("if.event.put_in",{messageId:`${t.action.id}.${Zt.PuttingMessages.PUT_IN}`,params:a,itemId:e.id,itemName:e.name,targetId:r.id,targetName:r.name,actorId:t.player.id,preposition:"in",itemSnapshot:(0,zc.captureEntitySnapshot)(e,t.world,!0),targetSnapshot:(0,zc.captureEntitySnapshot)(r,t.world,!0)}))}else{let a={item:e.name,surface:r.name};i.push(t.event("if.event.put_on",{messageId:`${t.action.id}.${Zt.PuttingMessages.PUT_ON}`,params:a,itemId:e.id,itemName:e.name,targetId:r.id,targetName:r.name,actorId:t.player.id,preposition:"on",itemSnapshot:(0,zc.captureEntitySnapshot)(e,t.world,!0),targetSnapshot:(0,zc.captureEntitySnapshot)(r,t.world,!0)}))}}function gie(t,e,r,n,i,o){o.push(t.event("if.event.put_blocked",{messageId:`${t.action.id}.${n}`,params:{...i,item:e.name,destination:r.name},itemId:e.id,itemName:e.name,targetId:r.id,targetName:r.name,reason:n}))}A_.puttingAction={id:die.IFActions.PUTTING,defaultScope:{item:S_.ScopeLevel.REACHABLE,target:S_.ScopeLevel.REACHABLE},requiredMessages:["no_target","no_destination","not_held","not_container","not_surface","container_closed","already_there","put_in","put_on","cant_put_in_itself","cant_put_on_itself","no_room","no_space","nothing_to_put"],group:"object_manipulation",metadata:{requiresDirectObject:!0,requiresIndirectObject:!0,directObjectScope:S_.ScopeLevel.REACHABLE,indirectObjectScope:S_.ScopeLevel.REACHABLE},validate(t){if((0,nY.isMultiObjectCommand)(t))return mie(t);let e=t.command.directObject?.entity,r=t.command.indirectObject?.entity,n=t.command.parsed.structure.preposition?.text;if(!e)return{valid:!1,error:Zt.PuttingMessages.NO_TARGET};if(!r)return{valid:!1,error:Zt.PuttingMessages.NO_DESTINATION,params:{item:e.name}};let i=t.requireCarriedOrImplicitTake(e);return i.ok?iY(t,e,r,n):i.error},execute(t){let e=(0,qD.getPuttingSharedData)(t),r=t.command.indirectObject.entity,n=t.command.parsed.structure.preposition?.text;if(e.multiObjectResults){let{targetPreposition:a}=FD(n,r);for(let s of e.multiObjectResults)s.success&&fie(t,s.entity,r,s,a);return}let i=t.command.directObject.entity,{targetPreposition:o}=FD(n,r);if(e.targetPreposition=o,o==="in"){let a=ro.ContainerBehavior.addItem(r,i,t.world);e.putResult=a}else{let a=ro.SupporterBehavior.addItem(r,i,t.world);e.putResult=a}t.world.moveEntity(i.id,r.id)},report(t){let e=(0,qD.getPuttingSharedData)(t),r=t.command.indirectObject.entity,n=[];if(t.sharedData.implicitTakeEvents&&n.push(...t.sharedData.implicitTakeEvents),e.multiObjectResults){for(let a of e.multiObjectResults)a.success?pie(t,a.entity,r,a,n):gie(t,a.entity,r,a.error,a.errorParams,n);return n}let i=t.command.directObject.entity;if(e.targetPreposition==="in"){let a={item:i.name,container:r.name};n.push(t.event("if.event.put_in",{messageId:`${t.action.id}.${Zt.PuttingMessages.PUT_IN}`,params:a,itemId:i.id,itemName:i.name,targetId:r.id,targetName:r.name,actorId:t.player.id,preposition:"in",itemSnapshot:(0,zc.captureEntitySnapshot)(i,t.world,!0),targetSnapshot:(0,zc.captureEntitySnapshot)(r,t.world,!0)}))}else{let a={item:i.name,surface:r.name};n.push(t.event("if.event.put_on",{messageId:`${t.action.id}.${Zt.PuttingMessages.PUT_ON}`,params:a,itemId:i.id,itemName:i.name,targetId:r.id,targetName:r.name,actorId:t.player.id,preposition:"on",itemSnapshot:(0,zc.captureEntitySnapshot)(i,t.world,!0),targetSnapshot:(0,zc.captureEntitySnapshot)(r,t.world,!0)}))}return n},blocked(t,e){let r=t.command.directObject?.entity,n=t.command.indirectObject?.entity;return[t.event("if.event.put_blocked",{messageId:`${t.action.id}.${e.error}`,params:{...e.params,item:r?.name,destination:n?.name},itemId:r?.id,itemName:r?.name,targetId:n?.id,targetName:n?.name,reason:e.error})]}}});var sY=p(aY=>{"use strict";Object.defineProperty(aY,"__esModule",{value:!0})});var R_=p(is=>{"use strict";var hie=is&&is.__createBinding||(Object.create?(function(t,e,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}):(function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]})),yie=is&&is.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&hie(e,t,r)};Object.defineProperty(is,"__esModule",{value:!0});is.puttingAction=void 0;var vie=oY();Object.defineProperty(is,"puttingAction",{enumerable:!0,get:function(){return vie.puttingAction}});yie(sY(),is)});var cY=p(w_=>{"use strict";Object.defineProperty(w_,"__esModule",{value:!0});w_.InsertingMessages=void 0;w_.InsertingMessages={NO_TARGET:"no_target",NO_DESTINATION:"no_destination",NOT_HELD:"not_held",NOT_INSERTABLE:"not_insertable",NOT_CONTAINER:"not_container",ALREADY_THERE:"already_there",INSERTED:"inserted",WONT_FIT:"wont_fit",CONTAINER_CLOSED:"container_closed",CANT_INSERT:"cant_insert",NOTHING_TO_INSERT:"nothing_to_insert"}});var dY=p(N_=>{"use strict";Object.defineProperty(N_,"__esModule",{value:!0});N_.insertingAction=void 0;var C_=Ce(),Eie=ce(),Tu=R_(),lY=HN(),GD=cY();function VD(t){return t.sharedData}function uY(t){return{...t.command,parsed:{...t.command.parsed,structure:{...t.command.parsed.structure,preposition:{tokens:[],text:"in"}},preposition:"in"}}}N_.insertingAction={id:Eie.IFActions.INSERTING,defaultScope:{item:C_.ScopeLevel.REACHABLE,container:C_.ScopeLevel.REACHABLE},requiredMessages:["no_target","no_destination","not_held","not_insertable","not_container","already_there","inserted","wont_fit","container_closed","nothing_to_insert"],group:"object_manipulation",metadata:{requiresDirectObject:!0,requiresIndirectObject:!0,directObjectScope:C_.ScopeLevel.REACHABLE,indirectObjectScope:C_.ScopeLevel.REACHABLE},validate(t){let e=t.command.directObject?.entity,r=t.command.indirectObject?.entity;if(!(t.command.parsed.structure.directObject?.isAll||t.command.parsed.structure.directObject?.isList)&&!e)return{valid:!1,error:GD.InsertingMessages.NO_TARGET};if(!r)return{valid:!1,error:GD.InsertingMessages.NO_DESTINATION,params:{item:e?.name}};let i=uY(t),o=(0,lY.createActionContext)(t.world,t.player,Tu.puttingAction,i),a=VD(t);a.modifiedContext=o;let s=Tu.puttingAction.validate(o);return s.valid?{valid:!0}:s},execute(t){let e=VD(t);if(!e.modifiedContext){let n=uY(t);e.modifiedContext=(0,lY.createActionContext)(t.world,t.player,Tu.puttingAction,n)}Tu.puttingAction.execute(e.modifiedContext)},report(t){let r=VD(t).modifiedContext;if(!r){let n=t.command.directObject?.entity,i=t.command.indirectObject?.entity;return[t.event("if.event.insert_blocked",{messageId:`${t.action.id}.${GD.InsertingMessages.CANT_INSERT}`,params:{item:n?.name,container:i?.name},itemId:n?.id,itemName:n?.name,containerId:i?.id,containerName:i?.name,reason:"cant_insert"})]}return"report"in Tu.puttingAction&&typeof Tu.puttingAction.report=="function"?Tu.puttingAction.report(r):[]},blocked(t,e){let r=t.command.directObject?.entity,n=t.command.indirectObject?.entity;return[t.event("if.event.insert_blocked",{messageId:`${t.action.id}.${e.error}`,params:{...e.params,item:r?.name,container:n?.name},itemId:r?.id,itemName:r?.name,containerId:n?.id,containerName:n?.name,reason:e.error})]}}});var fY=p(mY=>{"use strict";Object.defineProperty(mY,"__esModule",{value:!0})});var YD=p(os=>{"use strict";var Tie=os&&os.__createBinding||(Object.create?(function(t,e,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}):(function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]})),_ie=os&&os.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&Tie(e,t,r)};Object.defineProperty(os,"__esModule",{value:!0});os.insertingAction=void 0;var bie=dY();Object.defineProperty(os,"insertingAction",{enumerable:!0,get:function(){return bie.insertingAction}});_ie(fY(),os)});var pY=p(zD=>{"use strict";Object.defineProperty(zD,"__esModule",{value:!0});zD.createReadingEvent=Oie;function Oie(t){return{id:`${Date.now()}-read`,type:"if.event.read",timestamp:Date.now(),data:{...t},entities:{target:t.targetId}}}});var yY=p(P_=>{"use strict";Object.defineProperty(P_,"__esModule",{value:!0});P_.reading=void 0;var D_=b(),Iie=pY();function gY(t){return t.sharedData}var hY=Ce();P_.reading={id:"if.action.reading",defaultScope:{target:hY.ScopeLevel.REACHABLE},targetRequirements:{trait:D_.TraitType.READABLE,description:"readable"},requiresHolding:!0,validate(t){let{directObject:e}=t.command;if(!e?.entity)return{valid:!1,error:"what_to_read"};let r=e.entity,n=t.requireScope(r,hY.ScopeLevel.VISIBLE);if(!n.ok)return n.error;let i=r.get(D_.TraitType.READABLE);if(!i)return{valid:!1,error:"not_readable",params:{item:String(r.attributes.name||"that")}};if(i.isReadable===!1)return{valid:!1,error:"cannot_read_now",params:{item:String(r.attributes.name||"that"),reason:i.cannotReadMessage||"cannot_read_now"}};if(!r.has(D_.TraitType.SCENERY)){let o=t.requireCarriedOrImplicitTake(r);if(!o.ok)return o.error}return i.requiresAbility&&i.requiredAbility,{valid:!0}},execute(t){let{directObject:e}=t.command,r=e.entity,n=r.get(D_.TraitType.READABLE),i=gY(t);n.hasBeenRead=!0;let o={targetId:r.id,targetName:String(r.attributes.name||"something"),text:n.text,readableType:n.readableType||"text",hasBeenRead:!0};n.pageContent&&n.currentPage&&(o.currentPage=n.currentPage,o.totalPages=n.pages||n.pageContent.length,o.text=n.pageContent[n.currentPage-1]);let a=(0,Iie.createReadingEvent)(o),s="read_text";n.readableType==="book"?s=n.pageContent?"read_book_page":"read_book":n.readableType==="sign"?s="read_sign":n.readableType==="inscription"&&(s="read_inscription");let c={item:String(r.attributes.name||"something"),text:o.text};o.currentPage&&(c.currentPage=o.currentPage,c.totalPages=o.totalPages),i.readEvent=a,i.messageId=s,i.params=c},blocked(t,e){let r=t.command.directObject?.entity;return[t.event("if.event.read",{blocked:!0,messageId:`${t.action.id}.${e.error}`,params:{item:r?.name,...e.params},reason:e.error,targetId:r?.id,targetName:r?.name})]},report(t){let e=gY(t),r=[];t.sharedData.implicitTakeEvents&&r.push(...t.sharedData.implicitTakeEvents);let n=t.command.directObject?.entity;return r.push(t.event("if.event.read",{messageId:`${t.action.id}.${e.messageId||"read_text"}`,params:e.params||{},targetId:n?.id,targetName:String(n?.attributes.name||"something"),text:e.params?.text})),r}}});var $D=p(L_=>{"use strict";Object.defineProperty(L_,"__esModule",{value:!0});L_.reading=void 0;var Sie=yY();Object.defineProperty(L_,"reading",{enumerable:!0,get:function(){return Sie.reading}})});var vY=p(M_=>{"use strict";Object.defineProperty(M_,"__esModule",{value:!0});M_.RemovingMessages=void 0;M_.RemovingMessages={NO_TARGET:"no_target",NO_SOURCE:"no_source",NOT_IN_CONTAINER:"not_in_container",NOT_ON_SURFACE:"not_on_surface",CONTAINER_CLOSED:"container_closed",REMOVED_FROM:"removed_from",REMOVED_FROM_SURFACE:"removed_from_surface",CANT_REACH:"cant_reach",ALREADY_HAVE:"already_have",CANNOT_TAKE:"cannot_take",CANT_REMOVE:"cant_remove",TOO_HEAVY:"too_heavy",CONTAINER_FULL:"container_full",CANT_TAKE:"cant_take",NOTHING_TO_REMOVE:"nothing_to_remove"}});var EY=p(KD=>{"use strict";Object.defineProperty(KD,"__esModule",{value:!0});KD.getRemovingSharedData=Aie;function Aie(t){return(typeof t.sharedData!="object"||t.sharedData===null)&&(t.sharedData={}),t.sharedData}});var OY=p(k_=>{"use strict";Object.defineProperty(k_,"__esModule",{value:!0});k_.removingAction=void 0;var Rm=zo(),Re=b(),Rie=ce(),QD=$o(),Br=vY(),XD=EY(),_Y=xp();function wie(t){return!(t.has(Re.TraitType.ROOM)||t.has(Re.TraitType.SCENERY)||t.has(Re.TraitType.ACTOR))}function TY(t,e){return t.world.getContents(e.id).filter(n=>wie(n))}function bY(t,e,r){let n=t.player;if(Re.ActorBehavior.isHolding(n,e.id,t.world))return{valid:!1,error:Br.RemovingMessages.ALREADY_HAVE,params:{item:e.name}};let i=t.world.getLocation(e.id);return!i||i!==r.id?r.has(Re.TraitType.CONTAINER)?{valid:!1,error:Br.RemovingMessages.NOT_IN_CONTAINER,params:{item:e.name,container:r.name}}:r.has(Re.TraitType.SUPPORTER)?{valid:!1,error:Br.RemovingMessages.NOT_ON_SURFACE,params:{item:e.name,surface:r.name}}:{valid:!1,error:Br.RemovingMessages.NOT_IN_CONTAINER,params:{item:e.name,container:r.name}}:r.has(Re.TraitType.CONTAINER)&&r.has(Re.TraitType.OPENABLE)&&!Re.OpenableBehavior.isOpen(r)?{valid:!1,error:Br.RemovingMessages.CONTAINER_CLOSED,params:{container:r.name}}:Re.ActorBehavior.canTakeItem(n,e,t.world)?{valid:!0}:{valid:!1,error:Br.RemovingMessages.CANNOT_TAKE,params:{item:e.name}}}function Cie(t){let e=t.command.indirectObject?.entity;if(!e)return{valid:!1,error:Br.RemovingMessages.NO_SOURCE};if(e.has(Re.TraitType.CONTAINER)&&e.has(Re.TraitType.OPENABLE)&&!Re.OpenableBehavior.isOpen(e))return{valid:!1,error:Br.RemovingMessages.CONTAINER_CLOSED,params:{container:e.name}};let r=t.command.parsed.structure.directObject,n;if(r?.isAll){n=TY(t,e);let s=(0,_Y.getExcludedNames)(t);s.length>0&&(n=n.filter(c=>{let l=c.name.toLowerCase();return!s.includes(l)}))}else if(r?.isList&&r.items){let s=TY(t,e);n=[];for(let c of r.items){let l=(c.head||c.text).toLowerCase(),u=s.find(m=>m.name.toLowerCase()===l);u&&n.push(u)}}else n=[];if(n.length===0)return{valid:!1,error:Br.RemovingMessages.NOTHING_TO_REMOVE};let i=n.map(s=>{let c=bY(t,s,e);return{entity:s,success:c.valid,error:c.valid?void 0:c.error,errorParams:c.valid?void 0:c.params}}),o=(0,XD.getRemovingSharedData)(t);return o.multiObjectResults=i,i.some(s=>s.success)?{valid:!0}:{valid:!1,error:i[0].error,params:i[0].errorParams}}function Nie(t,e,r,n){let i=t.player,o=null;r.has(Re.TraitType.CONTAINER)?o=Re.ContainerBehavior.removeItem(r,e,t.world):r.has(Re.TraitType.SUPPORTER)&&(o=Re.SupporterBehavior.removeItem(r,e,t.world)),n.removeResult=o;let a=Re.ActorBehavior.takeItem(i,e,t.world);n.takeResult=a,t.world.moveEntity(e.id,i.id)}function Die(t,e,r,n,i){let o=t.player,a={item:e.name},s;r.has(Re.TraitType.CONTAINER)?(a.container=r.name,s=Br.RemovingMessages.REMOVED_FROM):(a.surface=r.name,s=Br.RemovingMessages.REMOVED_FROM_SURFACE),i.push(t.event("if.event.taken",{messageId:`${t.action.id}.${s}`,params:a,item:e.name,itemId:e.id,actorId:o.id,fromLocation:r.id,container:r.name,fromContainer:r.has(Re.TraitType.CONTAINER),fromSupporter:r.has(Re.TraitType.SUPPORTER)&&!r.has(Re.TraitType.CONTAINER),itemSnapshot:(0,Rm.captureEntitySnapshot)(e,t.world,!0),actorSnapshot:(0,Rm.captureEntitySnapshot)(o,t.world,!1),sourceSnapshot:(0,Rm.captureEntitySnapshot)(r,t.world,r.has(Re.TraitType.ROOM))}))}function Pie(t,e,r,n,i,o){o.push(t.event("if.event.remove_blocked",{messageId:`${t.action.id}.${n}`,params:{...i,item:e.name,source:r.name},itemId:e.id,itemName:e.name,sourceId:r.id,sourceName:r.name,reason:n}))}k_.removingAction={id:Rie.IFActions.REMOVING,defaultScope:{item:QD.ScopeLevel.REACHABLE,source:QD.ScopeLevel.REACHABLE},requiredMessages:["no_target","no_source","not_in_container","not_on_surface","container_closed","removed_from","removed_from_surface","cant_reach","already_have","nothing_to_remove"],group:"object_manipulation",metadata:{requiresDirectObject:!0,requiresIndirectObject:!0,directObjectScope:QD.ScopeLevel.REACHABLE},validate(t){if((0,_Y.isMultiObjectCommand)(t))return Cie(t);let e=t.command.directObject?.entity,r=t.command.indirectObject?.entity;return e?r?bY(t,e,r):{valid:!1,error:Br.RemovingMessages.NO_SOURCE,params:{item:e.name}}:{valid:!1,error:Br.RemovingMessages.NO_TARGET,params:{}}},execute(t){let e=(0,XD.getRemovingSharedData)(t),r=t.command.indirectObject.entity;if(e.multiObjectResults){for(let s of e.multiObjectResults)s.success&&Nie(t,s.entity,r,s);return}let n=t.player,i=t.command.directObject.entity,o=null;r.has(Re.TraitType.CONTAINER)?o=Re.ContainerBehavior.removeItem(r,i,t.world):r.has(Re.TraitType.SUPPORTER)&&(o=Re.SupporterBehavior.removeItem(r,i,t.world)),e.removeResult=o;let a=Re.ActorBehavior.takeItem(n,i,t.world);e.takeResult=a,t.world.moveEntity(i.id,n.id)},report(t){let e=(0,XD.getRemovingSharedData)(t),r=t.command.indirectObject.entity;if(e.multiObjectResults){let s=[];for(let c of e.multiObjectResults)c.success?Die(t,c.entity,r,c,s):Pie(t,c.entity,r,c.error,c.errorParams,s);return s}let n=t.player,i=t.command.directObject.entity,o={item:i.name},a;return r.has(Re.TraitType.CONTAINER)?(o.container=r.name,a=Br.RemovingMessages.REMOVED_FROM):(o.surface=r.name,a=Br.RemovingMessages.REMOVED_FROM_SURFACE),[t.event("if.event.taken",{messageId:`${t.action.id}.${a}`,params:o,item:i.name,itemId:i.id,actorId:n.id,fromLocation:r.id,container:r.name,fromContainer:r.has(Re.TraitType.CONTAINER),fromSupporter:r.has(Re.TraitType.SUPPORTER)&&!r.has(Re.TraitType.CONTAINER),itemSnapshot:(0,Rm.captureEntitySnapshot)(i,t.world,!0),actorSnapshot:(0,Rm.captureEntitySnapshot)(n,t.world,!1),sourceSnapshot:(0,Rm.captureEntitySnapshot)(r,t.world,r.has(Re.TraitType.ROOM))})]},blocked(t,e){let r=t.command.directObject?.entity,n=t.command.indirectObject?.entity;return[t.event("if.event.remove_blocked",{messageId:`${t.action.id}.${e.error}`,params:{...e.params,item:r?.name,source:n?.name},itemId:r?.id,itemName:r?.name,sourceId:n?.id,sourceName:n?.name,reason:e.error})]}}});var ZD=p(x_=>{"use strict";Object.defineProperty(x_,"__esModule",{value:!0});x_.removingAction=void 0;var Lie=OY();Object.defineProperty(x_,"removingAction",{enumerable:!0,get:function(){return Lie.removingAction}})});var SY=p(j_=>{"use strict";Object.defineProperty(j_,"__esModule",{value:!0});j_.givingAction=void 0;var B_=Ce(),Fp=b(),Mie=ce();function IY(t){return t.sharedData}j_.givingAction={id:Mie.IFActions.GIVING,defaultScope:{item:B_.ScopeLevel.REACHABLE,recipient:B_.ScopeLevel.REACHABLE},requiredMessages:["no_item","no_recipient","not_holding","recipient_not_visible","recipient_not_reachable","not_actor","self","inventory_full","too_heavy","not_interested","refuses","given","accepts","gratefully_accepts","reluctantly_accepts"],metadata:{requiresDirectObject:!0,requiresIndirectObject:!0,directObjectScope:B_.ScopeLevel.REACHABLE,indirectObjectScope:B_.ScopeLevel.REACHABLE},validate(t){let e=t.player,r=t.command.directObject?.entity,n=t.command.indirectObject?.entity;if(!r)return{valid:!1,error:"no_item",params:{}};if(!n)return{valid:!1,error:"no_recipient",params:{}};let i=t.requireCarriedOrImplicitTake(r);if(!i.ok)return i.error;if(!n.has(Fp.TraitType.ACTOR))return{valid:!1,error:"not_actor",params:{recipient:n.name}};if(n.id===e.id)return{valid:!1,error:"self",params:{item:r.name}};let o=n.get(Fp.TraitType.ACTOR);if(o){let s=o.capacity||o.inventoryLimit;if(s){let c=t.world.getContents(n.id);if(s.maxItems!==void 0&&c.length>=s.maxItems)return{valid:!1,error:"inventory_full",params:{recipient:n.name}};if(s.maxWeight!==void 0){let l=c.reduce((m,f)=>m+Fp.IdentityBehavior.getWeight(f),0),u=Fp.IdentityBehavior.getWeight(r);if(l+u>s.maxWeight)return{valid:!1,error:"too_heavy",params:{item:r.name,recipient:n.name}}}}}let a=o?.preferences;if(a){let s=r.name.toLowerCase();if(a.refuses&&Array.isArray(a.refuses)){for(let c of a.refuses)if(s.includes(c.toLowerCase()))return{valid:!1,error:"not_interested",params:{item:r.name,recipient:n.name}}}}return{valid:!0}},execute(t){let e=t.command.directObject.entity,r=t.command.indirectObject.entity,n=IY(t);n.itemId=e.id,n.itemName=e.name,n.recipientId=r.id,n.recipientName=r.name,t.world.moveEntity(e.id,r.id);let i="normal",a=r.get(Fp.TraitType.ACTOR)?.preferences;if(a){let s=e.name.toLowerCase();if(a.likes&&Array.isArray(a.likes)){for(let c of a.likes)if(s.includes(c.toLowerCase())){i="grateful";break}}if(i==="normal"&&a.dislikes&&Array.isArray(a.dislikes)){for(let c of a.dislikes)if(s.includes(c.toLowerCase())){i="reluctant";break}}}switch(n.acceptanceType=i,i){case"grateful":n.messageId="gratefully_accepts";break;case"reluctant":n.messageId="reluctantly_accepts";break;default:n.messageId="given"}n.params={item:e.name,recipient:r.name}},blocked(t,e){let r=t.command.directObject?.entity,n=t.command.indirectObject?.entity;return[t.event("if.event.give_blocked",{blocked:!0,messageId:`${t.action.id}.${e.error}`,params:{...e.params,item:r?.name,recipient:n?.name},reason:e.error,itemId:r?.id,itemName:r?.name,recipientId:n?.id,recipientName:n?.name})]},report(t){let e=IY(t),r=[];return t.sharedData.implicitTakeEvents&&r.push(...t.sharedData.implicitTakeEvents),r.push(t.event("if.event.given",{messageId:`${t.action.id}.${e.messageId}`,params:e.params,item:e.itemId,itemName:e.itemName,recipient:e.recipientId,recipientName:e.recipientName,accepted:!0})),r},group:"social"}});var RY=p(AY=>{"use strict";Object.defineProperty(AY,"__esModule",{value:!0})});var JD=p(as=>{"use strict";var kie=as&&as.__createBinding||(Object.create?(function(t,e,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}):(function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]})),xie=as&&as.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&kie(e,t,r)};Object.defineProperty(as,"__esModule",{value:!0});as.givingAction=void 0;var Bie=SY();Object.defineProperty(as,"givingAction",{enumerable:!0,get:function(){return Bie.givingAction}});xie(RY(),as)});var CY=p(H_=>{"use strict";Object.defineProperty(H_,"__esModule",{value:!0});H_.showingAction=void 0;var W_=Ce(),wm=b(),jie=ce();function wY(t){return t.sharedData}function Wie(t){let e=t.command.directObject?.entity,r=t.command.indirectObject?.entity;if(!e||!r)return null;let i=(e.has(wm.TraitType.WEARABLE)?e.get(wm.TraitType.WEARABLE):null)?.worn===!0,o={item:e.id,itemName:e.name,viewer:r.id,viewerName:r.name,isWorn:i},a={item:e.name,viewer:r.name},s="shown";if(e.has(wm.TraitType.IDENTITY)){let l=e.get(wm.TraitType.IDENTITY);l.properName&&l.name&&(o.itemProperName=l.name)}let c=r.get(wm.TraitType.ACTOR);if(c&&c.reactions){let l=c.reactions,u=e.name.toLowerCase();l.recognizes&&l.recognizes.some(m=>u.includes(m))?(s="viewer_recognizes",o.recognized=!0):l.impressed&&l.impressed.some(m=>u.includes(m))?(s="viewer_impressed",o.impressed=!0):l.unimpressed&&l.unimpressed.some(m=>u.includes(m))?s="viewer_unimpressed":l.examines&&l.examines.some(m=>u.includes(m))?s="viewer_examines":s="viewer_nods"}return i&&s==="shown"&&(s="wearing_shown"),{item:e,viewer:r,isWearing:i,messageId:s,eventData:o,params:a}}H_.showingAction={id:jie.IFActions.SHOWING,defaultScope:{item:W_.ScopeLevel.REACHABLE,viewer:W_.ScopeLevel.VISIBLE},requiredMessages:["no_item","no_viewer","not_carrying","viewer_not_visible","viewer_too_far","not_actor","self","shown","viewer_examines","viewer_nods","viewer_impressed","viewer_unimpressed","viewer_recognizes","wearing_shown"],metadata:{requiresDirectObject:!0,requiresIndirectObject:!0,directObjectScope:W_.ScopeLevel.REACHABLE,indirectObjectScope:W_.ScopeLevel.VISIBLE},validate(t){let e=t.player,r=t.command.directObject?.entity,n=t.command.indirectObject?.entity;if(!r)return{valid:!1,error:"no_item",params:{}};if(!n)return{valid:!1,error:"no_viewer",params:{}};let i=t.requireCarriedOrImplicitTake(r);if(!i.ok)return i.error;let o=t.world.getLocation?.(n.id),a=t.world.getLocation?.(e.id);return o!==a?{valid:!1,error:"viewer_too_far",params:{viewer:n.name}}:n.has(wm.TraitType.ACTOR)?n.id===e.id?{valid:!1,error:"self",params:{item:r.name}}:{valid:!0}:{valid:!1,error:"not_actor"}},execute(t){let e=Wie(t),r=wY(t);e&&(r.messageId=e.messageId,r.eventData=e.eventData,r.params=e.params)},blocked(t,e){let r=t.command.directObject?.entity,n=t.command.indirectObject?.entity;return[t.event("if.event.show_blocked",{blocked:!0,messageId:`${t.action.id}.${e.error}`,params:{...e.params,item:r?.name,viewer:n?.name},reason:e.error,itemId:r?.id,itemName:r?.name,viewerId:n?.id,viewerName:n?.name})]},report(t){let e=[],r=wY(t);return t.sharedData.implicitTakeEvents&&e.push(...t.sharedData.implicitTakeEvents),e.push(t.event("if.event.shown",{messageId:`${t.action.id}.${r.messageId||"shown"}`,params:r.params,...r.eventData})),e},group:"social"}});var DY=p(NY=>{"use strict";Object.defineProperty(NY,"__esModule",{value:!0})});var eP=p(ss=>{"use strict";var Hie=ss&&ss.__createBinding||(Object.create?(function(t,e,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}):(function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]})),Uie=ss&&ss.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&Hie(e,t,r)};Object.defineProperty(ss,"__esModule",{value:!0});ss.showingAction=void 0;var qie=CY();Object.defineProperty(ss,"showingAction",{enumerable:!0,get:function(){return qie.showingAction}});Uie(DY(),ss)});var MY=p(q_=>{"use strict";Object.defineProperty(q_,"__esModule",{value:!0});q_.throwingAction=void 0;var ve=b(),Fie=ce(),U_=Ce();function PY(t){return t&&{north:ve.Direction.NORTH,south:ve.Direction.SOUTH,east:ve.Direction.EAST,west:ve.Direction.WEST,northeast:ve.Direction.NORTHEAST,northwest:ve.Direction.NORTHWEST,southeast:ve.Direction.SOUTHEAST,southwest:ve.Direction.SOUTHWEST,up:ve.Direction.UP,down:ve.Direction.DOWN,in:ve.Direction.IN,out:ve.Direction.OUT,n:ve.Direction.NORTH,s:ve.Direction.SOUTH,e:ve.Direction.EAST,w:ve.Direction.WEST,ne:ve.Direction.NORTHEAST,nw:ve.Direction.NORTHWEST,se:ve.Direction.SOUTHEAST,sw:ve.Direction.SOUTHWEST,u:ve.Direction.UP,d:ve.Direction.DOWN}[t.toLowerCase()]||null}function LY(t){return t.sharedData}q_.throwingAction={id:Fie.IFActions.THROWING,defaultScope:{item:U_.ScopeLevel.REACHABLE,target:U_.ScopeLevel.VISIBLE},requiredMessages:["no_item","not_holding","target_not_visible","target_not_here","no_exit","too_heavy","self","thrown","thrown_down","thrown_gently","thrown_at","hits_target","misses_target","bounces_off","lands_on","lands_in","thrown_direction","sails_through","breaks_on_impact","breaks_against","fragile_breaks","target_ducks","target_catches","target_angry"],metadata:{requiresDirectObject:!0,requiresIndirectObject:!0,directObjectScope:U_.ScopeLevel.REACHABLE,indirectObjectScope:U_.ScopeLevel.VISIBLE},validate(t){let e=t.player,r=t.command.directObject?.entity,n=t.command.indirectObject?.entity,i=t.command.parsed.extras?.direction;if(!r)return{valid:!1,error:"no_item"};let o=t.requireCarriedOrImplicitTake(r);if(!o.ok)return o.error;if(n){let a=t.world.getLocation?.(n.id),s=t.world.getLocation?.(e.id);if(a!==s)return{valid:!1,error:"target_not_here",params:{target:n.name}};if(n.id===e.id)return{valid:!1,error:"self"}}else if(i){let a=PY(i);if(!a)return{valid:!1,error:"no_exit"};let s=t.currentLocation;if(s.has(ve.TraitType.ROOM)&&!ve.RoomBehavior.getExit(s,a))return{valid:!1,error:"no_exit",params:{direction:a}}}if(n||i){let a=ve.IdentityBehavior.getWeight(r);if(a>10)return{valid:!1,error:"too_heavy",params:{item:r.name,weight:a}}}return{valid:!0}},execute(t){let e=t.player,r=t.command.directObject.entity,n=t.command.indirectObject?.entity,i=t.command.parsed.extras?.direction,o=LY(t);o.itemId=r.id,o.itemName=r.name;let a=PY(i);n?(o.throwType="at_target",o.targetId=n.id,o.targetName=n.name):a?(o.throwType="directional",o.direction=a):o.throwType="general",o.weight=ve.IdentityBehavior.getWeight(r);let s=r.name.toLowerCase(),l=(r.get(ve.TraitType.IDENTITY)?.description||"").toLowerCase(),u=["glass","crystal","delicate","fragile","bottle","vase","china","porcelain"];o.isFragile=u.some(f=>s.includes(f)||l.includes(f)),o.params={item:r.name};let m=t.world.getLocation?.(e.id)||"";if(o.willBreak=!1,o.messageId="thrown",o.throwType==="at_target"&&n){o.params.target=n.name;let f=!1;if(n.has(ve.TraitType.ACTOR)){f=Math.random()>.3;let g=ve.ActorBehavior.getCustomProperty(n,"agility"),h=ve.ActorBehavior.getCustomProperty(n,"canCatch");!f&&g>5?(o.targetDucked=!0,o.messageId="target_ducks"):h&&Math.random()>.7&&(o.targetCaught=!0,f=!1,m=n.id,o.messageId="target_catches")}else f=Math.random()>.1;o.hit=f,f?(o.messageId="hits_target",o.targetAngry=n.has(ve.TraitType.ACTOR),o.isFragile&&(o.willBreak=Math.random()>.2,o.willBreak&&(o.messageId="breaks_against")),o.willBreak||(n.has(ve.TraitType.SUPPORTER)?(m=n.id,o.messageId="lands_on"):n.has(ve.TraitType.CONTAINER)&&(n.has(ve.TraitType.OPENABLE)?ve.OpenableBehavior.isOpen(n)?(m=n.id,o.messageId="lands_in"):o.messageId="bounces_off":(m=n.id,o.messageId="lands_in")))):!o.targetDucked&&!o.targetCaught&&(o.messageId="misses_target")}else if(o.throwType==="directional"&&a){o.params.direction=a;let f=t.currentLocation;if(f.has(ve.TraitType.ROOM)){let g=ve.RoomBehavior.getExit(f,a);g?(m=g.destination,o.messageId="sails_through",o.isFragile&&(o.willBreak=Math.random()>.5,o.willBreak&&(o.messageId="breaks_on_impact"))):o.messageId="thrown_direction"}}else o.isFragile?(o.willBreak=Math.random()>.7,o.willBreak?o.messageId="fragile_breaks":o.messageId="thrown_gently"):o.messageId="thrown_down";o.finalLocation=o.willBreak?null:m,o.finalLocation?t.world.moveEntity(r.id,o.finalLocation):o.willBreak&&t.world.moveEntity(r.id,"")},blocked(t,e){let r=t.command.directObject?.entity,n=t.command.indirectObject?.entity;return[t.event("if.event.throw_blocked",{blocked:!0,messageId:`${t.action.id}.${e.error}`,params:{...e.params,item:r?.name,target:n?.name},reason:e.error,itemId:r?.id,itemName:r?.name,targetId:n?.id,targetName:n?.name})]},report(t){let e=LY(t),r=[];t.sharedData.implicitTakeEvents&&r.push(...t.sharedData.implicitTakeEvents);let n={messageId:`${t.action.id}.${e.messageId}`,params:e.params,item:e.itemId,itemName:e.itemName,throwType:e.throwType,isFragile:e.isFragile,weight:e.weight,willBreak:e.willBreak,finalLocation:e.finalLocation};if(e.targetId&&(n.target=e.targetId,n.targetName=e.targetName,n.hit=e.hit),e.direction&&(n.direction=e.direction),r.push(t.event("if.event.thrown",n)),e.willBreak){let i={item:e.itemId,itemName:e.itemName,cause:"thrown"};r.push(t.event("if.event.item_destroyed",i))}return e.hit&&e.targetAngry&&r.push(t.event("if.event.thrown",{messageId:`${t.action.id}.target_angry`,params:e.params,item:e.itemId,itemName:e.itemName,target:e.targetId,targetName:e.targetName})),r},group:"interaction"}});var tP=p(F_=>{"use strict";Object.defineProperty(F_,"__esModule",{value:!0});F_.throwingAction=void 0;var Gie=MY();Object.defineProperty(F_,"throwingAction",{enumerable:!0,get:function(){return Gie.throwingAction}})});var xY=p(G_=>{"use strict";Object.defineProperty(G_,"__esModule",{value:!0});G_.pushingAction=void 0;var $c=b(),Vie=ce(),rP=Ce();function kY(t){return t.sharedData}G_.pushingAction={id:Vie.IFActions.PUSHING,defaultScope:{target:rP.ScopeLevel.REACHABLE},requiredMessages:["no_target","not_visible","not_reachable","too_heavy","wearing_it","button_pushed","button_clicks","switch_toggled","pushed_direction","pushed_nudged","pushed_with_effort","reveals_passage","wont_budge","pushing_does_nothing","fixed_in_place"],metadata:{requiresDirectObject:!0,requiresIndirectObject:!1,directObjectScope:rP.ScopeLevel.REACHABLE},validate(t){let e=t.player,r=t.command.directObject?.entity;if(!r)return{valid:!1,error:"no_target"};let n=t.requireScope(r,rP.ScopeLevel.REACHABLE);return n.ok?r.has($c.TraitType.WEARABLE)&&t.world.getLocation(r.id)===e.id?{valid:!1,error:"wearing_it"}:r.has($c.TraitType.PUSHABLE)?{valid:!0}:r.has($c.TraitType.SCENERY)?{valid:!1,error:"fixed_in_place"}:{valid:!1,error:"pushing_does_nothing"}:n.error},execute(t){let e=t.command.directObject.entity,r=t.command.parsed.extras?.direction,n=kY(t);n.targetId=e.id,n.targetName=e.name,n.direction=r,n.messageParams={};let i=e.get($c.TraitType.PUSHABLE);switch(n.pushType=i.pushType,i.pushType){case"button":if(n.activated=!0,e.has($c.TraitType.SWITCHABLE)){let o=e.get($c.TraitType.SWITCHABLE);n.willToggle=!0,n.currentState=o.isOn,n.newState=!o.isOn,$c.SwitchableBehavior.toggle(e),e.has($c.TraitType.BUTTON)?n.messageId="button_clicks":n.messageId="switch_toggled",n.messageParams.target=e.name,n.messageParams.newState=n.newState?"on":"off"}else n.messageId="button_pushed",n.messageParams.target=e.name;i.pushSound&&(n.sound=i.pushSound);break;case"heavy":i.requiresStrength&&(n.requiresStrength=i.requiresStrength),r?(n.moved=!0,n.moveDirection=r,n.messageId="pushed_with_effort",n.messageParams.target=e.name,n.messageParams.direction=r):(n.moved=!1,n.nudged=!0,n.messageId="wont_budge",n.messageParams.target=e.name);break;case"moveable":r?(n.moved=!0,n.moveDirection=r,i.revealsPassage?(n.revealsPassage=!0,n.messageId="reveals_passage"):n.messageId="pushed_direction",n.messageParams.target=e.name,n.messageParams.direction=r):(n.moved=!1,n.nudged=!0,n.messageId="pushed_nudged",n.messageParams.target=e.name),i.pushSound&&(n.sound=i.pushSound);break;default:n.messageId="pushing_does_nothing",n.messageParams.target=e.name;break}},blocked(t,e){let r=t.command.directObject?.entity;return[t.event("if.event.pushed",{blocked:!0,messageId:`${t.action.id}.${e.error}`,params:{target:r?.name,...e.params},reason:e.error,targetId:r?.id,targetName:r?.name})]},report(t){let e=[],r=kY(t);return e.push(t.event("if.event.pushed",{messageId:`${t.action.id}.${r.messageId}`,params:r.messageParams,target:r.targetId,targetName:r.targetName,direction:r.direction,pushType:r.pushType,activated:r.activated,willToggle:r.willToggle,currentState:r.currentState,newState:r.newState,sound:r.sound,moved:r.moved,moveDirection:r.moveDirection,nudged:r.nudged,revealsPassage:r.revealsPassage,requiresStrength:r.requiresStrength})),e},group:"device_manipulation"}});var jY=p(BY=>{"use strict";Object.defineProperty(BY,"__esModule",{value:!0})});var nP=p(cs=>{"use strict";var Yie=cs&&cs.__createBinding||(Object.create?(function(t,e,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}):(function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]})),zie=cs&&cs.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&Yie(e,t,r)};Object.defineProperty(cs,"__esModule",{value:!0});cs.pushingAction=void 0;var $ie=xY();Object.defineProperty(cs,"pushingAction",{enumerable:!0,get:function(){return $ie.pushingAction}});zie(jY(),cs)});var HY=p(V_=>{"use strict";Object.defineProperty(V_,"__esModule",{value:!0});V_.pullingAction=void 0;var Gp=b(),Kie=ce(),iP=Ce();function WY(t){return t.sharedData}V_.pullingAction={id:Kie.IFActions.PULLING,defaultScope:{target:iP.ScopeLevel.REACHABLE},group:"interaction",metadata:{requiresDirectObject:!0,requiresIndirectObject:!1,directObjectScope:iP.ScopeLevel.REACHABLE},requiredMessages:["no_target","not_visible","not_reachable","cant_pull_that","worn","pulled","nothing_happens","already_pulled"],validate(t){let e=t.command.directObject?.entity;if(!e)return{valid:!1,error:"no_target"};let r=t.requireScope(e,iP.ScopeLevel.REACHABLE);return r.ok?e.has(Gp.TraitType.PULLABLE)?e.has(Gp.TraitType.WEARABLE)&&e.get(Gp.TraitType.WEARABLE)?.isWorn?{valid:!1,error:"worn",params:{target:e.name}}:e.get(Gp.TraitType.PULLABLE).state==="pulled"?{valid:!1,error:"already_pulled",params:{target:e.name}}:{valid:!0}:{valid:!1,error:"cant_pull_that",params:{target:e.name}}:r.error},execute(t){let e=t.command.directObject.entity,r=e.get(Gp.TraitType.PULLABLE),n=WY(t);n.targetId=e.id,n.targetName=e.name,n.pullCount=r.pullCount||0,n.pullType=r.pullType,r.state="pulled",r.pullCount=(r.pullCount||0)+1},blocked(t,e){let r=t.command.directObject?.entity;return[t.event("if.event.pulled",{blocked:!0,messageId:`${t.action.id}.${e.error}`,params:{target:r?.name,...e.params},reason:e.error,targetId:r?.id,targetName:r?.name})]},report(t){let e=[],r=WY(t);return e.push(t.event("if.event.pulled",{messageId:`${t.action.id}.pulled`,params:{target:r.targetName},target:r.targetId,targetName:r.targetName,pullCount:r.pullCount,pullType:r.pullType})),e}}});var qY=p(UY=>{"use strict";Object.defineProperty(UY,"__esModule",{value:!0})});var oP=p(ls=>{"use strict";var Qie=ls&&ls.__createBinding||(Object.create?(function(t,e,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}):(function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]})),Xie=ls&&ls.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&Qie(e,t,r)};Object.defineProperty(ls,"__esModule",{value:!0});ls.pullingAction=void 0;var Zie=HY();Object.defineProperty(ls,"pullingAction",{enumerable:!0,get:function(){return Zie.pullingAction}});Xie(qY(),ls)});var sP=p(aP=>{"use strict";Object.defineProperty(aP,"__esModule",{value:!0});aP.createCapabilityDispatchAction=eoe;var FY=b(),Jie=Ce();function GY(t,e){return t.map(r=>e.event(r.type,r.payload))}function eoe(t){return{id:t.actionId,group:t.group,metadata:{requiresDirectObject:!0,requiresIndirectObject:!1,directObjectScope:t.scope??Jie.ScopeLevel.REACHABLE},requiredMessages:["no_target","cant_do_that"],validate(e){let r=e.command.directObject?.entity;if(!r)return{valid:!1,error:t.noTargetError};let n=(0,FY.findTraitWithCapability)(r,t.actionId);if(!n)return{valid:!1,error:t.cantDoThatError,params:{target:r.name}};let i=(0,FY.getBehaviorForCapability)(n,t.actionId);if(!i)return console.warn(`Capability dispatch: trait "${n.type}" claims "${t.actionId}" but no behavior registered`),{valid:!1,error:t.cantDoThatError,params:{target:r.name}};let o={},a=i.validate(r,e.world,e.player.id,o);return a.valid?{valid:!0,data:{trait:n,behavior:i,entityId:r.id,entityName:r.name,sharedData:o}}:{valid:!1,error:a.error,params:a.params}},execute(e){let r=e.validationResult?.data,n=e.command.directObject?.entity;!n||!r?.behavior||r.behavior.execute(n,e.world,e.player.id,r.sharedData)},blocked(e,r){let n=e.validationResult?.data??r.data,i=e.command.directObject?.entity;if(i&&n?.behavior){let o=n.behavior.blocked(i,e.world,e.player.id,r.error||t.cantDoThatError,n.sharedData);return GY(o,e)}return[e.event("if.event.capability_blocked",{blocked:!0,messageId:r.error||t.cantDoThatError,actionId:t.actionId,reason:r.error||t.cantDoThatError,targetId:i?.id,targetName:i?.name,...r.params})]},report(e){let r=e.validationResult?.data,n=e.command.directObject?.entity;if(!n||!r?.behavior)return[];let i=r.behavior.report(n,e.world,e.player.id,r.sharedData);return GY(i,e)}}}});var VY=p(Y_=>{"use strict";Object.defineProperty(Y_,"__esModule",{value:!0});Y_.loweringAction=void 0;var toe=sP(),roe=ce();Y_.loweringAction=(0,toe.createCapabilityDispatchAction)({actionId:roe.IFActions.LOWERING,group:"manipulation",noTargetError:"if.lower.no_target",cantDoThatError:"if.lower.cant_lower_that"})});var cP=p(z_=>{"use strict";Object.defineProperty(z_,"__esModule",{value:!0});z_.loweringAction=void 0;var noe=VY();Object.defineProperty(z_,"loweringAction",{enumerable:!0,get:function(){return noe.loweringAction}})});var YY=p($_=>{"use strict";Object.defineProperty($_,"__esModule",{value:!0});$_.raisingAction=void 0;var ioe=sP(),ooe=ce();$_.raisingAction=(0,ioe.createCapabilityDispatchAction)({actionId:ooe.IFActions.RAISING,group:"manipulation",noTargetError:"if.raise.no_target",cantDoThatError:"if.raise.cant_raise_that"})});var lP=p(K_=>{"use strict";Object.defineProperty(K_,"__esModule",{value:!0});K_.raisingAction=void 0;var aoe=YY();Object.defineProperty(K_,"raisingAction",{enumerable:!0,get:function(){return aoe.raisingAction}})});var uP=p(Xo=>{"use strict";Object.defineProperty(Xo,"__esModule",{value:!0});Xo.analyzeWearableContext=soe;Xo.checkWearingConflicts=coe;Xo.checkRemovalBlockers=loe;Xo.buildWearableEventParams=uoe;Xo.createWearableErrorEvent=doe;Xo.createWearableSuccessEvent=moe;Xo.isWornByActor=foe;Xo.hasRemovalRestrictions=poe;var Qo=b();function soe(t,e,r){let n=e.get(Qo.TraitType.WEARABLE),i=t.world.getContents(r.id);return{item:e,actor:r,wearableTrait:n,inventory:i}}function coe(t){let{item:e,wearableTrait:r,inventory:n}=t;if(r.bodyPart&&r.layer===void 0){let i=n.find(o=>{if(o.id===e.id||!o.has(Qo.TraitType.WEARABLE))return!1;let a=o.get(Qo.TraitType.WEARABLE);return a.worn&&a.bodyPart===r.bodyPart&&a.layer===void 0});if(i)return i}if(r.layer!==void 0&&r.bodyPart){let i=n.filter(o=>o.has(Qo.TraitType.WEARABLE)?o.get(Qo.TraitType.WEARABLE).worn:!1);for(let o of i){let a=o.get(Qo.TraitType.WEARABLE);if(a.layer!==void 0&&a.layer>r.layer&&a.bodyPart===r.bodyPart)return o}}return null}function loe(t){let{item:e,wearableTrait:r,inventory:n}=t;return r.layer!==void 0&&r.bodyPart&&n.find(o=>{if(o.id===e.id||!o.has(Qo.TraitType.WEARABLE))return!1;let a=o.get(Qo.TraitType.WEARABLE);return a.worn&&a.layer!==void 0&&a.layer>r.layer&&a.bodyPart===r.bodyPart})||null}function uoe(t,e){let r={item:t.name};return e.bodyPart&&(r.bodyPart=e.bodyPart),e.layer!==void 0&&(r.layer=e.layer),r}function doe(t,e,r,n){return t.event("action.error",{actionId:t.action.id,messageId:e,reason:r,params:n||{}})}function moe(t,e,r){return t.event("action.success",{actionId:t.action.id,messageId:e,params:r})}function foe(t,e){if(!t.has(Qo.TraitType.WEARABLE))return!1;let r=t.get(Qo.TraitType.WEARABLE);return r.worn&&r.wornBy===e.id}function poe(t){return!!t.cursed}});var KY=p(X_=>{"use strict";Object.defineProperty(X_,"__esModule",{value:!0});X_.wearingAction=void 0;var Q_=b(),goe=ce(),zY=$o(),dP=uP();function $Y(t){return t.sharedData}X_.wearingAction={id:goe.IFActions.WEARING,defaultScope:{item:zY.ScopeLevel.REACHABLE},requiredMessages:["no_target","not_wearable","not_held","already_wearing","worn","cant_wear_that","hands_full"],group:"wearable_manipulation",validate(t){let e=t.player,r=t.command.directObject?.entity;if(!r)return{valid:!1,error:"no_target"};if(!r.has(Q_.TraitType.WEARABLE))return{valid:!1,error:"not_wearable"};let n=t.requireCarriedOrImplicitTake(r);return n.ok?Q_.WearableBehavior.canWear(r,e)?{valid:!0}:r.get(Q_.TraitType.WEARABLE).worn?{valid:!1,error:"already_wearing"}:{valid:!1,error:"cant_wear_that"}:n.error},execute(t){let e=t.player,r=t.command.directObject.entity,n=$Y(t);n.itemId=r.id,n.itemName=r.name;let i=(0,dP.analyzeWearableContext)(t,r,e),{wearableTrait:o}=i;n.bodyPart=o.bodyPart,n.layer=o.layer;let a=(0,dP.checkWearingConflicts)(i);if(a){n.failed=!0,n.errorMessageId=o.layer!==void 0?"hands_full":"already_wearing",n.errorReason=n.errorMessageId,n.errorParams={item:a.name};return}let s=Q_.WearableBehavior.wear(r,e);if(!s.success){n.failed=!0,s.alreadyWorn?(n.errorMessageId="already_wearing",n.errorReason="already_wearing",n.errorParams={item:r.name}):s.wornByOther?(n.errorMessageId="already_wearing",n.errorReason="worn_by_other",n.errorParams={item:r.name,wornBy:s.wornByOther}):(n.errorMessageId="cant_wear_that",n.errorReason="cant_wear_that",n.errorParams={item:r.name});return}n.failed=!1,n.params=(0,dP.buildWearableEventParams)(r,o),n.messageId="worn"},report(t){let e=$Y(t),r=[];return e.failed?[t.event("if.event.wear_blocked",{messageId:`${t.action.id}.${e.errorMessageId}`,params:e.errorParams,itemId:e.itemId,itemName:e.itemName,reason:e.errorReason})]:(t.sharedData.implicitTakeEvents&&r.push(...t.sharedData.implicitTakeEvents),r.push(t.event("if.event.worn",{messageId:`${t.action.id}.${e.messageId}`,params:e.params,itemId:e.itemId,itemName:e.itemName,actorId:t.player.id,bodyPart:e.bodyPart,layer:e.layer})),r)},blocked(t,e){let r=t.command.directObject?.entity;return[t.event("if.event.wear_blocked",{messageId:`${t.action.id}.${e.error}`,params:e.params||{},itemId:r?.id,itemName:r?.name,reason:e.error})]},metadata:{requiresDirectObject:!0,requiresIndirectObject:!1,directObjectScope:zY.ScopeLevel.REACHABLE}}});var mP=p(Z_=>{"use strict";Object.defineProperty(Z_,"__esModule",{value:!0});Z_.wearingAction=void 0;var hoe=KY();Object.defineProperty(Z_,"wearingAction",{enumerable:!0,get:function(){return hoe.wearingAction}})});var ZY=p(tb=>{"use strict";Object.defineProperty(tb,"__esModule",{value:!0});tb.takingOffAction=void 0;var J_=b(),yoe=ce(),QY=$o(),eb=uP();function XY(t){return t.sharedData}tb.takingOffAction={id:yoe.IFActions.TAKING_OFF,defaultScope:{item:QY.ScopeLevel.CARRIED},requiredMessages:["no_target","not_wearing","removed","cant_remove","prevents_removal"],group:"wearable_manipulation",validate(t){let e=t.player,r=t.command.directObject?.entity;if(!r)return{valid:!1,error:"no_target"};if(!r.has(J_.TraitType.WEARABLE))return{valid:!1,error:"not_wearing"};if(!J_.WearableBehavior.canRemove(r,e)){let n=r.get(J_.TraitType.WEARABLE);return n.worn?n.wornBy!==e.id?{valid:!1,error:"not_wearing"}:{valid:!1,error:"cant_remove"}:{valid:!1,error:"not_wearing"}}return{valid:!0}},execute(t){let e=t.player,r=t.command.directObject.entity,n=XY(t);n.itemId=r.id,n.itemName=r.name;let i=(0,eb.analyzeWearableContext)(t,r,e),{wearableTrait:o}=i;n.bodyPart=o.bodyPart,n.layer=o.layer;let a=(0,eb.checkRemovalBlockers)(i);if(a){n.failed=!0,n.errorMessageId="prevents_removal",n.errorReason="prevents_removal",n.errorParams={blocking:a.name};return}if((0,eb.hasRemovalRestrictions)(o)){n.failed=!0,n.errorMessageId="cant_remove",n.errorReason="cant_remove",n.errorParams={item:r.name};return}let s=J_.WearableBehavior.remove(r,e);if(!s.success){n.failed=!0,s.notWorn?(n.errorMessageId="not_wearing",n.errorReason="not_wearing",n.errorParams={item:r.name}):s.wornByOther?(n.errorMessageId="not_wearing",n.errorReason="worn_by_other",n.errorParams={item:r.name,wornBy:s.wornByOther}):(n.errorMessageId="cant_remove",n.errorReason="cant_remove",n.errorParams={item:r.name});return}n.failed=!1,n.params=(0,eb.buildWearableEventParams)(r,o),n.messageId="removed"},blocked(t,e){let r=t.command.directObject?.entity;return[t.event("if.event.take_off_blocked",{messageId:`${t.action.id}.${e.error}`,params:e.params||{},itemId:r?.id,itemName:r?.name,reason:e.error})]},report(t){let e=XY(t);return e.failed?[t.event("if.event.take_off_blocked",{messageId:`${t.action.id}.${e.errorMessageId}`,params:e.errorParams||{},itemId:e.itemId,itemName:e.itemName,reason:e.errorReason})]:[t.event("if.event.removed",{messageId:`${t.action.id}.${e.messageId}`,params:e.params,itemId:e.itemId,itemName:e.itemName,actorId:t.player.id,bodyPart:e.bodyPart,layer:e.layer})]},metadata:{requiresDirectObject:!0,requiresIndirectObject:!1,directObjectScope:QY.ScopeLevel.CARRIED}}});var fP=p(rb=>{"use strict";Object.defineProperty(rb,"__esModule",{value:!0});rb.takingOffAction=void 0;var voe=ZY();Object.defineProperty(rb,"takingOffAction",{enumerable:!0,get:function(){return voe.takingOffAction}})});var ez=p(nb=>{"use strict";Object.defineProperty(nb,"__esModule",{value:!0});nb.eatingAction=void 0;var no=b(),Eoe=ce(),pP=Ce();function JY(t){return t.sharedData}nb.eatingAction={id:Eoe.IFActions.EATING,defaultScope:{item:pP.ScopeLevel.REACHABLE},targetRequirements:{trait:no.TraitType.EDIBLE,description:"edible"},requiresHolding:!0,requiredMessages:["no_item","not_visible","not_reachable","not_edible","is_drink","already_consumed","eaten","eaten_all","eaten_some","delicious","tasty","bland","awful","filling","still_hungry","poisonous"],metadata:{requiresDirectObject:!0,requiresIndirectObject:!1,directObjectScope:pP.ScopeLevel.REACHABLE},validate(t){let e=t.command.directObject?.entity;if(!e)return{valid:!1,error:"no_item"};let r=t.requireScope(e,pP.ScopeLevel.REACHABLE);if(!r.ok)return r.error;if(!e.has(no.TraitType.EDIBLE))return{valid:!1,error:"not_edible",params:{item:e.name}};if(no.EdibleBehavior.isLiquid(e))return{valid:!1,error:"is_drink",params:{item:e.name}};if(!no.EdibleBehavior.canConsume(e))return{valid:!1,error:"already_consumed",params:{item:e.name}};let n=t.requireCarriedOrImplicitTake(e);return n.ok?{valid:!0}:n.error},execute(t){let e=t.command.directObject.entity,r=t.player,n=no.EdibleBehavior.getServings(e),i=no.EdibleBehavior.getNutrition(e),o=no.EdibleBehavior.getTaste(e),a=no.EdibleBehavior.getEffects(e),s=no.EdibleBehavior.satisfiesHunger(e);no.EdibleBehavior.consume(e,r);let c=no.EdibleBehavior.getServings(e),l={item:e.id,itemName:e.name};i!==void 0&&i!==1&&(l.nutrition=i),n>1&&(l.servings=n,l.servingsRemaining=c),a&&a.length>0&&(l.effects=a),s!==void 0&&(l.satisfiesHunger=s);let u="eaten";if(a&&a.includes("poison"))u="poisonous";else if(o)switch(o){case"delicious":u="delicious";break;case"tasty":case"good":u="tasty";break;case"bland":case"plain":u="bland";break;case"awful":case"terrible":u="awful";break}else n>1&&c>0?u="eaten_some":n>1&&c===0?u="eaten_all":s===!0?u="filling":s===!1&&(u="still_hungry");let m=JY(t);m.itemId=e.id,m.itemName=e.name,m.messageId=u,m.eventData=l},blocked(t,e){let r=t.command.directObject?.entity;return[t.event("if.event.eaten",{blocked:!0,messageId:`${t.action.id}.${e.error}`,params:{item:r?.name,...e.params},reason:e.error,itemId:r?.id,itemName:r?.name})]},report(t){let e=[],r=JY(t);return t.sharedData.implicitTakeEvents&&e.push(...t.sharedData.implicitTakeEvents),e.push(t.event("if.event.eaten",{messageId:`${t.action.id}.${r.messageId}`,params:{item:r.eventData?.itemName},...r.eventData})),e},group:"interaction"}});var rz=p(tz=>{"use strict";Object.defineProperty(tz,"__esModule",{value:!0})});var gP=p(us=>{"use strict";var Toe=us&&us.__createBinding||(Object.create?(function(t,e,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}):(function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]})),_oe=us&&us.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&Toe(e,t,r)};Object.defineProperty(us,"__esModule",{value:!0});us.eatingAction=void 0;var boe=ez();Object.defineProperty(us,"eatingAction",{enumerable:!0,get:function(){return boe.eatingAction}});_oe(rz(),us)});var iz=p(ib=>{"use strict";Object.defineProperty(ib,"__esModule",{value:!0});ib.drinkingAction=void 0;var Kn=b(),Ooe=ce(),hP=Ce();function nz(t){return t.sharedData}function Ioe(t,e,r,n,i){let o="drunk";if(e){e.nutrition&&(n.nutrition=e.nutrition),e.portions&&(n.portions=e.portions,n.portionsRemaining=(e.portions||1)-1,o=n.portionsRemaining>0?"drunk_some":"drunk_all");let a=e.taste;if(a){let c={refreshing:"refreshing",satisfying:"satisfying",bitter:"bitter",sweet:"sweet",strong:"strong",alcoholic:"strong"};c[a]&&(o=c[a])}if(e.effects){n.effects=e.effects;let c=e.effects;c.includes("magic")?o="magical_effects":c.includes("healing")&&(o="healing")}let s=e.satisfiesThirst;s!==void 0&&(n.satisfiesThirst=s,s===!0&&o==="drunk"?o="thirst_quenched":s===!1&&(o="still_thirsty"))}if(r&&r.containsLiquid){n.fromContainer=!0,r.liquidType&&(n.liquidType=r.liquidType);let a=r.liquidAmount;a!==void 0?(n.liquidAmount=a,n.liquidRemaining=Math.max(0,a-1),n.liquidRemaining===0?o="empty_now":o==="drunk"&&(o="from_container",r.liquidType&&(i.liquidType=r.liquidType))):o="drunk_from"}if(o==="drunk"||o==="drunk_some"){let a={sip:"sipped",quaff:"quaffed",swallow:"gulped"};a[t]&&(o=a[t])}return o}ib.drinkingAction={id:Ooe.IFActions.DRINKING,defaultScope:{item:hP.ScopeLevel.REACHABLE},group:"interaction",metadata:{requiresDirectObject:!0,requiresIndirectObject:!1,directObjectScope:hP.ScopeLevel.REACHABLE},requiredMessages:["no_item","not_visible","not_reachable","not_drinkable","already_consumed","container_closed","drunk","drunk_all","drunk_some","drunk_from","refreshing","satisfying","bitter","sweet","strong","thirst_quenched","still_thirsty","magical_effects","healing","from_container","empty_now","some_remains","sipped","quaffed","gulped"],validate(t){let e=t.command.directObject?.entity;if(!e)return{valid:!1,error:"no_item"};let r=t.requireScope(e,hP.ScopeLevel.REACHABLE);if(!r.ok)return r.error;let n=!1,i,o;return e.has(Kn.TraitType.EDIBLE)&&(i=e.get(Kn.TraitType.EDIBLE),n=i.isDrink===!0),e.has(Kn.TraitType.CONTAINER)&&(o=e.get(Kn.TraitType.CONTAINER),!n&&o.containsLiquid&&(n=!0)),n?i&&i.consumed?{valid:!1,error:"already_consumed",params:{item:e.name}}:o&&e.has(Kn.TraitType.OPENABLE)&&!Kn.OpenableBehavior.isOpen(e)?{valid:!1,error:"container_closed",params:{item:e.name}}:{valid:!0}:{valid:!1,error:"not_drinkable",params:{item:e.name}}},execute(t){let e=t.player,r=t.command.directObject.entity,n=nz(t),i=r.has(Kn.TraitType.EDIBLE)?r.get(Kn.TraitType.EDIBLE):void 0,o=r.has(Kn.TraitType.CONTAINER)?r.get(Kn.TraitType.CONTAINER):void 0,s=t.world.getLocation(r.id)===e.id,c={item:r.id,itemName:r.name},l={item:r.name},u=i?Kn.EdibleBehavior.getServings(r):0,m=t.command.parsed.structure.verb?.text.toLowerCase()||"drink",f=Ioe(m,i,o,c,l);if(s||t.world.moveEntity(r.id,e.id),i){Kn.EdibleBehavior.consume(r,e);let g=Kn.EdibleBehavior.getServings(r);u>1&&(c.portions=u,c.portionsRemaining=g)}if(o&&o.liquidAmount!==void 0){let g=o.liquidAmount,h=Math.max(0,g-1);o.liquidAmount=h,c.liquidAmount=g,c.liquidRemaining=h}n.itemId=r.id,n.itemName=r.name,n.isHeld=s,n.messageId=f,n.params=l,n.eventData=c},blocked(t,e){let r=t.command.directObject?.entity;return[t.event("if.event.drunk",{blocked:!0,messageId:`${t.action.id}.${e.error}`,params:{item:r?.name,...e.params},reason:e.error,itemId:r?.id,itemName:r?.name})]},report(t){let e=[],r=nz(t);if(!r.isHeld){let n={implicit:!0,item:r.itemId,itemName:r.itemName};e.push(t.event("if.event.taken",n))}return e.push(t.event("if.event.drunk",{messageId:`${t.action.id}.${r.messageId}`,params:r.params||{},...r.eventData})),e}}});var az=p(oz=>{"use strict";Object.defineProperty(oz,"__esModule",{value:!0})});var yP=p(ds=>{"use strict";var Soe=ds&&ds.__createBinding||(Object.create?(function(t,e,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}):(function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]})),Aoe=ds&&ds.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&Soe(e,t,r)};Object.defineProperty(ds,"__esModule",{value:!0});ds.drinkingAction=void 0;var Roe=iz();Object.defineProperty(ds,"drinkingAction",{enumerable:!0,get:function(){return Roe.drinkingAction}});Aoe(az(),ds)});var cz=p(ob=>{"use strict";Object.defineProperty(ob,"__esModule",{value:!0});ob.talkingAction=void 0;var Vp=b(),woe=ce(),Coe=Ce();function sz(t){return t.sharedData}ob.talkingAction={id:woe.IFActions.TALKING,requiredMessages:["no_target","not_visible","too_far","not_actor","self","not_available","talked","no_response","acknowledges","first_meeting","greets_back","formal_greeting","casual_greeting","greets_again","remembers_you","friendly_greeting","has_topics","nothing_to_say"],validate(t){let e=t.player,r=t.command.directObject?.entity;if(!r)return{valid:!1,error:"no_target"};if(!t.canSee(r))return{valid:!1,error:"not_visible"};let n=t.world.getLocation(r.id),i=t.world.getLocation(e.id);if(n!==i)return{valid:!1,error:"too_far"};if(!r.has(Vp.TraitType.ACTOR))return{valid:!1,error:"not_actor",params:{target:r.name}};if(r.id===e.id)return{valid:!1,error:"self"};let a=r.get(Vp.TraitType.ACTOR)?.conversation||Vp.ActorBehavior.getCustomProperty(r,"conversation");return a&&a.isAvailable!==void 0&&!a.isAvailable?{valid:!1,error:"not_available",params:{target:r.name}}:{valid:!0}},execute(t){let e=t.command.directObject?.entity,r=sz(t),n={target:e.id,targetName:e.name},o=e.get(Vp.TraitType.ACTOR)?.conversation||Vp.ActorBehavior.getCustomProperty(e,"conversation"),a="talked";o?(n.conversationState=o.state||"initial",n.hasTopics=!!(o.topics&&Object.keys(o.topics).length>0),o.hasGreeted?o.relationship==="friendly"?a="friendly_greeting":o.remembersPlayer?a="remembers_you":a="greets_again":(n.firstMeeting=!0,o.personality==="formal"?a="formal_greeting":o.personality==="casual"?a="casual_greeting":a="first_meeting"),["formal_greeting","casual_greeting","first_meeting","friendly_greeting","remembers_you"].includes(a)||(n.hasTopics?a="has_topics":a==="greets_again"&&!n.hasTopics&&o.topics!==void 0&&(a="nothing_to_say"))):a="no_response",r.targetName=e.name,r.messageId=a,r.eventData=n},blocked(t,e){let r=t.command.directObject?.entity;return[t.event("if.event.talk_blocked",{blocked:!0,messageId:`${t.action.id}.${e.error}`,params:{...e.params,target:r?.name},reason:e.error,targetId:r?.id,targetName:r?.name})]},report(t){let e=[],r=sz(t);return e.push(t.event("if.event.talked",{messageId:`${t.action.id}.${r.messageId||"talked"}`,params:{target:r.targetName},...r.eventData})),e},group:"social",metadata:{requiresDirectObject:!0,requiresIndirectObject:!1,directObjectScope:Coe.ScopeLevel.AWARE}}});var uz=p(lz=>{"use strict";Object.defineProperty(lz,"__esModule",{value:!0})});var vP=p(ms=>{"use strict";var Noe=ms&&ms.__createBinding||(Object.create?(function(t,e,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}):(function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]})),Doe=ms&&ms.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&Noe(e,t,r)};Object.defineProperty(ms,"__esModule",{value:!0});ms.talkingAction=void 0;var Poe=cz();Object.defineProperty(ms,"talkingAction",{enumerable:!0,get:function(){return Poe.talkingAction}});Doe(uz(),ms)});var ab=p(io=>{"use strict";Object.defineProperty(io,"__esModule",{value:!0});io.CombatMessages=void 0;io.getHealthStatusMessageId=Loe;io.CombatMessages={ATTACK_MISSED:"combat.attack.missed",ATTACK_HIT:"combat.attack.hit",ATTACK_HIT_LIGHT:"combat.attack.hit_light",ATTACK_HIT_HEAVY:"combat.attack.hit_heavy",ATTACK_KNOCKED_OUT:"combat.attack.knocked_out",ATTACK_KILLED:"combat.attack.killed",DEFEND_BLOCKED:"combat.defend.blocked",DEFEND_PARRIED:"combat.defend.parried",DEFEND_DODGED:"combat.defend.dodged",HEALTH_HEALTHY:"combat.health.healthy",HEALTH_WOUNDED:"combat.health.wounded",HEALTH_BADLY_WOUNDED:"combat.health.badly_wounded",HEALTH_NEAR_DEATH:"combat.health.near_death",HEALTH_UNCONSCIOUS:"combat.health.unconscious",HEALTH_DEAD:"combat.health.dead",SWORD_GLOWS:"combat.special.sword_glows",SWORD_STOPS_GLOWING:"combat.special.sword_stops_glowing",BLESSED_WEAPON_EFFECT:"combat.special.blessed_weapon",CANNOT_ATTACK:"combat.cannot_attack",ALREADY_DEAD:"combat.already_dead",NOT_HOSTILE:"combat.not_hostile",NO_TARGET:"combat.no_target",TARGET_UNCONSCIOUS:"combat.target_unconscious",NEED_WEAPON:"combat.need_weapon",COMBAT_STARTED:"combat.started",COMBAT_ENDED:"combat.ended",PLAYER_DIED:"combat.player_died",PLAYER_RESURRECTED:"combat.player_resurrected"};function Loe(t){switch(t){case"healthy":return io.CombatMessages.HEALTH_HEALTHY;case"wounded":return io.CombatMessages.HEALTH_WOUNDED;case"badly_wounded":return io.CombatMessages.HEALTH_BADLY_WOUNDED;case"near_death":return io.CombatMessages.HEALTH_NEAR_DEATH;case"unconscious":return io.CombatMessages.HEALTH_UNCONSCIOUS;case"dead":return io.CombatMessages.HEALTH_DEAD}}});var dz=p(_u=>{"use strict";Object.defineProperty(_u,"__esModule",{value:!0});_u.CombatService=void 0;_u.createCombatService=Moe;_u.applyCombatResult=koe;_u.findWieldedWeapon=xoe;var vn=b(),Kc=ab(),sb=class{calculateHitChance(e,r,n){let o=e+n-r;return Math.max(10,Math.min(95,50+o))}resolveAttack(e){let{attacker:r,target:n,weapon:i,random:o}=e,a=r.get(vn.TraitType.COMBATANT),s=n.get(vn.TraitType.COMBATANT),c=i?.get(vn.TraitType.WEAPON),l=a?.skill??30,u=s?.skill??30,m=c?.skillBonus??0,f=this.calculateHitChance(l,u,m),h=o.int(1,100)<=f,y={attackerName:r.name,targetName:n.name,weaponName:i?.name};if(!h)return{hit:!1,damage:0,targetNewHealth:s?.health??0,targetKnockedOut:!1,targetKilled:!1,messageId:Kc.CombatMessages.ATTACK_MISSED,messageData:y};let _=a?.baseDamage??1,v=c?.damage??0,E=_+v;c?.isBlessed&&n.get(vn.TraitType.IDENTITY)?.isUndead&&(E=Math.floor(E*1.5));let T=s?.armor??0,O=Math.max(1,E-T),R=s?.health??10,I=Math.max(0,R-O),w=I<=0,N=s?.maxHealth??10,G=!w&&I<=N*.2;y.damage=O;let k;return w?k=Kc.CombatMessages.ATTACK_KILLED:G?k=Kc.CombatMessages.ATTACK_KNOCKED_OUT:O>=N*.3?k=Kc.CombatMessages.ATTACK_HIT_HEAVY:O<=N*.1?k=Kc.CombatMessages.ATTACK_HIT_LIGHT:k=Kc.CombatMessages.ATTACK_HIT,{hit:!0,damage:O,targetNewHealth:I,targetKnockedOut:G,targetKilled:w,messageId:k,messageData:y}}canAttack(e,r){let n=r.get(vn.TraitType.COMBATANT);return n?n.isAlive?{valid:!0}:{valid:!1,messageId:Kc.CombatMessages.ALREADY_DEAD,messageData:{targetName:r.name}}:{valid:!1,messageId:Kc.CombatMessages.CANNOT_ATTACK,messageData:{targetName:r.name}}}getHealthStatus(e){let r=e.get(vn.TraitType.COMBATANT);if(!r)return"healthy";if(!r.isAlive)return"dead";if(!r.isConscious)return"unconscious";let n=r.health/r.maxHealth;return n<=.1?"near_death":n<=.3?"badly_wounded":n<=.7?"wounded":"healthy"}};_u.CombatService=sb;function Moe(){return new sb}function koe(t,e,r){let n={droppedItems:[]};if(!e.hit)return n;let i=t.get(vn.TraitType.COMBATANT);if(!i)return n;if(i.health=e.targetNewHealth,e.targetKnockedOut&&i.knockOut(),e.targetKilled&&(i.kill(),i.dropsInventory)){let o=r.getLocation(t.id);if(o){let a=r.getContents(t.id);for(let s of a)r.moveEntity(s.id,o),n.droppedItems.push(s.id)}}return n}function xoe(t,e){let n=e.getContents(t.id).filter(o=>o.has(vn.TraitType.WEAPON));if(n.length===0)return;let i=n.filter(o=>o.has(vn.TraitType.EQUIPPED)?o.get(vn.TraitType.EQUIPPED)?.isEquipped:!1);return i.length>0?i.reduce((o,a)=>{let s=o.get(vn.TraitType.WEAPON);return a.get(vn.TraitType.WEAPON).damage>s.damage?a:o}):n.reduce((o,a)=>{let s=o.get(vn.TraitType.WEAPON);return a.get(vn.TraitType.WEAPON).damage>s.damage?a:o})}});var lb=p(jr=>{"use strict";var Boe=jr&&jr.__createBinding||(Object.create?(function(t,e,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}):(function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]})),joe=jr&&jr.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&Boe(e,t,r)};Object.defineProperty(jr,"__esModule",{value:!0});jr.findWieldedWeapon=jr.applyCombatResult=jr.createCombatService=jr.CombatService=void 0;joe(ab(),jr);var cb=dz();Object.defineProperty(jr,"CombatService",{enumerable:!0,get:function(){return cb.CombatService}});Object.defineProperty(jr,"createCombatService",{enumerable:!0,get:function(){return cb.createCombatService}});Object.defineProperty(jr,"applyCombatResult",{enumerable:!0,get:function(){return cb.applyCombatResult}});Object.defineProperty(jr,"findWieldedWeapon",{enumerable:!0,get:function(){return cb.findWieldedWeapon}})});var fz=p(db=>{"use strict";Object.defineProperty(db,"__esModule",{value:!0});db.attackingAction=void 0;var Yp=b(),Woe=ce(),Hoe=Ce(),ub=lb(),mz=ab();function Uoe(){return{next:()=>Math.random(),int:(t,e)=>Math.floor(Math.random()*(e-t+1))+t,chance:t=>Math.random()<t,pick:t=>t[Math.floor(Math.random()*t.length)],shuffle:t=>{let e=[...t];for(let r=e.length-1;r>0;r--){let n=Math.floor(Math.random()*(r+1));[e[r],e[n]]=[e[n],e[r]]}return e},getSeed:()=>0,setSeed:()=>{}}}db.attackingAction={id:Woe.IFActions.ATTACKING,group:"interaction",metadata:{requiresDirectObject:!0,requiresIndirectObject:!1,directObjectScope:Hoe.ScopeLevel.REACHABLE},requiredMessages:["no_target","not_visible","not_reachable","self","not_holding_weapon","attacked","attacked_with","hit","hit_with","struck","struck_with","punched","kicked","unarmed_attack","broke","smashed","destroyed","shattered","already_damaged","partial_break","defends","dodges","retaliates","flees","peaceful_solution","no_fighting","unnecessary_violence"],validate(t){let e=t.player,r=t.command.directObject?.entity,n=t.command.instrument?.entity??t.command.indirectObject?.entity;if(!r)return{valid:!1,error:"no_target"};if(!t.canSee(r))return{valid:!1,error:"not_visible",params:{target:r.name}};if(!t.canReach(r))return{valid:!1,error:"not_reachable",params:{target:r.name}};if(r.id===e.id)return{valid:!1,error:"self"};if(n&&t.world.getLocation(n.id)!==e.id)return{valid:!1,error:"not_holding_weapon",params:{weapon:n.name}};if(r.has(Yp.TraitType.COMBATANT)){let o=new ub.CombatService().canAttack(e,r);if(!o.valid)return{valid:!1,error:o.messageId||"already_dead",params:{target:r.name}}}return{valid:!0}},execute(t){let e=t.command.directObject.entity,r=t.command.instrument?.entity??t.command.indirectObject?.entity,n=!1,i=t.command.parsed.action||t.command.parsed.structure.verb?.text||"attack";if(!r&&(i==="stab"||i==="slash"||i==="cut"||e.has(Yp.TraitType.COMBATANT))){if(r=(0,ub.findWieldedWeapon)(t.player,t.world),!r){let a=t.world.getContents(t.player.id);r=Yp.AttackBehavior.inferWeapon(a)}n=!!r}if(e.has(Yp.TraitType.COMBATANT)){let a=new ub.CombatService().resolveAttack({attacker:t.player,target:e,weapon:r,world:t.world,random:Uoe()}),s=(0,ub.applyCombatResult)(e,a,t.world),l={attackResult:{success:!0,type:a.targetKilled?"killed":a.targetKnockedOut?"knocked_out":a.hit?"hit":"missed",damage:a.damage,remainingHitPoints:a.targetNewHealth,targetDestroyed:!1,targetKilled:a.targetKilled,targetKnockedOut:a.targetKnockedOut,itemsDropped:s.droppedItems},weaponUsed:r?.id,weaponInferred:n,customMessage:void 0,combatResult:a,usedCombatService:!0};Object.assign(t.sharedData,l)}else{let o=Yp.AttackBehavior.attack(e,r,t.world),s={attackResult:{success:o.success,type:o.type,damage:o.damage,remainingHitPoints:o.remainingHitPoints,targetDestroyed:o.targetDestroyed,targetKilled:o.targetKilled,itemsDropped:o.itemsDropped,debrisCreated:o.debrisCreated,exitRevealed:o.exitRevealed,transformedTo:o.transformedTo},weaponUsed:r?.id,weaponInferred:n,customMessage:o.message,usedCombatService:!1};Object.assign(t.sharedData,s)}},blocked(t,e){let r=t.command.directObject?.entity;return[t.event("if.event.attacked",{blocked:!0,messageId:`${t.action.id}.${e.error}`,params:{target:r?.name,...e.params},reason:e.error,targetId:r?.id,targetName:r?.name})]},report(t){let e=t.command.directObject.entity,r=t.sharedData.weaponUsed,n=r?t.world.getEntity(r):void 0,i=t.command.parsed.action||"attack",o=t.sharedData.attackResult,a=t.sharedData.customMessage,s=t.sharedData.usedCombatService,c=t.sharedData.combatResult,l=[];if(!o.success&&!s)return[t.event("if.event.attacked",{messageId:`${t.action.id}.${a||"attack_ineffective"}`,params:{target:e.name},target:e.id,targetName:e.name,failed:!0})];let u={target:e.id,targetName:e.name,weapon:n?.id,weaponName:n?.name,unarmed:!n},m={target:e.name,weapon:n?.name};l.push(t.event("if.event.attacked",u));let f;if(s&&c)f=c.messageId,m.damage=c.damage,m.attackerName=t.player.name,m.targetName=e.name,c.messageData&&Object.assign(m,c.messageData);else switch(o.type){case"broke":f="target_broke",o.debrisCreated?.length&&(m.debris=o.debrisCreated.length);break;case"damaged":f="target_damaged",m.damage=o.damage,m.remaining=o.remainingHitPoints;break;case"destroyed":if(f="target_destroyed",o.transformedTo){let g=t.world.getEntity(o.transformedTo);m.transformedTo=g?.name}o.exitRevealed&&(m.exitRevealed=o.exitRevealed);break;case"killed":f="killed_target",o.itemsDropped?.length&&(m.itemsDropped=o.itemsDropped.length);break;case"knocked_out":f=mz.CombatMessages.ATTACK_KNOCKED_OUT,m.damage=o.damage;break;case"missed":f=mz.CombatMessages.ATTACK_MISSED;break;case"hit":f=n?"hit_with":"hit_target",m.damage=o.damage;break;default:f="attacked"}if(l[0]=t.event("if.event.attacked",{messageId:`${t.action.id}.${a||f}`,params:m,...u}),o.itemsDropped?.length)for(let g of o.itemsDropped){let h=t.world.getEntity(g);h&&l.push(t.event("if.event.dropped",{item:g,itemName:h.name,dropper:e.id,dropperName:e.name}))}return o.exitRevealed&&l.push(t.event("if.event.exit_revealed",{direction:o.exitRevealed,room:t.world.getLocation(t.player.id)})),o.targetKilled&&l.push(t.event("if.event.death",{target:e.id,targetName:e.name,killedBy:t.player.id})),o.targetKnockedOut&&l.push(t.event("if.event.knocked_out",{target:e.id,targetName:e.name,knockedOutBy:t.player.id})),l}}});var gz=p(pz=>{"use strict";Object.defineProperty(pz,"__esModule",{value:!0})});var EP=p(fs=>{"use strict";var qoe=fs&&fs.__createBinding||(Object.create?(function(t,e,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}):(function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]})),Foe=fs&&fs.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&qoe(e,t,r)};Object.defineProperty(fs,"__esModule",{value:!0});fs.attackingAction=void 0;var Goe=fz();Object.defineProperty(fs,"attackingAction",{enumerable:!0,get:function(){return Goe.attackingAction}});Foe(gz(),fs)});var hz=p(mb=>{"use strict";Object.defineProperty(mb,"__esModule",{value:!0});mb.savingAction=void 0;var Voe=Je(),Yoe=ce();function zoe(t,e){let r=t.world.getCapability("sharedData")||{},n=r.score||0,i=r.moves||0,o=r.turnCount||0,a=e==="quicksave"||t.command.parsed.extras?.quick,s=t.command.parsed.extras?.auto,c={saveName:e!=="default"?e:void 0,autosave:s,timestamp:Date.now(),metadata:{score:n,moves:i,turnCount:o,quickSave:a}},l={saveName:e,timestamp:c.timestamp,metadata:{score:n,moves:i,turnCount:o,quickSave:a}};return{saveName:e,isQuickSave:a,isAutoSave:s,score:n,moves:i,turnCount:o,saveContext:c,eventData:l}}mb.savingAction={id:Yoe.IFActions.SAVING,requiredMessages:["game_saved","game_saved_as","save_successful","save_slot","overwrite_save","save_details","quick_save","auto_save","save_failed","no_save_slots","invalid_save_name","save_not_allowed","save_in_progress","confirm_overwrite","save_reminder","saved_locally","saved_to_cloud","save_exported"],validate(t){let e=t.command.parsed.extras?.name||t.command.parsed.extras?.slot||t.command.indirectObject?.parsed?.text||"default",n=(t.world.getCapability("sharedData")||{}).saveRestrictions||{};return n.disabled?{valid:!1,error:"save_not_allowed"}:n.inProgress?{valid:!1,error:"save_in_progress"}:e.length>50||/[<>:"/\\|?*]/.test(e)?{valid:!1,error:"invalid_save_name"}:{valid:!0}},execute(t){let e=t.command.parsed.extras?.name||t.command.parsed.extras?.slot||t.command.directObject?.parsed?.text||"default",r=zoe(t,e);Object.assign(t.sharedData,r)},blocked(t,e){return[t.event("if.event.save_blocked",{messageId:`if.action.saving.${e.error}`,params:e.params||{},blocked:!0,reason:e.error})]},report(t){let e=[],r=t.sharedData,n=(0,Voe.createSaveRequestedEvent)(r.saveContext);return e.push(n),e.push(t.event("if.event.save_requested",r.eventData)),e},group:"meta",metadata:{requiresDirectObject:!1,requiresIndirectObject:!1}}});var vz=p(yz=>{"use strict";Object.defineProperty(yz,"__esModule",{value:!0})});var TP=p(ps=>{"use strict";var $oe=ps&&ps.__createBinding||(Object.create?(function(t,e,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}):(function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]})),Koe=ps&&ps.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&$oe(e,t,r)};Object.defineProperty(ps,"__esModule",{value:!0});ps.savingAction=void 0;var Qoe=hz();Object.defineProperty(ps,"savingAction",{enumerable:!0,get:function(){return Qoe.savingAction}});Koe(vz(),ps)});var Ez=p(fb=>{"use strict";Object.defineProperty(fb,"__esModule",{value:!0});fb.restoringAction=void 0;var Xoe=Je(),Zoe=ce();function Joe(t){return Object.entries(t).filter(([e])=>e!=="autosave").map(([e,r])=>({slot:e,name:r.name||e,timestamp:r.timestamp||Date.now(),metadata:{score:r.score,moves:r.moves,version:r.version}}))}function eae(t){if(t.length===0)return null;let e=t.reduce((r,n)=>!r||n.timestamp>r.timestamp?n:r,null);return e?{slot:e.slot,timestamp:e.timestamp}:null}function tae(t,e){let n=(t.world.getCapability("sharedData")||{}).saves||{},i=Joe(n),o=eae(i),a={slot:e!=="default"?e:void 0,availableSaves:i,lastSave:o||void 0},s={saveName:e,timestamp:Date.now(),availableSaves:i.length};return{saveName:e,availableSaves:i,lastSave:o,restoreContext:a,eventData:s}}fb.restoringAction={id:Zoe.IFActions.RESTORING,requiredMessages:["game_restored","game_loaded","restore_successful","welcome_back","restore_details","quick_restore","resuming_game","restore_failed","save_not_found","no_saves","corrupt_save","incompatible_save","restore_not_allowed","confirm_restore","unsaved_progress","available_saves","no_saves_available","choose_save","import_save","save_imported"],validate(t){let e=t.world.getCapability("sharedData")||{},r=e.saves||{};return(e.restoreRestrictions||{}).disabled?{valid:!1,error:"restore_not_allowed"}:Object.keys(r).filter(o=>o!=="autosave").length===0?{valid:!1,error:"no_saves"}:{valid:!0}},execute(t){let e=t.command.parsed.extras?.name||t.command.parsed.extras?.slot||t.command.indirectObject?.parsed?.text||"default",r=tae(t,e);Object.assign(t.sharedData,r)},blocked(t,e){return[t.event("if.event.restore_blocked",{messageId:`if.action.restoring.${e.error}`,params:e.params||{},blocked:!0,reason:e.error})]},report(t){let e=[],r=t.sharedData,n=(0,Xoe.createRestoreRequestedEvent)(r.restoreContext);return e.push(n),e.push(t.event("if.event.restore_requested",r.eventData)),e},group:"meta",metadata:{requiresDirectObject:!1,requiresIndirectObject:!1}}});var _z=p(Tz=>{"use strict";Object.defineProperty(Tz,"__esModule",{value:!0})});var _P=p(gs=>{"use strict";var rae=gs&&gs.__createBinding||(Object.create?(function(t,e,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}):(function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]})),nae=gs&&gs.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&rae(e,t,r)};Object.defineProperty(gs,"__esModule",{value:!0});gs.restoringAction=void 0;var iae=Ez();Object.defineProperty(gs,"restoringAction",{enumerable:!0,get:function(){return iae.restoringAction}});nae(_z(),gs)});var Oz=p(pb=>{"use strict";Object.defineProperty(pb,"__esModule",{value:!0});pb.quittingAction=void 0;var oae=Je(),aae=ce();function bz(t){return t.sharedData}function sae(t){let e=t.world.getCapability("sharedData")||{},r=(e.moves||0)>(e.lastSaveMove||0),n=e.score||0,i=e.maxScore||0,o=e.moves||0,a=i>0&&n/i>.8,s=t.command.parsed.extras?.force||t.command.parsed.extras?.now||t.command.parsed.action==="exit",c={score:n,moves:o,hasUnsavedChanges:r,force:s,stats:{maxScore:i,nearComplete:a,playTime:e.playTime||0,achievements:e.achievements||[]}},l={timestamp:Date.now(),hasUnsavedChanges:r,force:s,score:n,moves:o};return{quitContext:c,eventData:l,forceQuit:s,hasUnsavedProgress:r}}pb.quittingAction={id:aae.IFActions.QUITTING,requiredMessages:["quit_confirm_query","quit_save_query","quit_unsaved_query","quit_requested","game_ending"],validate(t){return{valid:!0}},execute(t){let e=sae(t),r=bz(t);r.quitContext=e.quitContext,r.eventData=e.eventData,r.forceQuit=e.forceQuit,r.hasUnsavedProgress=e.hasUnsavedProgress},blocked(t,e){return[t.event("if.event.quit_blocked",{messageId:`if.action.quitting.${e.error}`,params:e.params||{},blocked:!0,reason:e.error})]},report(t){let e=[],r=bz(t);if(!r.quitContext||!r.eventData)return e;let n=(0,oae.createQuitRequestedEvent)(r.quitContext);return e.push(n),e.push(t.event("client.query",{queryId:`quit_${Date.now()}`,prompt:"Are you sure you want to quit?",source:"system",type:"multiple_choice",messageId:"quit_confirm_query",options:["quit","cancel"],context:r.quitContext})),e.push(t.event("if.event.quit_requested",r.eventData)),e},group:"meta",metadata:{requiresDirectObject:!1,requiresIndirectObject:!1}}});var Sz=p(Iz=>{"use strict";Object.defineProperty(Iz,"__esModule",{value:!0})});var bP=p(hs=>{"use strict";var cae=hs&&hs.__createBinding||(Object.create?(function(t,e,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}):(function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]})),lae=hs&&hs.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&cae(e,t,r)};Object.defineProperty(hs,"__esModule",{value:!0});hs.quittingAction=void 0;var uae=Oz();Object.defineProperty(hs,"quittingAction",{enumerable:!0,get:function(){return uae.quittingAction}});lae(Sz(),hs)});var Az=p(gb=>{"use strict";Object.defineProperty(gb,"__esModule",{value:!0});gb.restartingAction=void 0;var dae=Je(),mae=ce();function fae(t){let e=t.world.getCapability("sharedData")||{},r=e.moves>(e.lastSaveMove||0),n=e.score||0,i=e.moves||0,o=t.currentLocation?.name||"unknown",a=t.command.parsed.extras?.force||t.command.parsed.extras?.now||t.command.parsed.action==="reset",s={currentProgress:{score:n,moves:i,location:o},confirmationRequired:!a&&(r||i>10),hasUnsavedChanges:r,force:a},c={timestamp:Date.now(),hasUnsavedChanges:r,force:a,currentProgress:{score:n,moves:i,location:o}},l=!a&&(r||i>10);return{forceRestart:a,hasUnsavedProgress:r,score:n,moves:i,currentLocation:o,restartContext:s,eventData:c,showHint:l}}gb.restartingAction={id:mae.IFActions.RESTARTING,requiredMessages:["restart_confirm","restart_unsaved","restart_requested","game_restarting","starting_over","new_game"],validate(t){return{valid:!0}},execute(t){let e=fae(t);Object.assign(t.sharedData,e)},blocked(t,e){return[t.event("if.event.restart_blocked",{messageId:`if.action.restarting.${e.error}`,params:e.params||{},blocked:!0,reason:e.error})]},report(t){let e=[],r=t.sharedData,n=(0,dae.createRestartRequestedEvent)(r.restartContext);return e.push(n),e.push(t.event("if.event.restart_requested",r.eventData)),e},group:"meta",metadata:{requiresDirectObject:!1,requiresIndirectObject:!1}}});var wz=p(Rz=>{"use strict";Object.defineProperty(Rz,"__esModule",{value:!0})});var OP=p(ys=>{"use strict";var pae=ys&&ys.__createBinding||(Object.create?(function(t,e,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}):(function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]})),gae=ys&&ys.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&pae(e,t,r)};Object.defineProperty(ys,"__esModule",{value:!0});ys.restartingAction=void 0;var hae=Az();Object.defineProperty(ys,"restartingAction",{enumerable:!0,get:function(){return hae.restartingAction}});gae(wz(),ys)});var Cz=p(hb=>{"use strict";Object.defineProperty(hb,"__esModule",{value:!0});hb.undoingAction=void 0;var yae=Je(),vae=ce();hb.undoingAction={id:vae.IFActions.UNDOING,requiredMessages:["undo_success","undo_failed","nothing_to_undo"],validate(t){return{valid:!0}},execute(t){},blocked(t,e){return[]},report(t){return[(0,yae.createUndoRequestedEvent)()]},group:"meta",metadata:{requiresDirectObject:!1,requiresIndirectObject:!1}}});var Dz=p(Nz=>{"use strict";Object.defineProperty(Nz,"__esModule",{value:!0})});var IP=p(vs=>{"use strict";var Eae=vs&&vs.__createBinding||(Object.create?(function(t,e,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}):(function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]})),Tae=vs&&vs.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&Eae(e,t,r)};Object.defineProperty(vs,"__esModule",{value:!0});vs.undoingAction=void 0;var _ae=Cz();Object.defineProperty(vs,"undoingAction",{enumerable:!0,get:function(){return _ae.undoingAction}});Tae(Dz(),vs)});var Lz=p(yb=>{"use strict";Object.defineProperty(yb,"__esModule",{value:!0});yb.againAction=void 0;var bae=Je(),Oae=ce();function Pz(t){return t.sharedData}yb.againAction={id:Oae.IFActions.AGAIN,requiredMessages:["nothing_to_repeat"],group:"meta",metadata:{requiresDirectObject:!1,requiresIndirectObject:!1},validate(t){let e=t.world.getCapability("commandHistory");if(!e||!e.entries||e.entries.length===0)return{valid:!1,error:"nothing_to_repeat"};let r=e.entries[e.entries.length-1],n=Pz(t);return n.lastCommand=r.originalText,n.lastActionId=r.actionId,{valid:!0}},execute(t){},blocked(t,e){return[t.event("if.event.again_blocked",{blocked:!0,messageId:`${t.action.id}.${e.error}`,reason:e.error})]},report(t){let e=Pz(t);return[(0,bae.createAgainRequestedEvent)({command:e.lastCommand,actionId:e.lastActionId})]}}});var SP=p(vb=>{"use strict";Object.defineProperty(vb,"__esModule",{value:!0});vb.againAction=void 0;var Iae=Lz();Object.defineProperty(vb,"againAction",{enumerable:!0,get:function(){return Iae.againAction}})});var Mz=p(Eb=>{"use strict";Object.defineProperty(Eb,"__esModule",{value:!0});Eb.TraceAction=void 0;var Sae=FN(),AP=class extends Sae.MetaAction{constructor(){super();d(this,"id","author.trace");d(this,"verbs",["trace"]);this.ensureRegistered()}validate(r){let{command:n}=r,i=n.parsed?.tokens||[];if(i.length===0)return{valid:!1,error:"no_tokens"};if(i[0]?.normalized?.toLowerCase()!=="trace")return{valid:!1,error:"not_trace"};if(i.length===1)return{valid:!0};if(i.length===2){let a=i[1]?.normalized?.toLowerCase();return a==="on"||a==="off"?{valid:!0}:{valid:!1,error:"invalid_state"}}if(i.length===3){let a=i[1]?.normalized?.toLowerCase(),s=i[2]?.normalized?.toLowerCase(),c=["parser","validation","system","all"],l=["on","off"];return c.includes(a)&&l.includes(s)?{valid:!0}:{valid:!1,error:"invalid_target_or_state"}}return{valid:!1,error:"invalid_pattern"}}execute(r){let{command:n,world:i}=r,o=n.parsed?.tokens||[],a=[],s=i.getCapability("debug")||{debugParserEvents:!1,debugValidationEvents:!1,debugSystemEvents:!1};if(o.length===1)return a.push(r.event("trace.status",{parser:s.debugParserEvents||!1,validation:s.debugValidationEvents||!1,system:s.debugSystemEvents||!1})),a;if(o.length===2){let c=o[1]?.normalized?.toLowerCase()==="on";return s.debugParserEvents=c,s.debugValidationEvents=c,s.debugSystemEvents=c,i.updateCapability("debug",s),a.push(r.event("trace.changed",{target:"all",enabled:c})),a}if(o.length===3){let c=o[1]?.normalized?.toLowerCase(),l=o[2]?.normalized?.toLowerCase()==="on";switch(c){case"parser":s.debugParserEvents=l;break;case"validation":s.debugValidationEvents=l;break;case"system":s.debugSystemEvents=l;break;case"all":s.debugParserEvents=l,s.debugValidationEvents=l,s.debugSystemEvents=l;break;default:return a.push(r.event("action.error",{reason:`Unknown trace target: ${c}`})),a}i.updateCapability("debug",s),a.push(r.event("trace.changed",{target:c,enabled:l}))}return a}};Eb.TraceAction=AP});var RP=p(Tb=>{"use strict";Object.defineProperty(Tb,"__esModule",{value:!0});Tb.TraceAction=void 0;var Aae=Mz();Object.defineProperty(Tb,"TraceAction",{enumerable:!0,get:function(){return Aae.TraceAction}})});var kz=p(Q=>{"use strict";var Rae=Q&&Q.__createBinding||(Object.create?(function(t,e,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}):(function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]})),me=Q&&Q.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&Rae(e,t,r)};Object.defineProperty(Q,"__esModule",{value:!0});Q.standardActions=Q.takingOffAction=Q.wearingAction=Q.throwingAction=Q.removingAction=Q.takingAction=void 0;var wae=YN();Object.defineProperty(Q,"takingAction",{enumerable:!0,get:function(){return wae.takingAction}});me(KN(),Q);me(ZN(),Q);me(eD(),Q);me(rD(),Q);me(sD(),Q);me(lD(),Q);me(uD(),Q);me(dD(),Q);me(mD(),Q);me(fD(),Q);me(pD(),Q);me(gD(),Q);me(hD(),Q);me(_D(),Q);me(ID(),Q);me(RD(),Q);me(ND(),Q);me(PD(),Q);me(LD(),Q);me(MD(),Q);me(xD(),Q);me(BD(),Q);me(jD(),Q);me(HD(),Q);me(R_(),Q);me(YD(),Q);me($D(),Q);var Cae=ZD();Object.defineProperty(Q,"removingAction",{enumerable:!0,get:function(){return Cae.removingAction}});me(JD(),Q);me(eP(),Q);var Nae=tP();Object.defineProperty(Q,"throwingAction",{enumerable:!0,get:function(){return Nae.throwingAction}});me(nP(),Q);me(oP(),Q);me(cP(),Q);me(lP(),Q);var Dae=mP();Object.defineProperty(Q,"wearingAction",{enumerable:!0,get:function(){return Dae.wearingAction}});var Pae=fP();Object.defineProperty(Q,"takingOffAction",{enumerable:!0,get:function(){return Pae.takingOffAction}});me(gP(),Q);me(yP(),Q);me(vP(),Q);me(EP(),Q);me(TP(),Q);me(_P(),Q);me(bP(),Q);me(OP(),Q);me(IP(),Q);me(SP(),Q);var Lae=YN(),Mae=KN(),kae=ZN(),xae=eD(),Bae=rD(),jae=sD(),Wae=lD(),Hae=uD(),Uae=dD(),qae=mD(),Fae=fD(),Gae=pD(),Vae=gD(),Yae=hD(),zae=_D(),$ae=ID(),Kae=RD(),Qae=ND(),Xae=PD(),Zae=LD(),Jae=MD(),ese=xD(),tse=BD(),rse=jD(),nse=HD(),ise=R_(),ose=YD(),ase=$D(),sse=ZD(),cse=JD(),lse=eP(),use=tP(),dse=nP(),mse=oP(),fse=cP(),pse=lP(),gse=mP(),hse=fP(),yse=gP(),vse=yP(),Ese=vP(),Tse=EP(),_se=TP(),bse=_P(),Ose=bP(),Ise=OP(),Sse=IP(),Ase=SP(),Rse=RP(),wse=new Rse.TraceAction;Q.standardActions=[Lae.takingAction,Mae.droppingAction,kae.examiningAction,xae.openingAction,Bae.closingAction,jae.goingAction,Wae.lookingAction,Hae.inventoryAction,Uae.waitingAction,qae.sleepingAction,Fae.scoringAction,Gae.helpAction,Vae.aboutAction,Yae.versionAction,zae.lockingAction,$ae.unlockingAction,Kae.switchingOnAction,Qae.switchingOffAction,Xae.enteringAction,Zae.exitingAction,Jae.climbingAction,ese.searchingAction,tse.listeningAction,rse.smellingAction,nse.touchingAction,ise.puttingAction,ose.insertingAction,ase.reading,sse.removingAction,cse.givingAction,lse.showingAction,use.throwingAction,dse.pushingAction,mse.pullingAction,fse.loweringAction,pse.raisingAction,gse.wearingAction,hse.takingOffAction,yse.eatingAction,vse.drinkingAction,Ese.talkingAction,Tse.attackingAction,_se.savingAction,bse.restoringAction,Ose.quittingAction,Ise.restartingAction,Sse.undoingAction,Ase.againAction,wse]});var xz=p(Lt=>{"use strict";var Cse=Lt&&Lt.__createBinding||(Object.create?(function(t,e,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}):(function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]})),bu=Lt&&Lt.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&Cse(e,t,r)};Object.defineProperty(Lt,"__esModule",{value:!0});Lt.createEvent=Lt.MetaCommandRegistry=Lt.MetaAction=void 0;bu(Yw(),Lt);bu(HN(),Lt);var Nse=FN();Object.defineProperty(Lt,"MetaAction",{enumerable:!0,get:function(){return Nse.MetaAction}});var Dse=UN();Object.defineProperty(Lt,"MetaCommandRegistry",{enumerable:!0,get:function(){return Dse.MetaCommandRegistry}});bu(vG(),Lt);bu(EG(),Lt);bu(ce(),Lt);bu(kz(),Lt);bu(RP(),Lt);var Pse=Je();Object.defineProperty(Lt,"createEvent",{enumerable:!0,get:function(){return Pse.createEvent}})});var jz=p(Bz=>{"use strict";Object.defineProperty(Bz,"__esModule",{value:!0})});var Hz=p(Wz=>{"use strict";Object.defineProperty(Wz,"__esModule",{value:!0})});var Uz=p(Es=>{"use strict";Object.defineProperty(Es,"__esModule",{value:!0});Es.createTargetData=Lse;Es.createObjectData=Mse;Es.createContainerData=kse;Es.createLocationData=xse;Es.entitiesToIds=Bse;Es.entitiesToNames=jse;Es.createMovementData=Wse;function Lse(t){return{targetId:t.id,targetName:t.name}}function Mse(t){return{targetId:t.id,targetName:t.name,objectId:t.id,objectName:t.name}}function kse(t){return{containerId:t.id,containerName:t.name}}function xse(t){return{locationId:t.id,locationName:t.name}}function Bse(t){return t.map(e=>e.id)}function jse(t){return t.map(e=>e.name)}function Wse(t,e){return{fromLocationId:t.id,fromLocationName:t.name,toLocationId:e.id,toLocationName:e.name}}});var Fz=p(qz=>{"use strict";Object.defineProperty(qz,"__esModule",{value:!0})});var Gz=p(Zo=>{"use strict";var Hse=Zo&&Zo.__createBinding||(Object.create?(function(t,e,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}):(function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]})),_b=Zo&&Zo.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&Hse(e,t,r)};Object.defineProperty(Zo,"__esModule",{value:!0});_b(jz(),Zo);_b(Hz(),Zo);_b(Uz(),Zo);_b(Fz(),Zo)});var wP=p(It=>{"use strict";Object.defineProperty(It,"__esModule",{value:!0});It.adaptSpecialVocabulary=It.adaptDirectionVocabulary=It.adaptVerbVocabulary=It.GrammarPatterns=It.vocabularyRegistry=It.VocabularyRegistry=It.PartOfSpeech=It.ParseErrorType=It.ParserFactory=void 0;var Ts=Xt();Object.defineProperty(It,"ParserFactory",{enumerable:!0,get:function(){return Ts.ParserFactory}});Object.defineProperty(It,"ParseErrorType",{enumerable:!0,get:function(){return Ts.ParseErrorType}});Object.defineProperty(It,"PartOfSpeech",{enumerable:!0,get:function(){return Ts.PartOfSpeech}});Object.defineProperty(It,"VocabularyRegistry",{enumerable:!0,get:function(){return Ts.VocabularyRegistry}});Object.defineProperty(It,"vocabularyRegistry",{enumerable:!0,get:function(){return Ts.vocabularyRegistry}});Object.defineProperty(It,"GrammarPatterns",{enumerable:!0,get:function(){return Ts.GrammarPatterns}});Object.defineProperty(It,"adaptVerbVocabulary",{enumerable:!0,get:function(){return Ts.adaptVerbVocabulary}});Object.defineProperty(It,"adaptDirectionVocabulary",{enumerable:!0,get:function(){return Ts.adaptDirectionVocabulary}});Object.defineProperty(It,"adaptSpecialVocabulary",{enumerable:!0,get:function(){return Ts.adaptSpecialVocabulary}})});var Vz=p(bb=>{"use strict";Object.defineProperty(bb,"__esModule",{value:!0});bb.CommandValidator=void 0;var We=Ce(),Use=kp(),CP=class{constructor(e,r,n){d(this,"world");d(this,"actionRegistry");d(this,"scopeResolver");d(this,"systemEvents");d(this,"currentActionId");this.world=e,this.actionRegistry=r,this.scopeResolver=n||new Use.StandardScopeResolver(e)}setSystemEventSource(e){this.systemEvents=e}validate(e){let r=Date.now(),n=[],i=this.actionRegistry.get(e.action);if(!i){let g=e.structure?.verb?.text||e.action,h=this.actionRegistry.findByPattern(g);h.length>0&&(i=h[0])}if(!i)return{success:!1,error:{type:"VALIDATION_ERROR",code:"ACTION_NOT_AVAILABLE",parsed:e,details:{action:e.action}}};this.currentActionId=i.id;let o;if(e.structure?.directObject){let g=e.structure.directObject;if(g.isAll||g.isList)o=void 0;else{let y=this.getActionMetadata(i).directObjectScope||We.ScopeLevel.VISIBLE,_=this.resolveEntity(g,"direct",y,e);if(!_.success)return _;o=_.value}}let a;if(e.structure?.indirectObject){let h=this.getActionMetadata(i).indirectObjectScope||We.ScopeLevel.VISIBLE,y=this.resolveEntity(e.structure.indirectObject,"indirect",h,e);if(!y.success)return y;a=y.value}let s;if(e.instrument){let g=this.resolveEntity(e.instrument,"instrument",We.ScopeLevel.REACHABLE,e);if(!g.success)return g;s=g.value}let c=this.getActionMetadata(i);if(o&&c.directObjectScope){let g=this.checkEntityScope(o.entity,c.directObjectScope,o.parsed.text);if(!g.success)return{success:!1,error:{type:"VALIDATION_ERROR",code:"ENTITY_NOT_VISIBLE",parsed:e,details:{entity:o.entity.id,entityName:o.parsed.text,scopeCode:g.code}}}}if(a&&c.indirectObjectScope){let g=this.checkEntityScope(a.entity,c.indirectObjectScope,a.parsed.text);if(!g.success)return{success:!1,error:{type:"VALIDATION_ERROR",code:"ENTITY_NOT_VISIBLE",parsed:e,details:{entity:a.entity.id,entityName:a.parsed.text,scopeCode:g.code}}}}let l=this.checkActionPreconditions(i,o?.entity,a?.entity);if(!l.success)return{success:!1,error:{type:"VALIDATION_ERROR",code:"PRECONDITION_FAILED",parsed:e,details:l.details}};let u=Date.now()-r,m={};if(o){let g=this.world.getPlayer(),h=this.scopeResolver.getScope(g,o.entity),y=this.getPerceivedSenses(g,o.entity);m.directObject={level:h,perceivedBy:y}}if(a){let g=this.world.getPlayer(),h=this.scopeResolver.getScope(g,a.entity),y=this.getPerceivedSenses(g,a.entity);m.indirectObject={level:h,perceivedBy:y}}if(s){let g=this.world.getPlayer(),h=this.scopeResolver.getScope(g,s.entity),y=this.getPerceivedSenses(g,s.entity);m.instrument={level:h,perceivedBy:y}}return{success:!0,value:{parsed:e,actionId:i.id,directObject:o,indirectObject:a,instrument:s,metadata:{validationTime:u,warnings:n.length>0?n:void 0},...Object.keys(m).length>0&&{scopeInfo:m}}}}resolveWithSelection(e,r){let n=Date.now(),i=[],o=this.actionRegistry.get(e.action);if(!o){let h=e.structure?.verb?.text||e.action,y=this.actionRegistry.findByPattern(h);y.length>0&&(o=y[0])}if(!o)return{success:!1,error:{type:"VALIDATION_ERROR",code:"ACTION_NOT_AVAILABLE",parsed:e,details:{action:e.action}}};this.currentActionId=o.id;let a;if(e.structure?.directObject){let h=e.structure.directObject;if(h.isAll||h.isList)a=void 0;else if(r.directObject){let y=this.world.getEntity(r.directObject);if(!y)return{success:!1,error:{type:"VALIDATION_ERROR",code:"ENTITY_NOT_FOUND",parsed:e,details:{slot:"directObject",selectedId:r.directObject,reason:"Selected entity no longer exists"}}};a={entity:y,parsed:h}}else{let _=this.getActionMetadata(o).directObjectScope||We.ScopeLevel.VISIBLE,v=this.resolveEntity(h,"direct",_,e);if(!v.success)return v;a=v.value}}let s;if(e.structure?.indirectObject)if(r.indirectObject){let h=this.world.getEntity(r.indirectObject);if(!h)return{success:!1,error:{type:"VALIDATION_ERROR",code:"ENTITY_NOT_FOUND",parsed:e,details:{slot:"indirectObject",selectedId:r.indirectObject,reason:"Selected entity no longer exists"}}};s={entity:h,parsed:e.structure.indirectObject}}else{let y=this.getActionMetadata(o).indirectObjectScope||We.ScopeLevel.VISIBLE,_=this.resolveEntity(e.structure.indirectObject,"indirect",y,e);if(!_.success)return _;s=_.value}let c;if(e.instrument)if(r.instrument){let h=this.world.getEntity(r.instrument);if(!h)return{success:!1,error:{type:"VALIDATION_ERROR",code:"ENTITY_NOT_FOUND",parsed:e,details:{slot:"instrument",selectedId:r.instrument,reason:"Selected entity no longer exists"}}};c={entity:h,parsed:e.instrument}}else{let h=this.resolveEntity(e.instrument,"instrument",We.ScopeLevel.REACHABLE,e);if(!h.success)return h;c=h.value}let l=this.getActionMetadata(o);if(a&&l.directObjectScope){let h=this.checkEntityScope(a.entity,l.directObjectScope,a.parsed.text);if(!h.success)return{success:!1,error:{type:"VALIDATION_ERROR",code:"ENTITY_NOT_VISIBLE",parsed:e,details:{entity:a.entity.id,entityName:a.parsed.text,scopeCode:h.code}}}}if(s&&l.indirectObjectScope){let h=this.checkEntityScope(s.entity,l.indirectObjectScope,s.parsed.text);if(!h.success)return{success:!1,error:{type:"VALIDATION_ERROR",code:"ENTITY_NOT_VISIBLE",parsed:e,details:{entity:s.entity.id,entityName:s.parsed.text,scopeCode:h.code}}}}let u=this.checkActionPreconditions(o,a?.entity,s?.entity);if(!u.success)return{success:!1,error:{type:"VALIDATION_ERROR",code:"PRECONDITION_FAILED",parsed:e,details:u.details}};let m=Date.now()-n,f={};if(a){let h=this.world.getPlayer(),y=this.scopeResolver.getScope(h,a.entity),_=this.getPerceivedSenses(h,a.entity);f.directObject={level:y,perceivedBy:_}}if(s){let h=this.world.getPlayer(),y=this.scopeResolver.getScope(h,s.entity),_=this.getPerceivedSenses(h,s.entity);f.indirectObject={level:y,perceivedBy:_}}if(c){let h=this.world.getPlayer(),y=this.scopeResolver.getScope(h,c.entity),_=this.getPerceivedSenses(h,c.entity);f.instrument={level:y,perceivedBy:_}}let g={parsed:e,actionId:o.id,directObject:a,indirectObject:s,instrument:c,metadata:{validationTime:m,warnings:i.length>0?i:void 0},...Object.keys(f).length>0&&{scopeInfo:f}};return this.emitDebugEvent("entity_resolution",e,{method:"resolveWithSelection",selections:r,success:!0}),{success:!0,value:g}}resolveEntity(e,r,n,i){if(!e)throw new Error("Cannot resolve undefined reference");if(this.emitDebugEvent("entity_resolution",i,{objectType:r,reference:e,requiredScope:n,startTime:Date.now()}),e.entityId){let h=this.resolveEntityById(e.entityId,e);if(h)return this.emitDebugEvent("entity_resolution",i,{objectType:r,preResolvedEntityId:e.entityId,entity:h.entity.id}),{success:!0,value:h}}let o=e.head||e.text,a=[];if(n===We.ScopeLevel.AWARE)a=this.world.getAllEntities().filter(h=>h.type!=="room"&&h.id!==this.world.getPlayer()?.id),a=a.filter(h=>{let y=this.getEntityName(h).toLowerCase(),_=h.type?.toLowerCase()||"",v=this.getEntitySynonyms(h).map(T=>T.toLowerCase()),E=o.toLowerCase();return y===E||_===E||v.includes(E)});else{let h=this.getEntitiesByName(o);a=h;let y=this.getEntitiesByType(o);a.push(...y);let _=this.getEntitiesBySynonym(o);if(a.push(..._),this.emitDebugEvent("entity_search",i,{searchTerm:o,byName:h.length,byType:y.length,bySynonym:_.length,totalBeforeDedupe:a.length}),a=a.filter((v,E,T)=>T.findIndex(O=>O.id===v.id)===E),a.length===0){let v=this.getEntitiesByAdjective(o);v.length>0&&(a=v,this.emitDebugEvent("entity_search",i,{searchTerm:o,byAdjective:v.length,fallback:!0}))}}let c=this.filterByScope(a,n);if(c.length===0&&a.length>0){let h=this.getEntitiesByAdjective(o);if(h.length>0){let y=this.filterByScope(h,n);y.length>0&&(a=h,c=y,this.emitDebugEvent("entity_search",i,{searchTerm:o,byAdjective:h.length,adjectiveInScope:y.length,fallbackAfterScope:!0}))}}let l=[],u=this.world.getPlayer();if(u)for(let h of a){let y=this.scopeResolver.getScope(u,h);l.push({id:h.id,name:this.getEntityName(h),type:h.type,location:this.world.getLocation(h.id),scope:y,meetsRequired:this.filterByScope([h],n).length>0,visible:this.isEntityVisible(h),reachable:this.isEntityReachable(h),touchable:this.isEntityTouchable(h)})}this.emitDebugEvent("scope_check",i,{objectType:r,requiredScope:n,totalCandidates:a.length,entitiesInScope:c.length,candidateScopes:l,scopeDetails:c.map(h=>({id:h.id,name:this.getEntityName(h),visible:this.isEntityVisible(h),reachable:this.isEntityReachable(h),touchable:this.isEntityTouchable(h)}))});let f=this.scoreEntities(c,e).filter(h=>h.score>0);if(f.length===0)return this.emitDebugEvent("validation_error",i,{errorType:"NO_MATCHES",reference:e,scope:n,checkedEntities:c.length}),{success:!1,error:{type:"VALIDATION_ERROR",code:"ENTITY_NOT_FOUND",parsed:i,details:{searchText:e.text,candidates:e.candidates,scope:n}}};if(f.length>1){let h=this.resolveAmbiguity(f,e,i);if(h)return{success:!0,value:{entity:h.entity,parsed:e}};let y=e.modifiers||[];if(y.length===0&&e.text&&e.head){let v=e.head.toLowerCase(),E=e.text.toLowerCase().split(/\s+/).filter(O=>O!==v),T=["the","a","an","all","some","every","any","my"];y=E.filter(O=>!T.includes(O))}if(y.length>0&&!f.some(E=>E.matchReasons.some(T=>T.startsWith("modifier_match_"))))return this.emitDebugEvent("entity_resolution",i,{objectType:r,resolved:!1,reason:"modifiers_not_matched",searchText:e.text,specifiedModifiers:y}),{success:!1,error:{type:"VALIDATION_ERROR",code:"ENTITY_NOT_FOUND",parsed:i,details:{searchText:e.text,modifiers:y,nearMatches:f.slice(0,3).map(E=>this.getEntityName(E.entity))}}};let _=f.slice(0,5).map(v=>({id:v.entity.id,name:this.getEntityName(v.entity),description:this.getEntityDescription(v.entity),score:v.score,matchReasons:v.matchReasons}));return this.emitDebugEvent("disambiguation_required",i,{objectType:r,searchText:e.text,candidateCount:f.length,topCandidates:_}),{success:!1,error:{type:"VALIDATION_ERROR",code:"AMBIGUOUS_ENTITY",parsed:i,details:{ambiguousEntities:_,searchText:e.text,matchCount:f.length,objectType:r}}}}let g=f[0];return this.emitDebugEvent("entity_resolution",i,{objectType:r,resolved:!0,entity:g.entity.id,score:g.score,matchReasons:g.matchReasons}),{success:!0,value:{entity:g.entity,parsed:e}}}getEntitiesByName(e){let r=e.toLowerCase();return this.world.findWhere(n=>n.type==="room"||n.id===this.world.getPlayer()?.id?!1:this.getEntityName(n).toLowerCase()===r)}getEntitiesByType(e){let r=e.toLowerCase();return this.world.findByType(r)}getEntitiesBySynonym(e){let r=e.toLowerCase();return this.world.findWhere(n=>n.type==="room"||n.id===this.world.getPlayer()?.id?!1:this.getEntitySynonyms(n).map(o=>o.toLowerCase()).includes(r))}getEntitiesByAdjective(e){let r=e.toLowerCase();return this.world.findWhere(n=>n.type==="room"||n.id===this.world.getPlayer()?.id?!1:this.getEntityAdjectives(n).map(o=>o.toLowerCase()).includes(r))}filterByScope(e,r){let n=this.world.getPlayer();return n?e.filter(i=>{let o=this.scopeResolver.getScope(n,i);switch(r){case We.ScopeLevel.CARRIED:return o===We.ScopeLevel.CARRIED;case We.ScopeLevel.REACHABLE:return o===We.ScopeLevel.CARRIED||o===We.ScopeLevel.REACHABLE;case We.ScopeLevel.VISIBLE:return o===We.ScopeLevel.CARRIED||o===We.ScopeLevel.REACHABLE||o===We.ScopeLevel.VISIBLE;case We.ScopeLevel.AWARE:let a=this.scopeResolver.canHear&&this.scopeResolver.canHear(n,i),s=this.scopeResolver.canSmell&&this.scopeResolver.canSmell(n,i);return a||s||o>=We.ScopeLevel.AWARE;default:return o>=r}}):[]}scoreEntities(e,r){if(!r)return[];let n=[],i=(r.head||r.text).toLowerCase(),o=r.modifiers||[];if(o.length===0&&r.text&&r.head){let a=r.head.toLowerCase(),s=r.text.toLowerCase().split(/\s+/).filter(l=>l!==a),c=["the","a","an","all","some","every","any","my"];o=s.filter(l=>!c.includes(l))}for(let a of e){let s=0,c=[],l=this.getEntityName(a).toLowerCase(),u=a.type?.toLowerCase()||"",m=this.getEntityAdjectives(a).map(h=>h.toLowerCase()),f=this.getEntitySynonyms(a).map(h=>h.toLowerCase());l===i?(s+=10,c.push("exact_name_match")):u===i?(s+=8,c.push("type_match")):f.includes(i)?(s+=6,c.push("synonym_match")):m.includes(i)&&(s+=4,c.push("adjective_match"));for(let h of o)m.includes(h.toLowerCase())&&(s+=5,c.push(`modifier_match_${h}`));o.length===0&&m.length>0&&(s-=1,c.push("unspecified_adjectives")),this.isEntityVisible(a)&&(s+=1,c.push("visible")),this.isEntityReachable(a)&&(s+=1,c.push("reachable")),this.isInPlayerInventory(a)&&(s+=2,c.push("in_inventory"));let g=this.currentActionId;if(g&&typeof a.scope=="function"){let h=a.scope(g),y=Math.round((h-100)/10);y!==0&&(s+=y,c.push(`scope_priority_${h}`))}s>0&&n.push({entity:a,score:s,matchReasons:c})}return n.sort((a,s)=>s.score-a.score),n}resolveAmbiguity(e,r,n){if(this.emitDebugEvent("ambiguity_resolution",n,{reference:r,matchCount:e.length,topMatches:e.slice(0,5).map(o=>({entity:o.entity.id,name:this.getEntityName(o.entity),score:o.score,reasons:o.matchReasons}))}),e.length>=2){let o=e[0].score,a=e[1].score;if(o>=a*1.5)return this.emitDebugEvent("ambiguity_resolution",n,{resolved:!0,method:"score_threshold",chosen:e[0].entity.id,scoreGap:o-a}),e[0]}if(r&&r.modifiers&&r.modifiers.length>0){let o=e.filter(a=>{let s=this.getEntityAdjectives(a.entity).map(c=>c.toLowerCase());return r.modifiers.every(c=>s.includes(c.toLowerCase()))});if(o.length===1)return this.emitDebugEvent("ambiguity_resolution",n,{resolved:!0,method:"all_modifiers_match",chosen:o[0].entity.id}),o[0]}let i=e.filter(o=>this.isEntityVisible(o.entity)&&this.isEntityReachable(o.entity));return i.length===1?(this.emitDebugEvent("ambiguity_resolution",n,{resolved:!0,method:"only_reachable",chosen:i[0].entity.id}),i[0]):(this.emitDebugEvent("ambiguity_resolution",n,{resolved:!1,method:"none",remainingCount:e.length}),null)}resolveEntityById(e,r){let n=this.world.getEntity(e);return n?{entity:n,parsed:r}:null}isEntityVisible(e){let r=this.world.getPlayer();return r?this.scopeResolver.canSee(r,e):!1}isEntityReachable(e){let r=this.world.getPlayer();return r?this.scopeResolver.canReach(r,e):!1}isEntityTouchable(e){return!(!this.isEntityReachable(e)||e.has&&e.has("intangible"))}isInPlayerInventory(e){let r=this.world.getPlayer();return r?this.world.getContents(r.id).some(i=>i.id===e.id):!1}checkEntityScope(e,r,n){let i=this.world.getPlayer();if(!i)return{success:!1,code:"NO_PLAYER"};let o=this.scopeResolver.getScope(i,e);switch(r){case We.ScopeLevel.CARRIED:if(o!==We.ScopeLevel.CARRIED)return{success:!1,code:"NOT_CARRIED"};break;case We.ScopeLevel.REACHABLE:if(o!==We.ScopeLevel.CARRIED&&o!==We.ScopeLevel.REACHABLE)return{success:!1,code:"NOT_REACHABLE"};break;case We.ScopeLevel.VISIBLE:if(o<We.ScopeLevel.VISIBLE)return{success:!1,code:"NOT_VISIBLE"};break;case We.ScopeLevel.AWARE:if(o===We.ScopeLevel.UNAWARE)return{success:!1,code:"NOT_AWARE"};break}return{success:!0}}getPerceivedSenses(e,r){let n=[];return this.scopeResolver.canSee(e,r)&&n.push("sight"),this.scopeResolver.canHear&&this.scopeResolver.canHear(e,r)&&n.push("hearing"),this.scopeResolver.canSmell&&this.scopeResolver.canSmell(e,r)&&n.push("smell"),this.scopeResolver.canReach(e,r)&&n.push("touch"),n}getEntityName(e){let r=e.name;return typeof r=="string"?r:e.type||e.id}getEntityDescription(e){return e.description||this.getEntityName(e)}getEntityAdjectives(e){let r=[],n=e.get("identity");if(n&&typeof n=="object"&&"adjectives"in n){let i=n.adjectives;Array.isArray(i)&&r.push(...i.map(String))}return r}getEntitySynonyms(e){let r=[],n=e.get("identity");if(n&&typeof n=="object"&&"aliases"in n){let i=n.aliases;Array.isArray(i)&&r.push(...i.map(String))}return e.type&&r.push(e.type),r}getActionMetadata(e){return e.metadata&&"requiresDirectObject"in e.metadata&&"requiresIndirectObject"in e.metadata?e.metadata:{requiresDirectObject:!1,requiresIndirectObject:!1,directObjectScope:We.ScopeLevel.VISIBLE,indirectObjectScope:We.ScopeLevel.VISIBLE}}checkActionPreconditions(e,r,n){return e.metadata&&typeof e.metadata.validate=="function"?e.metadata.validate(r,n):{success:!0,message:"OK"}}emitDebugEvent(e,r,n){this.systemEvents&&this.systemEvents.emit({id:`validator_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,timestamp:Date.now(),subsystem:"validator",type:e,data:{command:r,...n}})}};bb.CommandValidator=CP});var Yz=p(Ob=>{"use strict";Object.defineProperty(Ob,"__esModule",{value:!0});Ob.CommandValidator=void 0;var qse=Vz();Object.defineProperty(Ob,"CommandValidator",{enumerable:!0,get:function(){return qse.CommandValidator}})});var $z=p(Wr=>{"use strict";Object.defineProperty(Wr,"__esModule",{value:!0});Wr.commonPrepositions=Wr.specialVocabulary=Wr.standardDirections=Wr.standardVerbs=void 0;Wr.registerStandardVocabulary=zz;var Ib=wP();Wr.standardVerbs=[{actionId:"GO",verbs:["go","walk","move","travel","head"],pattern:"verb_direction"},{actionId:"TAKE",verbs:["take","get","pick","grab","acquire","obtain"],pattern:"verb_noun"},{actionId:"DROP",verbs:["drop","put","place","leave","discard"],pattern:"verb_noun"},{actionId:"EXAMINE",verbs:["examine","look","x","ex","inspect","study","observe"],pattern:"verb_noun",prepositions:["at"]},{actionId:"OPEN",verbs:["open","unlock"],pattern:"verb_noun"},{actionId:"CLOSE",verbs:["close","shut","lock"],pattern:"verb_noun"},{actionId:"INVENTORY",verbs:["inventory","inv","i"],pattern:"verb_only"},{actionId:"LOOK",verbs:["look","l"],pattern:"verb_only"},{actionId:"PUT",verbs:["put","place","insert","deposit"],pattern:"verb_noun_prep_noun",prepositions:["in","into","on","onto","under","behind"]},{actionId:"USE",verbs:["use","apply","activate"],pattern:"verb_noun"},{actionId:"TALK",verbs:["talk","speak","say","tell","ask"],pattern:"verb_prep_noun",prepositions:["to","with"]},{actionId:"GIVE",verbs:["give","offer","hand"],pattern:"verb_noun_prep_noun",prepositions:["to"]},{actionId:"ATTACK",verbs:["attack","hit","strike","fight","kill"],pattern:"verb_noun"},{actionId:"WAIT",verbs:["wait","z"],pattern:"verb_only"},{actionId:"SAVE",verbs:["save"],pattern:"verb_only"},{actionId:"LOAD",verbs:["load","restore"],pattern:"verb_only"},{actionId:"QUIT",verbs:["quit","exit","q"],pattern:"verb_only"},{actionId:"author.trace",verbs:["trace"],pattern:"verb_noun"}];Wr.standardDirections=[{direction:"NORTH",words:["north"],abbreviations:["n"]},{direction:"SOUTH",words:["south"],abbreviations:["s"]},{direction:"EAST",words:["east"],abbreviations:["e"]},{direction:"WEST",words:["west"],abbreviations:["w"]},{direction:"NORTHEAST",words:["northeast"],abbreviations:["ne"]},{direction:"NORTHWEST",words:["northwest"],abbreviations:["nw"]},{direction:"SOUTHEAST",words:["southeast"],abbreviations:["se"]},{direction:"SOUTHWEST",words:["southwest"],abbreviations:["sw"]},{direction:"UP",words:["up","upward","upwards"],abbreviations:["u"]},{direction:"DOWN",words:["down","downward","downwards"],abbreviations:["d"]},{direction:"IN",words:["in","inside","enter"],abbreviations:[]},{direction:"OUT",words:["out","outside","exit","leave"],abbreviations:[]}];Wr.specialVocabulary={pronouns:["it","them","that","those","this","these"],allWords:["all","everything","every"],exceptWords:["except","but"],articles:["a","an","the","some"]};Wr.commonPrepositions=["in","into","on","onto","at","to","from","with","under","over","behind","beside","through","across","between","among"];function zz(){Ib.vocabularyRegistry.registerVerbs(Wr.standardVerbs),Ib.vocabularyRegistry.registerDirections(Wr.standardDirections),Ib.vocabularyRegistry.registerSpecial(Wr.specialVocabulary),Ib.vocabularyRegistry.registerProvider({id:"standard-prepositions",priority:100,getVocabulary:()=>Wr.commonPrepositions.map(t=>({word:t,partOfSpeech:"preposition",mapsTo:t.toUpperCase(),source:"base"}))})}zz()});var Kz=p(Ou=>{"use strict";var Fse=Ou&&Ou.__createBinding||(Object.create?(function(t,e,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}):(function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]})),Gse=Ou&&Ou.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&Fse(e,t,r)};Object.defineProperty(Ou,"__esModule",{value:!0});Gse($z(),Ou)});var Qz=p(Sb=>{"use strict";Object.defineProperty(Sb,"__esModule",{value:!0});Sb.ScoringCapabilitySchema=void 0;Sb.ScoringCapabilitySchema={scoreValue:{type:"number",default:0,required:!0},maxScore:{type:"number",default:0,required:!0},moves:{type:"number",default:0,required:!1},achievements:{type:"array",default:[],required:!1},scoreHistory:{type:"array",default:[],required:!1},scoredTreasures:{type:"array",default:[],required:!1}}});var Xz=p(Ab=>{"use strict";Object.defineProperty(Ab,"__esModule",{value:!0});Ab.SaveRestoreCapabilitySchema=void 0;Ab.SaveRestoreCapabilitySchema={saves:{type:"object",default:{},required:!0},lastSave:{type:"string",default:"",required:!1},autoSaveEnabled:{type:"boolean",default:!0,required:!1},maxSaveSlots:{type:"number",default:10,required:!1}}});var Zz=p(Rb=>{"use strict";Object.defineProperty(Rb,"__esModule",{value:!0});Rb.ConversationCapabilitySchema=void 0;Rb.ConversationCapabilitySchema={states:{type:"object",default:{},required:!0},globalTopics:{type:"array",default:[],required:!1},conversationHistory:{type:"array",default:[],required:!1}}});var Jz=p(wb=>{"use strict";Object.defineProperty(wb,"__esModule",{value:!0});wb.GameMetaCapabilitySchema=void 0;wb.GameMetaCapabilitySchema={turnCount:{type:"number",default:0,required:!0},startTime:{type:"number",default:0,required:!0},lastAction:{type:"string",default:"",required:!1},preferences:{type:"object",default:{verboseMode:!1,briefMode:!1,scoring:!0},required:!0}}});var e$=p(Cb=>{"use strict";Object.defineProperty(Cb,"__esModule",{value:!0});Cb.CommandHistoryCapabilitySchema=void 0;Cb.CommandHistoryCapabilitySchema={entries:{type:"array",default:[],required:!0},maxEntries:{type:"number",default:100,required:!1}}});var t$=p(Qc=>{"use strict";Object.defineProperty(Qc,"__esModule",{value:!0});Qc.DEBUG_CAPABILITY=Qc.DebugCapabilitySchema=void 0;Qc.isAnyDebugEnabled=Vse;Qc.createDefaultDebugData=Yse;Qc.DebugCapabilitySchema={debugParserEvents:{type:"boolean",default:!1,required:!1},debugValidationEvents:{type:"boolean",default:!1,required:!1},debugSystemEvents:{type:"boolean",default:!1,required:!1},debugEngineEvents:{type:"boolean",default:!1,required:!1},debugTextEvents:{type:"boolean",default:!1,required:!1}};Qc.DEBUG_CAPABILITY="debug";function Vse(t){return t?!!(t.debugParserEvents||t.debugValidationEvents||t.debugSystemEvents||t.debugEngineEvents||t.debugTextEvents):!1}function Yse(){return{debugParserEvents:!1,debugValidationEvents:!1,debugSystemEvents:!1,debugEngineEvents:!1,debugTextEvents:!1}}});var s$=p(tt=>{"use strict";Object.defineProperty(tt,"__esModule",{value:!0});tt.StandardCapabilitySchemas=tt.createDefaultDebugData=tt.isAnyDebugEnabled=tt.DEBUG_CAPABILITY=tt.DebugCapabilitySchema=tt.CommandHistoryCapabilitySchema=tt.GameMetaCapabilitySchema=tt.ConversationCapabilitySchema=tt.SaveRestoreCapabilitySchema=tt.ScoringCapabilitySchema=void 0;tt.registerStandardCapabilities=zse;var Cm=b(),r$=Qz();Object.defineProperty(tt,"ScoringCapabilitySchema",{enumerable:!0,get:function(){return r$.ScoringCapabilitySchema}});var n$=Xz();Object.defineProperty(tt,"SaveRestoreCapabilitySchema",{enumerable:!0,get:function(){return n$.SaveRestoreCapabilitySchema}});var i$=Zz();Object.defineProperty(tt,"ConversationCapabilitySchema",{enumerable:!0,get:function(){return i$.ConversationCapabilitySchema}});var o$=Jz();Object.defineProperty(tt,"GameMetaCapabilitySchema",{enumerable:!0,get:function(){return o$.GameMetaCapabilitySchema}});var a$=e$();Object.defineProperty(tt,"CommandHistoryCapabilitySchema",{enumerable:!0,get:function(){return a$.CommandHistoryCapabilitySchema}});var zp=t$();Object.defineProperty(tt,"DebugCapabilitySchema",{enumerable:!0,get:function(){return zp.DebugCapabilitySchema}});Object.defineProperty(tt,"DEBUG_CAPABILITY",{enumerable:!0,get:function(){return zp.DEBUG_CAPABILITY}});Object.defineProperty(tt,"isAnyDebugEnabled",{enumerable:!0,get:function(){return zp.isAnyDebugEnabled}});Object.defineProperty(tt,"createDefaultDebugData",{enumerable:!0,get:function(){return zp.createDefaultDebugData}});tt.StandardCapabilitySchemas={[Cm.StandardCapabilities.SCORING]:r$.ScoringCapabilitySchema,[Cm.StandardCapabilities.SAVE_RESTORE]:n$.SaveRestoreCapabilitySchema,[Cm.StandardCapabilities.CONVERSATION]:i$.ConversationCapabilitySchema,[Cm.StandardCapabilities.GAME_META]:o$.GameMetaCapabilitySchema,[Cm.StandardCapabilities.COMMAND_HISTORY]:a$.CommandHistoryCapabilitySchema,[Cm.StandardCapabilities.DEBUG]:zp.DebugCapabilitySchema};function zse(t,e=Object.keys(tt.StandardCapabilitySchemas)){for(let r of e){let n=tt.StandardCapabilitySchemas[r];n&&t.registerCapability(r,{schema:n})}}});var c$=p($p=>{"use strict";Object.defineProperty($p,"__esModule",{value:!0});$p.QuitQueryHandler=void 0;$p.createQuitQueryHandler=$se;var oo=Je(),Nb=class{constructor(){d(this,"eventSource",(0,oo.createSemanticEventSource)())}canHandle(e){return e.source===oo.QuerySource.SYSTEM&&(e.type===oo.QueryType.YES_NO||e.type===oo.QueryType.MULTIPLE_CHOICE)&&(e.messageId==="quit_confirmation"||e.messageId==="quit_confirm_query"||e.messageId==="quit_unsaved_query"||e.messageId==="quit_save_query")}handleResponse(e,r){let n=[],i=r.context,o=r.options?.[e.selectedIndex||0]||e.response;if(typeof o=="boolean")if(o===!0){let a={score:i.score,moves:i.moves,hasUnsavedChanges:i.hasUnsavedProgress||!1,force:!0,stats:{maxScore:i.maxScore,nearComplete:i.nearComplete}},s=(0,oo.createQuitRequestedEvent)(a);n.push(s),n.push(this.createEvent("query.handled",{queryId:r.id,action:"quit_confirmed",savedBeforeQuit:!1}))}else{let a=(0,oo.createQuitCancelledEvent)();n.push(a),n.push(this.createEvent("query.handled",{queryId:r.id,action:"quit_cancelled"}))}else switch(o){case"quit":case"quit_without_saving":case"yes":let a={score:i.score,moves:i.moves,hasUnsavedChanges:i.hasUnsavedProgress||!1,force:!0,stats:{maxScore:i.maxScore,nearComplete:i.nearComplete}},s=(0,oo.createQuitRequestedEvent)(a);n.push(s),n.push(this.createEvent("query.handled",{queryId:r.id,action:"quit_confirmed",savedBeforeQuit:!1}));break;case"save_and_quit":n.push(this.createEvent("platform.save_requested",{saveName:"autosave",autosave:!0,timestamp:Date.now(),metadata:{reason:"quit",score:i.score,moves:i.moves}}));let c={score:i.score,moves:i.moves,hasUnsavedChanges:!1,force:!0,stats:{maxScore:i.maxScore,savedBeforeQuit:!0}},l=(0,oo.createQuitRequestedEvent)(c);n.push(l),n.push(this.createEvent("query.handled",{queryId:r.id,action:"save_and_quit",savedBeforeQuit:!0}));break;default:let u=(0,oo.createQuitCancelledEvent)();n.push(u),n.push(this.createEvent("query.handled",{queryId:r.id,action:"quit_cancelled"}));break}for(let a of n)this.eventSource.emit(a)}handleTimeout(e){let r=(0,oo.createQuitCancelledEvent)();this.eventSource.emit(r),this.eventSource.emit(this.createEvent("query.timeout",{queryId:e.id,action:"quit_cancelled",reason:"timeout"}))}handleCancel(e){let r=(0,oo.createQuitCancelledEvent)();this.eventSource.emit(r),this.eventSource.emit(this.createEvent("query.cancelled",{queryId:e.id,action:"quit_cancelled",reason:"cancelled"}))}getEventSource(){return this.eventSource}createEvent(e,r){return{id:`evt_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:e,timestamp:Date.now(),entities:{},data:r}}};$p.QuitQueryHandler=Nb;function $se(){return new Nb}});var l$=p(Kp=>{"use strict";Object.defineProperty(Kp,"__esModule",{value:!0});Kp.RestartQueryHandler=void 0;Kp.createRestartQueryHandler=Kse;var ao=Je(),Db=class{constructor(){d(this,"eventSource",(0,ao.createSemanticEventSource)())}canHandle(e){return e.source===ao.QuerySource.SYSTEM&&(e.type===ao.QueryType.YES_NO||e.type===ao.QueryType.MULTIPLE_CHOICE)&&(e.messageId==="restart_confirmation"||e.messageId==="restart_confirm"||e.messageId==="restart_unsaved"||e.messageId==="restart_progress")}handleResponse(e,r){let n=[],i=r.context,o=r.options?.[e.selectedIndex||0]||e.response;if(typeof o=="boolean")if(o===!0){let a={currentProgress:{score:i.score,moves:i.moves,location:i.location},confirmationRequired:!1,hasUnsavedChanges:i.hasUnsavedProgress||!1,force:!0},s=(0,ao.createRestartRequestedEvent)(a);n.push(s),n.push(this.createEvent("query.handled",{queryId:r.id,action:"restart_confirmed",savedBeforeRestart:!1}))}else{let a=(0,ao.createRestartCompletedEvent)(!1);n.push(a),n.push(this.createEvent("query.handled",{queryId:r.id,action:"restart_cancelled"}))}else switch(o){case"restart":case"restart_without_saving":case"yes":let a={currentProgress:{score:i.score,moves:i.moves,location:i.location},confirmationRequired:!1,hasUnsavedChanges:i.hasUnsavedProgress||!1,force:!0},s=(0,ao.createRestartRequestedEvent)(a);n.push(s),n.push(this.createEvent("query.handled",{queryId:r.id,action:"restart_confirmed",savedBeforeRestart:!1}));break;case"save_and_restart":n.push(this.createEvent("platform.save_requested",{saveName:"before_restart",autosave:!0,timestamp:Date.now(),metadata:{reason:"restart",score:i.score,moves:i.moves,location:i.location}}));let c={currentProgress:{score:i.score,moves:i.moves,location:i.location},confirmationRequired:!1,hasUnsavedChanges:!1,force:!0},l=(0,ao.createRestartRequestedEvent)(c);n.push(l),n.push(this.createEvent("query.handled",{queryId:r.id,action:"save_and_restart",savedBeforeRestart:!0}));break;default:let u=(0,ao.createRestartCompletedEvent)(!1);n.push(u),n.push(this.createEvent("query.handled",{queryId:r.id,action:"restart_cancelled"}));break}for(let a of n)this.eventSource.emit(a)}handleTimeout(e){let r=(0,ao.createRestartCompletedEvent)(!1);this.eventSource.emit(r),this.eventSource.emit(this.createEvent("query.timeout",{queryId:e.id,action:"restart_cancelled",reason:"timeout"}))}handleCancel(e){let r=(0,ao.createRestartCompletedEvent)(!1);this.eventSource.emit(r),this.eventSource.emit(this.createEvent("query.cancelled",{queryId:e.id,action:"restart_cancelled",reason:"cancelled"}))}getEventSource(){return this.eventSource}createEvent(e,r){return{id:`evt_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:e,timestamp:Date.now(),entities:{},data:r}}};Kp.RestartQueryHandler=Db;function Kse(){return new Db}});var d$=p(Xc=>{"use strict";var Qse=Xc&&Xc.__createBinding||(Object.create?(function(t,e,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}):(function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]})),u$=Xc&&Xc.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&Qse(e,t,r)};Object.defineProperty(Xc,"__esModule",{value:!0});u$(c$(),Xc);u$(l$(),Xc)});var f$=p(Pb=>{"use strict";Object.defineProperty(Pb,"__esModule",{value:!0});Pb.PerceptionService=void 0;var m$=b(),NP=class{filterEvents(e,r,n){let i=this.getActorRoom(r,n);if(!i)return e;let o=this.canPerceive(r,i,n,"sight");return e.map(a=>!this.isVisualEvent(a)||o?a:this.createPerceptionBlockedEvent(a,r,i,n))}canPerceive(e,r,n,i){switch(i){case"sight":return this.canSeeVisually(e,r,n);case"hearing":return this.canHear(e,r,n);case"smell":return this.canSmell(e,r,n);case"touch":return this.canTouch(e,r,n);default:return!0}}canSeeVisually(e,r,n){return!(this.isBlind(e)||this.isWearingBlindfold(e,n)||m$.VisibilityBehavior.isDark(r,n))}canHear(e,r,n){return!0}canSmell(e,r,n){return!0}canTouch(e,r,n){return!0}isBlind(e){return!1}isWearingBlindfold(e,r){return!1}getActorRoom(e,r){return"getContainingRoom"in r&&r.getContainingRoom(e.id)||null}isVisualEvent(e){return e.type==="if.event.room.description"||e.type==="if.event.contents.listed"||e.type==="action.success"&&e.data?.messageId==="contents_list"}createPerceptionBlockedEvent(e,r,n,i){let o=this.getBlockReason(r,n,i),a={originalType:e.type,reason:o,sense:"sight",originalData:e.data};return{...e,type:"if.event.perception.blocked",data:a}}getBlockReason(e,r,n){return this.isBlind(e)?"blindness":this.isWearingBlindfold(e,n)?"blindfolded":m$.VisibilityBehavior.isDark(r,n)?"darkness":"unknown"}};Pb.PerceptionService=NP});var p$=p(Zc=>{"use strict";Object.defineProperty(Zc,"__esModule",{value:!0});Zc.ScoringService=Zc.DEFAULT_RANKS=void 0;var Xse=b();Zc.DEFAULT_RANKS=[{threshold:0,messageId:"if.rank.beginner",name:"Beginner"},{threshold:50,messageId:"if.rank.novice",name:"Novice"},{threshold:100,messageId:"if.rank.amateur",name:"Amateur"},{threshold:200,messageId:"if.rank.experienced",name:"Experienced"},{threshold:350,messageId:"if.rank.expert",name:"Expert"},{threshold:500,messageId:"if.rank.master",name:"Master"}];var DP=class{constructor(e,r={maxScore:350}){d(this,"world");d(this,"config");d(this,"definitions",new Map);d(this,"enabled");this.world=e,this.config=r,this.enabled=r.enabled??!0;let n=this.getScoringData();if(n&&(n.maxScore===void 0&&(n.maxScore=r.maxScore),n.scoredSources===void 0&&(n.scoredSources=[])),r.definitions)for(let[i,o]of Object.entries(r.definitions))this.definitions.set(i,o)}isEnabled(){return this.enabled}getScore(){return this.getScoringData()?.scoreValue??0}getMaxScore(){return this.getScoringData()?.maxScore??this.config.maxScore}setMaxScore(e){let r=this.getScoringData();r&&(r.maxScore=e)}getMoves(){return this.getScoringData()?.moves??0}incrementMoves(){let e=this.getScoringData();e&&(e.moves=(e.moves||0)+1)}getRankMessageId(){let e=this.getScore(),r=this.config.ranks??Zc.DEFAULT_RANKS,n=r[0]?.messageId??"if.rank.beginner";for(let i of r)e>=i.threshold&&(n=i.messageId);return n}getRank(){let e=this.getScore(),r=this.config.ranks??Zc.DEFAULT_RANKS,n=r[0]?.name??"Beginner";for(let i of r)e>=i.threshold&&(n=i.name??i.messageId);return n}hasScored(e){return this.getScoringData()?.scoredSources?.includes(e)??!1}scorePoints(e){if(!this.enabled||this.hasScored(e))return!1;let r=this.definitions.get(e);if(!r)return console.warn(`ScoringService: No definition found for sourceId "${e}"`),!1;let n=this.getScoringData();return n?(n.scoredSources||(n.scoredSources=[]),n.scoredSources.push(e),n.scoreValue=(n.scoreValue||0)+r.points,n.scoreHistory||(n.scoreHistory=[]),n.scoreHistory.push({points:r.points,sourceId:e,reasonMessageId:r.reasonMessageId,timestamp:Date.now()}),!0):!1}losePoints(e,r){if(!this.enabled)return;let n=this.getScoringData();if(!n)return;let i=r,o="if.score.lost";if(i===void 0){let a=this.definitions.get(e);if(a)i=a.points,o=a.reasonMessageId;else{console.warn(`ScoringService: No definition found for sourceId "${e}" and no overridePoints provided`);return}}n.scoreValue=(n.scoreValue||0)-i,n.scoreHistory||(n.scoreHistory=[]),n.scoreHistory.push({points:-i,sourceId:e,reasonMessageId:o,timestamp:Date.now()})}getDefinition(e){return this.definitions.get(e)}registerDefinition(e,r){this.definitions.set(e,r)}getScoredSources(){return this.getScoringData()?.scoredSources??[]}restoreScoredSources(e){let r=this.getScoringData();r&&(r.scoredSources=[...e])}getHistory(){return this.getScoringData()?.scoreHistory??[]}addPoints(e,r){let n=this.getScoringData();n&&(n.scoreValue=(n.scoreValue||0)+e,r&&(n.scoreHistory||(n.scoreHistory=[]),n.scoreHistory.push({points:e,sourceId:"legacy",reasonMessageId:r,timestamp:Date.now()})))}getScoringData(){return this.world.getCapability(Xse.StandardCapabilities.SCORING)??null}};Zc.ScoringService=DP});var g$=p(Lb=>{"use strict";Object.defineProperty(Lb,"__esModule",{value:!0});Lb.ScoringEventProcessor=void 0;var PP=class{constructor(e,r){d(this,"scoringService");d(this,"world");d(this,"treasures",new Map);d(this,"roomVisits",new Map);d(this,"sequences",new Map);d(this,"goals",new Map);d(this,"unlocks",new Map);d(this,"takenTreasures",new Set);d(this,"containerTreasures",new Set);d(this,"visitedRooms",new Set);d(this,"sequenceStates",new Map);d(this,"completedGoals",new Set);d(this,"triggeredUnlocks",new Set);d(this,"currentTurn",0);d(this,"defaultContainerId");d(this,"dynamicTreasureMode",!1);d(this,"dynamicContainerName");d(this,"onTreasureTake");d(this,"onTreasurePlace");this.scoringService=e,this.world=r}setDefaultContainer(e){return this.defaultContainerId=e,this}enableDynamicTreasures(e){return this.dynamicTreasureMode=!0,this.dynamicContainerName=e,this}setTreasureTakeCallback(e){return this.onTreasureTake=e,this}setTreasurePlaceCallback(e){return this.onTreasurePlace=e,this}registerTreasure(e){return!e.containerId&&this.defaultContainerId&&(e={...e,containerId:this.defaultContainerId}),this.treasures.set(e.entityId,e),this}registerTreasures(e){for(let r of e)this.registerTreasure(r);return this}registerRoomVisit(e,r){return this.roomVisits.set(e,{roomId:e,points:r}),this}registerSequence(e,r){return this.sequences.set(e,r),this.sequenceStates.set(e,{currentStep:0,lastStepTurn:0,completed:!1}),this}registerGoal(e,r){return this.goals.set(e,r),this}registerUnlock(e,r){return this.unlocks.set(e,r),this}initializeHandlers(e){return e.registerHandler("if.event.taken",r=>(this.handleTaken(r),[])),e.registerHandler("if.event.put_in",r=>(this.handlePutIn(r),[])),e.registerHandler("if.event.player_moved",r=>(this.handlePlayerMoved(r),[])),e.registerHandler("if.event.actor_moved",r=>(this.handlePlayerMoved(r),[])),this}handleTaken(e){let r=e,i=r.data?.itemId??r.itemId;if(!i)return;let o=this.treasures.get(i);if(o&&o.takePoints){this.takenTreasures.has(i)||(this.takenTreasures.add(i),this.onTreasureTake?this.onTreasureTake(i,o.takePoints):this.scoringService.addPoints(o.takePoints,`Took ${i}`),this.checkGoalsAndUnlocks());return}if(this.dynamicTreasureMode){let a=this.world.getEntity(i);if(!a)return;let s=a;if(!s.isTreasure)return;let c=s.treasureValue||0,l=s.treasureId||a.id;c>0&&!this.takenTreasures.has(l)&&(this.takenTreasures.add(l),this.onTreasureTake?this.onTreasureTake(l,c):this.scoringService.addPoints(c,`Took ${l}`),this.checkGoalsAndUnlocks())}}handlePutIn(e){let r=e,n=r.data,i=n?.itemId??r.itemId,o=n?.targetId??r.targetId;if(!i||!o)return;let a=this.treasures.get(i);if(a&&a.containerPoints){if(a.containerId&&a.containerId!==o)return;this.containerTreasures.has(i)||(this.containerTreasures.add(i),this.onTreasurePlace?this.onTreasurePlace(i,a.containerPoints):this.scoringService.addPoints(a.containerPoints,`Placed ${i} in container`),this.checkGoalsAndUnlocks());return}if(this.dynamicTreasureMode&&this.dynamicContainerName){let s=this.world.getEntity(o);if(!s||s.get("identity")?.name!==this.dynamicContainerName)return;let l=this.world.getEntity(i);if(!l)return;let u=l;if(!u.isTreasure)return;let m=u.trophyCaseValue||0,f=u.treasureId||l.id;m>0&&!this.containerTreasures.has(f)&&(this.containerTreasures.add(f),this.onTreasurePlace?this.onTreasurePlace(f,m):this.scoringService.addPoints(m,`Placed ${f} in container`),this.checkGoalsAndUnlocks())}}handlePlayerMoved(e){let r=e,i=r.data?.toRoomId??r.toRoomId;if(!i)return;let o=this.roomVisits.get(i);o&&(this.visitedRooms.has(i)||(this.visitedRooms.add(i),this.scoringService.addPoints(o.points,`Visited ${i}`),this.checkGoalsAndUnlocks()))}processEventForSequences(e){for(let[r,n]of this.sequences){let i=this.sequenceStates.get(r);if(!i||i.completed)continue;n.timeout&&i.currentStep>0&&this.currentTurn-i.lastStepTurn>n.timeout&&(i.currentStep=0,i.lastStepTurn=0);let o=n.steps[i.currentStep];o&&this.eventMatchesStep(e,o)&&(i.currentStep++,i.lastStepTurn=this.currentTurn,n.onStep&&n.onStep(i.currentStep-1,this),i.currentStep>=n.steps.length&&(i.completed=!0,n.onComplete(this),n.repeatable&&(i.currentStep=0,i.completed=!1),this.checkGoalsAndUnlocks()))}}incrementTurn(){this.currentTurn++}getSequenceProgress(e){return this.sequenceStates.get(e)}getGoalProgress(e){let r=this.goals.get(e);if(r){if(r.conditionFn){let n=r.conditionFn(this.world);return{completed:n?1:0,total:1,percentage:n?100:0,remaining:n?[]:["condition"],isComplete:n}}if(r.conditions){let n=r.conditions.length,i=[],o=0;for(let a=0;a<r.conditions.length;a++){let s=r.conditions[a];this.checkCondition(s)?o++:i.push(this.getConditionId(s,a))}return{completed:o,total:n,percentage:n>0?Math.round(o/n*100):100,remaining:i,isComplete:o===n}}return{completed:0,total:0,percentage:100,remaining:[],isComplete:!0}}}isGoalComplete(e){return this.completedGoals.has(e)}isUnlockTriggered(e){return this.triggeredUnlocks.has(e)}hasTakenTreasure(e){return this.takenTreasures.has(e)}hasPlacedTreasure(e){return this.containerTreasures.has(e)}hasVisitedRoom(e){return this.visitedRooms.has(e)}awardOnce(e,r,n){if(this.scoringService.hasScored(e))return!1;this.scoringService.addPoints(r,n||e);let i=this.scoringService.getScoredSources();return i.push(e),this.scoringService.restoreScoredSources(i),!0}getScoringService(){return this.scoringService}getWorld(){return this.world}getState(){let e={};for(let[r,n]of this.sequenceStates)e[r]={...n};return{takenTreasures:Array.from(this.takenTreasures),containerTreasures:Array.from(this.containerTreasures),visitedRooms:Array.from(this.visitedRooms),sequences:e,completedGoals:Array.from(this.completedGoals),triggeredUnlocks:Array.from(this.triggeredUnlocks),currentTurn:this.currentTurn}}restoreState(e){this.takenTreasures=new Set(e.takenTreasures),this.containerTreasures=new Set(e.containerTreasures),this.visitedRooms=new Set(e.visitedRooms),this.completedGoals=new Set(e.completedGoals),this.triggeredUnlocks=new Set(e.triggeredUnlocks),this.currentTurn=e.currentTurn;for(let[r,n]of Object.entries(e.sequences))this.sequenceStates.has(r)&&this.sequenceStates.set(r,{...n})}eventMatchesStep(e,r){if(e.type!==r.event)return!1;if(r.filter){let n=e.data;if(!n)return!1;for(let[i,o]of Object.entries(r.filter))if(n[i]!==o)return!1}return!0}checkCondition(e){switch(e.type){case"item_in_container":return this.world.getLocation(e.itemId)===e.containerId;case"item_taken":return this.takenTreasures.has(e.itemId);case"room_visited":return this.visitedRooms.has(e.roomId);case"achievement":return this.scoringService.hasScored(e.id);case"sequence_complete":return this.sequenceStates.get(e.sequenceId)?.completed??!1;case"score_reached":return this.scoringService.getScore()>=e.score;case"custom":return e.check(this.world);default:return!1}}getConditionId(e,r){switch(e.type){case"item_in_container":return`${e.itemId}\u2192${e.containerId}`;case"item_taken":return e.itemId;case"room_visited":return e.roomId;case"achievement":return e.id;case"sequence_complete":return e.sequenceId;case"score_reached":return`score:${e.score}`;case"custom":return`custom:${r}`;default:return`unknown:${r}`}}checkGoalsAndUnlocks(){for(let[e,r]of this.goals){if(this.completedGoals.has(e))continue;let n=this.getGoalProgress(e);n?.isComplete?(this.completedGoals.add(e),r.onComplete(this)):r.onProgress&&n&&r.onProgress(n,this)}for(let[e,r]of this.unlocks){if(this.triggeredUnlocks.has(e))continue;r.conditions.every(i=>this.checkCondition(i))&&(this.triggeredUnlocks.add(e),r.onUnlock(this))}}};Lb.ScoringEventProcessor=PP});var y$=p(Jc=>{"use strict";Object.defineProperty(Jc,"__esModule",{value:!0});Jc.ScoringEventProcessor=Jc.DEFAULT_RANKS=Jc.ScoringService=void 0;var h$=p$();Object.defineProperty(Jc,"ScoringService",{enumerable:!0,get:function(){return h$.ScoringService}});Object.defineProperty(Jc,"DEFAULT_RANKS",{enumerable:!0,get:function(){return h$.DEFAULT_RANKS}});var Zse=g$();Object.defineProperty(Jc,"ScoringEventProcessor",{enumerable:!0,get:function(){return Zse.ScoringEventProcessor}})});var v$=p(Jo=>{"use strict";Object.defineProperty(Jo,"__esModule",{value:!0});Jo.ScoringEventProcessor=Jo.DEFAULT_RANKS=Jo.ScoringService=Jo.PerceptionService=void 0;var Jse=f$();Object.defineProperty(Jo,"PerceptionService",{enumerable:!0,get:function(){return Jse.PerceptionService}});var LP=y$();Object.defineProperty(Jo,"ScoringService",{enumerable:!0,get:function(){return LP.ScoringService}});Object.defineProperty(Jo,"DEFAULT_RANKS",{enumerable:!0,get:function(){return LP.DEFAULT_RANKS}});Object.defineProperty(Jo,"ScoringEventProcessor",{enumerable:!0,get:function(){return LP.ScoringEventProcessor}})});var T$=p(E$=>{"use strict";Object.defineProperty(E$,"__esModule",{value:!0})});var kb=p(Mb=>{"use strict";Object.defineProperty(Mb,"__esModule",{value:!0});Mb.NpcMessages=void 0;Mb.NpcMessages={NPC_ENTERS:"npc.enters",NPC_LEAVES:"npc.leaves",NPC_ARRIVES:"npc.arrives",NPC_DEPARTS:"npc.departs",NPC_NOTICES_PLAYER:"npc.notices_player",NPC_IGNORES_PLAYER:"npc.ignores_player",NPC_TAKES:"npc.takes",NPC_DROPS:"npc.drops",NPC_FOLLOWS:"npc.follows",GUARD_BLOCKS:"npc.guard.blocks",GUARD_ATTACKS:"npc.guard.attacks",GUARD_DEFEATED:"npc.guard.defeated",NPC_ATTACKS:"npc.attacks",NPC_MISSES:"npc.misses",NPC_HITS:"npc.hits",NPC_KILLED:"npc.killed",NPC_UNCONSCIOUS:"npc.unconscious",NPC_SPEAKS:"npc.speaks",NPC_SHOUTS:"npc.shouts",NPC_WHISPERS:"npc.whispers",NPC_MUTTERS:"npc.mutters",NPC_LAUGHS:"npc.laughs",NPC_GROWLS:"npc.growls",NPC_CRIES:"npc.cries",NPC_SIGHS:"npc.sighs",NPC_GREETS:"npc.greets",NPC_FAREWELL:"npc.farewell",NPC_NO_RESPONSE:"npc.no_response",NPC_CONFUSED:"npc.confused"}});var _$=p(Qp=>{"use strict";Object.defineProperty(Qp,"__esModule",{value:!0});Qp.NpcService=void 0;Qp.createNpcService=rce;var En=b(),ece=kb(),MP=lb();function tce(t){return`${t}_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}function ea(t,e,r){return{id:tce("npc"),type:t,timestamp:Date.now(),entities:r?{actor:r}:{},data:e}}var xb=class{constructor(){d(this,"behaviors",new Map)}registerBehavior(e){this.behaviors.set(e.id,e)}removeBehavior(e){this.behaviors.delete(e)}getBehavior(e){return this.behaviors.get(e)}tick(e){let r=[],{world:n,turn:i,random:o,playerLocation:a,playerId:s}=e,c=this.getActiveNpcs(n);for(let l of c){let u=l.get(En.TraitType.NPC);if(!u||!u.canAct)continue;let m=this.getBehaviorForNpc(l);if(!m)continue;let f=n.getLocation(l.id)||"",g=this.createNpcContext(l,n,o,i,a,f),h=m.onTurn(g),y=this.executeActions(l,h,n,o);r.push(...y)}return r}onPlayerEnters(e,r,n,i){let o=[],a=e.getPlayer()?.id||"",c=e.getContents(r).filter(l=>l.has(En.TraitType.NPC));for(let l of c){let u=l.get(En.TraitType.NPC);if(!u||!u.canAct)continue;let m=this.getBehaviorForNpc(l);if(!m?.onPlayerEnters)continue;let f=this.createNpcContext(l,e,n,i,r,r),g=m.onPlayerEnters(f),h=this.executeActions(l,g,e,n);o.push(...h)}return o}onPlayerLeaves(e,r,n,i){let o=[],a=e.getPlayer()?.id||"",s=e.getLocation(a)||"",l=e.getContents(r).filter(u=>u.has(En.TraitType.NPC));for(let u of l){let m=u.get(En.TraitType.NPC);if(!m||!m.canAct)continue;let f=this.getBehaviorForNpc(u);if(!f?.onPlayerLeaves)continue;let g=this.createNpcContext(u,e,n,i,s,r),h=f.onPlayerLeaves(g),y=this.executeActions(u,h,e,n);o.push(...y)}return o}onPlayerSpeaks(e,r,n,i,o){let a=e.getEntity(r);if(!a)return[];let s=a.get(En.TraitType.NPC);if(!s||!s.canAct)return[];let c=this.getBehaviorForNpc(a);if(!c?.onSpokenTo)return[ea("npc.spoke",{npc:r,messageId:ece.NpcMessages.NPC_NO_RESPONSE,data:{npcName:a.name}},r)];let l=e.getPlayer()?.id||"",u=e.getLocation(l)||"",m=e.getLocation(r)||"",f=this.createNpcContext(a,e,i,o,u,m),g=c.onSpokenTo(f,n);return this.executeActions(a,g,e,i)}onNpcAttacked(e,r,n,i,o){let a=e.getEntity(r);if(!a)return[];let s=a.get(En.TraitType.NPC);if(!s||!s.canAct)return[];let c=this.getBehaviorForNpc(a);if(!c?.onAttacked)return[];let l=e.getEntity(n);if(!l)return[];let u=e.getLocation(n)||"",m=e.getLocation(r)||"",f=this.createNpcContext(a,e,i,o,u,m),g=c.onAttacked(f,l);return this.executeActions(a,g,e,i)}getActiveNpcs(e){return e.getAllEntities().filter(n=>n.has(En.TraitType.NPC)?n.get(En.TraitType.NPC).canAct:!1)}getBehaviorForNpc(e){let r=e.get(En.TraitType.NPC);if(r.behaviorId)return this.behaviors.get(r.behaviorId)}createNpcContext(e,r,n,i,o,a){let s=r.getContents(e.id);return{npc:e,world:r,random:n,turnCount:i,playerLocation:o,npcLocation:a,npcInventory:s,playerVisible:a===o,getEntitiesInRoom:()=>r.getContents(a),getAvailableExits:()=>this.getExitsFromRoom(r,a,e)}}getExitsFromRoom(e,r,n){let i=e.getEntity(r);if(!i)return[];let o=i.get(En.TraitType.ROOM);if(!o?.exits)return[];let a=n.get(En.TraitType.NPC),s=[];for(let[c,l]of Object.entries(o.exits)){let u=l;u.destination&&a.canEnterRoom(u.destination)&&s.push({direction:c,destination:u.destination})}return s}executeActions(e,r,n,i){let o=[];for(let a of r){let s=this.executeAction(e,a,n,i);o.push(...s)}return o}executeAction(e,r,n,i){switch(r.type){case"move":return this.executeMove(e,r.direction,n);case"moveTo":return this.executeMoveTo(e,r.roomId,n);case"take":return this.executeTake(e,r.target,n);case"drop":return this.executeDrop(e,r.target,n);case"attack":return this.executeAttack(e,r.target,n,i);case"speak":return[ea("npc.spoke",{npc:e.id,messageId:r.messageId,data:r.data},e.id)];case"emote":return[ea("npc.emoted",{npc:e.id,messageId:r.messageId,data:r.data},e.id)];case"wait":return[];case"custom":return r.handler();default:return[]}}executeMove(e,r,n){let i=n.getLocation(e.id);if(!i)return[];let o=n.getEntity(i);if(!o)return[];let a=o.get(En.TraitType.ROOM);if(!a?.exits?.[r])return[];let s=a.exits[r].destination;return s?(n.moveEntity(e.id,s),[ea("npc.moved",{npc:e.id,from:i,to:s,direction:r},e.id)]):[]}executeMoveTo(e,r,n){let i=n.getLocation(e.id);return i?(n.moveEntity(e.id,r),[ea("npc.moved",{npc:e.id,from:i,to:r},e.id)]):[]}executeTake(e,r,n){return n.getEntity(r)?(n.moveEntity(r,e.id),[ea("npc.took",{npc:e.id,target:r},e.id)]):[]}executeDrop(e,r,n){if(!n.getEntity(r))return[];let o=n.getLocation(e.id);return o?(n.moveEntity(r,o),[ea("npc.dropped",{npc:e.id,target:r},e.id)]):[]}executeAttack(e,r,n,i){let o=n.getEntity(r);if(!o)return[];let a=[];if(o.has(En.TraitType.COMBATANT)){let s=new MP.CombatService,c=n.getContents(e.id),l=(0,MP.findWieldedWeapon)(e,n)||c.find(f=>f.isWeapon),u=s.resolveAttack({attacker:e,target:o,weapon:l,world:n,random:i});(0,MP.applyCombatResult)(o,u,n);let m=u.messageId.replace("combat.attack.","npc.combat.attack.");a.push(ea("npc.attacked",{npc:e.id,npcName:e.name,target:r,targetName:o.name,hit:u.hit,damage:u.damage,messageId:m,targetKilled:u.targetKilled,targetKnockedOut:u.targetKnockedOut},e.id)),u.targetKilled&&a.push(ea("if.event.death",{target:r,targetName:o.name,killedBy:e.id},e.id))}else a.push(ea("npc.attacked",{npc:e.id,target:r},e.id));return a}};Qp.NpcService=xb;function rce(){return new xb}});var b$=p(_s=>{"use strict";Object.defineProperty(_s,"__esModule",{value:!0});_s.passiveBehavior=_s.guardBehavior=void 0;_s.createWandererBehavior=nce;_s.createFollowerBehavior=ice;_s.createPatrolBehavior=oce;var Bb=kb(),kP=b();_s.guardBehavior={id:"guard",name:"Guard Behavior",onTurn(t){let e=t.npc.get(kP.TraitType.COMBATANT);if(e&&(!e.isAlive||!e.isConscious))return[];if(e?.hostile&&t.playerVisible){let r=t.world.getPlayer();if(r)return[{type:"attack",target:r.id}]}return[]},onPlayerEnters(t){let e=t.npc.get(kP.TraitType.COMBATANT);return e&&(!e.isAlive||!e.isConscious)?[]:[{type:"emote",messageId:Bb.NpcMessages.GUARD_BLOCKS,data:{npcName:t.npc.name}}]},onAttacked(t,e){let r=t.npc.get(kP.TraitType.COMBATANT);return r&&(!r.isAlive||!r.isConscious)?[]:[{type:"attack",target:e.id}]}};function nce(t={}){let e=t.moveChance??.3,r=t.announceEntry??!0;return{id:"wanderer",name:"Wanderer Behavior",onTurn(n){let i=[];if(n.random.chance(e)){let o=n.getAvailableExits();if(o.length>0){let a=n.random.pick(o);i.push({type:"move",direction:a.direction}),r&&a.destination===n.playerLocation&&i.push({type:"emote",messageId:Bb.NpcMessages.NPC_ENTERS,data:{npcName:n.npc.name}})}}return i},onPlayerEnters(n){return[{type:"emote",messageId:Bb.NpcMessages.NPC_NOTICES_PLAYER,data:{npcName:n.npc.name}}]}}}function ice(t={}){let e=t.immediate??!0,r=t.followMessageId??Bb.NpcMessages.NPC_FOLLOWS,n;return{id:"follower",name:"Follower Behavior",onTurn(i){let o=[];if(!i.playerVisible&&n){let s=i.getAvailableExits().find(c=>c.destination===i.playerLocation);s&&(o.push({type:"move",direction:s.direction}),o.push({type:"emote",messageId:r,data:{npcName:i.npc.name}}))}return n=i.playerLocation,o},onPlayerLeaves(i){if(!e)return[];let a=i.getAvailableExits().find(s=>s.destination===i.playerLocation);return a?[{type:"move",direction:a.direction},{type:"emote",messageId:r,data:{npcName:i.npc.name}}]:[]},getState(){return{lastPlayerLocation:n}},setState(i,o){n=o.lastPlayerLocation}}}_s.passiveBehavior={id:"passive",name:"Passive Behavior",onTurn(){return[]}};function oce(t={route:[]}){let e=t.route,r=t.loop??!0,n=t.waitTurns??0,i=0,o=1,a=0;return{id:"patrol",name:"Patrol Behavior",onTurn(s){if(e.length===0)return[];if(a>0)return a--,[];let c=e[i];if(s.npcLocation!==c){let u=s.getAvailableExits().find(m=>m.destination===c);if(u)return[{type:"move",direction:u.direction}]}return a=n,r?i=(i+1)%e.length:(i+=o,(i>=e.length-1||i<=0)&&(o*=-1)),[]},getState(){return{currentWaypoint:i,direction:o,waitCounter:a}},setState(s,c){i=c.currentWaypoint??0,o=c.direction??1,a=c.waitCounter??0}}}});var S$=p(gt=>{"use strict";var ace=gt&&gt.__createBinding||(Object.create?(function(t,e,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}):(function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]})),O$=gt&&gt.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&ace(e,t,r)};Object.defineProperty(gt,"__esModule",{value:!0});gt.createPatrolBehavior=gt.createFollowerBehavior=gt.createWandererBehavior=gt.passiveBehavior=gt.guardBehavior=gt.createNpcService=gt.NpcService=void 0;O$(T$(),gt);O$(kb(),gt);var I$=_$();Object.defineProperty(gt,"NpcService",{enumerable:!0,get:function(){return I$.NpcService}});Object.defineProperty(gt,"createNpcService",{enumerable:!0,get:function(){return I$.createNpcService}});var Xp=b$();Object.defineProperty(gt,"guardBehavior",{enumerable:!0,get:function(){return Xp.guardBehavior}});Object.defineProperty(gt,"passiveBehavior",{enumerable:!0,get:function(){return Xp.passiveBehavior}});Object.defineProperty(gt,"createWandererBehavior",{enumerable:!0,get:function(){return Xp.createWandererBehavior}});Object.defineProperty(gt,"createFollowerBehavior",{enumerable:!0,get:function(){return Xp.createFollowerBehavior}});Object.defineProperty(gt,"createPatrolBehavior",{enumerable:!0,get:function(){return Xp.createPatrolBehavior}})});var jb=p(Zp=>{"use strict";Object.defineProperty(Zp,"__esModule",{value:!0});Zp.OPENED_REVEALED_CHAIN_KEY=void 0;Zp.createOpenedRevealedChain=cce;var sce=b();Zp.OPENED_REVEALED_CHAIN_KEY="stdlib.chain.opened-revealed";function cce(){return(t,e)=>{let r=t.data,{targetId:n,targetName:i}=r;if(!n)return null;let o=e.getEntity(n);if(!o||!o.has(sce.TraitType.CONTAINER))return null;let a=e.getContents(n);if(a.length===0)return null;let s={containerId:n,containerName:i||o.name||"container",items:a.map(l=>({entityId:l.id,messageId:l.name||l.id}))};return{id:`revealed-${n}-${Date.now()}`,type:"if.event.revealed",timestamp:Date.now(),entities:{target:n,others:a.map(l=>l.id)},data:s}}}});var R$=p(Iu=>{"use strict";Object.defineProperty(Iu,"__esModule",{value:!0});Iu.createOpenedRevealedChain=Iu.OPENED_REVEALED_CHAIN_KEY=void 0;Iu.registerStandardChains=lce;var A$=jb();function lce(t){t.chainEvent("if.event.opened",(0,A$.createOpenedRevealedChain)(),{key:A$.OPENED_REVEALED_CHAIN_KEY,priority:100})}var uce=jb();Object.defineProperty(Iu,"OPENED_REVEALED_CHAIN_KEY",{enumerable:!0,get:function(){return uce.OPENED_REVEALED_CHAIN_KEY}});var dce=jb();Object.defineProperty(Iu,"createOpenedRevealedChain",{enumerable:!0,get:function(){return dce.createOpenedRevealedChain}})});var C$=p(Jp=>{"use strict";Object.defineProperty(Jp,"__esModule",{value:!0});Jp.meetsActionRequirements=w$;Jp.findValidTargets=mce;Jp.tryInferTarget=fce;function w$(t,e,r){let n=e.targetRequirements;if(!n)return!0;if(n.trait){if(!t.has(n.trait))return!1;if(n.condition){let i=t.get(n.trait);if(!i)return!1;switch(n.condition){case"not_open":return i.isOpen!==!0;case"is_open":return i.isOpen===!0;case"not_locked":return i.isLocked===!0;case"is_locked":return i.isLocked!==!0;case"not_on":return i.isOn!==!0;case"is_on":return i.isOn===!0;default:return!0}}}return!0}function mce(t,e,r){return e.filter(n=>w$(n,t,r))}function fce(t,e,r,n,i){return e?{inferred:!1,originalTarget:t,failureReason:"not_pronoun"}:{inferred:!1,originalTarget:t,failureReason:"not_pronoun"}}});var N$=p(el=>{"use strict";Object.defineProperty(el,"__esModule",{value:!0});el.findValidTargets=el.meetsActionRequirements=el.tryInferTarget=void 0;var xP=C$();Object.defineProperty(el,"tryInferTarget",{enumerable:!0,get:function(){return xP.tryInferTarget}});Object.defineProperty(el,"meetsActionRequirements",{enumerable:!0,get:function(){return xP.meetsActionRequirements}});Object.defineProperty(el,"findValidTargets",{enumerable:!0,get:function(){return xP.findValidTargets}})});var so=p(Mt=>{"use strict";var pce=Mt&&Mt.__createBinding||(Object.create?(function(t,e,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}):(function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]})),Qn=Mt&&Mt.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&pce(e,t,r)};Object.defineProperty(Mt,"__esModule",{value:!0});Qn(xz(),Mt);Qn(Gz(),Mt);Qn(wP(),Mt);Qn(Yz(),Mt);Qn(Kz(),Mt);Qn(s$(),Mt);Qn(d$(),Mt);Qn($o(),Mt);Qn(v$(),Mt);Qn(S$(),Mt);Qn(lb(),Mt);Qn(R$(),Mt);Qn(N$(),Mt)});var HP=p(WP=>{"use strict";Object.defineProperty(WP,"__esModule",{value:!0});WP.createActionContext=L$;var qe=so(),BP=b(),gce=Je(),D$=Hy();function P$(t,e){switch(e){case"target":case"directObject":case"item":return t.directObject?.entity??null;case"container":case"recipient":case"instrument":case"indirectObject":return t.indirectObject?.entity??null;default:return t.directObject?.entity??null}}function jP(t,e,r){let n={item:r.name};return e===qe.ScopeLevel.UNAWARE?{valid:!1,error:qe.ScopeErrors.NOT_KNOWN,params:n}:t>=qe.ScopeLevel.VISIBLE&&e<qe.ScopeLevel.VISIBLE?{valid:!1,error:qe.ScopeErrors.NOT_VISIBLE,params:n}:t>=qe.ScopeLevel.REACHABLE&&e<qe.ScopeLevel.REACHABLE?{valid:!1,error:qe.ScopeErrors.NOT_REACHABLE,params:n}:t>=qe.ScopeLevel.CARRIED&&e<qe.ScopeLevel.CARRIED?{valid:!1,error:qe.ScopeErrors.NOT_CARRIED,params:n}:{valid:!1,error:qe.ScopeErrors.OUT_OF_SCOPE,params:n}}function L$(t,e,r,n,i){let o=e.player,a=t.getLocation(o.id)?t.getEntity(t.getLocation(o.id)):o,s={};return{world:t,player:o,currentLocation:a,command:r,scopeResolver:i,action:n,sharedData:s,validationResult:void 0,canSee:l=>i.canSee(o,l),canReach:l=>i.canReach(o,l),canTake:l=>!l.has("if.trait.scenery")&&!l.has("if.trait.fixed")&&l.type!=="room"&&l.type!=="location",isInScope:l=>i.getScope(o,l)>=qe.ScopeLevel.AWARE,getVisible:()=>i.getVisible(o),getInScope:()=>t.getAllEntities().filter(u=>i.getScope(o,u)>=qe.ScopeLevel.AWARE),getEntityScope:l=>i.getScope(o,l),getSlotScope:l=>{let u=P$(r,l);return u?i.getScope(o,u):qe.ScopeLevel.UNAWARE},requireScope:(l,u)=>{let m=i.getScope(o,l);return m>=u?{ok:!0,actualScope:m}:{ok:!1,error:jP(u,m,l),actualScope:m}},requireSlotScope:(l,u)=>{let m=P$(r,l);if(!m)return{ok:!1,error:{valid:!1,error:"no_target",params:{slot:l}}};let f=i.getScope(o,m);return f>=u?{ok:!0,actualScope:f}:{ok:!1,error:jP(u,f,m),actualScope:f}},requireCarriedOrImplicitTake:l=>{let u=i.getScope(o,l);if(u>=qe.ScopeLevel.CARRIED)return{ok:!0};if(u<qe.ScopeLevel.REACHABLE)return{ok:!1,error:jP(qe.ScopeLevel.REACHABLE,u,l)};if(e.implicitActions?.implicitTake===!1)return{ok:!1,error:{valid:!1,error:qe.ScopeErrors.NOT_CARRIED,params:{item:l.name}}};if(n.allowImplicitTake===!1)return{ok:!1,error:{valid:!1,error:qe.ScopeErrors.NOT_CARRIED,params:{item:l.name}}};if(l.has(BP.TraitType.SCENERY)||l.has(BP.TraitType.ROOM)||l.has(BP.TraitType.DOOR))return{ok:!1,error:{valid:!1,error:"fixed_in_place",params:{item:l.name}}};let m={parsed:{rawInput:`take ${l.name}`,action:qe.takingAction.id,tokens:[],structure:{verb:{tokens:[0],text:"take",head:"take"}},pattern:"VERB_NOUN",confidence:1},actionId:qe.takingAction.id,directObject:{entity:l,parsed:{text:l.name,candidates:[l.name]}}},f=L$(t,e,m,qe.takingAction,i),g=qe.takingAction.validate(f);if(!g.valid)return{ok:!1,error:{valid:!1,error:g.error||"cannot_take",params:g.params}};qe.takingAction.execute(f);let y=(qe.takingAction.report?qe.takingAction.report(f):[]).filter(T=>T.type!=="action.success"),v=[(0,gce.createEvent)("if.event.implicit_take",{item:l.id,itemName:l.name},{actor:o.id,target:l.id,location:a?.id||o.id}),...y],E=s[D$.SharedDataKeys.IMPLICIT_TAKE_EVENTS]??[];return s[D$.SharedDataKeys.IMPLICIT_TAKE_EVENTS]=[...E,...v],{ok:!0,implicitTakeEvents:v}},event:(l,u)=>{let m={actor:o.id,location:a?.id||o.id};return r.directObject?.entity&&(m.target=r.directObject.entity.id),r.indirectObject?.entity&&(m.indirect=r.indirectObject.entity.id),{id:`evt_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:l,timestamp:Date.now(),data:{...u,actionId:n.id,turn:e.currentTurn},entities:m}}}}});var qP=p(tl=>{"use strict";Object.defineProperty(tl,"__esModule",{value:!0});tl.checkCapabilityDispatch=hce;tl.checkCapabilityDispatchMulti=k$;tl.executeCapabilityValidate=yce;tl.executeCapabilityExecute=vce;tl.executeCapabilityReport=Ece;tl.executeCapabilityBlocked=Tce;var UP=b();function hce(t,e){return e?k$(t,[e]):{shouldDispatch:!1}}function k$(t,e){let r=e.filter(s=>s!==void 0);if(r.length===0)return{shouldDispatch:!1};let n=[];for(let s of r){let c=(0,UP.findTraitWithCapability)(s,t);if(!c)continue;let l=(0,UP.getBehaviorBinding)(c,t);if(!l){console.warn(`Universal dispatch: trait "${c.type}" claims "${t}" but no behavior registered. Falling back to stdlib action.`);continue}n.push({entity:s,trait:c,behavior:l.behavior,priority:l.priority,resolutionOverride:l.resolution})}if(n.length===0)return{shouldDispatch:!1};n.sort((s,c)=>c.priority-s.priority);let i=n.find(s=>s.resolutionOverride)?.resolutionOverride,o=(0,UP.getCapabilityConfig)(t),a=i??o.resolution;if(n.length===1||a==="first-wins"||a==="highest-priority"){let s=n[0];return{shouldDispatch:!0,trait:s.trait,behavior:s.behavior,entity:s.entity,claims:n,resolution:a}}return{shouldDispatch:!0,trait:n[0].trait,behavior:n[0].behavior,entity:n[0].entity,claims:n,resolution:a}}function x$(t,e){return t.map(r=>e.event(r.type,r.payload))}function yce(t,e){let{trait:r,behavior:n,entity:i,claims:o,resolution:a}=t;if(!r||!n||!i)return{valid:!1,error:"capability_dispatch_error"};let s={};if(!o||o.length<=1||a==="first-wins"||a==="highest-priority")return M$(i,r,n,e,s);if(a==="any-blocks"){for(let l of o){let u={},m=l.behavior.validate(l.entity,e.world,e.player.id,u);if(!m.valid){let f={trait:l.trait,behavior:l.behavior,entityId:l.entity.id,entityName:l.entity.name,sharedData:u};return{valid:!1,error:m.error,params:m.params,data:f}}}return{valid:!0,data:{trait:r,behavior:n,entityId:i.id,entityName:i.name,sharedData:s}}}if(a==="all-must-pass"){for(let l of o){let u={},m=l.behavior.validate(l.entity,e.world,e.player.id,u);if(!m.valid){let f={trait:l.trait,behavior:l.behavior,entityId:l.entity.id,entityName:l.entity.name,sharedData:u};return{valid:!1,error:m.error,params:m.params,data:f}}}return{valid:!0,data:{trait:r,behavior:n,entityId:i.id,entityName:i.name,sharedData:s}}}return M$(i,r,n,e,s)}function M$(t,e,r,n,i){let o=r.validate(t,n.world,n.player.id,i),a={trait:e,behavior:r,entityId:t.id,entityName:t.name,sharedData:i};return o.valid?{valid:!0,data:a}:{valid:!1,error:o.error,params:o.params,data:a}}function vce(t){let e=t.validationResult?.data,r=t.command.directObject?.entity;!r||!e?.behavior||e.behavior.execute(r,t.world,t.player.id,e.sharedData)}function Ece(t){let e=t.validationResult?.data,r=t.command.directObject?.entity;if(!r||!e?.behavior)return[];let n=e.behavior.report(r,t.world,t.player.id,e.sharedData);return x$(n,t)}function Tce(t,e,r){let n=t.validationResult?.data??e.data,i=t.command.directObject?.entity;if(i&&n?.behavior){let o=n.behavior.blocked(i,t.world,t.player.id,e.error||"action_blocked",n.sharedData);return x$(o,t)}return[t.event("action.blocked",{actionId:r,messageId:e.error||"action_blocked",params:e.params||{}})]}});var Ub=p(eg=>{"use strict";Object.defineProperty(eg,"__esModule",{value:!0});eg.CommandExecutor=void 0;eg.createCommandExecutor=bce;var B$=Je(),_ce=vp(),FP=Hy(),GP=so(),Wb=lp(),j$=HP(),Su=qP(),Hb=class{constructor(e,r,n,i,o){d(this,"parser");d(this,"validator");d(this,"actionRegistry");d(this,"eventProcessor");d(this,"scopeResolver");d(this,"parsedCommandTransformers",[]);if(!e)throw new Error("World model is required");if(!r)throw new Error("Action registry is required");if(!n)throw new Error("Event processor is required");if(!i)throw new Error("Parser is required");this.parser=i,this.validator=new GP.CommandValidator(e,r),o&&this.validator.setSystemEventSource(o),this.actionRegistry=r,this.eventProcessor=n}registerParsedCommandTransformer(e){this.parsedCommandTransformers.push(e)}unregisterParsedCommandTransformer(e){let r=this.parsedCommandTransformers.indexOf(e);return r!==-1?(this.parsedCommandTransformers.splice(r,1),!0):!1}async execute(e,r,n,i){let o=n.currentTurn;Wb.eventSequencer.resetTurn(o);let a=i?.collectTiming?Date.now():0,s=0,c=0;try{let l=r.getPlayer();if(l&&(0,_ce.hasWorldContext)(this.parser)){let le=r.getLocation(l.id)||"";this.parser.setWorldContext(r,l.id,le)}let u=i?.collectTiming?Date.now():0,m=this.parser.parse(e);if(i?.collectTiming&&(s=Date.now()-u),!m.success)throw new Error(`Parse failed: ${m.error.code}`);let f=m.value;for(let le of this.parsedCommandTransformers)f=le(f,r);let g=this.validator.validate(f);if(!g.success){if(g.error.code==="AMBIGUOUS_ENTITY"){let le=g.error.details||{},Bi=le.ambiguousEntities||[],jn=Wb.eventSequencer.sequence({type:"client.query",data:{source:B$.QuerySource.DISAMBIGUATION,type:B$.QueryType.DISAMBIGUATION,messageId:"core.disambiguation_prompt",candidates:Bi,searchText:le.searchText,originalCommand:f}},o);return{turn:o,input:e,success:!1,needsInput:!0,events:[jn],error:"DISAMBIGUATION_NEEDED"}}throw new Error(`Validation failed: ${g.error.code}`)}let h=i?.collectTiming?Date.now():0,y=g.value,_=this.actionRegistry.get(y.actionId);if(!_)throw new Error(`Action not found: ${y.actionId}`);this.scopeResolver||(this.scopeResolver=(0,GP.createScopeResolver)(r));let v=(0,j$.createActionContext)(r,n,y,_,this.scopeResolver),E=[y.directObject?.entity,y.indirectObject?.entity],T=(0,Su.checkCapabilityDispatchMulti)(y.actionId,E),O=T.shouldDispatch?(0,Su.executeCapabilityValidate)(T,v):_.validate(v),R=y,I=v,w=T.shouldDispatch,N=n.implicitActions?.inference!==!1;if(!O.valid&&_.targetRequirements&&N){let le=y.directObject,jn=le?.parsed?.wasPronoun===!0;if(jn&&le?.entity){let Ml=this.scopeResolver.getVisible(r.getPlayer()),en=(0,GP.tryInferTarget)(le.entity,jn,_,Ml,r);if(en.inferred&&en.inferredTarget){let Xs={...y,directObject:{entity:en.inferredTarget,parsed:{...le.parsed,text:en.inferredTarget.name}}},kl=(0,j$.createActionContext)(r,n,Xs,_,this.scopeResolver),eA=kl.sharedData;eA[FP.SharedDataKeys.INFERENCE_PERFORMED]=!0,eA[FP.SharedDataKeys.ORIGINAL_TARGET]=le.entity,eA[FP.SharedDataKeys.INFERRED_TARGET]=en.inferredTarget;let v8=[en.inferredTarget,y.indirectObject?.entity],tA=(0,Su.checkCapabilityDispatchMulti)(y.actionId,v8),mB=tA.shouldDispatch?(0,Su.executeCapabilityValidate)(tA,kl):_.validate(kl);mB.valid&&(O=mB,R=Xs,I=kl,w=tA.shouldDispatch)}}}I.validationResult=O;let G;if(O.valid)if(w)(0,Su.executeCapabilityExecute)(I),G=(0,Su.executeCapabilityReport)(I);else{let le=_.execute(I);if(le==null)if(_.report)G=_.report(I);else throw new Error(`Action ${_.id} uses new pattern but lacks report()`);else G=le}else w?G=(0,Su.executeCapabilityBlocked)(I,O,y.actionId):_.blocked?G=_.blocked(I,O):G=[{id:`${o}-error`,type:"action.error",timestamp:Date.now(),data:{actionId:y.actionId,messageId:O.error||"validation_failed",params:O.params||{}},entities:{}}];i?.collectTiming&&(c=Date.now()-h);let k=G;if(G.length>0){let le=this.eventProcessor.processEvents(G);le.reactions&&le.reactions.length>0&&(k=[...G,...le.reactions])}let pe=Wb.eventSequencer.sequenceAll(k,o),oe={turn:o,input:e,success:!G.some(le=>le.type==="action.error"),events:pe,actionId:y.actionId,parsedCommand:y.parsed,validatedCommand:y};return i?.collectTiming&&(oe.timing={parsing:s,execution:c,total:Date.now()-a}),oe}catch(l){let u={turn:o,input:e,success:!1,events:[Wb.eventSequencer.sequence({type:"command.failed",data:{reason:l.message,input:e}},o)],error:l.message};return i?.collectTiming&&(u.timing={parsing:s,execution:c,total:Date.now()-a}),u}}};eg.CommandExecutor=Hb;function bce(t,e,r,n,i){return new Hb(t,e,r,n,i)}});var H$=p(W$=>{"use strict";Object.defineProperty(W$,"__esModule",{value:!0})});var VP=p(we=>{"use strict";Object.defineProperty(we,"__esModule",{value:!0});we.handleClimbed=we.handleExited=we.handleEntered=we.handleRemovedFrom=we.handlePutOn=we.handlePutIn=we.handleActorMoved=we.handleRemoved=we.handleDropped=we.handleTaken=void 0;we.registerMovementHandlers=Lce;var rl=b(),ta=Xt(),Oce=(t,e)=>{let{actor:r,target:n}=t.entities;if(r&&n){let i=e.getEntity(n);i&&i.has(rl.TraitType.WEARABLE)&&e.updateEntity(n,o=>{let a=o.get(rl.TraitType.WEARABLE);a?.worn&&(a.worn=!1)}),e.moveEntity(n,r)}};we.handleTaken=Oce;var Ice=(t,e)=>{let{actor:r,target:n,location:i}=t.entities,o=i||(r?e.getLocation(r):void 0);n&&o&&e.moveEntity(n,o)};we.handleDropped=Ice;var Sce=(t,e)=>{let{target:r}=t.entities;if(r){let n=e.getEntity(r);n&&n.has(rl.TraitType.WEARABLE)&&e.updateEntity(r,i=>{let o=i.get(rl.TraitType.WEARABLE);o?.worn&&(o.worn=!1)})}};we.handleRemoved=Sce;var Ace=(t,e)=>{let{actor:r,location:n}=t.entities;if(r&&n){let i=e.getLocation(r);if(i){let a=e.getEntity(i);a&&a.has(rl.TraitType.ROOM)&&e.updateEntity(i,s=>{let c=s.get(rl.TraitType.ROOM);c&&!c.visited&&(c.visited=!0)})}e.moveEntity(r,n);let o=e.getEntity(n);o&&o.has(rl.TraitType.ROOM)&&e.updateEntity(n,a=>{let s=a.get(rl.TraitType.ROOM);s&&!s.visited&&(s.visited=!0)})}};we.handleActorMoved=Ace;var Rce=(t,e)=>{let{target:r,location:n}=t.entities;r&&n&&e.moveEntity(r,n)};we.handlePutIn=Rce;var wce=(t,e)=>{let{target:r,location:n}=t.entities;r&&n&&e.moveEntity(r,n)};we.handlePutOn=wce;var Cce=(t,e)=>{let{actor:r,target:n}=t.entities;r&&n&&e.moveEntity(n,r)};we.handleRemovedFrom=Cce;var Nce=(t,e)=>{let{actor:r,location:n}=t.entities;r&&n&&e.moveEntity(r,n)};we.handleEntered=Nce;var Dce=(t,e)=>{let{actor:r,location:n}=t.entities;r&&n&&e.moveEntity(r,n)};we.handleExited=Dce;var Pce=(t,e)=>{};we.handleClimbed=Pce;function Lce(t){t.registerEventHandler(ta.IFEvents.TAKEN,we.handleTaken),t.registerEventHandler(ta.IFEvents.DROPPED,we.handleDropped),t.registerEventHandler(ta.IFEvents.REMOVED,we.handleRemoved),t.registerEventHandler(ta.IFEvents.ACTOR_MOVED,we.handleActorMoved),t.registerEventHandler(ta.IFEvents.PUT_IN,we.handlePutIn),t.registerEventHandler(ta.IFEvents.PUT_ON,we.handlePutOn),t.registerEventHandler(ta.IFEvents.REMOVED_FROM,we.handleRemovedFrom),t.registerEventHandler(ta.IFEvents.ENTERED,we.handleEntered),t.registerEventHandler(ta.IFEvents.EXITED,we.handleExited),t.registerEventHandler(ta.IFEvents.CLIMBED,we.handleClimbed)}});var YP=p(Me=>{"use strict";Object.defineProperty(Me,"__esModule",{value:!0});Me.handleDrunk=Me.handleEaten=Me.handleWorn=Me.handleSwitchedOff=Me.handleSwitchedOn=Me.handleUnlocked=Me.handleLocked=Me.handleClosed=Me.handleOpened=void 0;Me.registerStateChangeHandlers=Fce;var Os=b(),bs=Xt(),Mce=(t,e)=>{let{target:r}=t.entities;r&&e.updateEntity(r,n=>{let i=n.get(Os.TraitType.OPENABLE);i&&(i.isOpen=!0)})};Me.handleOpened=Mce;var kce=(t,e)=>{let{target:r}=t.entities;r&&e.updateEntity(r,n=>{let i=n.get(Os.TraitType.OPENABLE);i&&(i.isOpen=!1)})};Me.handleClosed=kce;var xce=(t,e)=>{let{target:r}=t.entities;r&&e.updateEntity(r,n=>{let i=n.get(Os.TraitType.LOCKABLE);i&&(i.isLocked=!0)})};Me.handleLocked=xce;var Bce=(t,e)=>{let{target:r}=t.entities;r&&e.updateEntity(r,n=>{let i=n.get(Os.TraitType.LOCKABLE);i&&(i.isLocked=!1)})};Me.handleUnlocked=Bce;var jce=(t,e)=>{let{target:r}=t.entities;r&&e.updateEntity(r,n=>{let i=n.get(Os.TraitType.SWITCHABLE);i&&(i.isOn=!0);let o=n.get(Os.TraitType.LIGHT_SOURCE);o&&(o.isLit=!0)})};Me.handleSwitchedOn=jce;var Wce=(t,e)=>{let{target:r}=t.entities;r&&e.updateEntity(r,n=>{let i=n.get(Os.TraitType.SWITCHABLE);i&&(i.isOn=!1);let o=n.get(Os.TraitType.LIGHT_SOURCE);o&&(o.isLit=!1)})};Me.handleSwitchedOff=Wce;var Hce=(t,e)=>{let{target:r}=t.entities;r&&e.updateEntity(r,n=>{let i=n.get(Os.TraitType.WEARABLE);i&&(i.worn=!0)})};Me.handleWorn=Hce;var Uce=(t,e)=>{let{target:r}=t.entities;r&&e.removeEntity(r)};Me.handleEaten=Uce;var qce=(t,e)=>{let{target:r}=t.entities;r&&e.removeEntity(r)};Me.handleDrunk=qce;function Fce(t){t.registerEventHandler(bs.IFEvents.OPENED,Me.handleOpened),t.registerEventHandler(bs.IFEvents.CLOSED,Me.handleClosed),t.registerEventHandler(bs.IFEvents.LOCKED,Me.handleLocked),t.registerEventHandler(bs.IFEvents.UNLOCKED,Me.handleUnlocked),t.registerEventHandler(bs.IFEvents.SWITCHED_ON,Me.handleSwitchedOn),t.registerEventHandler(bs.IFEvents.SWITCHED_OFF,Me.handleSwitchedOff),t.registerEventHandler(bs.IFEvents.WORN,Me.handleWorn),t.registerEventHandler(bs.IFEvents.EATEN,Me.handleEaten),t.registerEventHandler(bs.IFEvents.DRUNK,Me.handleDrunk)}});var zP=p(ra=>{"use strict";Object.defineProperty(ra,"__esModule",{value:!0});ra.handlePlayerCheckedInventory=U$;ra.handlePlayerInventoryEmpty=q$;ra.handleTextInventoryList=F$;ra.handlePlayerLooked=G$;ra.handlePlayerExamined=V$;ra.handleTextRoomDescription=Y$;ra.handleTextListContents=z$;ra.registerObservationHandlers=Gce;function U$(t,e){let r=t.data}function q$(t,e){let r=t.data}function F$(t,e){let r=t.data}function G$(t,e){let r=t.data}function V$(t,e){let r=t.data}function Y$(t,e){let r=t.data}function z$(t,e){let r=t.data}function Gce(t){t.registerEventHandler("player.looked",G$),t.registerEventHandler("player.examined",V$),t.registerEventHandler("text.room_description",Y$),t.registerEventHandler("text.list_contents",z$),t.registerEventHandler("player.checked_inventory",U$),t.registerEventHandler("player.inventory_empty",q$),t.registerEventHandler("text.inventory_list",F$)}});var $P=p(Hr=>{"use strict";Object.defineProperty(Hr,"__esModule",{value:!0});Hr.handleTouched=Hr.handleSmelled=Hr.handleListened=Hr.handleSearched=void 0;Hr.registerSensoryHandlers=Qce;var Vce=Je(),$$=b(),qb=Xt(),Yce=(t,e)=>{let{target:r}=t.entities,n=(0,Vce.getUntypedEventData)(t),i=Array.isArray(n?.foundItems)?n.foundItems:[];r&&i&&i.length>0&&i.forEach(o=>{e.updateEntity(o,a=>{if(a.has($$.TraitType.IDENTITY)){let s=a.get($$.TraitType.IDENTITY);s.concealed=!1}})})};Hr.handleSearched=Yce;var zce=(t,e)=>{};Hr.handleListened=zce;var $ce=(t,e)=>{};Hr.handleSmelled=$ce;var Kce=(t,e)=>{let{target:r}=t.entities};Hr.handleTouched=Kce;function Qce(t){t.registerEventHandler(qb.IFEvents.SEARCHED,Hr.handleSearched),t.registerEventHandler(qb.IFEvents.LISTENED,Hr.handleListened),t.registerEventHandler(qb.IFEvents.SMELLED,Hr.handleSmelled),t.registerEventHandler(qb.IFEvents.TOUCHED,Hr.handleTouched)}});var Q$=p(nl=>{"use strict";var Xce=nl&&nl.__createBinding||(Object.create?(function(t,e,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}):(function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]})),K$=nl&&nl.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&Xce(e,t,r)};Object.defineProperty(nl,"__esModule",{value:!0});K$(zP(),nl);K$($P(),nl)});var KP=p(Au=>{"use strict";Object.defineProperty(Au,"__esModule",{value:!0});Au.handleWaited=X$;Au.handleScoreDisplayed=Z$;Au.handleHelpDisplayed=J$;Au.handleAboutDisplayed=eK;Au.registerMetaHandlers=Zce;function X$(t,e){let r=t.data}function Z$(t,e){let r=t.data}function J$(t,e){let r=t.data}function eK(t,e){let r=t.data}function Zce(t){t.registerEventHandler("waited",X$),t.registerEventHandler("score_displayed",Z$),t.registerEventHandler("help_displayed",J$),t.registerEventHandler("about_displayed",eK)}});var XP=p(Ur=>{"use strict";Object.defineProperty(Ur,"__esModule",{value:!0});Ur.handleItemDestroyed=Ur.handleThrown=Ur.handleShown=Ur.handleGiven=void 0;Ur.registerComplexManipulationHandlers=nle;var QP=Je(),Fb=Xt(),Jce=(t,e)=>{let{actor:r,target:n,instrument:i,location:o}=t.entities,s=!!(0,QP.getUntypedEventData)(t)?.accepted;n&&o&&s&&e.moveEntity(n,o)};Ur.handleGiven=Jce;var ele=(t,e)=>{let{actor:r,target:n,instrument:i}=t.entities};Ur.handleShown=ele;var tle=(t,e)=>{let{target:r,location:n}=t.entities,i=(0,QP.getUntypedEventData)(t),o=!!i?.willBreak,a=typeof i?.finalLocation=="string"?i.finalLocation:void 0;r&&(o?e.removeEntity(r):a&&e.moveEntity(r,a))};Ur.handleThrown=tle;var rle=(t,e)=>{let r=(0,QP.getUntypedEventData)(t),n=typeof r?.item=="string"?r.item:void 0;n&&e.removeEntity(n)};Ur.handleItemDestroyed=rle;function nle(t){t.registerEventHandler(Fb.IFEvents.GIVEN,Ur.handleGiven),t.registerEventHandler(Fb.IFEvents.SHOWN,Ur.handleShown),t.registerEventHandler(Fb.IFEvents.THROWN,Ur.handleThrown),t.registerEventHandler(Fb.IFEvents.ITEM_DESTROYED,Ur.handleItemDestroyed)}});var ZP=p(qr=>{"use strict";Object.defineProperty(qr,"__esModule",{value:!0});qr.handleUsed=qr.handleTurned=qr.handlePulled=qr.handlePushed=void 0;qr.registerDeviceHandlers=cle;var Vb=Je(),il=b(),Gb=Xt(),ile=(t,e)=>{let{target:r,location:n}=t.entities,i=(0,Vb.getUntypedEventData)(t),o=String(i?.pushType||"");if(!r)return;let a=e.getEntity(r);if(a)switch(o){case"button":if(a.has(il.TraitType.SWITCHABLE)&&i?.willToggle){let s=a.get(il.TraitType.SWITCHABLE);s.isOn=i?.newState}break;case"moveable":case"heavy":i?.moved&&i?.moveDirection&&n&&i?.revealsPassage;break;case"fixed":break}};qr.handlePushed=ile;var ole=(t,e)=>{let{target:r}=t.entities,n=(0,Vb.getUntypedEventData)(t),i=String(n?.pullType||"");if(!r)return;let o=e.getEntity(r);if(o)switch(i){case"lever":case"cord":if(o.has(il.TraitType.SWITCHABLE)&&n?.willToggle){let a=o.get(il.TraitType.SWITCHABLE);a.isOn=n?.newState}break;case"attached":n?.willDetach;break;case"moveable":n?.moved&&n?.moveDirection;break}};qr.handlePulled=ole;var ale=(t,e)=>{let{target:r}=t.entities,n=(0,Vb.getUntypedEventData)(t),i=String(n?.turnType||""),o=n?.newSetting;if(!r)return;let a=e.getEntity(r);if(a)switch(i){case"dial":case"knob":if(a.has(il.TraitType.SWITCHABLE)&&n?.willToggle){let s=a.get(il.TraitType.SWITCHABLE);s.isOn=n?.newState}break;case"wheel":case"crank":n?.activatesMechanism;break}};qr.handleTurned=ale;var sle=(t,e)=>{let{target:r}=t.entities,n=(0,Vb.getUntypedEventData)(t),i=String(n?.useType||"");if(!r)return;let o=e.getEntity(r);if(o)switch(i){case"device":if(o.has(il.TraitType.SWITCHABLE)){let a=o.get(il.TraitType.SWITCHABLE);a.isOn=!a.isOn}break;case"tool":break;case"consumable":n?.consumed&&e.removeEntity(r);break}};qr.handleUsed=sle;function cle(t){t.registerEventHandler(Gb.IFEvents.PUSHED,qr.handlePushed),t.registerEventHandler(Gb.IFEvents.PULLED,qr.handlePulled),t.registerEventHandler(Gb.IFEvents.TURNED,qr.handleTurned),t.registerEventHandler(Gb.IFEvents.USED,qr.handleUsed)}});var JP=p(Xn=>{"use strict";var lle=Xn&&Xn.__createBinding||(Object.create?(function(t,e,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}):(function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]})),Nm=Xn&&Xn.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&lle(e,t,r)};Object.defineProperty(Xn,"__esModule",{value:!0});Xn.registerStandardHandlers=yle;Nm(VP(),Xn);Nm(YP(),Xn);Nm(Q$(),Xn);Nm(KP(),Xn);Nm(XP(),Xn);Nm(ZP(),Xn);var ule=VP(),dle=YP(),mle=zP(),fle=$P(),ple=KP(),gle=XP(),hle=ZP();function yle(t){(0,ule.registerMovementHandlers)(t),(0,dle.registerStateChangeHandlers)(t),(0,mle.registerObservationHandlers)(t),(0,fle.registerSensoryHandlers)(t),(0,ple.registerMetaHandlers)(t),(0,gle.registerComplexManipulationHandlers)(t),(0,hle.registerDeviceHandlers)(t)}});var rK=p(tK=>{"use strict";Object.defineProperty(tK,"__esModule",{value:!0})});var nK=p(eL=>{"use strict";Object.defineProperty(eL,"__esModule",{value:!0});eL.createWorldQuery=vle;function vle(t){return{getEntity:e=>t.getEntity(e),hasEntity:e=>t.hasEntity(e),getPlayer:()=>t.getPlayer(),getCurrentRoom:()=>{let e=t.getPlayer();return e?t.getContainingRoom(e.id):void 0},getContainingRoom:e=>t.getContainingRoom(e),getLocation:e=>t.getLocation(e),getContents:e=>t.getContents(e),findByTrait:e=>t.findByTrait(e),findWhere:e=>t.findWhere(e),getStateValue:e=>t.getStateValue(e),getCapability:e=>t.getCapability(e),hasCapability:e=>t.hasCapability(e)}}});var iK=p(Yb=>{"use strict";Object.defineProperty(Yb,"__esModule",{value:!0});Yb.EffectProcessor=void 0;var Ele=b(),tL=class{constructor(e,r){d(this,"world");d(this,"emitEvents");d(this,"pendingEmittedEvents",[]);this.world=e,this.emitEvents=r}process(e){this.pendingEmittedEvents=[];let r=this.validateAll(e);if(r.length>0)return{success:!1,errors:r,applied:[]};for(let i of e)this.apply(i);let n=this.pendingEmittedEvents.length>0?[...this.pendingEmittedEvents]:void 0;return this.pendingEmittedEvents=[],{success:!0,errors:[],applied:e,emittedEvents:n}}validateAll(e){let r=[];for(let n of e){let i=this.validate(n);i&&r.push({effect:n,reason:i})}return r}validate(e){switch(e.type){case"score":if(typeof e.points!="number")return"points must be a number";break;case"flag":if(!e.name||typeof e.name!="string")return"flag name required";if(typeof e.value!="boolean")return"flag value must be a boolean";break;case"message":if(!e.id||typeof e.id!="string")return"message id required";break;case"emit":if(!e.event||!e.event.type)return"emit effect requires a valid event";break;case"move_entity":if(!e.entityId)return"entityId required";if(!this.world.hasEntity(e.entityId))return`entity ${e.entityId} not found`;if(e.destination!==null&&!this.world.hasEntity(e.destination))return`destination ${e.destination} not found`;break;case"update_entity":if(!e.entityId)return"entityId required";if(!this.world.hasEntity(e.entityId))return`entity ${e.entityId} not found`;break;case"set_state":if(!e.key||typeof e.key!="string")return"state key required";break;case"update_exits":if(!e.roomId)return"roomId required";if(!this.world.hasEntity(e.roomId))return`room ${e.roomId} not found`;break;case"unblock":case"block":if(!e.room)return"room required";if(!this.world.hasEntity(e.room))return`room ${e.room} not found`;if(!e.exit)return"exit direction required";break;case"schedule":if(!e.daemon||typeof e.daemon!="string")return"daemon id required";if(typeof e.turns!="number"||e.turns<0)return"turns must be a non-negative number";break}return null}apply(e){switch(e.type){case"score":this.applyScoreEffect(e);break;case"flag":this.applyFlagEffect(e);break;case"message":this.applyMessageEffect(e);break;case"emit":this.applyEmitEffect(e);break;case"move_entity":this.applyMoveEntityEffect(e);break;case"update_entity":this.applyUpdateEntityEffect(e);break;case"set_state":this.applySetStateEffect(e);break;case"update_exits":this.applyUpdateExitsEffect(e);break;case"unblock":break;case"block":break;case"schedule":break}}applyScoreEffect(e){let r=this.world.getCapability("scoring");r&&typeof r.score=="number"&&this.world.updateCapability("scoring",{score:r.score+e.points})}applyFlagEffect(e){this.world.setStateValue(`flag.${e.name}`,e.value)}applyMessageEffect(e){if(this.emitEvents){let r={id:`msg-${Date.now()}-${Math.random().toString(36).slice(2)}`,type:"game.message",timestamp:Date.now(),entities:{},data:{messageId:e.id,...e.data},narrate:!0};this.emitEvents([r])}}applyEmitEffect(e){this.pendingEmittedEvents.push(e.event),this.emitEvents&&this.emitEvents([e.event])}applyMoveEntityEffect(e){this.world.moveEntity(e.entityId,e.destination)}applyUpdateEntityEffect(e){this.world.updateEntity(e.entityId,r=>{for(let[n,i]of Object.entries(e.updates))r[n]=i})}applySetStateEffect(e){this.world.setStateValue(e.key,e.value)}applyUpdateExitsEffect(e){let r=this.world.getEntity(e.roomId);if(!r)return;let n=r.get(Ele.RoomTrait);if(!n)return;n.exits||(n.exits={});let i=n.exits;for(let[o,a]of Object.entries(e.exits))a===null?delete i[o]:i[o]=a}};Yb.EffectProcessor=tL});var rL=p(co=>{"use strict";var Tle=co&&co.__createBinding||(Object.create?(function(t,e,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}):(function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]})),_le=co&&co.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&Tle(e,t,r)};Object.defineProperty(co,"__esModule",{value:!0});co.EffectProcessor=co.createWorldQuery=void 0;_le(rK(),co);var ble=nK();Object.defineProperty(co,"createWorldQuery",{enumerable:!0,get:function(){return ble.createWorldQuery}});var Ole=iK();Object.defineProperty(co,"EffectProcessor",{enumerable:!0,get:function(){return Ole.EffectProcessor}})});var aK=p(zb=>{"use strict";Object.defineProperty(zb,"__esModule",{value:!0});zb.EventProcessor=void 0;var Ile=JP(),oK=rL(),Sle=0;function Ale(){return`evt_${Date.now()}_${(++Sle).toString(36)}`}var nL=class{constructor(e,r={}){d(this,"world");d(this,"options");d(this,"effectProcessor");d(this,"worldQuery");d(this,"storyHandlers",new Map);this.world=e,this.options={validate:r.validate??!0,preview:r.preview??!1,maxReactionDepth:r.maxReactionDepth??10},this.worldQuery=(0,oK.createWorldQuery)(e),this.effectProcessor=new oK.EffectProcessor(e,n=>{this.processEvents(n)}),(0,Ile.registerStandardHandlers)(e)}registerHandler(e,r){let n=this.storyHandlers.get(e)||[];n.push(r),this.storyHandlers.set(e,n)}unregisterHandler(e,r){let n=this.storyHandlers.get(e);if(n){let i=n.indexOf(r);i!==-1&&n.splice(i,1),n.length===0&&this.storyHandlers.delete(e)}}processEvents(e){let r={applied:[],failed:[],changes:[],reactions:[]};for(let n of e){let i=this.processSingleEvent(n);if(i.success){if(r.applied.push(n),r.changes.push(...i.changes),i.reactions&&i.reactions.length>0){let o=this.processReactions(i.reactions,0);r.reactions.push(...o.reactions),r.applied.push(...o.applied),r.failed.push(...o.failed),r.changes.push(...o.changes)}}else r.failed.push({event:n,reason:i.reason||"Unknown failure"})}return r}processSingleEvent(e){if(this.options.validate&&!this.world.canApplyEvent(e))return{success:!1,reason:"Event validation failed",changes:[]};let r=[];this.options.preview&&(r=this.world.previewEvent(e));try{this.world.applyEvent(e);let n=this.invokeEntityHandlers(e);return{success:!0,changes:r,reactions:n}}catch(n){return{success:!1,reason:n instanceof Error?n.message:"Unknown error",changes:[]}}}processReactions(e,r){let n={applied:[],failed:[],changes:[],reactions:[]};if(r>=this.options.maxReactionDepth)return console.warn("Maximum reaction depth reached, stopping processing"),n;for(let i of e){let o=this.processSingleEvent(i);if(o.success){if(n.applied.push(i),n.changes.push(...o.changes),o.reactions&&o.reactions.length>0){let a=this.processReactions(o.reactions,r+1);n.reactions.push(...a.reactions),n.applied.push(...a.applied),n.failed.push(...a.failed),n.changes.push(...a.changes)}}else n.failed.push({event:i,reason:o.reason||"Unknown failure"})}return n.reactions.push(...e),n}isEffectArray(e){if(!Array.isArray(e)||e.length===0)return!1;let r=e[0];if(typeof r!="object"||r===null)return!1;let n=["score","flag","message","emit","schedule","unblock","block","move_entity","update_entity","set_state","update_exits"];return"type"in r&&n.includes(r.type)}invokeEntityHandlers(e){let r=[],n=[],i={...e,data:e.data||{}};if(e.entities?.target){let c=this.world.getEntity(e.entities.target);if(c?.on?.[e.type]){let l=c.on[e.type],u=Array.isArray(l)?l:[l];for(let m of u)try{let f=m(i,this.worldQuery);f&&Array.isArray(f)&&(this.isEffectArray(f)?r.push(...f):n.push(...f))}catch(f){console.error(`Entity handler error for ${e.type} on ${c.id}:`,f instanceof Error?f.message:f)}}}let o=this.storyHandlers.get(e.type);if(o)for(let c of o)try{let l=c(i,this.worldQuery);l&&Array.isArray(l)&&r.push(...l)}catch(l){console.error(`Story handler error for ${e.type}:`,l instanceof Error?l.message:l)}if(r.length>0){let c=this.effectProcessor.process(r);c.success||console.error("Effect processing failed:",c.errors),c.emittedEvents&&c.emittedEvents.length>0&&n.push(...c.emittedEvents)}let a=n.filter(c=>c.type==="game.message"),s=n;if(a.length>1){console.error(`Multiple game.message reactions for ${e.type} on ${e.entities?.target}:`,a.map(m=>m.data?.messageId)),s.push({id:Ale(),type:"if.event.error",entities:e.entities,data:{message:`Multiple game.message reactions returned for ${e.type}`,sourceEvent:e.type,targetId:e.entities?.target,count:a.length,messageIds:a.map(m=>m.data?.messageId)},timestamp:Date.now()});let l=a[0].data,u=e.data;l.messageId&&(u.messageId=l.messageId),l.text&&(u.text=l.text),l.params&&(u.params=l.params),s=n.filter(m=>m.type!=="game.message")}else if(a.length===1){let l=a[0].data,u=e.data;l.messageId&&(u.messageId=l.messageId),l.text&&(u.text=l.text),l.params&&(u.params=l.params),s=n.filter(m=>m.type!=="game.message")}return s}getWorld(){return this.world}setOptions(e){this.options={...this.options,...e}}};zb.EventProcessor=nL});var cK=p(sK=>{"use strict";Object.defineProperty(sK,"__esModule",{value:!0})});var lK=p(Zn=>{"use strict";var Rle=Zn&&Zn.__createBinding||(Object.create?(function(t,e,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}):(function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]})),tg=Zn&&Zn.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&Rle(e,t,r)};Object.defineProperty(Zn,"__esModule",{value:!0});Zn.WorldModel=void 0;tg(H$(),Zn);tg(aK(),Zn);tg(JP(),Zn);tg(rL(),Zn);tg(cK(),Zn);var wle=b();Object.defineProperty(Zn,"WorldModel",{enumerable:!0,get:function(){return wle.WorldModel}})});var iL=p(Dm=>{"use strict";Object.defineProperty(Dm,"__esModule",{value:!0});Dm.CORE_BLOCK_KEYS=Dm.CORE_DECORATION_TYPES=void 0;Dm.CORE_DECORATION_TYPES={EM:"em",STRONG:"strong",ITEM:"item",ROOM:"room",NPC:"npc",COMMAND:"command",DIRECTION:"direction",UNDERLINE:"underline",STRIKETHROUGH:"strikethrough",SUPER:"super",SUB:"sub"};Dm.CORE_BLOCK_KEYS={ROOM_NAME:"room.name",ROOM_DESCRIPTION:"room.description",ROOM_CONTENTS:"room.contents",ACTION_RESULT:"action.result",ACTION_BLOCKED:"action.blocked",STATUS_ROOM:"status.room",STATUS_SCORE:"status.score",STATUS_TURNS:"status.turns",ERROR:"error",PROMPT:"prompt",GAME_MESSAGE:"game.message",GAME_BANNER:"game.banner"}});var dK=p(Is=>{"use strict";Object.defineProperty(Is,"__esModule",{value:!0});Is.isDecoration=Cle;Is.isTextBlock=Nle;Is.hasKeyPrefix=$b;Is.isStatusBlock=Dle;Is.isRoomBlock=Ple;Is.isActionBlock=Lle;Is.extractPlainText=uK;function Cle(t){return typeof t=="object"&&t!==null&&"type"in t&&"content"in t}function Nle(t){return typeof t=="object"&&t!==null&&"key"in t&&"content"in t&&typeof t.key=="string"&&Array.isArray(t.content)}function $b(t,e){return t.key.startsWith(e)}function Dle(t){return $b(t,"status.")}function Ple(t){return $b(t,"room.")}function Lle(t){return $b(t,"action.")}function uK(t){return t.map(e=>typeof e=="string"?e:uK(e.content)).join("")}});var ol=p(ot=>{"use strict";Object.defineProperty(ot,"__esModule",{value:!0});ot.BLOCK_KEY_PREFIXES=ot.extractPlainText=ot.isActionBlock=ot.isRoomBlock=ot.isStatusBlock=ot.hasKeyPrefix=ot.isTextBlock=ot.isDecoration=ot.BLOCK_KEYS=ot.CORE_BLOCK_KEYS=ot.CORE_DECORATION_TYPES=void 0;var mK=iL();Object.defineProperty(ot,"CORE_DECORATION_TYPES",{enumerable:!0,get:function(){return mK.CORE_DECORATION_TYPES}});Object.defineProperty(ot,"CORE_BLOCK_KEYS",{enumerable:!0,get:function(){return mK.CORE_BLOCK_KEYS}});var Mle=iL();Object.defineProperty(ot,"BLOCK_KEYS",{enumerable:!0,get:function(){return Mle.CORE_BLOCK_KEYS}});var Ru=dK();Object.defineProperty(ot,"isDecoration",{enumerable:!0,get:function(){return Ru.isDecoration}});Object.defineProperty(ot,"isTextBlock",{enumerable:!0,get:function(){return Ru.isTextBlock}});Object.defineProperty(ot,"hasKeyPrefix",{enumerable:!0,get:function(){return Ru.hasKeyPrefix}});Object.defineProperty(ot,"isStatusBlock",{enumerable:!0,get:function(){return Ru.isStatusBlock}});Object.defineProperty(ot,"isRoomBlock",{enumerable:!0,get:function(){return Ru.isRoomBlock}});Object.defineProperty(ot,"isActionBlock",{enumerable:!0,get:function(){return Ru.isActionBlock}});Object.defineProperty(ot,"extractPlainText",{enumerable:!0,get:function(){return Ru.extractPlainText}});ot.BLOCK_KEY_PREFIXES={STATUS:"status.",ROOM:"room.",ACTION:"action."}});var aL=p(oL=>{"use strict";Object.defineProperty(oL,"__esModule",{value:!0});oL.filterEvents=kle;function kle(t){return t.filter(e=>!(e.type.startsWith("system.")||e.type.startsWith("platform.")))}});var sL=p(Kb=>{"use strict";Object.defineProperty(Kb,"__esModule",{value:!0});Kb.sortEventsForProse=xle;Kb.getChainMetadata=Ble;function xle(t){return[...t].sort((e,r)=>{let n=e.data,i=r.data,o=n?._transactionId,a=i?._transactionId,s=["game.started","game.starting","game.loading","game.loaded","game.initialized"],c=s.includes(e.type),l=s.includes(r.type);if(c&&!l)return-1;if(!c&&l)return 1;if(o!==a)return 0;let u=e.type==="if.event.implicit_take",m=r.type==="if.event.implicit_take";if(u&&!m)return-1;if(!u&&m)return 1;let f=e.type==="if.event.room.description"||e.type==="if.event.room_description",g=r.type==="if.event.room.description"||r.type==="if.event.room_description";if(f&&!g)return-1;if(!f&&g)return 1;let h=e.type.startsWith("action."),y=r.type.startsWith("action.");if(h&&!y)return-1;if(!h&&y)return 1;let _=n?._chainDepth??0,v=i?._chainDepth??0;return _-v})}function Ble(t){let e=t.data;return{_transactionId:e?._transactionId,_chainDepth:e?._chainDepth,_chainedFrom:e?._chainedFrom,_chainSourceId:e?._chainSourceId}}});var cL=p(Xb=>{"use strict";Object.defineProperty(Xb,"__esModule",{value:!0});Xb.parseDecorations=Qb;Xb.hasDecorations=Hle;function Qb(t){if(!t)return[];let e=[],r="",n=0;for(;n<t.length;){let i=t[n];if(i==="\\"&&n+1<t.length){let o=t[n+1];if(o==="*"||o==="["||o==="]"||o==="\\"){r+=o,n+=2;continue}}if(i==="["){let o=jle(t,n);if(o!==-1){r&&(e.push(r),r="");let a=t.slice(n+1,o),s=a.indexOf(":");if(s!==-1){let c=a.slice(0,s),l=a.slice(s+1),u={type:c,content:Qb(l)};e.push(u)}else r+=t.slice(n,o+1);n=o+1;continue}}if(i==="*"&&t[n+1]==="*"){let o=t.indexOf("**",n+2);if(o!==-1){r&&(e.push(r),r="");let a=t.slice(n+2,o),s={type:"strong",content:Qb(a)};e.push(s),n=o+2;continue}}if(i==="*"){let o=Wle(t,n+1);if(o!==-1){r&&(e.push(r),r="");let a=t.slice(n+1,o),s={type:"em",content:Qb(a)};e.push(s),n=o+1;continue}}r+=i,n++}return r&&e.push(r),e}function jle(t,e){let r=1,n=e+1;for(;n<t.length&&r>0;){let i=t[n];if(i==="\\"&&n+1<t.length){n+=2;continue}if(i==="["?r++:i==="]"&&r--,r===0)return n;n++}return-1}function Wle(t,e){let r=e;for(;r<t.length;){let n=t[r];if(n==="\\"&&r+1<t.length){r+=2;continue}if(n==="*"&&t[r+1]!=="*"&&(r===e||t[r-1]!=="*"))return r;r++}return-1}function Hle(t){return/[*\[]/.test(t)}});var al=p(Zb=>{"use strict";Object.defineProperty(Zb,"__esModule",{value:!0});Zb.createBlock=Ule;Zb.extractValue=qle;var fK=cL();function Ule(t,e){let r=(0,fK.hasDecorations)(e)?(0,fK.parseDecorations)(e):[e];return{key:t,content:r}}function qle(t){if(typeof t=="function")try{let e=t();return e?String(e):null}catch{return null}return t?String(t):null}});var uL=p(lL=>{"use strict";Object.defineProperty(lL,"__esModule",{value:!0});lL.handleRoomDescription=Fle;var pK=ol(),Jb=al();function Fle(t,e){let r=t.data,n=[];if(r.verbose){let a,s=r.roomNameId??r.room?.nameId;if(s&&e.languageProvider){let c=e.languageProvider.getMessage(s,{});c&&c!==s&&(a=c)}if(a||(a=r.room?.name??r.roomName),a){let c=(0,Jb.extractValue)(a);c&&n.push((0,Jb.createBlock)(pK.BLOCK_KEYS.ROOM_NAME,c))}}let i,o=r.roomDescriptionId??r.room?.descriptionId;if(o&&e.languageProvider){let a=e.languageProvider.getMessage(o,{});a&&a!==o&&(i=a)}if(i||(i=r.room?.description??r.roomDescription),i){let a=(0,Jb.extractValue)(i);a&&n.push((0,Jb.createBlock)(pK.BLOCK_KEYS.ROOM_DESCRIPTION,a))}return n}});var dL=p(rO=>{"use strict";Object.defineProperty(rO,"__esModule",{value:!0});rO.handleActionSuccess=Gle;rO.handleActionFailure=Vle;var eO=ol(),tO=al();function Gle(t,e){let r=t.data;if(r.messageId&&e.languageProvider){let i=r.actionId?`${r.actionId}.${r.messageId}`:r.messageId,o=e.languageProvider.getMessage(i,r.params);if(o===i&&r.messageId&&(o=e.languageProvider.getMessage(r.messageId,r.params)),o!==r.messageId&&o!==i)return[(0,tO.createBlock)(eO.BLOCK_KEYS.ACTION_RESULT,o)]}let n=r.message??r.text;return n?[(0,tO.createBlock)(eO.BLOCK_KEYS.ACTION_RESULT,n)]:[]}function Vle(t,e){let r=t.data;if(r.messageId&&e.languageProvider){let i=r.actionId?`${r.actionId}.${r.messageId}`:r.messageId,o=e.languageProvider.getMessage(i,r.params);if(o===i&&r.messageId&&(o=e.languageProvider.getMessage(r.messageId,r.params)),o!==r.messageId&&o!==i)return[(0,tO.createBlock)(eO.BLOCK_KEYS.ACTION_BLOCKED,o)]}let n=r.params?.reason??r.reason??r.message??"You can't do that.";return[(0,tO.createBlock)(eO.BLOCK_KEYS.ACTION_BLOCKED,n)]}});var gL=p(pL=>{"use strict";Object.defineProperty(pL,"__esModule",{value:!0});pL.handleRevealed=Yle;var mL=ol(),fL=al();function Yle(t,e){let r=t.data;if(r.message||r.text){let n=r.message??r.text??"";if(n)return[(0,fL.createBlock)(mL.BLOCK_KEYS.ACTION_RESULT,n)]}if(e.languageProvider){let n=e.languageProvider.getMessage(t.type,{containerId:r.containerId,containerName:r.containerName,container:r.containerName,items:r.items});if(n&&n!==t.type)return[(0,fL.createBlock)(mL.BLOCK_KEYS.ACTION_RESULT,n)]}if(r.items&&r.items.length>0){let n=r.items.map(a=>a.name??a.messageId??a.entityId).join(", "),o=`Inside the ${r.containerName??"it"} you see ${n}.`;return[(0,fL.createBlock)(mL.BLOCK_KEYS.ACTION_RESULT,o)]}return[]}});var hL=p(nO=>{"use strict";Object.defineProperty(nO,"__esModule",{value:!0});nO.handleGameMessage=zle;nO.handleGenericEvent=$le;var rg=ol(),ng=al();function zle(t,e){let r=t.data;if(r.messageId&&e.languageProvider){let i=e.languageProvider.getMessage(r.messageId,r.params);if(i&&i!==r.messageId)return[(0,ng.createBlock)(rg.BLOCK_KEYS.GAME_MESSAGE,i)]}let n=r.text??r.message;return n?[(0,ng.createBlock)(rg.BLOCK_KEYS.GAME_MESSAGE,n)]:[]}function $le(t,e){let r=t.data;if(!r)return[];if(r.message||r.text){let n=r.message??r.text??"";if(n)return[(0,ng.createBlock)(rg.BLOCK_KEYS.ACTION_RESULT,n)]}if(e.languageProvider){let n=e.languageProvider.getMessage(t.type,r);if(n&&n!==t.type)return[(0,ng.createBlock)(rg.BLOCK_KEYS.ACTION_RESULT,n)];if(r.messageId){let i=e.languageProvider.getMessage(r.messageId,r);if(i&&i!==r.messageId)return[(0,ng.createBlock)(rg.BLOCK_KEYS.ACTION_RESULT,i)]}}return[]}});var gK=p(yL=>{"use strict";Object.defineProperty(yL,"__esModule",{value:!0});yL.handleGameStarted=Qle;var Kle=al();function Qle(t,e){let r=t.data,n=r?.story;if(!n)return[];let i=r?.engineVersion||"unknown",o=r?.clientVersion||"N/A",a={title:n.title||"Unknown",author:n.author||"Unknown",version:n.version||"1.0.0",id:n.id||"unknown",engineVersion:i,clientVersion:o},s=e.languageProvider?.getMessage("game.started.banner",a);return!s||s==="game.started.banner"?[]:[(0,Kle.createBlock)("game.banner",s)]}});var vK=p(ig=>{"use strict";Object.defineProperty(ig,"__esModule",{value:!0});ig.TextService=void 0;ig.createTextService=nue;var wu=ol(),Xle=aL(),Zle=sL(),Pm=al(),Jle=uL(),hK=dL(),eue=gL(),yK=hL(),tue=gK(),rue=new Set(["if.event.opened","if.event.closed","if.event.locked","if.event.unlocked","if.event.switched_on","if.event.switched_off","if.event.taken","if.event.dropped","if.event.read"]),iO=class{constructor(e){d(this,"languageProvider");this.languageProvider=e}processTurn(e){let r=(0,Xle.filterEvents)(e),n=(0,Zle.sortEventsForProse)(r),i={languageProvider:this.languageProvider},o=[];for(let a of n){let s=this.routeToHandler(a,i);o.push(...s)}return o}routeToHandler(e,r){let n=this.tryProcessDomainEventMessage(e,r);if(n)return n;if(rue.has(e.type))return[];switch(e.type){case"game.started":return(0,tue.handleGameStarted)(e,r);case"if.event.room_description":case"if.event.room.description":return(0,Jle.handleRoomDescription)(e,r);case"action.success":return(0,hK.handleActionSuccess)(e,r);case"action.failure":case"action.blocked":return(0,hK.handleActionFailure)(e,r);case"game.message":return(0,yK.handleGameMessage)(e,r);case"if.event.revealed":return(0,eue.handleRevealed)(e,r);case"if.event.implicit_take":return this.handleImplicitTake(e,r);case"command.failed":return this.handleCommandFailed(e,r);case"client.query":return this.handleClientQuery(e,r);default:return(0,yK.handleGenericEvent)(e,r)}}tryProcessDomainEventMessage(e,r){let n=e.data;if(!n?.messageId||e.type.startsWith("action.")||!r.languageProvider)return null;let i=r.languageProvider.getMessage(n.messageId,n.params);if(i===n.messageId)return null;let o=e.type.includes("blocked")||e.type.includes("failure")?wu.BLOCK_KEYS.ACTION_BLOCKED:wu.BLOCK_KEYS.ACTION_RESULT;return[(0,Pm.createBlock)(o,i)]}handleImplicitTake(e,r){let i=e.data.itemName||"something";return[(0,Pm.createBlock)(wu.BLOCK_KEYS.ACTION_RESULT,`(first taking the ${i})`)]}handleCommandFailed(e,r){let n=e.data;if(n.reason){if(n.reason.includes("ENTITY_NOT_FOUND")||n.reason.includes("modifiers_not_matched")){let o=r.languageProvider?.getMessage("core.entity_not_found")??"I don't see that here.";return[(0,Pm.createBlock)(wu.BLOCK_KEYS.ERROR,o)]}if(n.reason.includes("NO_MATCH")||n.reason.includes("parse")){let o=r.languageProvider?.getMessage("core.command_not_understood")??"I don't understand that.";return[(0,Pm.createBlock)(wu.BLOCK_KEYS.ERROR,o)]}}let i=r.languageProvider?.getMessage("core.command_failed")??"I don't understand that.";return[(0,Pm.createBlock)(wu.BLOCK_KEYS.ERROR,i)]}handleClientQuery(e,r){let n=e.data;if(n.source!=="disambiguation")return[];let i=(n.candidates||[]).map(s=>s.name),o=this.formatCandidateList(i),a=r.languageProvider?.getMessage("core.disambiguation_prompt",{options:o})??`Which do you mean: ${o}?`;return[(0,Pm.createBlock)(wu.BLOCK_KEYS.ERROR,a)]}formatCandidateList(e){if(e.length===0)return"";if(e.length===1)return`the ${e[0]}`;let r=e.map(i=>`the ${i}`);if(r.length===2)return`${r[0]} or ${r[1]}`;let n=r.pop();return`${r.join(", ")}, or ${n}`}};ig.TextService=iO;function nue(t){return new iO(t)}});var TK=p(oO=>{"use strict";Object.defineProperty(oO,"__esModule",{value:!0});oO.renderToString=cue;oO.renderStatusLine=lue;var EK=ol(),ze={RESET:"\x1B[0m",BOLD:"\x1B[1m",ITALIC:"\x1B[3m",UNDERLINE:"\x1B[4m",STRIKETHROUGH:"\x1B[9m",BLACK:"\x1B[30m",RED:"\x1B[31m",GREEN:"\x1B[32m",YELLOW:"\x1B[33m",BLUE:"\x1B[34m",MAGENTA:"\x1B[35m",CYAN:"\x1B[36m",WHITE:"\x1B[37m",BRIGHT_RED:"\x1B[91m",BRIGHT_GREEN:"\x1B[92m",BRIGHT_YELLOW:"\x1B[93m",BRIGHT_BLUE:"\x1B[94m",BRIGHT_MAGENTA:"\x1B[95m",BRIGHT_CYAN:"\x1B[96m",BRIGHT_WHITE:"\x1B[97m"},iue={em:ze.ITALIC,strong:ze.BOLD,item:ze.CYAN,room:ze.YELLOW,npc:ze.MAGENTA,command:ze.GREEN,direction:ze.WHITE,underline:ze.UNDERLINE,strikethrough:ze.STRIKETHROUGH};function oue(t){let e=parseInt(t.slice(1,3),16),r=parseInt(t.slice(3,5),16),n=parseInt(t.slice(5,7),16);return e>r&&e>n?e>180?ze.BRIGHT_RED:ze.RED:r>e&&r>n?r>180?ze.BRIGHT_GREEN:ze.GREEN:n>e&&n>r?n>180?ze.BRIGHT_BLUE:ze.BLUE:e>200&&r>200?ze.BRIGHT_YELLOW:e>200&&n>200?ze.BRIGHT_MAGENTA:r>200&&n>200?ze.BRIGHT_CYAN:e>180&&r>180&&n>180?ze.BRIGHT_WHITE:ze.WHITE}function Lm(t,e){return t.map(r=>typeof r=="string"?r:aue(r,e)).join("")}function aue(t,e){let r=Lm(t.content,e);if(!e.ansi)return t.type==="em"?`*${r}*`:t.type==="strong"?`**${r}**`:r;let n=iue[t.type];if(!n&&e.colors?.[t.type]){let i=e.colors[t.type];i.startsWith("#")&&(n=oue(i))}return n?`${n}${r}${ze.RESET}`:r}function sue(t,e){let r=Lm(t.content,e);if(e.ansi){if(t.key==="room.name")return`${ze.BOLD}${ze.YELLOW}${r}${ze.RESET}`;if(t.key==="action.blocked"||t.key==="error")return`${ze.RED}${r}${ze.RESET}`}return r}function cue(t,e={}){let r={ansi:!1,blockSeparator:`

`,includeStatus:!1,...e},i=(r.includeStatus?t:t.filter(a=>!(0,EK.isStatusBlock)(a))).map(a=>({key:a.key,text:sue(a,r)})).filter(a=>a.text.trim());if(i.length===0)return"";let o=[i[0].text];for(let a=1;a<i.length;a++){let s=i[a-1],c=i[a],l=s.key===c.key?`
`:r.blockSeparator;o.push(l+c.text)}return o.join("")}function lue(t,e={}){let r=t.filter(EK.isStatusBlock),n=[],i=r.find(l=>l.key==="status.room");i&&n.push(Lm(i.content,e));let o=r.find(l=>l.key==="status.score");o&&n.push(`Score: ${Lm(o.content,e)}`);let a=r.find(l=>l.key==="status.turns");a&&n.push(`Turns: ${Lm(a.content,e)}`);let s=["status.room","status.score","status.turns"],c=r.filter(l=>!s.includes(l.key));for(let l of c)n.push(Lm(l.content,e));return n.join(" | ")}});var wK=p(re=>{"use strict";Object.defineProperty(re,"__esModule",{value:!0});re.CORE_DECORATION_TYPES=re.BLOCK_KEY_PREFIXES=re.BLOCK_KEYS=re.extractPlainText=re.isActionBlock=re.isRoomBlock=re.isStatusBlock=re.isTextBlock=re.isDecoration=re.renderStatusLine=re.renderToString=re.hasDecorations=re.parseDecorations=re.handleGenericEvent=re.handleGameMessage=re.handleRevealed=re.handleActionFailure=re.handleActionSuccess=re.handleRoomDescription=re.extractValue=re.createBlock=re.getChainMetadata=re.sortEventsForProse=re.filterEvents=re.createTextService=re.TextService=void 0;var _K=vK();Object.defineProperty(re,"TextService",{enumerable:!0,get:function(){return _K.TextService}});Object.defineProperty(re,"createTextService",{enumerable:!0,get:function(){return _K.createTextService}});var uue=aL();Object.defineProperty(re,"filterEvents",{enumerable:!0,get:function(){return uue.filterEvents}});var bK=sL();Object.defineProperty(re,"sortEventsForProse",{enumerable:!0,get:function(){return bK.sortEventsForProse}});Object.defineProperty(re,"getChainMetadata",{enumerable:!0,get:function(){return bK.getChainMetadata}});var OK=al();Object.defineProperty(re,"createBlock",{enumerable:!0,get:function(){return OK.createBlock}});Object.defineProperty(re,"extractValue",{enumerable:!0,get:function(){return OK.extractValue}});var due=uL();Object.defineProperty(re,"handleRoomDescription",{enumerable:!0,get:function(){return due.handleRoomDescription}});var IK=dL();Object.defineProperty(re,"handleActionSuccess",{enumerable:!0,get:function(){return IK.handleActionSuccess}});Object.defineProperty(re,"handleActionFailure",{enumerable:!0,get:function(){return IK.handleActionFailure}});var mue=gL();Object.defineProperty(re,"handleRevealed",{enumerable:!0,get:function(){return mue.handleRevealed}});var SK=hL();Object.defineProperty(re,"handleGameMessage",{enumerable:!0,get:function(){return SK.handleGameMessage}});Object.defineProperty(re,"handleGenericEvent",{enumerable:!0,get:function(){return SK.handleGenericEvent}});var AK=cL();Object.defineProperty(re,"parseDecorations",{enumerable:!0,get:function(){return AK.parseDecorations}});Object.defineProperty(re,"hasDecorations",{enumerable:!0,get:function(){return AK.hasDecorations}});var RK=TK();Object.defineProperty(re,"renderToString",{enumerable:!0,get:function(){return RK.renderToString}});Object.defineProperty(re,"renderStatusLine",{enumerable:!0,get:function(){return RK.renderStatusLine}});var Ss=ol();Object.defineProperty(re,"isDecoration",{enumerable:!0,get:function(){return Ss.isDecoration}});Object.defineProperty(re,"isTextBlock",{enumerable:!0,get:function(){return Ss.isTextBlock}});Object.defineProperty(re,"isStatusBlock",{enumerable:!0,get:function(){return Ss.isStatusBlock}});Object.defineProperty(re,"isRoomBlock",{enumerable:!0,get:function(){return Ss.isRoomBlock}});Object.defineProperty(re,"isActionBlock",{enumerable:!0,get:function(){return Ss.isActionBlock}});Object.defineProperty(re,"extractPlainText",{enumerable:!0,get:function(){return Ss.extractPlainText}});Object.defineProperty(re,"BLOCK_KEYS",{enumerable:!0,get:function(){return Ss.BLOCK_KEYS}});Object.defineProperty(re,"BLOCK_KEY_PREFIXES",{enumerable:!0,get:function(){return Ss.BLOCK_KEY_PREFIXES}});Object.defineProperty(re,"CORE_DECORATION_TYPES",{enumerable:!0,get:function(){return Ss.CORE_DECORATION_TYPES}})});var NK=p(CK=>{"use strict";Object.defineProperty(CK,"__esModule",{value:!0})});var vL=p(aO=>{"use strict";Object.defineProperty(aO,"__esModule",{value:!0});aO.createSeededRandom=void 0;var fue=Je();Object.defineProperty(aO,"createSeededRandom",{enumerable:!0,get:function(){return fue.createSeededRandom}})});var DK=p(og=>{"use strict";Object.defineProperty(og,"__esModule",{value:!0});og.SchedulerService=void 0;og.createSchedulerService=gue;var pue=vL(),sO=class{constructor(e){d(this,"daemons",new Map);d(this,"daemonStates",new Map);d(this,"fuses",new Map);d(this,"fuseStates",new Map);d(this,"random");d(this,"currentTurn",0);this.random=(0,pue.createSeededRandom)(e)}registerDaemon(e){if(this.daemons.has(e.id))throw new Error(`Daemon with id "${e.id}" already exists`);this.daemons.set(e.id,e),this.daemonStates.set(e.id,{id:e.id,isPaused:!1,runCount:0})}removeDaemon(e){this.daemons.delete(e),this.daemonStates.delete(e)}pauseDaemon(e){let r=this.daemonStates.get(e);r&&(r.isPaused=!0)}resumeDaemon(e){let r=this.daemonStates.get(e);r&&(r.isPaused=!1)}hasDaemon(e){return this.daemons.has(e)}setFuse(e){let r={...e,originalTurns:e.originalTurns??e.turns};this.fuses.set(e.id,r),this.fuseStates.set(e.id,{id:e.id,turnsRemaining:e.turns,isPaused:!1,entityId:e.entityId})}cancelFuse(e){let r=this.fuses.get(e),n=this.fuseStates.get(e);if(!r||!n)return[];let i=[];if(r.onCancel){let o=this.createContext(void 0,this.currentTurn,"");try{i=r.onCancel(o)}catch(a){console.error(`Error in fuse "${e}" onCancel:`,a)}}return this.fuses.delete(e),this.fuseStates.delete(e),i}getFuseRemaining(e){return this.fuseStates.get(e)?.turnsRemaining}adjustFuse(e,r){let n=this.fuseStates.get(e);n&&(n.turnsRemaining=Math.max(0,n.turnsRemaining+r))}pauseFuse(e){let r=this.fuseStates.get(e);r&&(r.isPaused=!0)}resumeFuse(e){let r=this.fuseStates.get(e);r&&(r.isPaused=!1)}hasFuse(e){return this.fuses.has(e)}tick(e,r,n){this.currentTurn=r;let i=[],o=[],a=[],s=e.getLocation(n)||"",c=this.createContext(e,r,s,n),l=this.getSortedDaemons();for(let f of l){let g=this.daemonStates.get(f.id);if(!(!g||g.isPaused)&&!(f.condition&&!f.condition(c)))try{let h=f.run(c);h.length>0&&(i.push(...h),a.push(f.id),g.runCount++,f.runOnce&&this.removeDaemon(f.id))}catch(h){console.error(`Error running daemon "${f.id}":`,h)}}let u=[],m=this.getSortedFuses();for(let f of m){let g=this.fuseStates.get(f.id);if(!(!g||g.isPaused)&&!(f.tickCondition&&!f.tickCondition(c))&&(g.turnsRemaining--,g.turnsRemaining<=0))try{let h=f.trigger(c);i.push(...h),o.push(f.id),f.repeat&&f.originalTurns?g.turnsRemaining=f.originalTurns:u.push(f.id)}catch(h){console.error(`Error triggering fuse "${f.id}":`,h),u.push(f.id)}}for(let f of u)this.fuses.delete(f),this.fuseStates.delete(f);return{events:i,fusesTriggered:o,daemonsRun:a}}getActiveDaemons(){let e=[];for(let[r,n]of this.daemons){let i=this.daemonStates.get(r);i&&e.push({id:n.id,name:n.name,isPaused:i.isPaused,runCount:i.runCount,priority:n.priority??0})}return e.sort((r,n)=>n.priority-r.priority)}getActiveFuses(){let e=[];for(let[r,n]of this.fuses){let i=this.fuseStates.get(r);i&&e.push({id:n.id,name:n.name,turnsRemaining:i.turnsRemaining,isPaused:i.isPaused,entityId:i.entityId,priority:n.priority??0,repeat:n.repeat??!1})}return e.sort((r,n)=>n.priority-r.priority)}getState(){let e=[],r=[];for(let n of this.daemonStates.values())e.push({...n});for(let n of this.fuseStates.values())r.push({...n});return{turn:this.currentTurn,daemons:e,fuses:r,randomSeed:this.random.getSeed()}}setState(e){this.currentTurn=e.turn,this.random.setSeed(e.randomSeed);for(let r of e.daemons)this.daemons.has(r.id)&&this.daemonStates.set(r.id,{...r});for(let r of e.fuses)this.fuses.has(r.id)&&this.fuseStates.set(r.id,{...r})}cleanupEntity(e){let r=[];for(let[n,i]of this.fuseStates)i.entityId===e&&r.push(...this.cancelFuse(n));return r}getRandom(){return this.random}createContext(e,r,n,i){return{world:e,turn:r,random:this.random,playerLocation:n,playerId:i||""}}getSortedDaemons(){return Array.from(this.daemons.values()).sort((e,r)=>(r.priority??0)-(e.priority??0))}getSortedFuses(){return Array.from(this.fuses.values()).sort((e,r)=>(r.priority??0)-(e.priority??0))}};og.SchedulerService=sO;function gue(t){return new sO(t)}});var TL=p(As=>{"use strict";var hue=As&&As.__createBinding||(Object.create?(function(t,e,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}):(function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]})),EL=As&&As.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&hue(e,t,r)};Object.defineProperty(As,"__esModule",{value:!0});EL(NK(),As);EL(vL(),As);EL(DK(),As)});var cO=p(Cu=>{"use strict";Object.defineProperty(Cu,"__esModule",{value:!0});Cu.normalizeEvent=PK;Cu.enrichEvent=LK;Cu.processEvent=MK;Cu.toSequencedEvent=yue;Cu.toSemanticEvent=Tue;function PK(t){return{...t,id:t.id||vue(),type:t.type.toLowerCase(),timestamp:t.timestamp||Date.now(),entities:t.entities||{},data:t.data,tags:t.tags,priority:t.priority,narrate:t.narrate}}function LK(t,e){let r={...t};return e&&(e.turn!==void 0&&r.data&&typeof r.data=="object"&&(r.data={...r.data,turn:e.turn}),e.playerId&&!r.entities.actor&&(r.entities={...r.entities,actor:e.playerId}),e.locationId&&!r.entities.location&&(r.entities={...r.entities,location:e.locationId})),r.tags||(r.tags=[]),r.type.startsWith("action.")&&!r.tags.includes("action")?r.tags=[...r.tags,"action"]:r.type.startsWith("system.")&&!r.tags.includes("system")?r.tags=[...r.tags,"system"]:r.type.startsWith("game.")&&!r.tags.includes("game")&&(r.tags=[...r.tags,"game"]),r}function MK(t,e){let r=PK(t);return LK(r,e)}function yue(t,e,r){let n=MK(t,{turn:e});return{type:n.type,data:n.data,sequence:r,timestamp:new Date(n.timestamp),turn:e,scope:Eue(n),source:n.id}}function vue(){return`event-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}function Eue(t){return t.type.startsWith("platform.")?"system":(t.type==="action.error","turn")}function Tue(t){return{...t,id:t.source||`${t.turn}-${t.sequence}`,type:t.type,timestamp:t.timestamp.getTime(),data:t.data,entities:t.entities||{}}}});var _L=p(ag=>{"use strict";Object.defineProperty(ag,"__esModule",{value:!0});ag.VocabularyManager=void 0;ag.createVocabularyManager=bue;var _ue=so(),lO=class{updateEntityVocabulary(e,r){let n=e.get("IDENTITY");if(n&&typeof n=="object"){let i=n,o=[];i.name&&o.push(i.name.toLowerCase()),i.aliases&&Array.isArray(i.aliases)&&o.push(...i.aliases),_ue.vocabularyRegistry.registerEntity({entityId:e.id,nouns:o,adjectives:i.adjectives||[],inScope:r})}}updateScopeVocabulary(e,r){if(!e.getEntity(r))return;let i=e.getInScope(r);for(let o of e.getAllEntities())this.updateEntityVocabulary(o,!1);for(let o of i)this.updateEntityVocabulary(o,!0)}};ag.VocabularyManager=lO;function bue(){return new lO}});var bL=p(sg=>{"use strict";Object.defineProperty(sg,"__esModule",{value:!0});sg.SaveRestoreService=void 0;sg.createSaveRestoreService=Sue;var kK=b(),Oue=Je(),Iue=cO(),uO=class{constructor(e){d(this,"undoSnapshots",[]);d(this,"undoSnapshotTurns",[]);d(this,"maxUndoSnapshots");this.maxUndoSnapshots=e?.maxSnapshots??10}createUndoSnapshot(e,r){if(this.maxUndoSnapshots<=0)return;let n=e.toJSON();for(this.undoSnapshots.push(n),this.undoSnapshotTurns.push(r);this.undoSnapshots.length>this.maxUndoSnapshots;)this.undoSnapshots.shift(),this.undoSnapshotTurns.shift()}undo(e){if(this.undoSnapshots.length===0)return null;let r=this.undoSnapshots.pop(),n=this.undoSnapshotTurns.pop();return e.loadJSON(r),{turn:n}}canUndo(){return this.undoSnapshots.length>0}getUndoLevels(){return this.undoSnapshots.length}clearUndoSnapshots(){this.undoSnapshots=[],this.undoSnapshotTurns=[]}createSaveData(e){let r=e.getContext(),n=e.getStory(),i=e.getEventSource(),o=e.getScheduler(),a=e.getWorld(),s=e.getParser(),c={storyId:n?.config.id||"unknown",storyVersion:n?.config.version||"0.0.0",turnCount:r.currentTurn-1,playTime:Date.now()-r.metadata.started.getTime(),description:`Turn ${r.currentTurn-1}`},l={eventSource:this.serializeEventSource(i),spatialIndex:this.serializeSpatialIndex(a),turnHistory:this.serializeTurnHistory(r.history),parserState:this.serializeParserState(s),schedulerState:this.serializeSchedulerState(o)};return{version:"1.0.0",timestamp:Date.now(),metadata:c,engineState:l,storyConfig:{id:n?.config.id||"unknown",version:n?.config.version||"0.0.0",title:n?.config.title||"Unknown",author:Array.isArray(n?.config.author)?n.config.author.join(", "):n?.config.author||"Unknown"}}}loadSaveData(e,r){let n=r.getStory();if(e.version!=="1.0.0")throw new Error(`Unsupported save version: ${e.version}`);if(e.storyConfig?.id&&n?.config.id&&e.storyConfig.id!==n.config.id)throw new Error(`Save is for different story: ${e.storyConfig.id}`);let i=this.deserializeEventSource(e.engineState.eventSource),o=r.getWorld();return this.deserializeSpatialIndex(e.engineState.spatialIndex,o),e.engineState.schedulerState&&this.deserializeSchedulerState(e.engineState.schedulerState,r.getScheduler()),this.clearUndoSnapshots(),{eventSource:i,currentTurn:e.metadata.turnCount+1}}serializeEventSource(e){let r=[];for(let n of e.getAllEvents())r.push({id:n.id,type:n.type,timestamp:n.timestamp||Date.now(),data:this.serializeEventData(n.data)});return r}serializeEventData(e){if(!e||typeof e!="object")return e||{};let r={};for(let[n,i]of Object.entries(e))typeof i=="function"?r[n]={__type:"function",__marker:"[Function]"}:i&&typeof i=="object"?Array.isArray(i)?r[n]=i.map(o=>typeof o=="object"?this.serializeEventData(o):o):r[n]=this.serializeEventData(i):r[n]=i;return r}deserializeEventSource(e){let r=(0,Oue.createSemanticEventSource)();for(let n of e)r.emit({id:n.id,type:n.type,timestamp:n.timestamp,data:this.deserializeEventData(n.data),entities:{}});return r}deserializeEventData(e){if(!e||typeof e!="object")return e;if(e.__type==="function")return()=>"[Serialized Function]";if(Array.isArray(e))return e.map(n=>this.deserializeEventData(n));let r={};for(let[n,i]of Object.entries(e))r[n]=this.deserializeEventData(i);return r}serializeSpatialIndex(e){let r={},n={},i={};for(let a of e.getAllEntities()){let s={};for(let[c,l]of a.traits)s[c]=this.serializeTrait(l);r[a.id]={id:a.id,traits:s,entityType:a.constructor.name}}let o=e.getAllEntities().filter(a=>a.type==="room"||a.type==="location"||a.has("if.trait.room"));for(let a of o){let s=e.getContents(a.id);n[a.id]={id:a.id,properties:{name:a.get(kK.TraitType.IDENTITY)?.name||"Unknown",description:a.get(kK.TraitType.IDENTITY)?.description||""},contents:s.map(c=>c.id),connections:this.extractConnections(a,e)}}return{entities:r,locations:n,relationships:i}}deserializeSpatialIndex(e,r){for(let[n,i]of Object.entries(e.entities)){let o=r.getEntity(n);if(o)for(let[a,s]of Object.entries(i.traits)){let c=this.deserializeTrait(a,s);c&&(o.has(a)&&o.remove(a),o.add(c))}}for(let[n,i]of Object.entries(e.locations))for(let o of i.contents){let a=r.getEntity(o);a&&r.moveEntity(a.id,n)}}serializeTurnHistory(e){let r=[];for(let[n,i]of e.entries())r.push({turnNumber:n+1,eventIds:i.events.map(o=>o.source||`${o.turn}-${o.sequence}`),timestamp:i.events[0]?.timestamp.getTime()||Date.now(),command:i.input});return r}deserializeTurnHistory(e,r){let n=[];for(let i of e){let a=r.getAllEvents().filter(s=>i.eventIds.includes(s.id)).map((s,c)=>(0,Iue.toSequencedEvent)(s,i.turnNumber,c));n.push({turn:i.turnNumber,input:i.command||"",success:!0,events:a})}return n}serializeParserState(e){if(e)return{}}serializeSchedulerState(e){let r=e.getState();return{turn:r.turn,daemons:r.daemons.map(n=>({id:n.id,isPaused:n.isPaused,runCount:n.runCount})),fuses:r.fuses.map(n=>({id:n.id,turnsRemaining:n.turnsRemaining,isPaused:n.isPaused,entityId:n.entityId})),randomSeed:r.randomSeed}}deserializeSchedulerState(e,r){r.setState({turn:e.turn,daemons:e.daemons.map(n=>({id:n.id,isPaused:n.isPaused,runCount:n.runCount})),fuses:e.fuses.map(n=>({id:n.id,turnsRemaining:n.turnsRemaining,isPaused:n.isPaused,entityId:n.entityId})),randomSeed:e.randomSeed})}serializeTrait(e){return typeof e=="object"&&e!==null?{...e}:e}deserializeTrait(e,r){return r&&typeof r=="object"?{type:e,...r}:null}extractConnections(e,r){let n={},i=e.get("if.trait.room");return i?.exits&&Object.entries(i.exits).forEach(([a,s])=>{s.destination&&(n[a]=s.destination)}),r.getContents(e.id).forEach(a=>{let s=a.get("if.trait.door");if(s){let c=s.room1===e.id?s.room2:s.room1;if(c){let l=a.name?.toLowerCase()||"";l.includes("north")?n.north=c:l.includes("south")?n.south=c:l.includes("east")?n.east=c:l.includes("west")?n.west=c:n.door=c}}}),n}};sg.SaveRestoreService=uO;function Sue(t){return new uO(t)}});var IL=p(cg=>{"use strict";Object.defineProperty(cg,"__esModule",{value:!0});cg.TurnEventProcessor=void 0;cg.createTurnEventProcessor=Aue;var xK=Je(),OL=cO(),dO=class{constructor(e){d(this,"perceptionService");this.perceptionService=e}processActionEvents(e,r,n,i){let o={turn:r.turn,playerId:r.playerId,locationId:r.locationId},a=e.map(c=>{let l=(0,OL.toSemanticEvent)(c);return(0,OL.processEvent)(l,o)});this.perceptionService&&(a=this.perceptionService.filterEvents(a,n,i));let s=[];for(let c of a)(0,xK.isPlatformRequestEvent)(c)&&s.push(c);return{semanticEvents:a,platformEvents:s}}processSemanticEvents(e,r,n,i){let o={turn:r.turn,playerId:r.playerId,locationId:r.locationId},a=e.map(c=>(0,OL.processEvent)(c,o));this.perceptionService&&(a=this.perceptionService.filterEvents(a,n,i));let s=[];for(let c of a)(0,xK.isPlatformRequestEvent)(c)&&s.push(c);return{semanticEvents:a,platformEvents:s}}emitEvents(e,r,n,i,o,a,s){let c=n.get(i)||[];n.set(i,[...c,...e]);for(let l of e)r.emit(l);if(o.onEvent)for(let l of e)o.onEvent(l);for(let l of e)a(l),s&&s(l)}checkForVictory(e){for(let r of e)if(r.type==="story.victory"){let n=r.data;return{reason:n?.reason||"Story completed",score:n?.score||0}}return null}};cg.TurnEventProcessor=dO;function Aue(t){return new dO(t)}});var wL=p(pO=>{"use strict";Object.defineProperty(pO,"__esModule",{value:!0});pO.GameEngine=void 0;var BK=b(),Rue=lK(),Nu=so(),SL=wK(),U=Je(),wue=TL(),AL=so(),jK=bw(),Cue=Ub(),Nue=HP(),mO=lp(),fO=cO(),sl=vp(),Due=_L(),Pue=bL(),Lue=IL(),RL=class{constructor(e){d(this,"world");d(this,"sessionStartTime");d(this,"sessionTurns",0);d(this,"sessionMoves",0);d(this,"context");d(this,"config");d(this,"commandExecutor");d(this,"eventProcessor");d(this,"platformEvents");d(this,"actionRegistry");d(this,"textService");d(this,"turnEvents",new Map);d(this,"running",!1);d(this,"story");d(this,"languageProvider");d(this,"parser");d(this,"eventListeners",new Map);d(this,"saveRestoreHooks");d(this,"eventSource",(0,U.createSemanticEventSource)());d(this,"systemEventSource");d(this,"pendingPlatformOps",[]);d(this,"perceptionService");d(this,"scheduler");d(this,"npcService");d(this,"narrativeSettings");d(this,"vocabularyManager");d(this,"saveRestoreService");d(this,"turnEventProcessor");d(this,"platformOpHandler");d(this,"hasEmittedInitialized",!1);this.world=e.world,this.perceptionService=e.perceptionService,this.world.registerCapability(BK.StandardCapabilities.COMMAND_HISTORY,{schema:Nu.CommandHistoryCapabilitySchema}),this.config={maxHistory:100,validateEvents:!0,collectTiming:!1,maxUndoSnapshots:10,...e.config},this.context={currentTurn:1,player:e.player,history:[],metadata:{started:new Date,lastPlayed:new Date}},this.actionRegistry=new Nu.StandardActionRegistry;for(let n of Nu.standardActions)this.actionRegistry.register(n);this.eventProcessor=new Rue.EventProcessor(this.world);let r={registerHandler:(n,i)=>{this.eventProcessor.registerHandler(n,(o,a)=>i(o))}};this.world.connectEventProcessor(r),(0,Nu.registerStandardChains)(this.world),this.platformEvents=(0,U.createSemanticEventSource)(),this.systemEventSource=(0,U.createGenericEventSource)(),this.systemEventSource.subscribe(n=>{this.emit("event",{id:n.id,timestamp:new Date(n.timestamp),type:`system.${n.type}`,data:n.data,sequence:0,turn:this.context.currentTurn,scope:"global"})}),this.scheduler=(0,wue.createSchedulerService)(),this.npcService=(0,AL.createNpcService)(),this.narrativeSettings=(0,jK.buildNarrativeSettings)(),this.vocabularyManager=(0,Due.createVocabularyManager)(),this.saveRestoreService=(0,Pue.createSaveRestoreService)({maxSnapshots:this.config.maxUndoSnapshots??10}),this.turnEventProcessor=(0,Lue.createTurnEventProcessor)(this.perceptionService),this.npcService.registerBehavior(AL.guardBehavior),this.npcService.registerBehavior(AL.passiveBehavior),this.languageProvider=e.language,this.parser=e.parser,this.textService=(0,SL.createTextService)(this.languageProvider),this.actionRegistry.setLanguageProvider(this.languageProvider),this.parser&&(0,sl.hasPlatformEventEmitter)(this.parser)&&this.parser.setPlatformEventEmitter(n=>{this.platformEvents.addEvent(n)}),this.commandExecutor=(0,Cue.createCommandExecutor)(this.world,this.actionRegistry,this.eventProcessor,this.parser,this.systemEventSource)}setStory(e){let r=(0,U.createStoryLoadingEvent)(e.config.id);this.emitGameEvent(r),this.story=e,this.narrativeSettings=(0,jK.buildNarrativeSettings)(e.config.narrative),e.initializeWorld(this.world);let n=e.createPlayer(this.world);if(this.context.player=n,this.world.setPlayer(n.id),this.configureLanguageProviderNarrative(n),this.context.metadata.title=e.config.title,this.context.metadata.author=Array.isArray(e.config.author)?e.config.author.join(", "):e.config.author,this.context.metadata.version=e.config.version,this.context.implicitActions=e.config.implicitActions,e.getCustomActions){let o=e.getCustomActions();for(let a of o)this.actionRegistry.register(a)}e.initialize&&e.initialize();let i=(0,U.createStoryLoadedEvent)({id:e.config.id,title:e.config.title,author:this.context.metadata.author,version:e.config.version});if(this.emitGameEvent(i),e.getCustomVocabulary&&this.parser&&this.parser.registerVerbs){let o=e.getCustomVocabulary();o.verbs&&o.verbs.length>0&&this.parser.registerVerbs(o.verbs)}e.onEngineReady&&e.onEngineReady(this)}getParser(){return this.parser}getLanguageProvider(){return this.languageProvider}start(){if(this.running)throw new Error("Engine is already running");if(!this.parser)throw new Error("Engine must have a parser before starting");if(!this.languageProvider)throw new Error("Engine must have a language provider before starting");if(!this.textService)throw new Error("Engine must have a text service before starting");if(!this.commandExecutor)throw new Error("Engine must have a command executor before starting");if(!this.hasEmittedInitialized){let a=(0,U.createGameInitializedEvent)();this.emitGameEvent(a),this.hasEmittedInitialized=!0}let e=(0,U.createGameStartingEvent)({id:this.story?.config.id,title:this.context.metadata.title,author:this.context.metadata.author,version:this.context.metadata.version});this.emitGameEvent(e),this.running=!0,this.sessionStartTime=Date.now(),this.sessionTurns=0,this.sessionMoves=0;let r=this.world.versionInfo,n=r?.engineVersion,i=r?.clientVersion||this.world.clientVersion,o=(0,U.createGameStartedEvent)({id:this.story?.config.id,title:this.context.metadata.title,author:this.context.metadata.author,version:this.context.metadata.version},this.sessionStartTime,n,i);this.emitGameEvent(o),this.emit("state:changed",this.context)}stop(e,r){if(!this.running)return;let n=(0,U.createGameEndingEvent)(e||"quit",{startTime:this.sessionStartTime,endTime:Date.now(),turns:this.sessionTurns,moves:this.sessionMoves});this.emitGameEvent(n),this.running=!1;let i={startTime:this.sessionStartTime,endTime:Date.now(),turns:this.sessionTurns,moves:this.sessionMoves};if(e==="victory"){let a=(0,U.createGameWonEvent)(i,r);this.emitGameEvent(a)}else if(e==="defeat"){let a=(0,U.createGameLostEvent)(r?.reason||"Game over",i);this.emitGameEvent(a)}else if(e==="quit"){let a=(0,U.createGameQuitEvent)(i);this.emitGameEvent(a)}else if(e==="abort"){let a=(0,U.createGameAbortedEvent)(r?.error||"Game aborted",i);this.emitGameEvent(a)}let o=(0,U.createGameEndedEvent)(e||"quit",i,r);this.emitGameEvent(o),this.emit("game:over",this.context)}async executeTurn(e){if(!this.running)throw new Error("Engine is not running");if(!this.commandExecutor)throw new Error("Engine must have a story set before executing turns");Nu.MetaCommandRegistry.isNonUndoable(e)||this.createUndoSnapshot();let r=this.world.getCapability("debug");r&&(r.debugParserEvents||r.debugValidationEvents||r.debugSystemEvents);let n=this.context.currentTurn;if(e==null){let i=mO.eventSequencer.sequence({type:"command.failed",data:{reason:"Input cannot be null or undefined",input:e}},n);return{turn:n,input:e,success:!1,events:[i],error:"Input cannot be null or undefined"}}this.emit("turn:start",n,e);try{if(this.parser){let m=this.world.getPlayer();if(m&&(0,sl.hasWorldContext)(this.parser)){let g=this.world.getLocation(m.id)||"";this.parser.setWorldContext(this.world,m.id,g)}let f=this.parser.parse(e);if(f.success){let g=f.value,h=g.action;if(h&&Nu.MetaCommandRegistry.isMeta(h)){let y=await this.executeMetaCommand(e,g);return{type:"turn",turn:n,input:y.input,success:y.success,events:y.events.map(_=>mO.eventSequencer.sequence(_,n)),error:y.error,actionId:y.actionId}}}}let i=await this.commandExecutor.execute(e,this.world,this.context,this.config),o=this.world.getLocation(this.context.player.id),a={turn:n,playerId:this.context.player.id,locationId:o},s=i.events.map(m=>{let f=(0,fO.toSemanticEvent)(m);return(0,fO.processEvent)(f,a)});this.perceptionService&&(s=this.perceptionService.filterEvents(s,this.context.player,this.world));let c=this.turnEvents.get(n)||[];this.turnEvents.set(n,[...c,...s]);for(let m of s)this.eventSource.emit(m),(0,U.isPlatformRequestEvent)(m)&&this.pendingPlatformOps.push(m);if(i.success&&(this.updateCommandHistory(i,e,n),this.parser&&(0,sl.hasPronounContext)(this.parser)&&i.validatedCommand&&this.parser.updatePronounContext(i.validatedCommand,n)),this.config.onEvent)for(let m of i.events)this.config.onEvent(m);let l=!1,u=null;for(let m of i.events)if(this.emit("event",m),m.type==="story.victory"){l=!0;let f=m.data;u={reason:f?.reason||"Story completed",score:f?.score||0}}if(i.success){let m=this.world.getLocation(this.context.player.id),f=this.npcService.tick({world:this.world,turn:n,random:this.scheduler.getRandom(),playerLocation:m||"",playerId:this.context.player.id});if(f.length>0){let h={turn:n,playerId:this.context.player.id,locationId:m},y=f.map(v=>(0,fO.processEvent)(v,h));this.perceptionService&&(y=this.perceptionService.filterEvents(y,this.context.player,this.world));let _=this.turnEvents.get(n)||[];this.turnEvents.set(n,[..._,...y]);for(let v of y)this.eventSource.emit(v),(0,U.isPlatformRequestEvent)(v)&&this.pendingPlatformOps.push(v);if(this.config.onEvent)for(let v of y)this.config.onEvent(v);for(let v of y)this.emit("event",v),this.dispatchEntityHandlers(v)}let g=this.scheduler.tick(this.world,n,this.context.player.id);if(g.events.length>0){let h={turn:n,playerId:this.context.player.id,locationId:m},y=g.events.map(v=>(0,fO.processEvent)(v,h));this.perceptionService&&(y=this.perceptionService.filterEvents(y,this.context.player,this.world));let _=this.turnEvents.get(n)||[];this.turnEvents.set(n,[..._,...y]);for(let v of y)this.eventSource.emit(v),(0,U.isPlatformRequestEvent)(v)&&this.pendingPlatformOps.push(v);if(this.config.onEvent)for(let v of y)this.config.onEvent(v);for(let v of y)this.emit("event",v),this.dispatchEntityHandlers(v)}}if(this.updateContext(i),this.sessionTurns++,i.success&&this.sessionMoves++,this.pendingPlatformOps.length>0){await this.processPlatformOperations(n);let m=this.turnEvents.get(n)||[];i.events=m}if(this.textService){let m=this.turnEvents.get(n)||[],f=this.textService.processTurn(m),g=(0,SL.renderToString)(f);g&&this.emit("text:output",g,n)}return this.turnEvents.set(n,[]),this.emit("turn:complete",i),l?(this.stop("victory",u),i):(this.isGameOver()&&this.stop("victory",{reason:"Story completed",score:0}),i)}catch(i){throw this.emit("turn:failed",i,n),i}}async executeMetaCommand(e,r){let n=[];try{let i=this.commandExecutor.validator.validate(r);if(!i.success){let f={id:`meta_error_${Date.now()}`,type:"if.event.command_error",timestamp:Date.now(),data:{messageId:`if.action.command.${i.error?.code||"validation_failed"}`,params:i.error?.details||{},blocked:!0,reason:i.error?.code||"validation_failed"},entities:{}};return n.push(f),this.processMetaEvents(n),{type:"meta",input:e,success:!1,events:n,error:i.error?.code||"Validation failed",actionId:r.action}}let o=i.value,a=this.actionRegistry.get(o.actionId);if(!a){let f={id:`meta_error_${Date.now()}`,type:"if.event.command_error",timestamp:Date.now(),data:{messageId:"if.action.command.action_not_found",params:{actionId:o.actionId},blocked:!0,reason:"action_not_found"},entities:{}};return n.push(f),this.processMetaEvents(n),{type:"meta",input:e,success:!1,events:n,error:`Action not found: ${o.actionId}`,actionId:o.actionId}}let s=(0,Nu.createScopeResolver)(this.world),c=(0,Nue.createActionContext)(this.world,this.context,o,a,s),l=a.validate(c),u;l.valid?(a.execute(c),u=a.report?a.report(c):[]):u=a.blocked?a.blocked(c,l):[{id:`meta_blocked_${Date.now()}`,type:"if.event.command_error",timestamp:Date.now(),data:{messageId:`if.action.command.${l.error||"validation_failed"}`,params:l.params||{},blocked:!0,reason:l.error||"validation_failed"},entities:{}}],n.push(...u);let m=n.filter(U.isPlatformRequestEvent);for(let f of m){let g=await this.processMetaPlatformOperation(f);n.push(...g)}return this.processMetaEvents(n),{type:"meta",input:e,success:l.valid,events:n,actionId:o.actionId}}catch(i){let o={id:`meta_error_${Date.now()}`,type:"command.failed",timestamp:Date.now(),data:{reason:i.message,input:e},entities:{}};return n.push(o),this.processMetaEvents(n),{type:"meta",input:e,success:!1,events:n,error:i.message,actionId:r.action}}}processMetaEvents(e){if(!this.textService||e.length===0)return;for(let i of e)this.emit("event",i);let r=this.textService.processTurn(e),n=(0,SL.renderToString)(r);n&&this.emit("text:output",n,this.context.currentTurn)}async processMetaPlatformOperation(e){let r=[];switch(e.type){case U.PlatformEventType.SAVE_REQUESTED:{let n=e.payload.context;if(this.saveRestoreHooks?.onSaveRequested)try{let i=this.createSaveData();n?.saveName&&(i.metadata.description=n.saveName),n?.metadata&&Object.assign(i.metadata,n.metadata),await this.saveRestoreHooks.onSaveRequested(i),r.push((0,U.createSaveCompletedEvent)(!0))}catch(i){r.push((0,U.createSaveCompletedEvent)(!1,i.message))}else r.push((0,U.createSaveCompletedEvent)(!1,"No save handler registered"));break}case U.PlatformEventType.RESTORE_REQUESTED:{if(this.saveRestoreHooks?.onRestoreRequested)try{let n=await this.saveRestoreHooks.onRestoreRequested();n?(this.loadSaveData(n),r.push((0,U.createRestoreCompletedEvent)(!0))):r.push((0,U.createRestoreCompletedEvent)(!1,"No save data available"))}catch(n){r.push((0,U.createRestoreCompletedEvent)(!1,n.message))}else r.push((0,U.createRestoreCompletedEvent)(!1,"No restore handler registered"));break}case U.PlatformEventType.QUIT_REQUESTED:{let n=e.payload.context;this.saveRestoreHooks?.onQuitRequested?await this.saveRestoreHooks.onQuitRequested(n)?(this.stop("quit"),r.push((0,U.createQuitConfirmedEvent)())):r.push((0,U.createQuitCancelledEvent)()):r.push((0,U.createQuitConfirmedEvent)());break}case U.PlatformEventType.RESTART_REQUESTED:{let n=e.payload.context;this.saveRestoreHooks?.onRestartRequested?await this.saveRestoreHooks.onRestartRequested(n)&&this.story?(this.running&&this.stop(),this.parser&&(0,sl.hasPronounContext)(this.parser)&&this.parser.resetPronounContext(),await this.setStory(this.story),this.start(),r.push((0,U.createRestartCompletedEvent)(!0))):r.push((0,U.createRestartCompletedEvent)(!1)):this.story&&(this.running&&this.stop(),this.parser&&(0,sl.hasPronounContext)(this.parser)&&this.parser.resetPronounContext(),await this.setStory(this.story),this.start(),r.push((0,U.createRestartCompletedEvent)(!0)));break}case U.PlatformEventType.UNDO_REQUESTED:{this.undo()?r.push((0,U.createUndoCompletedEvent)(!0,this.context.currentTurn)):r.push((0,U.createUndoCompletedEvent)(!1,void 0,"Nothing to undo"));break}case U.PlatformEventType.AGAIN_REQUESTED:{let n=e.payload.context;if(!n?.command)r.push((0,U.createAgainFailedEvent)("No command to repeat"));else try{await this.executeTurn(n.command)}catch(i){r.push((0,U.createAgainFailedEvent)(i.message))}break}}return r}getContext(){return{...this.context}}getWorld(){return this.world}getStory(){return this.story}getEventSource(){return this.eventSource}getNarrativeSettings(){return this.narrativeSettings}configureLanguageProviderNarrative(e){if(!this.languageProvider||!("setNarrativeSettings"in this.languageProvider))return;let r={perspective:this.narrativeSettings.perspective};if(this.narrativeSettings.perspective==="3rd")if(this.narrativeSettings.playerPronouns)r.playerPronouns=this.narrativeSettings.playerPronouns;else{let n=e.get("actor");n?.pronouns&&(r.playerPronouns=Array.isArray(n.pronouns)?n.pronouns[0]:n.pronouns)}this.languageProvider.setNarrativeSettings(r)}getScheduler(){return this.scheduler}getNpcService(){return this.npcService}getEventProcessor(){return this.eventProcessor}getTextService(){return this.textService}setTextService(e){this.textService=e}registerSaveRestoreHooks(e){this.saveRestoreHooks=e}registerParsedCommandTransformer(e){this.commandExecutor.registerParsedCommandTransformer(e)}unregisterParsedCommandTransformer(e){return this.commandExecutor.unregisterParsedCommandTransformer(e)}async save(){if(!this.saveRestoreHooks)return!1;try{let e=this.createSaveData();return await this.saveRestoreHooks.onSaveRequested(e),!0}catch(e){return console.error("Save failed:",e),!1}}async restore(){if(!this.saveRestoreHooks)return!1;try{let e=await this.saveRestoreHooks.onRestoreRequested();return e?(this.loadSaveData(e),!0):!1}catch(e){return console.error("Restore failed:",e),!1}}createUndoSnapshot(){this.saveRestoreService.createUndoSnapshot(this.world,this.context.currentTurn)}undo(){let e=this.saveRestoreService.undo(this.world);return e?(this.context.currentTurn=e.turn,this.updateScopeVocabulary(),this.emit("state:changed",this.context),!0):!1}canUndo(){return this.saveRestoreService.canUndo()}getUndoLevels(){return this.saveRestoreService.getUndoLevels()}createSaveData(){return this.saveRestoreService.createSaveData(this)}loadSaveData(e){let r=this.saveRestoreService.loadSaveData(e,this);this.eventSource=r.eventSource,this.context.currentTurn=r.currentTurn,this.context.metadata.lastPlayed=new Date,this.context.history=this.saveRestoreService.deserializeTurnHistory(e.engineState.turnHistory,this.eventSource),this.parser&&(0,sl.hasPronounContext)(this.parser)&&this.parser.resetPronounContext(),this.updateScopeVocabulary(),this.emit("state:changed",this.context)}getHistory(){return[...this.context.history]}getRecentEvents(e=10){let r=[],n=this.context.history.slice(-Math.ceil(e/5));for(let i of n)r.push(...i.events);return mO.EventSequenceUtils.sort(r).slice(-e)}updateEntityVocabulary(e,r){this.vocabularyManager.updateEntityVocabulary(e,r)}updateScopeVocabulary(){this.vocabularyManager.updateScopeVocabulary(this.world,this.context.player.id)}emitPlatformEvent(e){let r=typeof e.data=="object"&&e.data!==null?e.data:{},n={...e,id:`platform_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,timestamp:Date.now(),data:{...r,turn:this.context.currentTurn}};this.platformEvents.addEvent(n)}updateContext(e){this.context.history.push(e),this.context.history.length>this.config.maxHistory&&(this.context.history=this.context.history.slice(-this.config.maxHistory)),this.context.currentTurn++,this.context.metadata.lastPlayed=new Date,this.updateScopeVocabulary(),this.emit("state:changed",this.context)}updateCommandHistory(e,r,n){let i=this.world.getCapability(BK.StandardCapabilities.COMMAND_HISTORY);if(!i)return;let o=e.actionId;if(!o)return;let a={verb:e.parsedCommand?.action||r.split(" ")[0]};if(e.parsedCommand){let l=e.parsedCommand;if(l.structure)a={verb:l.structure.verb?.text||l.action,directObject:l.structure.directObject?.text,preposition:l.structure.preposition?.text,indirectObject:l.structure.indirectObject?.text};else{let u=l;(u.directObject||u.indirectObject)&&(a={verb:l.action,directObject:u.directObject?.text,preposition:u.preposition,indirectObject:u.indirectObject?.text})}}let s={actionId:o,originalText:r,parsedCommand:a,turnNumber:n,timestamp:Date.now()};i.entries||(i.entries=[]),i.entries.push(s);let c=i.maxEntries||100;i.entries.length>c&&(i.entries=i.entries.slice(-c))}async processPlatformOperations(e){let r=e??this.context.currentTurn;this.turnEvents.has(r)||this.turnEvents.set(r,[]);let n=[...this.pendingPlatformOps];this.pendingPlatformOps=[];for(let i of n)try{switch(i.type){case U.PlatformEventType.SAVE_REQUESTED:{let o=i.payload.context;if(this.saveRestoreHooks?.onSaveRequested){let a=this.createSaveData();o?.saveName&&(a.metadata.description=o.saveName),o?.metadata&&Object.assign(a.metadata,o.metadata),await this.saveRestoreHooks.onSaveRequested(a);let s=(0,U.createSaveCompletedEvent)(!0);this.eventSource.emit(s),this.turnEvents.get(r)?.push(s),this.emit("event",s)}else{let a=(0,U.createSaveCompletedEvent)(!1,"No save handler registered");this.eventSource.emit(a),this.turnEvents.get(r)?.push(a),this.emit("event",a)}break}case U.PlatformEventType.RESTORE_REQUESTED:{let o=i.payload.context;if(this.saveRestoreHooks?.onRestoreRequested){let a=await this.saveRestoreHooks.onRestoreRequested();if(a){this.loadSaveData(a);let s=(0,U.createRestoreCompletedEvent)(!0);this.eventSource.emit(s),this.turnEvents.get(r)?.push(s),this.emit("event",s)}else{let s=(0,U.createRestoreCompletedEvent)(!1,"No save data available or restore cancelled");this.eventSource.emit(s),this.turnEvents.get(r)?.push(s),this.emit("event",s)}}else{let a=(0,U.createRestoreCompletedEvent)(!1,"No restore handler registered");this.eventSource.emit(a),this.turnEvents.get(r)?.push(a),this.emit("event",a)}break}case U.PlatformEventType.QUIT_REQUESTED:{let o=i.payload.context;if(this.saveRestoreHooks?.onQuitRequested)if(await this.saveRestoreHooks.onQuitRequested(o)){this.stop("quit");let s=(0,U.createQuitConfirmedEvent)();this.eventSource.emit(s);let c=this.turnEvents.get(r);c&&c.push(s),this.emit("event",s)}else{let s=(0,U.createQuitCancelledEvent)();this.eventSource.emit(s);let c=this.turnEvents.get(r);c&&c.push(s),this.emit("event",s)}else{let a=(0,U.createQuitConfirmedEvent)();this.eventSource.emit(a);let s=this.turnEvents.get(r);s&&s.push(a),this.emit("event",a)}break}case U.PlatformEventType.RESTART_REQUESTED:{let o=i.payload.context;if(this.saveRestoreHooks?.onRestartRequested)if(await this.saveRestoreHooks.onRestartRequested(o)){let s=(0,U.createRestartCompletedEvent)(!0);this.eventSource.emit(s),this.turnEvents.get(r)?.push(s),this.emit("event",s),this.story&&(this.running&&this.stop(),this.parser&&(0,sl.hasPronounContext)(this.parser)&&this.parser.resetPronounContext(),await this.setStory(this.story),this.start())}else{let s=(0,U.createRestartCompletedEvent)(!1);this.eventSource.emit(s),this.turnEvents.get(r)?.push(s),this.emit("event",s)}else{let a=(0,U.createRestartCompletedEvent)(!0);this.eventSource.emit(a),this.turnEvents.get(r)?.push(a),this.emit("event",a),this.story&&(this.running&&this.stop(),this.parser&&(0,sl.hasPronounContext)(this.parser)&&this.parser.resetPronounContext(),await this.setStory(this.story),this.start())}break}case U.PlatformEventType.UNDO_REQUESTED:{let o=this.context.currentTurn;if(this.undo()){let s=(0,U.createUndoCompletedEvent)(!0,this.context.currentTurn);this.eventSource.emit(s),this.turnEvents.get(r)?.push(s),this.emit("event",s)}else{let s=(0,U.createUndoCompletedEvent)(!1,void 0,"Nothing to undo");this.eventSource.emit(s),this.turnEvents.get(r)?.push(s),this.emit("event",s)}break}case U.PlatformEventType.AGAIN_REQUESTED:{let o=i.payload.context;if(!o?.command){let a=(0,U.createAgainFailedEvent)("No command to repeat");this.eventSource.emit(a),this.turnEvents.get(r)?.push(a),this.emit("event",a);break}try{let a=await this.executeTurn(o.command)}catch(a){let s=(0,U.createAgainFailedEvent)(a instanceof Error?a.message:"Failed to repeat command");this.eventSource.emit(s),this.turnEvents.get(r)?.push(s),this.emit("event",s)}break}}}catch(o){console.error(`Error processing platform operation ${i.type}:`,o);let a;switch(i.type){case U.PlatformEventType.SAVE_REQUESTED:a=(0,U.createSaveCompletedEvent)(!1,o instanceof Error?o.message:"Unknown error");break;case U.PlatformEventType.RESTORE_REQUESTED:a=(0,U.createRestoreCompletedEvent)(!1,o instanceof Error?o.message:"Unknown error");break;case U.PlatformEventType.QUIT_REQUESTED:a=(0,U.createQuitCancelledEvent)();break;case U.PlatformEventType.RESTART_REQUESTED:a=(0,U.createRestartCompletedEvent)(!1);break;case U.PlatformEventType.UNDO_REQUESTED:a=(0,U.createUndoCompletedEvent)(!1,void 0,o instanceof Error?o.message:"Unknown error");break;case U.PlatformEventType.AGAIN_REQUESTED:a=(0,U.createAgainFailedEvent)(o instanceof Error?o.message:"Unknown error");break;default:continue}this.eventSource.emit(a),this.turnEvents.get(r)?.push(a),this.emit("event",a)}}emitGameEvent(e){let r={type:e.type,data:{...typeof e.data=="object"&&e.data!==null?e.data:{},id:e.id,timestamp:e.timestamp,entities:e.entities||{}}},n=mO.eventSequencer.sequence(r,this.context.currentTurn);if(this.emit("event",n),this.context.currentTurn>0){let i=this.turnEvents.get(this.context.currentTurn)||[];i.push(e),this.turnEvents.set(this.context.currentTurn,i)}}emit(e,...r){let n=this.eventListeners.get(e);if(n)for(let i of n)try{i(...r)}catch(o){console.error(`Error in event listener for ${e}:`,o)}}dispatchEntityHandlers(e){let r=this.world.getAllEntities();for(let n of r){let i=n.on;if(!i||typeof i!="object")continue;let o=i[e.type];if(typeof o=="function")try{let a=o(e,this.world);if(Array.isArray(a)){let s=this.turnEvents.get(this.context.currentTurn)||[];for(let c of a)s.push(c),this.emit("event",c);this.turnEvents.set(this.context.currentTurn,s)}}catch(a){console.error(`Error in entity handler for ${n.id} on ${e.type}:`,a)}}}isGameOver(){return this.story&&this.story.isComplete?this.story.isComplete():!1}on(e,r){return this.eventListeners.has(e)||this.eventListeners.set(e,new Set),this.eventListeners.get(e).add(r),this}off(e,r){let n=this.eventListeners.get(e);return n&&n.delete(r),this}};pO.GameEngine=RL});var WK=p(lg=>{"use strict";Object.defineProperty(lg,"__esModule",{value:!0});lg.PlatformOperationHandler=void 0;lg.createPlatformOperationHandler=Mue;var He=Je(),CL=vp(),gO=class{constructor(e,r,n,i){d(this,"saveRestoreHooks");d(this,"saveRestoreService");d(this,"stateProvider");d(this,"vocabularyManager");this.saveRestoreHooks=e,this.saveRestoreService=r,this.stateProvider=n,this.vocabularyManager=i}async processAll(e,r,n){r.turnEvents.has(r.currentTurn)||r.turnEvents.set(r.currentTurn,[]);for(let i of e)try{let o=await this.handleOperation(i,r,n);o&&(r.eventSource.emit(o),r.turnEvents.get(r.currentTurn)?.push(o),r.emitEvent(o))}catch(o){console.error(`Error processing platform operation ${i.type}:`,o);let a=this.createErrorEvent(i.type,o instanceof Error?o.message:"Unknown error");a&&(r.eventSource.emit(a),r.turnEvents.get(r.currentTurn)?.push(a),r.emitEvent(a))}}async handleOperation(e,r,n){switch(e.type){case He.PlatformEventType.SAVE_REQUESTED:return this.handleSave(e);case He.PlatformEventType.RESTORE_REQUESTED:return this.handleRestore(e,n);case He.PlatformEventType.QUIT_REQUESTED:return this.handleQuit(e,r,n);case He.PlatformEventType.RESTART_REQUESTED:return this.handleRestart(e,r,n);case He.PlatformEventType.UNDO_REQUESTED:return this.handleUndo(n);default:return null}}async handleSave(e){if(!this.saveRestoreHooks?.onSaveRequested)return(0,He.createSaveCompletedEvent)(!1,"No save handler registered");let r=e.payload.context,n=this.saveRestoreService.createSaveData(this.stateProvider);return r?.saveName&&(n.metadata.description=r.saveName),r?.metadata&&Object.assign(n.metadata,r.metadata),await this.saveRestoreHooks.onSaveRequested(n),(0,He.createSaveCompletedEvent)(!0)}async handleRestore(e,r){if(!this.saveRestoreHooks?.onRestoreRequested)return(0,He.createRestoreCompletedEvent)(!1,"No restore handler registered");let n=await this.saveRestoreHooks.onRestoreRequested();if(!n)return(0,He.createRestoreCompletedEvent)(!1,"No save data available or restore cancelled");let i=this.saveRestoreService.loadSaveData(n,this.stateProvider);r.updateContext({currentTurn:i.currentTurn});let o=r.getParser();return o&&(0,CL.hasPronounContext)(o)&&o.resetPronounContext(),r.updateScopeVocabulary(),r.emitStateChanged(),(0,He.createRestoreCompletedEvent)(!0)}async handleQuit(e,r,n){let i=e.payload.context;return this.saveRestoreHooks?.onQuitRequested?await this.saveRestoreHooks.onQuitRequested(i||{})?(n.stopEngine("quit"),(0,He.createQuitConfirmedEvent)()):(0,He.createQuitCancelledEvent)():(0,He.createQuitConfirmedEvent)()}async handleRestart(e,r,n){let i=e.payload.context;if(this.saveRestoreHooks?.onRestartRequested)if(await this.saveRestoreHooks.onRestartRequested(i||{})){let a=n.getParser();return a&&(0,CL.hasPronounContext)(a)&&a.resetPronounContext(),await n.restartStory(),(0,He.createRestartCompletedEvent)(!0)}else return(0,He.createRestartCompletedEvent)(!1);else{let o=n.getParser();return o&&(0,CL.hasPronounContext)(o)&&o.resetPronounContext(),await n.restartStory(),(0,He.createRestartCompletedEvent)(!0)}}handleUndo(e){let r=this.stateProvider.getWorld(),n=this.saveRestoreService.undo(r);return n?(e.updateContext({currentTurn:n.turn}),e.updateScopeVocabulary(),e.emitStateChanged(),(0,He.createUndoCompletedEvent)(!0,n.turn)):(0,He.createUndoCompletedEvent)(!1,void 0,"Nothing to undo")}createErrorEvent(e,r){switch(e){case He.PlatformEventType.SAVE_REQUESTED:return(0,He.createSaveCompletedEvent)(!1,r);case He.PlatformEventType.RESTORE_REQUESTED:return(0,He.createRestoreCompletedEvent)(!1,r);case He.PlatformEventType.QUIT_REQUESTED:return(0,He.createQuitCancelledEvent)();case He.PlatformEventType.RESTART_REQUESTED:return(0,He.createRestartCompletedEvent)(!1);case He.PlatformEventType.UNDO_REQUESTED:return(0,He.createUndoCompletedEvent)(!1,void 0,r);default:return null}}};lg.PlatformOperationHandler=gO;function Mue(t,e,r,n){return new gO(t,e,r,n)}});var qK=p(ke=>{"use strict";var kue=ke&&ke.__createBinding||(Object.create?(function(t,e,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}):(function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]})),Tn=ke&&ke.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&kue(e,t,r)};Object.defineProperty(ke,"__esModule",{value:!0});ke.EventSequenceUtils=ke.eventSequencer=ke.createCommandExecutor=ke.CommandExecutor=ke.GameEngine=void 0;Tn($W(),ke);Tn(bw(),ke);Tn(ZW(),ke);Tn(lp(),ke);Tn(Ub(),ke);Tn(qP(),ke);Tn(vp(),ke);Tn(Hy(),ke);Tn(wL(),ke);Tn(TL(),ke);Tn(_L(),ke);Tn(bL(),ke);Tn(IL(),ke);Tn(WK(),ke);var xue=wL();Object.defineProperty(ke,"GameEngine",{enumerable:!0,get:function(){return xue.GameEngine}});var HK=Ub();Object.defineProperty(ke,"CommandExecutor",{enumerable:!0,get:function(){return HK.CommandExecutor}});Object.defineProperty(ke,"createCommandExecutor",{enumerable:!0,get:function(){return HK.createCommandExecutor}});var UK=lp();Object.defineProperty(ke,"eventSequencer",{enumerable:!0,get:function(){return UK.eventSequencer}});Object.defineProperty(ke,"EventSequenceUtils",{enumerable:!0,get:function(){return UK.EventSequenceUtils}})});var FK=p(hO=>{"use strict";Object.defineProperty(hO,"__esModule",{value:!0});hO.EnglishPatternCompiler=void 0;var Rs=Xt(),NL=class{compile(e){if(!e||e.trim().length===0)throw new Rs.PatternSyntaxError("Pattern cannot be empty",e);if(!this.validate(e))throw new Rs.PatternSyntaxError("Invalid pattern syntax",e);let r=[],n=new Map,o=this.expandOptionalElements(e).trim().split(/\s+/);for(let c=0;c<o.length;c++){let l=o[c];if(l==="[optional]"){if(c++,c>=o.length)throw new Rs.PatternSyntaxError("Expected word after [optional] marker",e);let u=o[c];if(u.startsWith(":")){let m=u.substring(1),f=!1;if(m.endsWith("...")&&(m=m.slice(0,-3),f=!0),!m||!/^[a-zA-Z_]\w*$/.test(m))throw new Rs.PatternSyntaxError(`Invalid slot name: ${u}`,e,e.indexOf(u));if(n.has(m))throw new Rs.PatternSyntaxError(`Duplicate slot name: ${m}`,e,e.indexOf(u));n.set(m,r.length),r.push({type:"slot",value:m,optional:!0,greedy:f||void 0,slotType:f?Rs.SlotType.TEXT_GREEDY:void 0})}else if(u.includes("|")){let m=u.split("|");r.push({type:"alternates",value:m[0],alternates:m,optional:!0})}else r.push({type:"literal",value:u,optional:!0})}else if(l.startsWith(":")){let u=l.substring(1),m=!1;if(u.endsWith("...")&&(u=u.slice(0,-3),m=!0),!u||!/^[a-zA-Z_]\w*$/.test(u))throw new Rs.PatternSyntaxError(`Invalid slot name: ${l}`,e,e.indexOf(l));if(n.has(u))throw new Rs.PatternSyntaxError(`Duplicate slot name: ${u}`,e,e.indexOf(l));n.set(u,r.length),r.push({type:"slot",value:u,greedy:m||void 0,slotType:m?Rs.SlotType.TEXT_GREEDY:void 0})}else if(l.includes("|")){let u=l.split("|");r.push({type:"alternates",value:u[0],alternates:u})}else r.push({type:"literal",value:l})}let a=r.filter(c=>!c.optional&&(c.type==="slot"||c.type==="literal"||c.type==="alternates")).length,s=r.filter(c=>c.type==="slot"||c.type==="literal"||c.type==="alternates").length;return{tokens:r,slots:n,minTokens:a,maxTokens:s}}expandOptionalElements(e){let r=e,n=/\[([^\]]+)\]/g,i;for(;(i=n.exec(e))!==null;){let o=i[0],a=i[1];r=r.replace(o,`[optional] ${a}`)}return r}validate(e){if(!e||e.trim().length===0)return!1;let r=e.trim().split(/\s+/);for(let n of r){if(n.startsWith(":")){let i=n.substring(1);if(i.endsWith("...")&&(i=i.slice(0,-3)),!i||!/^[a-zA-Z_]\w*$/.test(i))return!1}if(n.includes("|")&&(n.endsWith("|")||n.includes("||")||n.split("|").some(o=>o.length===0)))return!1}return!0}extractSlots(e){let r=[],n=e.match(/:\w+(?:\.\.\.)?/g)||[];for(let i of n){let o=i.substring(1);o.endsWith("...")&&(o=o.slice(0,-3)),r.includes(o)||r.push(o)}return r}};hO.EnglishPatternCompiler=NL});var GK=p(ne=>{"use strict";Object.defineProperty(ne,"__esModule",{value:!0});ne.englishVerbs=ne.IFActions=void 0;ne.IFActions={GOING:"if.action.going",ENTERING:"if.action.entering",EXITING:"if.action.exiting",CLIMBING:"if.action.climbing",LOOKING:"if.action.looking",EXAMINING:"if.action.examining",READING:"if.action.reading",SEARCHING:"if.action.searching",LISTENING:"if.action.listening",SMELLING:"if.action.smelling",TOUCHING:"if.action.touching",TAKING:"if.action.taking",DROPPING:"if.action.dropping",PUTTING:"if.action.putting",INSERTING:"if.action.inserting",OPENING:"if.action.opening",CLOSING:"if.action.closing",LOCKING:"if.action.locking",UNLOCKING:"if.action.unlocking",SWITCHING_ON:"if.action.switching_on",SWITCHING_OFF:"if.action.switching_off",PUSHING:"if.action.pushing",PULLING:"if.action.pulling",TURNING:"if.action.turning",USING:"if.action.using",GIVING:"if.action.giving",SHOWING:"if.action.showing",THROWING:"if.action.throwing",ATTACKING:"if.action.attacking",TALKING:"if.action.talking",ASKING:"if.action.asking",TELLING:"if.action.telling",ANSWERING:"if.action.answering",WEARING:"if.action.wearing",TAKING_OFF:"if.action.taking_off",EATING:"if.action.eating",DRINKING:"if.action.drinking",INVENTORY:"if.action.inventory",WAITING:"if.action.waiting",SLEEPING:"if.action.sleeping",SAVING:"if.action.saving",RESTORING:"if.action.restoring",QUITTING:"if.action.quitting",HELP:"if.action.help",ABOUT:"if.action.about",SCORING:"if.action.scoring",TRACE:"author.trace"};ne.englishVerbs=[{action:ne.IFActions.GOING,verbs:["go","move","walk","run","head","travel"],requiresObject:!0},{action:ne.IFActions.ENTERING,verbs:["enter","go in","go into"],requiresObject:!0},{action:ne.IFActions.EXITING,verbs:["exit","leave","go out","get out"],requiresObject:!1},{action:ne.IFActions.CLIMBING,verbs:["climb","scale","ascend"],requiresObject:!0},{action:ne.IFActions.LOOKING,verbs:["look","l"],requiresObject:!1},{action:ne.IFActions.EXAMINING,verbs:["examine","x","inspect","check","view","observe","look at"],requiresObject:!0},{action:ne.IFActions.READING,verbs:["read","peruse","study"],requiresObject:!0},{action:ne.IFActions.SEARCHING,verbs:["search","find","locate"],requiresObject:!0},{action:ne.IFActions.LISTENING,verbs:["listen","hear"],requiresObject:!1},{action:ne.IFActions.SMELLING,verbs:["smell","sniff"],requiresObject:!1},{action:ne.IFActions.TOUCHING,verbs:["touch","feel"],requiresObject:!0},{action:ne.IFActions.TAKING,verbs:["take","get","pick","grab","acquire","pick up","take up"],requiresObject:!0},{action:ne.IFActions.DROPPING,verbs:["drop","put down","discard","throw away"],requiresObject:!0},{action:ne.IFActions.PUTTING,verbs:["put","place","put in","put on"],requiresObject:!0,allowsIndirectObject:!0},{action:ne.IFActions.INSERTING,verbs:["insert","insert into"],requiresObject:!0,allowsIndirectObject:!0},{action:ne.IFActions.OPENING,verbs:["open","unwrap","uncover"],requiresObject:!0},{action:ne.IFActions.CLOSING,verbs:["close","shut","cover"],requiresObject:!0},{action:ne.IFActions.LOCKING,verbs:["lock","secure"],requiresObject:!0},{action:ne.IFActions.UNLOCKING,verbs:["unlock","unsecure"],requiresObject:!0},{action:ne.IFActions.SWITCHING_ON,verbs:["switch on","turn on","activate","start"],requiresObject:!0},{action:ne.IFActions.SWITCHING_OFF,verbs:["switch off","turn off","deactivate","stop"],requiresObject:!0},{action:ne.IFActions.PUSHING,verbs:["push","press","shove"],requiresObject:!0},{action:ne.IFActions.PULLING,verbs:["pull","tug","drag"],requiresObject:!0},{action:ne.IFActions.TURNING,verbs:["turn","rotate","twist"],requiresObject:!0},{action:ne.IFActions.USING,verbs:["use","utilize","employ"],requiresObject:!0,allowsIndirectObject:!0},{action:ne.IFActions.GIVING,verbs:["give","hand","offer"],requiresObject:!0,allowsIndirectObject:!0},{action:ne.IFActions.SHOWING,verbs:["show","display","present"],requiresObject:!0,allowsIndirectObject:!0},{action:ne.IFActions.THROWING,verbs:["throw","toss","hurl"],requiresObject:!0,allowsIndirectObject:!0},{action:ne.IFActions.ATTACKING,verbs:["attack","hit","strike","fight","kill"],requiresObject:!0},{action:ne.IFActions.WEARING,verbs:["wear","put on","don","equip"],requiresObject:!0},{action:ne.IFActions.TAKING_OFF,verbs:["remove","take off","doff","unequip"],requiresObject:!0},{action:ne.IFActions.EATING,verbs:["eat","consume","devour"],requiresObject:!0},{action:ne.IFActions.DRINKING,verbs:["drink","sip","swallow","quaff"],requiresObject:!0},{action:ne.IFActions.TALKING,verbs:["talk","speak","converse","chat","talk to"],requiresObject:!0},{action:ne.IFActions.ASKING,verbs:["ask","inquire","question"],requiresObject:!0,allowsIndirectObject:!0},{action:ne.IFActions.TELLING,verbs:["tell","inform","say"],requiresObject:!0,allowsIndirectObject:!0},{action:ne.IFActions.ANSWERING,verbs:["answer","respond","reply"],requiresObject:!0},{action:ne.IFActions.INVENTORY,verbs:["inventory","i","inv"],requiresObject:!1},{action:ne.IFActions.WAITING,verbs:["wait","z"],requiresObject:!1},{action:ne.IFActions.SLEEPING,verbs:["sleep","nap","doze","rest","slumber"],requiresObject:!1},{action:ne.IFActions.SAVING,verbs:["save","save game"],requiresObject:!1},{action:ne.IFActions.RESTORING,verbs:["restore","load","load game","restore game"],requiresObject:!1},{action:ne.IFActions.QUITTING,verbs:["quit","q","exit game"],requiresObject:!1},{action:ne.IFActions.HELP,verbs:["help","?","commands"],requiresObject:!1},{action:ne.IFActions.ABOUT,verbs:["about","info","credits"],requiresObject:!1},{action:ne.IFActions.SCORING,verbs:["score","points"],requiresObject:!1},{action:ne.IFActions.TRACE,verbs:["trace"],requiresObject:!1}]});var DL=p(_n=>{"use strict";Object.defineProperty(_n,"__esModule",{value:!0});_n.directionMap=_n.ordinalNumbers=_n.cardinalNumbers=_n.abbreviations=_n.irregularPlurals=_n.englishWords=void 0;_n.englishWords={articles:["a","an","the"],prepositions:["in","on","at","to","for","with","from","into","onto","under","over","behind","beside","between","through","across","against","around","beneath","inside","outside","within","about","above","after","along","among","before","below","beyond","by","down","during","near","of","off","out","past","toward","towards","up","upon","using"],commonNouns:["door","window","wall","floor","ceiling","table","chair","bed","desk","shelf","box","container","bag","chest","trunk","key","lock","handle","button","switch","book","paper","note","letter","sign","lamp","light","candle","torch","lantern","sword","knife","gun","weapon","tool","food","water","bottle","cup","plate","coin","money","treasure","gem","jewel","rope","chain","string","wire","cable"],pronouns:["it","them","him","her","me","us","you","this","that","these","those","all","everything","everyone","everybody","nothing","nobody","none","some","any","anyone","anybody","anything","here","there","everywhere"],conjunctions:["and","or","but","then","so","because","if","when","while","although","though","unless"],determiners:["my","your","his","her","its","our","their","this","that","these","those","each","every","either","neither","some","any","no","all","both","half","several","many","much","few","little","other","another","such","what","which"],directions:["north","south","east","west","northeast","northwest","southeast","southwest","up","down","in","out","left","right","forward","back","backward"],commonAdjectives:["big","large","small","tiny","huge","little","red","blue","green","yellow","black","white","brown","gray","grey","wooden","metal","stone","glass","plastic","paper","old","new","broken","open","closed","locked","empty","full","good","bad","nice","beautiful","ugly","clean","dirty","first","second","third","last","next","previous","same","different","other","main","important"],numberWords:["zero","one","two","three","four","five","six","seven","eight","nine","ten","first","second","third","fourth","fifth","sixth","seventh","eighth","ninth","tenth"],auxiliaryVerbs:["is","are","was","were","be","been","being","have","has","had","having","do","does","did","doing","will","would","shall","should","may","might","must","can","could","ought","need","dare"],ignoreWords:["please","kindly","just","simply","really","very","quite","rather","well","now","then","so"]};_n.irregularPlurals=new Map([["children","child"],["people","person"],["men","man"],["women","woman"],["teeth","tooth"],["feet","foot"],["mice","mouse"],["geese","goose"],["oxen","ox"],["dice","die"],["pennies","penny"],["leaves","leaf"],["knives","knife"],["wives","wife"],["lives","life"],["shelves","shelf"],["wolves","wolf"],["halves","half"],["calves","calf"]]);_n.abbreviations=new Map([["n","north"],["s","south"],["e","east"],["w","west"],["ne","northeast"],["nw","northwest"],["se","southeast"],["sw","southwest"],["u","up"],["d","down"],["l","look"],["x","examine"],["i","inventory"],["z","wait"],["g","again"],["q","quit"]]);_n.cardinalNumbers={zero:0,one:1,two:2,three:3,four:4,five:5,six:6,seven:7,eight:8,nine:9,ten:10,eleven:11,twelve:12,thirteen:13,fourteen:14,fifteen:15,sixteen:16,seventeen:17,eighteen:18,nineteen:19,twenty:20,thirty:30,forty:40,fifty:50,sixty:60,seventy:70,eighty:80,ninety:90,hundred:100};_n.ordinalNumbers={first:1,second:2,third:3,fourth:4,fifth:5,sixth:6,seventh:7,eighth:8,ninth:9,tenth:10,eleventh:11,twelfth:12,thirteenth:13,fourteenth:14,fifteenth:15,sixteenth:16,seventeenth:17,eighteenth:18,nineteenth:19,twentieth:20};_n.directionMap={north:"north",south:"south",east:"east",west:"west",n:"north",s:"south",e:"east",w:"west",northeast:"northeast",northwest:"northwest",southeast:"southeast",southwest:"southwest",ne:"northeast",nw:"northwest",se:"southeast",sw:"southwest",up:"up",down:"down",u:"up",d:"down",in:"in",out:"out"}});var PL=p(yO=>{"use strict";Object.defineProperty(yO,"__esModule",{value:!0});yO.takingLanguage=void 0;yO.takingLanguage={actionId:"if.action.taking",patterns:["take [something]","get [something]","pick up [something]","grab [something]","acquire [something]","collect [something]"],messages:{no_target:"Take what?",cant_take_self:"{You} {can't} take {yourself}.",already_have:"{You} already {have} {item}.",cant_take_room:"{You} {can't} take {item}.",fixed_in_place:"{item} is fixed in place.",container_full:"{You're} carrying too much already.",too_heavy:"Your load is too heavy. You will have to leave something behind.",cannot_take:"{You} {can't} take {item}.",taken:"Taken.",taken_from:"{You} {take} {item} from {container}.",taken_multi:"{item}: Taken."},help:{description:"Pick up objects and add them to your inventory.",examples:"take book, get lamp, pick up the key, grab sword",summary:"TAKE/GET/PICK UP - Pick up objects and add them to your inventory. Example: TAKE LAMP"}}});var LL=p(vO=>{"use strict";Object.defineProperty(vO,"__esModule",{value:!0});vO.droppingLanguage=void 0;vO.droppingLanguage={actionId:"if.action.dropping",patterns:["drop [something]","put down [something]","discard [something]","release [something]","let go of [something]"],messages:{no_target:"Drop what?",not_held:"{You} aren't holding {item}.",nothing_to_drop:"{You} aren't carrying anything.",dropped:"Dropped.",dropped_in:"{You} {put} {item} in {container}.",dropped_on:"{You} {put} {item} on {surface}.",dropped_multi:"{item}: Dropped."},help:{description:"Drop objects from your inventory.",examples:"drop book, put down lamp, discard key",summary:"DROP/PUT DOWN - Drop objects from your inventory. Example: DROP SWORD"}}});var ML=p(EO=>{"use strict";Object.defineProperty(EO,"__esModule",{value:!0});EO.lookingLanguage=void 0;EO.lookingLanguage={actionId:"if.action.looking",patterns:["look","l","look around","look at [something]","examine [something]","x [something]"],messages:{room_description:`{name}
{description}`,room_dark:"It's pitch dark, and {you} {can't} see a thing.",exits:"Exits: {exits}",you_see:"{You} can {see} {items} here.",contents_list:"{You} can {see} {items} here.",nothing_special:"{You} {see} nothing special.",container_contents:"In {container} {you} {see} {items}.",surface_contents:"On {surface} {you} {see} {items}."},help:{description:"Look around the current location to see what is there.",examples:"look, l, look around",summary:"LOOK/L - Look around the current location to see what is there. Example: LOOK"}}});var kL=p(TO=>{"use strict";Object.defineProperty(TO,"__esModule",{value:!0});TO.inventoryLanguage=void 0;TO.inventoryLanguage={actionId:"if.action.inventory",patterns:["inventory","i","inv","take inventory","check inventory"],messages:{empty:"{You} aren't carrying anything.",inventory_empty:"{You} aren't carrying anything.",nothing_at_all:"{You} aren't carrying anything at all.",hands_empty:"{Your} hands are empty.",pockets_empty:"{Your} pockets are empty.",carrying:"{You} {be} carrying:",wearing:"{You} {be} wearing:",carrying_and_wearing:"{You} {be} carrying and wearing:",item_list:"  {item}",holding_list:"  {items}",worn_list:"  {items} (worn)",inventory_header:"{You} {be} carrying:",carrying_count:"{You} {be} carrying {holdingCount} item(s).",wearing_count:"{You} {be} wearing {wearingCount} item(s).",burden_light:"{You're} traveling light.",burden_heavy:"{You're} carrying quite a load.",burden_overloaded:"{You're} weighed down with everything {you're} carrying."},help:{description:"Check what you are carrying and wearing.",examples:"inventory, i, inv",summary:"INVENTORY/I - Check what you are carrying and wearing. Example: I"}}});var xL=p(_O=>{"use strict";Object.defineProperty(_O,"__esModule",{value:!0});_O.examiningLanguage=void 0;_O.examiningLanguage={actionId:"if.action.examining",patterns:["examine [something]","x [something]","look at [something]","inspect [something]","study [something]","read [something]"],messages:{no_target:"Examine what?",not_visible:"{You} {can't} see {item} here.",cant_see:"{You} {can't} see {item} here.",examined:"{description}",examined_self:"{description}",examined_container:"{description}",examined_supporter:"{description}",examined_readable:"{description}",examined_switchable:"{description}",examined_wearable:"{description}",examined_door:"{description}",nothing_special:"{You} {see} nothing special about {item}.",description:"{description}",brief_description:"{description}",no_description:"{You} {see} nothing special about {item}.",container_open:"{item} is open.",container_closed:"{item} is closed.",container_empty:"{item} is empty.",container_contents:"In {container} {you} {see} {items}.",surface_contents:"On {surface} {you} {see} {items}.",worn_by_you:"{You} {are} wearing {item}.",worn_by_other:"{actor} is wearing {item}."},help:{description:"Examine objects more closely.",examples:"examine book, x lamp, look at key, inspect door",summary:"EXAMINE/X/LOOK AT - Look closely at objects to see detailed descriptions. Example: X BOOK"}}});var BL=p(bO=>{"use strict";Object.defineProperty(bO,"__esModule",{value:!0});bO.goingLanguage=void 0;bO.goingLanguage={actionId:"if.action.going",patterns:["go [direction]","[direction]","walk [direction]","head [direction]","move [direction]","travel [direction]"],messages:{room_description:`{name}
{description}`,contents_list:"{You} can {see} {items} here.",no_exit:"{You} {can't} go that way.",no_exit_that_way:"{You} {can't} go that way.",door_closed:"The {door} is closed.",door_locked:"The {door} is locked.",too_dark:"It is pitch dark. You are likely to be eaten by a grue.",moved:"{You} {go} {direction}.",cant_go_through:"{You} {can't} go through {obstacle}.",already_there:"{You're} already there.",nowhere_to_go:"{You}'ll have to say which compass direction to go in.",no_direction:"{You}'ll have to say which direction to go.",not_in_room:"{You're} not in a place where {you} can go anywhere.",no_exits:"There are no obvious exits.",movement_blocked:"{message}",destination_not_found:"{You} {can't} go that way.",need_light:"It's too dark to go that way safely.",went:"{You} {go} {direction}.",arrived:"{You} {arrive}.",cant_go:"{You} {can't} go that way."},help:{description:"Move in compass directions or to connected locations.",examples:"go north, n, walk east, head south, go upstairs",summary:"GO/N/S/E/W - Move in compass directions or to connected locations. Example: GO NORTH or N"}}});var jL=p(OO=>{"use strict";Object.defineProperty(OO,"__esModule",{value:!0});OO.openingLanguage=void 0;OO.openingLanguage={actionId:"if.action.opening",patterns:["open [something]","open up [something]","unclose [something]"],messages:{no_target:"Open what?",not_openable:"{item} can't be opened.",already_open:"{item} is already open.",locked:"{item} is locked.",opened:"{You} {open} {item}.",revealing:"Opening {container} reveals {items}.",its_empty:"{You} {open} {container}, which is empty.",cant_reach:"{You} {can't} reach {item}."},help:{description:"Open containers or doors.",examples:"open door, open box, open chest",summary:"OPEN - Open doors, containers, and other openable objects. Example: OPEN DOOR"}}});var WL=p(IO=>{"use strict";Object.defineProperty(IO,"__esModule",{value:!0});IO.closingLanguage=void 0;IO.closingLanguage={actionId:"if.action.closing",patterns:["close [something]","shut [something]"],messages:{no_target:"Close what?",not_closable:"{item} can't be closed.",already_closed:"{item} is already closed.",closed:"{You} {close} {item}.",cant_reach:"{You} {can't} reach {item}.",prevents_closing:"{You} {can't} close {item} while {obstacle} is in the way."},help:{description:"Close containers or doors.",examples:"close door, shut box",summary:"CLOSE/SHUT - Close doors, containers, and other closeable objects. Example: CLOSE DOOR"}}});var HL=p(SO=>{"use strict";Object.defineProperty(SO,"__esModule",{value:!0});SO.puttingLanguage=void 0;SO.puttingLanguage={actionId:"if.action.putting",patterns:["put [something] in [something]","put [something] into [something]","put [something] on [something]","put [something] onto [something]","place [something] in [something]","place [something] on [something]","insert [something] in [something]","insert [something] into [something]"],messages:{no_target:"Put what?",no_destination:"Where do {you} want to put {item}?",not_held:"{You} {need} to be holding {item} first.",not_container:"{You} {can't} put things in {destination}.",not_surface:"{You} {can't} put things on {destination}.",container_closed:"{container} is closed.",already_there:"{item} is already {relation} {destination}.",put_in:"{You} {put} {item} in {container}.",put_on:"{You} {put} {item} on {surface}.",cant_put_in_itself:"{You} {can't} put {item} inside itself.",cant_put_on_itself:"{You} {can't} put {item} on itself.",no_room:"There's no room in {container}.",no_space:"There's no space on {surface}."},help:{description:"Put objects in or on other objects.",examples:"put book in box, put lamp on table, place key in drawer",summary:"PUT ON/IN - Place objects on surfaces or in containers. Example: PUT VASE ON TABLE"}}});var UL=p(AO=>{"use strict";Object.defineProperty(AO,"__esModule",{value:!0});AO.insertingLanguage=void 0;AO.insertingLanguage={actionId:"if.action.inserting",patterns:["insert [something] in [something]","insert [something] into [something]","stick [something] in [something]","push [something] in [something]"],messages:{no_target:"Insert what?",no_destination:"Insert {item} into what?",not_held:"{You} {need} to be holding {item} first.",not_insertable:"{item} can't be inserted into things.",not_container:"{You} {can't} insert things into {destination}.",already_there:"{item} is already in {destination}.",inserted:"{You} {insert} {item} into {container}.",wont_fit:"{item} won't fit in {container}.",container_closed:"{container} is closed."},help:{description:"Insert objects into containers.",examples:"insert coin in slot, insert key into lock",summary:"INSERT/PUT IN - Put objects inside containers. Example: PUT COIN IN SLOT"}}});var qL=p(RO=>{"use strict";Object.defineProperty(RO,"__esModule",{value:!0});RO.removingLanguage=void 0;RO.removingLanguage={actionId:"if.action.removing",patterns:["remove [something] from [something]","take [something] from [something]","take [something] out of [something]","get [something] from [something]","extract [something] from [something]"],messages:{no_target:"Remove what?",no_source:"Remove {item} from what?",not_in_container:"{item} isn't in {container}.",not_on_surface:"{item} isn't on {surface}.",container_closed:"{container} is closed.",removed_from:"{You} {take} {item} from {container}.",removed_from_surface:"{You} {take} {item} from {surface}.",cant_reach:"{You} {can't} reach {item}.",already_have:"{You} already {have} {item}."},help:{description:"Remove objects from containers or surfaces.",examples:"remove book from shelf, take coin from box, get apple from basket",summary:"REMOVE/TAKE FROM - Take objects out of containers. Example: TAKE BOOK FROM SHELF"}}});var FL=p(wO=>{"use strict";Object.defineProperty(wO,"__esModule",{value:!0});wO.wearingLanguage=void 0;wO.wearingLanguage={actionId:"if.action.wearing",patterns:["wear [something]","put on [something]","put [something] on","don [something]"],messages:{no_target:"Wear what?",not_wearable:"{You} {can't} wear {item}.",not_held:"{You} {need} to be holding {item} first.",already_wearing:"{You're} already wearing {item}.",worn:"{You} {put} on {item}.",cant_wear_that:"{You} {can't} wear {item}.",hands_full:"{You} {need} to have {your} hands free to put that on."},help:{description:"Wear clothing or accessories that you are carrying.",examples:"wear hat, put on coat, don gloves, put ring on",summary:"WEAR/PUT ON - Wear clothing or accessories that you are carrying. Example: WEAR HAT"}}});var GL=p(CO=>{"use strict";Object.defineProperty(CO,"__esModule",{value:!0});CO.takingOffLanguage=void 0;CO.takingOffLanguage={actionId:"if.action.taking_off",patterns:["take off [something]","take [something] off","remove [something]","doff [something]"],messages:{no_target:"Take off what?",not_wearing:"{You} aren't wearing {item}.",removed:"{You} {take} off {item}.",cant_remove:"{You} {can't} take off {item}.",prevents_removal:"{You}'ll need to take off {blocking} first."},help:{description:"Remove worn clothing or accessories.",examples:"take off hat, remove coat, doff gloves, take ring off",summary:"TAKE OFF/REMOVE - Remove worn clothing or accessories. Example: TAKE OFF COAT"}}});var VL=p(NO=>{"use strict";Object.defineProperty(NO,"__esModule",{value:!0});NO.lockingLanguage=void 0;NO.lockingLanguage={actionId:"if.action.locking",patterns:["lock [something]","lock [something] with [something]","secure [something]","secure [something] with [something]"],messages:{no_target:"Lock what?",not_lockable:"{item} can't be locked.",no_key:"What do {you} want to lock it with?",wrong_key:"{key} doesn't fit {item}.",already_locked:"{item} is already locked.",not_closed:"{You} {need} to close {item} first.",locked:"{You} {lock} {item}.",locked_with:"{You} {lock} {item} with {key}.",cant_reach:"{You} {can't} reach {item}.",key_not_held:"{You} {need} to be holding {key}."},help:{description:"Lock containers or doors.",examples:"lock door, lock chest with key",summary:"LOCK - Lock doors and containers with the appropriate key. Example: LOCK DOOR WITH KEY"}}});var YL=p(DO=>{"use strict";Object.defineProperty(DO,"__esModule",{value:!0});DO.unlockingLanguage=void 0;DO.unlockingLanguage={actionId:"if.action.unlocking",patterns:["unlock [something]","unlock [something] with [something]","open [something] with [something]"],messages:{no_target:"Unlock what?",not_lockable:"{item} can't be unlocked.",no_key:"What do {you} want to unlock it with?",wrong_key:"{key} doesn't fit {item}.",already_unlocked:"{item} is already unlocked.",unlocked:"{You} {unlock} {item}.",unlocked_with:"{You} {unlock} {item} with {key}.",cant_reach:"{You} {can't} reach {item}.",key_not_held:"{You} {need} to be holding {key}.",still_locked:"{item} is locked."},help:{description:"Unlock containers or doors.",examples:"unlock door, unlock chest with key",summary:"UNLOCK - Unlock doors and containers with the appropriate key. Example: UNLOCK CHEST WITH KEY"}}});var zL=p(PO=>{"use strict";Object.defineProperty(PO,"__esModule",{value:!0});PO.enteringLanguage=void 0;PO.enteringLanguage={actionId:"if.action.entering",patterns:["enter [something]","get in [something]","get into [something]","get on [something]","go in [something]","go into [something]","go inside [something]","board [something]","mount [something]","sit on [something]","sit in [something]","lie on [something]","lie in [something]","stand on [something]","stand in [something]","climb in [something]","climb into [something]","climb on [something]","climb onto [something]"],messages:{no_target:"Enter what?",not_enterable:"{You} {can't} enter {place}.",already_inside:"{You're} already in {place}.",container_closed:"{container} is closed.",too_full:"{place} is full (maximum {max} occupants).",entered:"{You} {get} into {place}.",entered_on:"{You} {get} onto {place}.",cant_enter:"{You} {can't} enter {place}: {reason}.",not_here:"{You} {don't} see {place} here.",too_small:"{place} is too small for {you} to enter.",occupied:"{place} is already occupied."},help:{description:"Enter containers, vehicles, or furniture that can hold you.",examples:"enter car, get in box, sit on chair, board ship",summary:"ENTER/GET IN - Enter containers, vehicles, or furniture that can hold you. Example: ENTER CAR"}}});var $L=p(LO=>{"use strict";Object.defineProperty(LO,"__esModule",{value:!0});LO.exitingLanguage=void 0;LO.exitingLanguage={actionId:"if.action.exiting",patterns:["exit","get out","get off","go out","go outside","leave","dismount","stand","stand up","climb out","climb off","disembark","alight"],messages:{already_outside:"{You're} not inside anything.",container_closed:"{container} is closed.",cant_exit:"{You} {can't} exit {place}.",exited:"{You} {get} out of {place}.",exited_from:"{You} {get} {preposition} {place}.",nowhere_to_go:"There's nowhere to go from here.",exit_blocked:"The way out is blocked.",must_stand_first:"{You}'ll need to stand up first."},help:{description:"Exit from containers, vehicles, or furniture you are inside.",examples:"exit, get out, leave, stand up",summary:"EXIT/LEAVE/GET OUT - Exit from containers, vehicles, or furniture you are inside. Example: EXIT"}}});var KL=p(MO=>{"use strict";Object.defineProperty(MO,"__esModule",{value:!0});MO.climbingLanguage=void 0;MO.climbingLanguage={actionId:"if.action.climbing",patterns:["climb","climb [something]","climb up","climb down","climb up [something]","climb down [something]","climb on [something]","climb onto [something]","climb over [something]","scale [something]","ascend","ascend [something]","descend","descend [something]","scramble up [something]","clamber up [something]","shin up [something]"],messages:{no_target:"What do {you} want to climb?",not_climbable:"{You} {can't} climb {object}.",cant_go_that_way:"{You} {can't} climb {direction} from here.",climbed_up:"{You} {climb} up.",climbed_down:"{You} {climb} down.",climbed_onto:"{You} {climb} onto {object}.",already_there:"{You're} already on {place}.",too_high:"That's too high to climb.",too_dangerous:"That looks too dangerous to climb.",need_equipment:"{You}'d need climbing equipment for that.",too_slippery:"It's too slippery to climb.",nothing_to_climb:"There's nothing to climb here."},help:{description:"Climb objects or move in vertical directions.",examples:"climb tree, climb up, climb down, climb ladder",summary:"CLIMB - Climb objects or move in vertical directions. Example: CLIMB LADDER"}}});var QL=p(kO=>{"use strict";Object.defineProperty(kO,"__esModule",{value:!0});kO.searchingLanguage=void 0;kO.searchingLanguage={actionId:"if.action.searching",patterns:["search [something]","look in [something]","look inside [something]","look through [something]","rummage [something]","rummage in [something]","rummage through [something]","examine [something] closely"],messages:{not_visible:"{You} {can't} see {target} to search it.",not_reachable:"{You} {can't} reach {target} to search it.",container_closed:"{target} is closed.",nothing_special:"{You} {find} nothing of interest.",found_items:"{You} {discover}: {items}.",empty_container:"{target} is empty.",container_contents:"In {target} {you} {see}: {items}.",supporter_contents:"On {target} {you} {see}: {items}.",searched_location:"{You} {search} around carefully.",searched_object:"{You} {search} {target} thoroughly.",found_concealed:"Hidden {where}, {you} {discover}: {items}."},help:{description:"Search objects or locations for hidden items or additional details.",examples:"search desk, look in drawer, rummage through bag, examine closely",summary:"SEARCH/LOOK IN - Search objects or locations for hidden items or additional details. Example: SEARCH DESK"}}});var XL=p(xO=>{"use strict";Object.defineProperty(xO,"__esModule",{value:!0});xO.listeningLanguage=void 0;xO.listeningLanguage={actionId:"if.action.listening",patterns:["listen","listen to [something]","hear [something]"],messages:{not_visible:"{You} {can't} see {target} well enough to focus on its sounds.",silence:"{You} {hear} nothing out of the ordinary.",ambient_sounds:"{You} {hear} the usual ambient sounds.",active_devices:"{You} can {hear} {devices} operating nearby.",no_sound:"{target} isn't making any sound.",device_running:"{target} is making a soft humming sound.",device_off:"{target} is silent.",container_sounds:"{You} {hear} faint sounds from inside {target}.",liquid_sounds:"{You} {hear} liquid sloshing in {target}.",listened_to:"{You} {listen} carefully to {target}.",listened_environment:"{You} {listen} carefully."},help:{description:"Listen for sounds in the environment or from specific objects.",examples:"listen, listen to radio, hear",summary:"LISTEN - Listen for sounds in the environment or from specific objects. Example: LISTEN TO RADIO"}}});var ZL=p(BO=>{"use strict";Object.defineProperty(BO,"__esModule",{value:!0});BO.smellingLanguage=void 0;BO.smellingLanguage={actionId:"if.action.smelling",patterns:["smell","smell [something]","sniff [something]","sniff","inhale"],messages:{not_visible:"{You} {can't} see {target} to smell it.",too_far:"{target} is too far away to smell.",no_scent:"{You} {don't} smell anything unusual.",room_scents:"The air carries various scents.",food_nearby:"{You} {smell} food nearby.",smoke_detected:"{You} {detect} a faint smell of smoke.",no_particular_scent:"{target} has no particular smell.",food_scent:"{target} smells delicious.",drink_scent:"{target} has a pleasant aroma.",burning_scent:"{target} gives off a smoky smell.",container_food_scent:"{You} {smell} food inside {target}.",musty_scent:"{target} smells a bit musty.",fresh_scent:"{target} smells fresh and clean.",smelled:"{You} {smell} {target}.",smelled_environment:"{You} {sniff} the air."},help:{description:"Smell objects or detect scents in your current location.",examples:"smell, smell flower, sniff wine, inhale",summary:"SMELL/SNIFF - Smell objects or detect scents in your current location. Example: SMELL FLOWER"}}});var JL=p(jO=>{"use strict";Object.defineProperty(jO,"__esModule",{value:!0});jO.touchingLanguage=void 0;jO.touchingLanguage={actionId:"if.action.touching",patterns:["touch [something]","feel [something]","pat [something]","stroke [something]","poke [something]","prod [something]"],messages:{no_target:"Touch what?",not_visible:"{You} {can't} see {target} to touch it.",not_reachable:"{You} {can't} reach {target}.",feels_normal:"{target} feels as {you}'d expect.",feels_warm:"{target} feels warm to the touch.",feels_hot:"{target} is hot! {You} {pull} {your} hand back quickly.",feels_cold:"{target} feels cold.",feels_soft:"{target} feels soft.",feels_hard:"{target} feels hard and solid.",feels_smooth:"{target} feels smooth.",feels_rough:"{target} feels rough.",feels_wet:"{target} feels damp.",device_vibrating:"{target} is vibrating slightly.",immovable_object:"{target} is solid and immovable.",liquid_container:"{You} {feel} liquid sloshing inside {target}.",touched:"{You} {touch} {target}.",touched_gently:"{You} gently {touch} {target}.",poked:"{You} {poke} {target}.",prodded:"{You} {prod} {target}.",patted:"{You} {pat} {target}.",stroked:"{You} {stroke} {target}."},help:{description:"Touch objects to discover their texture, temperature, or other tactile properties.",examples:"touch wall, feel fabric, pat dog, poke button",summary:"TOUCH/FEEL - Touch objects to discover their texture, temperature, or other tactile properties. Example: TOUCH STONE"}}});var eM=p(WO=>{"use strict";Object.defineProperty(WO,"__esModule",{value:!0});WO.readingLanguage=void 0;WO.readingLanguage={actionId:"if.action.reading",patterns:["read [something]","peruse [something]"],messages:{what_to_read:"What do you want to read?",not_readable:"There's nothing written on {item}.",cannot_read_now:"{reason}",read_text:`{cap:item} reads:
{text}`,read_book:`{cap:item} reads:
{text}`,read_book_page:`{cap:item} (page {currentPage} of {totalPages}):
{text}`,read_sign:`{cap:item} says:
{text}`,read_inscription:`{cap:item} reads:
{text}`},help:{description:"Read text written on objects.",examples:"read book, read sign, read leaflet",summary:"READ - Read text on books, signs, notes, and inscriptions. Example: READ BOOK"}}});var tM=p(HO=>{"use strict";Object.defineProperty(HO,"__esModule",{value:!0});HO.switchingOnLanguage=void 0;HO.switchingOnLanguage={actionId:"if.action.switching_on",patterns:["switch on [something]","switch [something] on","turn on [something]","turn [something] on","activate [something]","start [something]","power on [something]","power [something] on"],messages:{no_target:"Switch on what?",not_visible:"{You} {can't} see {target}.",not_reachable:"{You} {can't} reach {target}.",not_switchable:"{target} isn't something {you} can switch on.",already_on:"{target} is already on.",no_power:"{target} has no power source.",switched_on:"{You} {switch} on {target}.",light_on:"{You} {switch} on {target}, illuminating the area.",device_humming:"{target} hums to life.",temporary_activation:"{target} switches on temporarily.",with_sound:"{You} {switch} on {target}. {sound}",door_opens:"{target} switches on and opens.",illuminates_darkness:"{the:cap:target} switches on, banishing the darkness."},help:{description:"Turn on devices, lights, and other switchable objects.",examples:"turn on lamp, switch radio on, activate machine, start engine",summary:"TURN ON/SWITCH ON - Turn on devices, lights, and other switchable objects. Example: TURN ON LAMP"}}});var rM=p(UO=>{"use strict";Object.defineProperty(UO,"__esModule",{value:!0});UO.switchingOffLanguage=void 0;UO.switchingOffLanguage={actionId:"if.action.switching_off",patterns:["switch off [something]","switch [something] off","turn off [something]","turn [something] off","deactivate [something]","stop [something]","power off [something]","power [something] off"],messages:{no_target:"Switch off what?",not_visible:"{You} {can't} see {target}.",not_reachable:"{You} {can't} reach {target}.",not_switchable:"{target} isn't something {you} can switch off.",already_off:"{target} is already off.",switched_off:"{You} {switch} off {target}.",light_off:"{You} {switch} off {target}, plunging the area into darkness.",light_off_still_lit:"{You} {switch} off {target}.",device_stops:"{target} powers down with a soft whir.",silence_falls:"{You} {switch} off {target}. Silence falls.",with_sound:"{You} {switch} off {target}. {sound}",door_closes:"{target} switches off and closes.",was_temporary:"{target} switches off (it had {remainingTime} seconds left)."},help:{description:"Turn off devices, lights, and other switchable objects.",examples:"turn off lamp, switch radio off, deactivate alarm, stop machine",summary:"TURN OFF/SWITCH OFF - Turn off devices, lights, and other switchable objects. Example: TURN OFF RADIO"}}});var nM=p(qO=>{"use strict";Object.defineProperty(qO,"__esModule",{value:!0});qO.pushingLanguage=void 0;qO.pushingLanguage={actionId:"if.action.pushing",patterns:["push [something]","push [something] [direction]","press [something]","shove [something]","shove [something] [direction]","move [something]","move [something] [direction]"],messages:{no_target:"Push what?",not_visible:"{You} {can't} see {target}.",not_reachable:"{You} {can't} reach {target}.",too_heavy:"{target} is far too heavy to push (weighs {weight}kg).",wearing_it:"{You} {can't} push {target} while wearing it.",button_pushed:"{You} {push} {target}.",button_clicks:"{You} {press} {target}. Click!",switch_toggled:"{You} {push} {target}, toggling it {newState}.",pushed_direction:"{You} {push} {target} {direction}.",pushed_nudged:"{You} {give} {target} a push, but it doesn't move far.",pushed_with_effort:"With considerable effort, {you} {push} {target} {direction}.",reveals_passage:"As {you} {push} {target} {direction}, it slides aside, revealing a hidden passage!",wont_budge:"{target} won't budge.",pushing_does_nothing:"Pushing {target} has no effect.",fixed_in_place:"{target} is fixed in place."},help:{description:"Push objects, press buttons, or move heavy items.",examples:"push button, push boulder north, press switch, shove crate",summary:"PUSH/PRESS - Push objects, press buttons, or move heavy items. Example: PUSH BUTTON"}}});var iM=p(FO=>{"use strict";Object.defineProperty(FO,"__esModule",{value:!0});FO.pullingLanguage=void 0;FO.pullingLanguage={actionId:"if.action.pulling",patterns:["pull [something]","pull [something] [direction]","tug [something]","tug on [something]","drag [something]","drag [something] [direction]","yank [something]","draw [something]"],messages:{no_target:"Pull what?",not_visible:"{You} {can't} see {target}.",not_reachable:"{You} {can't} reach {target}.",too_heavy:"{target} is too heavy to pull (weighs {weight}kg).",wearing_it:"{You} {can't} pull {target} while wearing it.",wont_budge:"{target} won't budge.",lever_pulled:"{You} {pull} {target}.",lever_clicks:"{You} {pull} {target} with a satisfying click.",lever_toggled:"{You} {pull} {target}, switching it {newState}.",cord_pulled:"{You} {pull} {target}.",bell_rings:"{You} {pull} {target}. A bell rings somewhere!",cord_activates:"{You} {give} {target} a firm tug.",comes_loose:"{You} {pull} {target} and it comes loose!",firmly_attached:"{You} {pull} {target}, but it's firmly attached.",tugging_useless:"Tugging on {target} accomplishes nothing.",pulled_direction:"{You} {pull} {target} {direction}.",pulled_nudged:"{You} {tug} at {target}, moving it slightly.",pulled_with_effort:"With effort, {you} {drag} {target} {direction}.",pulling_does_nothing:"Pulling {target} has no effect.",fixed_in_place:"{target} is fixed in place."},help:{description:"Pull objects, levers, cords, or drag heavy items.",examples:"pull lever, pull cord, drag chest south, tug rope, yank chain",summary:"PULL/DRAG - Pull objects, levers, cords, or drag heavy items. Example: PULL LEVER"}}});var oM=p(GO=>{"use strict";Object.defineProperty(GO,"__esModule",{value:!0});GO.turningLanguage=void 0;GO.turningLanguage={actionId:"if.action.turning",patterns:["turn [something]","turn [something] [direction]","turn [something] to [setting]","rotate [something]","rotate [something] [direction]","twist [something]","twist [something] [direction]","spin [something]","dial [something]","dial [something] to [setting]","crank [something]"],messages:{no_target:"Turn what?",not_visible:"{You} {can't} see {target}.",not_reachable:"{You} {can't} reach {target}.",wearing_it:"{You} {can't} turn {target} while wearing it.",cant_turn_that:"{target} isn't something {you} can turn.",dial_turned:"{You} {turn} {target}.",dial_set:"{You} {turn} {target} to {setting}.",dial_adjusted:"{You} {adjust} {target} {direction}.",knob_turned:"{You} {turn} {target}.",knob_clicks:"{You} {turn} {target} with a click.",knob_toggled:"{You} {turn} {target}, switching it {newState}.",wheel_turned:"{You} {turn} {target}.",crank_turned:"{You} {crank} {target}.",mechanism_grinds:"{You} {turn} {target}. Gears grind and machinery moves.",requires_more_turns:"{You} {turn} {target}. It seems to need more turning.",mechanism_activated:"As {you} {turn} {target}, {you} {hear} machinery activate!",valve_opened:"{You} {turn} {target}, opening the valve.",valve_closed:"{You} {turn} {target}, closing the valve.",flow_changes:"{You} {turn} {target}, adjusting the flow.",key_needs_lock:"{You} {need} to put {target} in a lock first.",key_turned:"{You} {turn} {target} in the lock.",turned:"{You} {turn} {target}.",rotated:"{You} {rotate} {target}.",spun:"{You} {spin} {target}.",nothing_happens:"{You} {turn} {target}, but nothing happens."},help:{description:"Turn dials, knobs, wheels, cranks, or keys to operate mechanisms.",examples:"turn dial to 11, rotate wheel clockwise, twist knob left, crank handle",summary:"TURN/ROTATE - Turn dials, knobs, wheels, cranks, or keys to operate mechanisms. Example: TURN DIAL TO 5"}}});var aM=p(VO=>{"use strict";Object.defineProperty(VO,"__esModule",{value:!0});VO.loweringLanguage=void 0;VO.loweringLanguage={actionId:"if.action.lowering",patterns:["lower [something]"],messages:{"if.lower.no_target":"Lower what?","if.lower.cant_lower_that":"{You} {can't} lower {target}.","if.lower.already_down":"That's already lowered.","if.lower.lowered":"{You} {lower} {target}."},help:{description:"Lower something that can be lowered.",examples:"lower basket, lower drawbridge, lower blinds",summary:"LOWER - Lower objects like baskets, drawbridges, or blinds. Example: LOWER BASKET"}}});var sM=p(YO=>{"use strict";Object.defineProperty(YO,"__esModule",{value:!0});YO.raisingLanguage=void 0;YO.raisingLanguage={actionId:"if.action.raising",patterns:["raise [something]","lift [something]"],messages:{"if.raise.no_target":"Raise what?","if.raise.cant_raise_that":"{You} {can't} raise {target}.","if.raise.already_up":"That's already raised.","if.raise.raised":"{You} {raise} {target}."},help:{description:"Raise or lift something.",examples:"raise basket, raise drawbridge, lift blinds",summary:"RAISE/LIFT - Raise or lift objects like baskets or drawbridges. Example: RAISE BASKET"}}});var cM=p(zO=>{"use strict";Object.defineProperty(zO,"__esModule",{value:!0});zO.givingLanguage=void 0;zO.givingLanguage={actionId:"if.action.giving",patterns:["give [something] to [someone]","give [someone] [something]","offer [something] to [someone]","offer [someone] [something]","hand [something] to [someone]","hand [someone] [something]","present [something] to [someone]","present [someone] [something]"],messages:{no_item:"Give what?",no_recipient:"Give it to whom?",not_holding:"{You} aren't holding {item}.",recipient_not_visible:"{You} {can't} see {recipient}.",recipient_not_reachable:"{recipient} is too far away.",not_actor:"{You} can only give things to people.",self:"{You} already {have} {item}!",inventory_full:`{recipient} says, "I can't carry any more."`,too_heavy:`{recipient} says, "That's too heavy for me."`,not_interested:"{recipient} doesn't seem interested in {item}.",refuses:"{recipient} politely declines.",given:"{You} {give} {item} to {recipient}.",accepts:"{recipient} accepts {item}.",gratefully_accepts:"{recipient} gratefully accepts {item}.",reluctantly_accepts:"{recipient} reluctantly takes {item}."},help:{description:"Give objects to other characters.",examples:"give sword to knight, give Bob the key, offer flower to princess",summary:"GIVE TO - Give objects to other characters. Example: GIVE FLOWER TO ALICE"}}});var lM=p($O=>{"use strict";Object.defineProperty($O,"__esModule",{value:!0});$O.showingLanguage=void 0;$O.showingLanguage={actionId:"if.action.showing",patterns:["show [something] to [someone]","show [someone] [something]","display [something] to [someone]","reveal [something] to [someone]","present [something] to [someone]"],messages:{no_item:"Show what?",no_viewer:"Show it to whom?",not_carrying:"{You} aren't carrying {item}.",viewer_not_visible:"{You} {can't} see {viewer}.",viewer_too_far:"{viewer} is too far away to see clearly.",not_actor:"{You} can only show things to people.",self:"{You} {examine} {item} closely.",shown:"{You} {show} {item} to {viewer}.",viewer_examines:"{viewer} examines {item} carefully.",viewer_nods:"{viewer} nods.",viewer_impressed:"{viewer} looks impressed.",viewer_unimpressed:"{viewer} seems unimpressed.",viewer_recognizes:"{viewer} recognizes {item}!",wearing_shown:"{You} {show} {viewer} that {you're} wearing {item}."},help:{description:"Show objects to other characters without giving them away.",examples:"show badge to guard, show merchant the gem, display painting to curator",summary:"SHOW TO - Show objects to other characters. Example: SHOW BADGE TO GUARD"}}});var uM=p(KO=>{"use strict";Object.defineProperty(KO,"__esModule",{value:!0});KO.talkingLanguage=void 0;KO.talkingLanguage={actionId:"if.action.talking",patterns:["talk to [someone]","talk [someone]","speak to [someone]","speak with [someone]","greet [someone]","say hello to [someone]","chat with [someone]"],messages:{no_target:"Talk to whom?",not_visible:"{You} {can't} see {target}.",too_far:"{target} is too far away for conversation.",not_actor:"{You} can only talk to people.",self:"Talking to {yourself} is a sign of madness.",not_available:"{target} doesn't want to talk right now.",talked:"{You} {greet} {target}.",no_response:"{target} doesn't respond.",acknowledges:"{target} acknowledges {you}.",first_meeting:"{You} {introduce} {yourself} to {target}.",greets_back:'{target} says, "Hello there!"',formal_greeting:'{target} says, "Good day to you."',casual_greeting:'{target} says, "Hey!"',greets_again:'{target} says, "Hello again."',remembers_you:`{target} says, "Ah, it's you again."`,friendly_greeting:"{target} smiles in recognition.",has_topics:"{target} seems willing to discuss various topics.",nothing_to_say:"{target} has nothing particular to say."},help:{description:"Start a conversation with another character.",examples:"talk to guard, greet merchant, speak with wizard, chat with innkeeper",summary:"TALK TO - Start a conversation with another character. Example: TALK TO MERCHANT"}}});var dM=p(QO=>{"use strict";Object.defineProperty(QO,"__esModule",{value:!0});QO.askingLanguage=void 0;QO.askingLanguage={actionId:"if.action.asking",patterns:["ask [someone] about [topic]","ask [someone] for [topic]","question [someone] about [topic]","inquire [someone] about [topic]","query [someone] about [topic]"],messages:{no_target:"Ask whom?",no_topic:"Ask about what?",not_visible:"{You} {can't} see {target}.",too_far:"{target} is too far away.",not_actor:"{You} can only ask questions of people.",unknown_topic:`{target} says, "I don't know anything about that."`,shrugs:"{target} shrugs.",no_idea:`{target} says, "No idea what you're talking about."`,confused:"{target} looks confused.",responds:"{target} tells you about {topic}.",explains:"{target} explains about {topic}.",already_told:'{target} says, "I already told you about that."',remembers:'{target} says, "Ah yes, about {topic}..."',not_yet:`{target} says, "I can't tell you about that yet."`,must_do_first:`{target} says, "There's something you need to do first."`,earned_trust:`{target} says, "Since you've proven yourself, I'll tell you..."`},help:{description:"Ask characters about specific topics to gather information.",examples:"ask guard about castle, ask wizard about magic, question merchant about prices",summary:"ASK ABOUT - Ask characters about specific topics to gather information. Example: ASK GUARD ABOUT CASTLE"}}});var mM=p(XO=>{"use strict";Object.defineProperty(XO,"__esModule",{value:!0});XO.tellingLanguage=void 0;XO.tellingLanguage={actionId:"if.action.telling",patterns:["tell [someone] about [topic]","inform [someone] about [topic]","notify [someone] about [topic]","say [topic] to [someone]"],messages:{no_target:"Tell whom?",no_topic:"Tell them about what?",not_visible:"{You} {can't} see {target}.",too_far:"{target} is too far away.",not_actor:"{You} can only tell things to people.",told:"{You} {tell} {target} about {topic}.",informed:"{You} {inform} {target} about {topic}.",interested:"{target} listens with interest.",very_interested:'{target} says, "Really? Tell me more!"',grateful:'{target} says, "Thank you for telling me!"',already_knew:`{target} says, "Yes, I'm aware of that."`,not_interested:"{target} doesn't seem interested.",bored:"{target} looks bored.",dismissive:'{target} says, "So what?"',ignores:"{target} ignores what {you're} saying."},help:{description:"Tell characters about topics or give them information.",examples:"tell guard about thief, inform king about danger, notify wizard about discovery",summary:"TELL ABOUT - Tell characters about topics or give them information. Example: TELL ALICE ABOUT KEY"}}});var fM=p(ZO=>{"use strict";Object.defineProperty(ZO,"__esModule",{value:!0});ZO.answeringLanguage=void 0;ZO.answeringLanguage={actionId:"if.action.answering",patterns:["answer [response]","reply [response]","respond [response]","say yes","say no","yes","no"],messages:{no_question:"There's nothing to answer.",no_one_asked:"No one asked {you} anything.",too_late:"It's too late to answer that.",answered:'{You} {answer}, "{response}"',answered_yes:'{You} {say}, "Yes."',answered_no:'{You} {say}, "No."',gave_answer:"{You} {respond} to the question.",accepted:"{Your} answer is accepted.",rejected:"{Your} answer is not what they wanted to hear.",noted:"{Your} response is noted.",confused_by_answer:"{Your} answer seems to confuse them.",invalid_response:"That's not a valid answer to the question.",needs_yes_or_no:"Please answer yes or no.",unclear_answer:"{Your} answer isn't clear. Try again."},help:{description:"Answer questions that have been asked of you.",examples:'answer yes, say no, reply "the password is xyzzy", yes',summary:"ANSWER/SAY - Answer questions that have been asked of you. Example: SAY YES"}}});var pM=p(JO=>{"use strict";Object.defineProperty(JO,"__esModule",{value:!0});JO.throwingLanguage=void 0;JO.throwingLanguage={actionId:"if.action.throwing",patterns:["throw [something]","throw [something] at [target]","throw [something] to [target]","throw [something] [direction]","hurl [something]","hurl [something] at [target]","toss [something]","toss [something] to [target]","chuck [something]","fling [something]","lob [something]"],messages:{no_item:"Throw what?",not_holding:"{You} aren't holding {item}.",target_not_visible:"{You} {can't} see {target}.",target_not_here:"{target} isn't here.",no_exit:"There's no exit {direction}.",too_heavy:"{item} is too heavy to throw far (weighs {weight}kg).",self:"{You} {can't} throw things at {yourself}.",thrown:"{You} {throw} {item}.",thrown_down:"{You} {toss} {item} to the ground.",thrown_gently:"{You} gently {toss} {item}.",thrown_at:"{You} {throw} {item} at {target}.",hits_target:"{You} {throw} {item} at {target}. It hits!",misses_target:"{You} {throw} {item} at {target}, but miss.",bounces_off:"{item} bounces off {target}.",lands_on:"{item} lands on {target}.",lands_in:"{item} lands in {target}.",thrown_direction:"{You} {throw} {item} {direction}.",sails_through:"{item} sails through the exit to the {direction}.",breaks_on_impact:"{item} shatters on impact!",breaks_against:"{item} smashes against {target}!",fragile_breaks:"The fragile {item} breaks into pieces.",target_ducks:"{target} ducks out of the way.",target_catches:"{target} catches {item}!",target_angry:"{target} doesn't appreciate being hit with {item}."},help:{description:"Throw objects at targets, in directions, or just drop them forcefully.",examples:"throw ball at window, throw rock north, toss coin to beggar, hurl spear at target",summary:"THROW AT - Throw objects at targets, in directions, or just drop them forcefully. Example: THROW ROCK AT WINDOW"}}});var gM=p(eI=>{"use strict";Object.defineProperty(eI,"__esModule",{value:!0});eI.usingLanguage=void 0;eI.usingLanguage={actionId:"if.action.using",patterns:["use [something]","use [something] with [target]","use [something] on [target]","operate [something]","employ [something]","utilize [something]","apply [something] to [target]"],messages:{no_target:"Use what?",not_visible:"{You} {can't} see {item}.",not_reachable:"{You} {can't} reach {item}.",target_not_visible:"{You} {can't} see {target}.",target_not_reachable:"{You} {can't} reach {target}.",nothing_to_use_with:"{You} {need} to specify what to use {item} with.",cant_use_together:"{You} {can't} use {item} with {target}.",device_used:"{You} {use} {item}.",device_activated:"{You} {activate} {item}.",device_toggled:"{You} {toggle} {item} {newState}.",tool_used:"{You} {use} {item} on {target}.",tool_applied:"{You} {apply} {item} to {target}.",tool_modifies:"Using {item} modifies {target}.",tool_fixes:"{You} {fix} {target} with {item}.",tool_breaks:"{You} {break} {target} with {item}.",consumed:"{You} {use} {item}.",potion_drunk:"{You} {drink} {item}.",medicine_taken:"{You} {take} {item}.",food_eaten:"{You} {eat} {item}.",key_used:"{You} {use} {item} on {target}.",unlocks:"{You} {unlock} {target} with {item}.",already_unlocked:"{target} is already unlocked.",wrong_key:"{item} doesn't fit {target}.",opens_item:"{You} {open} {item}.",reads_item:"{You} {read} {item}.",generic_use:"{You} {use} {item}.",nothing_happens:"Nothing obvious happens.",not_useful_here:"That doesn't seem useful here."},help:{description:"Use objects in various ways, or use one object with another.",examples:"use lamp, use key on door, use hammer with nail, apply bandage to wound",summary:"USE/OPERATE - Use objects in various ways, or use one object with another. Example: USE KEY ON DOOR"}}});var hM=p(tI=>{"use strict";Object.defineProperty(tI,"__esModule",{value:!0});tI.eatingLanguage=void 0;tI.eatingLanguage={actionId:"if.action.eating",patterns:["eat [something]","consume [something]","devour [something]","munch [something]","munch on [something]","nibble [something]","nibble on [something]","taste [something]"],messages:{no_item:"Eat what?",not_visible:"{You} {can't} see {item}.",not_reachable:"{You} {can't} reach {item}.",not_edible:"That's not something {you} can eat.",is_drink:"{You} should drink {item}, not eat it.",already_consumed:"There's nothing left of {item} to eat.",eaten:"{You} {eat} {item}.",eaten_all:"{You} {eat} all of {item}.",eaten_some:"{You} {eat} some of {item}.",eaten_portion:"{You} {eat} a portion of {item}.",delicious:"{You} {eat} {item}. Delicious!",tasty:"{You} {eat} {item}. It's quite tasty.",bland:"{You} {eat} {item}. It's rather bland.",awful:"{You} {eat} {item}. It tastes awful!",filling:"{You} {eat} {item}. That was filling.",still_hungry:"{You} {eat} {item}, but {you're} still hungry.",satisfying:"{You} {eat} {item}. Very satisfying!",poisonous:"{You} {eat} {item}. It tastes strange...",nibbled:"{You} {nibble} on {item}.",tasted:"{You} {taste} {item}.",devoured:"{You} {devour} {item} hungrily.",munched:"{You} {munch} on {item}."},help:{description:"Eat edible items to satisfy hunger or gain effects.",examples:"eat apple, consume bread, nibble cheese, taste soup",summary:"EAT - Eat edible items to satisfy hunger or gain effects. Example: EAT APPLE"}}});var yM=p(rI=>{"use strict";Object.defineProperty(rI,"__esModule",{value:!0});rI.drinkingLanguage=void 0;rI.drinkingLanguage={actionId:"if.action.drinking",patterns:["drink [something]","drink from [something]","sip [something]","sip from [something]","quaff [something]","imbibe [something]","swallow [something]"],messages:{no_item:"Drink what?",not_visible:"{You} {can't} see {item}.",not_reachable:"{You} {can't} reach {item}.",not_drinkable:"That's not something {you} can drink.",already_consumed:"There's nothing left to drink.",container_closed:"{You} {need} to open {item} first.",drunk:"{You} {drink} {item}.",drunk_all:"{You} {drink} all of {item}.",drunk_some:"{You} {drink} some of {item}.",drunk_from:"{You} {drink} from {item}.",refreshing:"{You} {drink} {item}. How refreshing!",satisfying:"{You} {drink} {item}. That hits the spot.",bitter:"{You} {drink} {item}. It's quite bitter.",sweet:"{You} {drink} {item}. It's sweet.",strong:"{You} {drink} {item}. It's strong!",thirst_quenched:"{You} {drink} {item}. {Your} thirst is quenched.",still_thirsty:"{You} {drink} {item}, but {you're} still thirsty.",magical_effects:"{You} {drink} {item}. {You} {feel} strange...",healing:"{You} {drink} {item}. {You} {feel} better!",from_container:"{You} {drink} the {liquidType} from {item}.",empty_now:"{You} {drink} the last of the {liquidType}.",some_remains:"{You} {drink} some {liquidType}. Some remains.",sipped:"{You} {take} a sip of {item}.",quaffed:"{You} {quaff} {item} heartily.",gulped:"{You} {gulp} down {item}."},help:{description:"Drink liquids to quench thirst or gain effects.",examples:"drink water, sip wine, drink from fountain, quaff potion",summary:"DRINK - Drink liquids to quench thirst or gain effects. Example: DRINK WATER"}}});var vM=p(nI=>{"use strict";Object.defineProperty(nI,"__esModule",{value:!0});nI.attackingLanguage=void 0;nI.attackingLanguage={actionId:"if.action.attacking",patterns:["attack [something]","attack [something] with [weapon]","hit [something]","hit [something] with [weapon]","strike [something]","strike [something] with [weapon]","fight [something]","kill [something]","break [something]","destroy [something]","smash [something]"],messages:{no_target:"Attack what?",not_visible:"{You} {can't} see {target}.",not_reachable:"{You} {can't} reach {target}.",self:"Violence against {yourself} isn't the answer.",not_holding_weapon:"{You} aren't holding {weapon}.",indestructible:"{target} is far too solid to damage.",need_weapon_to_damage:"{target} requires a weapon to damage.",wrong_weapon_type:"{target} can't be damaged with that type of weapon.",attack_ineffective:"{Your} attack has no effect on {target}.","combat.cannot_attack":"{You} {can't} attack {targetName}.","combat.already_dead":"{targetName} is already dead.","combat.not_hostile":"{targetName} isn't hostile.","combat.no_target":"Attack what?","combat.target_unconscious":"{targetName} is already unconscious.","combat.need_weapon":"{You} {need} a weapon to attack effectively.","combat.attack.missed":"{You} {swing} at {targetName} but miss!","combat.attack.hit":"{You} {hit} {targetName} for {damage} damage.","combat.attack.hit_light":"{You} {graze} {targetName}, doing {damage} damage.","combat.attack.hit_heavy":"{You} {land} a solid blow on {targetName}, dealing {damage} damage!","combat.attack.knocked_out":"{targetName} collapses, unconscious!","combat.attack.killed":"{You} {have} slain {targetName}!","combat.defend.blocked":"{targetName} blocks {your} attack!","combat.defend.parried":"{targetName} parries {your} attack!","combat.defend.dodged":"{targetName} dodges out of the way!","combat.health.healthy":"{targetName} appears uninjured.","combat.health.wounded":"{targetName} has been wounded.","combat.health.badly_wounded":"{targetName} is badly wounded.","combat.health.near_death":"{targetName} is barely clinging to life!","combat.health.unconscious":"{targetName} lies unconscious.","combat.health.dead":"{targetName} is dead.","combat.special.sword_glows":"{Your} sword glows brightly!","combat.special.sword_stops_glowing":"{Your} sword's glow fades.","combat.special.blessed_weapon":"{Your} blessed weapon burns the undead!","combat.started":"Combat has begun!","combat.ended":"The battle is over.","combat.player_died":"{You} {have} been slain!","combat.player_resurrected":"{You} {feel} life return to {your} body.",attacked:"{You} {attack} {target}.",attacked_with:"{You} {attack} {target} with {weapon}.",hit_target:"{You} {hit} {target}.",hit_blindly:"{You} {swing} wildly, hitting nothing.",hit_with:"{You} {hit} {target} with {weapon}.",struck:"{You} {strike} {target}!",struck_with:"{You} {strike} {target} with {weapon}!",punched:"{You} {punch} {target}.",kicked:"{You} {kick} {target}.",unarmed_attack:"{You} {attack} {target} with {your} bare hands.",target_broke:"{target} breaks!",target_shattered:"{target} shatters into pieces!",broke:"{You} {break} {target}!",smashed:"{You} {smash} {target} to pieces!",target_destroyed:"{target} is utterly destroyed!",destroyed:"{You} {destroy} {target}!",shattered:"{target} shatters!",target_damaged:"{target} shows signs of damage. ({damage} damage dealt)",killed_target:"{You} {have} defeated {target}!",killed_blindly:"Something dies in the darkness.",items_spilled:"{target}'s possessions spill onto the ground.",passage_revealed:"A hidden passage is revealed!",debris_created:"Debris from {target} litters the area.",defends:"{target} defends against {your} attack.",dodges:"{target} dodges {your} attack.",retaliates:"{target} fights back!",flees:"{target} flees from {you}!",peaceful_solution:"Violence isn't necessary here.",no_fighting:"Fighting won't solve this problem.",unnecessary_violence:"That seems unnecessarily violent."},help:{description:"Attack creatures or attempt to break objects.",examples:"attack troll, hit goblin with sword, break window, smash vase",summary:"ATTACK/HIT/FIGHT - Attack creatures or attempt to break objects. Example: ATTACK TROLL"}}});var EM=p(iI=>{"use strict";Object.defineProperty(iI,"__esModule",{value:!0});iI.waitingLanguage=void 0;iI.waitingLanguage={actionId:"if.action.waiting",patterns:["wait","z"],messages:{waited:"Time passes.",waited_patiently:"{You} {wait} patiently.",time_passes:"Time passes...",nothing_happens:"{You} {wait}. Nothing happens.",waited_in_vehicle:"{You} {wait} in {vehicle}.",waited_for_event:"{You} {wait} for something to happen.",waited_anxiously:"{You} {wait} anxiously.",waited_briefly:"{You} {wait} for a moment.",something_approaches:"As {you} {wait}, {you} {hear} something approaching.",time_runs_out:"{You}'ve waited too long!",patience_rewarded:"{Your} patience is rewarded.",grows_restless:"{You} {grow} restless from waiting."},help:{description:"Wait for time to pass without doing anything.",examples:"wait, z",summary:"WAIT/Z - Wait for time to pass without doing anything. Example: Z"}}});var TM=p(oI=>{"use strict";Object.defineProperty(oI,"__esModule",{value:!0});oI.sleepingLanguage=void 0;oI.sleepingLanguage={actionId:"if.action.sleeping",patterns:["sleep","nap","doze","rest","slumber","z"],messages:{slept:"{You} {sleep} for a while.",dozed_off:"{You} {doze} off for a bit.",fell_asleep:"{You} {fall} into a deep sleep.",brief_nap:"{You} {take} a brief nap.",deep_sleep:"{You} {fall} into a deep, restful sleep.",slept_fitfully:"{You} {sleep} fitfully.",cant_sleep_here:"{You} {can't} sleep in {location}.",too_dangerous_to_sleep:"It's too dangerous to sleep in {location}.",already_well_rested:"{You're} already well-rested and don't feel tired.",woke_refreshed:"{You} {wake} feeling refreshed.",disturbed_sleep:"{Your} sleep is disturbed.",nightmares:"{You} {have} unsettling dreams.",peaceful_sleep:"{You} {enjoy} a peaceful sleep."},help:{description:"Sleep or take a nap to pass time.",examples:"sleep, nap, doze, rest",summary:"SLEEP/NAP - Sleep or take a nap to pass time. May have different effects depending on location and circumstances. Example: SLEEP"}}});var _M=p(Mm=>{"use strict";Object.defineProperty(Mm,"__esModule",{value:!0});Mm.scoringSystemMessages=Mm.scoringLanguage=void 0;Mm.scoringLanguage={actionId:"if.action.scoring",patterns:["score","points"],messages:{no_scoring:"This isn't that kind of game.",scoring_not_enabled:"There is no score in this game.",score_display:"{You} {have} scored {score} out of a possible {maxScore}, in {moves} turns.",score_simple:"{Your} score is {score} points.",score_with_rank:"{You} {have} scored {score} out of {maxScore}, earning {you} the rank of {rank}.",perfect_score:"{You} {have} achieved a perfect score of {maxScore} points!",rank_novice:"{You} {are} ranked as a Novice adventurer.",rank_amateur:"{You} {are} ranked as an Amateur adventurer.",rank_proficient:"{You} {are} ranked as a Proficient adventurer.",rank_expert:"{You} {are} ranked as an Expert adventurer.",rank_master:"{You} {are} ranked as a Master adventurer!",with_achievements:"{You} {have} earned the following achievements: {achievements}.",no_achievements:"{You} {have}n't earned any special achievements yet.",early_game:"{You're} just getting started!",mid_game:"{You're} making good progress.",late_game:"{You're} nearing the end of {your} adventure.",game_complete:"{You} {have} completed the game!"},help:{description:"Display your current score and game progress.",examples:"score, points",summary:"SCORE - Display your current score and game progress. Example: SCORE"}};Mm.scoringSystemMessages={"if.score.gained":"{Your} score just increased by {points} points.","if.score.lost":"{You} just lost {points} points!","if.score.display":"{You} {have} scored {score} out of {maxScore}, earning {you} the rank of {rank}.","if.score.no_scoring":"This isn't that kind of game.","if.rank.beginner":"Beginner","if.rank.novice":"Novice","if.rank.amateur":"Amateur","if.rank.experienced":"Experienced","if.rank.proficient":"Proficient","if.rank.expert":"Expert","if.rank.master":"Master","if.rank.winner":"Winner"}});var bM=p(aI=>{"use strict";Object.defineProperty(aI,"__esModule",{value:!0});aI.helpLanguage=void 0;aI.helpLanguage={actionId:"if.action.help",patterns:["help","help [topic]","?","commands","h"],messages:{general_help:`Welcome to Interactive Fiction!

Basic commands:
- LOOK (L): Examine your surroundings
- INVENTORY (I): List what you're carrying
- EXAMINE (X) [object]: Look at something closely
- TAKE/DROP [object]: Pick up or put down items
- GO [direction] or just [direction]: Move around

For more help on a specific topic, type HELP [topic].`,help_topic:"Help on {topic}:",unknown_topic:"No help available on '{topic}'. Type HELP for general help.",help_movement:`Movement commands:
- GO NORTH/SOUTH/EAST/WEST (or just N/S/E/W)
- UP/DOWN (U/D)
- IN/OUT
- ENTER [place]
- EXIT`,help_objects:`Object commands:
- TAKE/GET [object]
- DROP [object]
- EXAMINE/LOOK AT [object]
- OPEN/CLOSE [object]
- PUT [object] IN/ON [container]
- WEAR/REMOVE [clothing]`,help_special:`Special commands:
- SAVE/RESTORE: Save and load your game
- SCORE: Check your progress
- WAIT (Z): Let time pass
- AGAIN (G): Repeat last command
- QUIT: Exit the game`,first_time_help:`New to Interactive Fiction? Try these commands to get started:
- LOOK to see where you are
- INVENTORY to see what you're carrying
- EXAMINE interesting objects
- Go in compass directions (NORTH, SOUTH, etc.)`,hints_available:"Hints are available. Type HINTS to see them.",hints_disabled:"Hints are not available in this game.",stuck_help:`If you're stuck, try:
- LOOK around carefully
- EXAMINE everything
- Check your INVENTORY
- Try different verbs with objects`,help_footer:"For a complete list of commands, consult the game documentation."},help:{description:"Get help on game commands and topics.",examples:"help, ?, help movement, help take, commands",summary:"HELP - Get help on game commands and topics. Example: HELP MOVEMENT"}}});var OM=p(sI=>{"use strict";Object.defineProperty(sI,"__esModule",{value:!0});sI.aboutLanguage=void 0;sI.aboutLanguage={actionId:"if.action.about",patterns:["about","info","credits"],messages:{about_header:"About {title}",game_info:`{title}
Version {version}
By {author}
Released: {releaseDate}`,game_info_simple:"{title} by {author}",description:"Description: {description}",copyright:"Copyright {copyright}",license:"License: {license}",website:"Website: {website}",contact:"Contact: {contact}",credits_header:"Credits:",credits_list:"{credits}",special_thanks:"Special Thanks: {specialThanks}",dedication:"Dedication: {dedication}",acknowledgments:"Acknowledgments: {acknowledgments}",engine_info:"Powered by {engine} version {engineVersion}",technical_info:`Technical Information:
Engine: {engine} v{engineVersion}
Platform: Interactive Fiction`,play_stats:`Current Session:
Time played: {playTime}
Moves made: {sessionMoves}`,session_info:"You've been playing for {playTime} and made {sessionMoves} moves.",about_footer:"Thank you for playing!",enjoy_game:"We hope you enjoy playing {title}!",about_compact:"{title} v{version} by {author}"},help:{description:"Display information about the game, including credits and version.",examples:"about, info, credits",summary:"ABOUT/INFO - Display information about the game, including credits and version. Example: ABOUT"}}});var IM=p(cI=>{"use strict";Object.defineProperty(cI,"__esModule",{value:!0});cI.versionLanguage=void 0;cI.versionLanguage={actionId:"if.action.version",patterns:["version"],messages:{version_full:`{storyTitle} v{storyVersion}
Sharpee Engine v{engineVersion}
Built: {buildDate}`,version_no_date:`{storyTitle} v{storyVersion}
Sharpee Engine v{engineVersion}`,version_compact:"{storyTitle} v{storyVersion} (Sharpee v{engineVersion})"},help:{description:"Display version information about the game and engine.",examples:"version",summary:"VERSION - Display version information about the game and engine. Example: VERSION"}}});var SM=p(lI=>{"use strict";Object.defineProperty(lI,"__esModule",{value:!0});lI.savingLanguage=void 0;lI.savingLanguage={actionId:"if.action.saving",patterns:["save","save game","save [name]","save as [name]","store","store game"],messages:{game_saved:"Game saved.",game_saved_as:"Game saved as '{saveName}'.",save_successful:"{Your} game has been saved successfully.",save_slot:"Game saved to slot {saveName}.",overwrite_save:"Previous save '{saveName}' has been overwritten.",save_details:`Saved: {saveName}
Score: {score}
Moves: {moves}`,quick_save:"Quick save completed.",auto_save:"Auto-saving game...",save_failed:"Failed to save game.",no_save_slots:"No save slots available.",invalid_save_name:"'{saveName}' is not a valid save name.",save_not_allowed:"{You} cannot save the game at this time.",save_in_progress:"Another save is already in progress.",confirm_overwrite:"A save named '{saveName}' already exists. Overwrite it?",save_reminder:"Don't forget to save {your} game regularly!",saved_locally:"Game saved to local storage.",saved_to_cloud:"Game saved to cloud storage.",save_exported:"Save file exported successfully."},help:{description:"Save your current game progress.",examples:'save, save game, save mysave, save as "Chapter 2"',summary:"SAVE - Save your current game progress. Example: SAVE"}}});var AM=p(uI=>{"use strict";Object.defineProperty(uI,"__esModule",{value:!0});uI.restoringLanguage=void 0;uI.restoringLanguage={actionId:"if.action.restoring",patterns:["restore","restore [name]","load","load [name]","load game","restore game"],messages:{game_restored:"Game restored.",game_loaded:"Game loaded from '{saveName}'.",restore_successful:"{Your} saved game has been restored successfully.",welcome_back:"Welcome back! Game restored from {saveName}.",restore_details:`Restored: {saveName}
Score: {score}
Moves: {moves}`,quick_restore:"Quick restore completed.",resuming_game:"Resuming {your} adventure...",restore_failed:"Failed to restore game.",save_not_found:"No save named '{saveName}' was found.",no_saves:"No saved games found.",corrupt_save:"The save file '{saveName}' appears to be corrupted.",incompatible_save:"This save file is from a different version and cannot be loaded.",restore_not_allowed:"{You} cannot restore a game at this time.",confirm_restore:"Restore game from '{saveName}'? Current progress will be lost.",unsaved_progress:"{You} {have} unsaved progress. Restore anyway?",available_saves:"Available saves: {saves}",no_saves_available:"No saved games available.",choose_save:"Which save would {you} like to restore?",import_save:"Import a save file to restore.",save_imported:"Save file imported successfully."},help:{description:"Restore a previously saved game.",examples:'restore, load, restore mysave, load "Chapter 2"',summary:"RESTORE/LOAD - Restore a previously saved game. Example: RESTORE"}}});var RM=p(dI=>{"use strict";Object.defineProperty(dI,"__esModule",{value:!0});dI.quittingLanguage=void 0;dI.quittingLanguage={actionId:"if.action.quitting",patterns:["quit","exit","bye","goodbye","end","stop","quit game","end game"],messages:{quit_confirm_query:"Are {you} sure {you} want to quit?",quit_save_query:"Would {you} like to save before quitting?",quit_unsaved_query:"{You} {have} unsaved progress. What would {you} like to do?",quit_confirmed:`Thanks for playing!

Final score: {finalScore} out of {maxScore}
Moves: {moves}`,quit_cancelled:"Quit cancelled.",quit_and_saved:`Game saved.

Thanks for playing!

Final score: {finalScore} out of {maxScore}
Moves: {moves}`,final_score:"{Your} final score was {finalScore} out of {maxScore}.",final_stats:`Final Statistics:
Score: {finalScore}/{maxScore}
Moves: {moves}
Time played: {playTime}`,achievements_earned:"{You} earned {count} achievements during {your} play!"},queryOptions:{quit:"Quit",cancel:"Return to game",save_and_quit:"Save and quit",quit_without_saving:"Quit without saving"},help:{description:"Quit the game. You will be asked to confirm.",examples:"quit, exit, bye, goodbye",summary:"QUIT/EXIT - Quit the game with confirmation"}}});var wM=p(mI=>{"use strict";Object.defineProperty(mI,"__esModule",{value:!0});mI.undoingLanguage=void 0;mI.undoingLanguage={actionId:"if.action.undoing",patterns:["undo"],messages:{undo_success:"Previous turn undone.",undo_to_turn:"Undone. (Now at turn {turn})",undo_failed:"Undo failed.",nothing_to_undo:"Nothing to undo."},help:{description:"Undo the previous turn.",examples:"undo",summary:"UNDO - Undo the previous turn. Example: UNDO"}}});var CM=p(fI=>{"use strict";Object.defineProperty(fI,"__esModule",{value:!0});fI.againLanguage=void 0;fI.againLanguage={actionId:"if.action.again",patterns:["again","g"],messages:{nothing_to_repeat:"There is nothing to repeat."},help:{description:"Repeat the last command.",examples:"again, g",summary:"AGAIN (G) - Repeat the last command. Example: G"}}});var NM=p(X=>{"use strict";var Bue=X&&X.__createBinding||(Object.create?(function(t,e,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}):(function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]})),ie=X&&X.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&Bue(e,t,r)};Object.defineProperty(X,"__esModule",{value:!0});X.standardActionLanguage=void 0;ie(PL(),X);ie(LL(),X);ie(ML(),X);ie(kL(),X);ie(xL(),X);ie(BL(),X);ie(jL(),X);ie(WL(),X);ie(HL(),X);ie(UL(),X);ie(qL(),X);ie(FL(),X);ie(GL(),X);ie(VL(),X);ie(YL(),X);ie(zL(),X);ie($L(),X);ie(KL(),X);ie(QL(),X);ie(XL(),X);ie(ZL(),X);ie(JL(),X);ie(eM(),X);ie(tM(),X);ie(rM(),X);ie(nM(),X);ie(iM(),X);ie(oM(),X);ie(aM(),X);ie(sM(),X);ie(cM(),X);ie(lM(),X);ie(uM(),X);ie(dM(),X);ie(mM(),X);ie(fM(),X);ie(pM(),X);ie(gM(),X);ie(hM(),X);ie(yM(),X);ie(vM(),X);ie(EM(),X);ie(TM(),X);ie(_M(),X);ie(bM(),X);ie(OM(),X);ie(IM(),X);ie(SM(),X);ie(AM(),X);ie(RM(),X);ie(wM(),X);ie(CM(),X);var jue=PL(),Wue=LL(),Hue=ML(),Uue=kL(),que=xL(),Fue=BL(),Gue=jL(),Vue=WL(),Yue=HL(),zue=UL(),$ue=qL(),Kue=FL(),Que=GL(),Xue=VL(),Zue=YL(),Jue=zL(),ede=$L(),tde=KL(),rde=QL(),nde=XL(),ide=ZL(),ode=JL(),ade=eM(),sde=tM(),cde=rM(),lde=nM(),ude=iM(),dde=oM(),mde=aM(),fde=sM(),pde=cM(),gde=lM(),hde=uM(),yde=dM(),vde=mM(),Ede=fM(),Tde=pM(),_de=gM(),bde=hM(),Ode=yM(),Ide=vM(),Sde=EM(),Ade=TM(),Rde=_M(),wde=bM(),Cde=OM(),Nde=IM(),Dde=SM(),Pde=AM(),Lde=RM(),Mde=wM(),kde=CM();X.standardActionLanguage=[jue.takingLanguage,Wue.droppingLanguage,Hue.lookingLanguage,Uue.inventoryLanguage,que.examiningLanguage,Fue.goingLanguage,Gue.openingLanguage,Vue.closingLanguage,Yue.puttingLanguage,zue.insertingLanguage,$ue.removingLanguage,Kue.wearingLanguage,Que.takingOffLanguage,Xue.lockingLanguage,Zue.unlockingLanguage,Jue.enteringLanguage,ede.exitingLanguage,tde.climbingLanguage,rde.searchingLanguage,nde.listeningLanguage,ide.smellingLanguage,ode.touchingLanguage,ade.readingLanguage,sde.switchingOnLanguage,cde.switchingOffLanguage,lde.pushingLanguage,ude.pullingLanguage,dde.turningLanguage,mde.loweringLanguage,fde.raisingLanguage,pde.givingLanguage,gde.showingLanguage,hde.talkingLanguage,yde.askingLanguage,vde.tellingLanguage,Ede.answeringLanguage,Tde.throwingLanguage,_de.usingLanguage,bde.eatingLanguage,Ode.drinkingLanguage,Ide.attackingLanguage,Sde.waitingLanguage,Ade.sleepingLanguage,Rde.scoringLanguage,wde.helpLanguage,Cde.aboutLanguage,Nde.versionLanguage,Dde.savingLanguage,Pde.restoringLanguage,Lde.quittingLanguage,Mde.undoingLanguage,kde.againLanguage]});var VK=p(pI=>{"use strict";Object.defineProperty(pI,"__esModule",{value:!0});pI.npcLanguage=void 0;pI.npcLanguage={messages:{"npc.enters":"{npcName} enters from the {direction}.","npc.leaves":"{npcName} leaves to the {direction}.","npc.arrives":"{npcName} arrives.","npc.departs":"{npcName} departs.","npc.notices_player":"{npcName} notices you.","npc.ignores_player":"{npcName} ignores you.","npc.takes":"{npcName} picks up {itemName}.","npc.drops":"{npcName} drops {itemName}.","npc.follows":"{npcName} follows you.","npc.guard.blocks":"{npcName} blocks your way!","npc.guard.attacks":"{npcName} attacks you!","npc.guard.defeated":"{npcName} is no longer a threat.","npc.attacks":"{npcName} attacks you!","npc.misses":"{npcName} swings at you but misses!","npc.hits":"{npcName} hits you for {damage} damage!","npc.killed":"{npcName} has been slain.","npc.unconscious":"{npcName} collapses, unconscious.","npc.combat.attack.missed":"The troll swings his axe, but it misses.","npc.combat.attack.hit":"The axe gets you right in the side. Ouch!","npc.combat.attack.hit_light":"The flat of the troll's axe skins across your forearm.","npc.combat.attack.hit_heavy":"The troll hits you with a glancing blow, and you are momentarily stunned.","npc.combat.attack.knocked_out":"The flat of the troll's axe hits you delicately on the head, knocking you out.","npc.combat.attack.killed":"The troll lands a killing blow. You are dead.","npc.speaks":'{npcName} says, "{text}"',"npc.shouts":'{npcName} shouts, "{text}"',"npc.whispers":'{npcName} whispers, "{text}"',"npc.mutters":'{npcName} mutters, "{text}"',"npc.laughs":"{npcName} laughs.","npc.growls":"{npcName} growls menacingly.","npc.cries":"{npcName} cries.","npc.sighs":"{npcName} sighs.","npc.greets":"{npcName} greets you.","npc.farewell":"{npcName} bids you farewell.","npc.no_response":"{npcName} doesn't respond.","npc.confused":"{npcName} looks confused."}}});var DM=p(Du=>{"use strict";var xde=Du&&Du.__createBinding||(Object.create?(function(t,e,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}):(function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]})),Bde=Du&&Du.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&xde(e,t,r)};Object.defineProperty(Du,"__esModule",{value:!0});Bde(VK(),Du)});var ZK=p(Fr=>{"use strict";Object.defineProperty(Fr,"__esModule",{value:!0});Fr.DEFAULT_NARRATIVE_CONTEXT=Fr.PRONOUNS=void 0;Fr.conjugateVerb=XK;Fr.resolvePerspectivePlaceholders=Wde;Fr.PRONOUNS={HE_HIM:{subject:"he",object:"him",possessive:"his",possessiveAdj:"his",reflexive:"himself",verbForm:"singular"},SHE_HER:{subject:"she",object:"her",possessive:"hers",possessiveAdj:"her",reflexive:"herself",verbForm:"singular"},THEY_THEM:{subject:"they",object:"them",possessive:"theirs",possessiveAdj:"their",reflexive:"themselves",verbForm:"plural"}};Fr.DEFAULT_NARRATIVE_CONTEXT={perspective:"2nd"};var ug={be:["are","is","are"],have:["have","has","have"],do:["do","does","do"],go:["go","goes","go"],can:["can","can","can"],"can't":["can't","can't","can't"],cannot:["cannot","cannot","cannot"],will:["will","will","will"],"won't":["won't","won't","won't"],would:["would","would","would"],"wouldn't":["wouldn't","wouldn't","wouldn't"],could:["could","could","could"],"couldn't":["couldn't","couldn't","couldn't"],should:["should","should","should"],"shouldn't":["shouldn't","shouldn't","shouldn't"],must:["must","must","must"],"mustn't":["mustn't","mustn't","mustn't"],may:["may","may","may"],might:["might","might","might"]};function YK(t){switch(t.perspective){case"1st":return"I";case"2nd":return"You";case"3rd":let e=t.playerPronouns||Fr.PRONOUNS.THEY_THEM;return e.subject.charAt(0).toUpperCase()+e.subject.slice(1)}}function zK(t){switch(t.perspective){case"1st":return"my";case"2nd":return"your";case"3rd":return(t.playerPronouns||Fr.PRONOUNS.THEY_THEM).possessiveAdj}}function $K(t){switch(t.perspective){case"1st":return"mine";case"2nd":return"yours";case"3rd":return(t.playerPronouns||Fr.PRONOUNS.THEY_THEM).possessive}}function KK(t){switch(t.perspective){case"1st":return"myself";case"2nd":return"yourself";case"3rd":return(t.playerPronouns||Fr.PRONOUNS.THEY_THEM).reflexive}}function QK(t){switch(t.perspective){case"1st":return"I'm";case"2nd":return"You're";case"3rd":let e=t.playerPronouns||Fr.PRONOUNS.THEY_THEM,r=e.subject.charAt(0).toUpperCase()+e.subject.slice(1);return e.verbForm==="plural"?`${r}'re`:`${r}'s`}}function XK(t,e){let r=t.toLowerCase();if(e.perspective==="1st"||e.perspective==="2nd")return ug[r]?ug[r][0]:t;let i=(e.playerPronouns||Fr.PRONOUNS.THEY_THEM).verbForm==="plural";return ug[r]?i?ug[r][2]:ug[r][1]:i?t:jde(t)}function jde(t){let e=t.toLowerCase();if(e.endsWith("s")||e.endsWith("sh")||e.endsWith("ch")||e.endsWith("x")||e.endsWith("z")||e.endsWith("o"))return t+"es";if(e.endsWith("y")&&e.length>1){let r=e[e.length-2];if(!["a","e","i","o","u"].includes(r))return t.slice(0,-1)+"ies"}return t+"s"}function Wde(t,e=Fr.DEFAULT_NARRATIVE_CONTEXT){t=t.replace(/\{You\}/g,YK(e)),t=t.replace(/\{you\}/g,YK(e).toLowerCase()),t=t.replace(/\{Your\}/g,gI(zK(e))),t=t.replace(/\{your\}/g,zK(e)),t=t.replace(/\{Yours\}/g,gI($K(e))),t=t.replace(/\{yours\}/g,$K(e)),t=t.replace(/\{Yourself\}/g,gI(KK(e))),t=t.replace(/\{yourself\}/g,KK(e)),t=t.replace(/\{You're\}/g,QK(e)),t=t.replace(/\{you're\}/g,QK(e).toLowerCase());let r=new Set(["item","target","container","direction","destination","surface","key","door","actor","recipient","object","room","count","score","turns","reason","message","the","a","an","text","description","name"]);return t=t.replace(/\{([a-z][a-z']*)\}/gi,(n,i)=>{let o=i.toLowerCase();if(r.has(o))return n;if([/^(take|get|drop|put|open|close|lock|unlock|give|show|wear|remove)$/i,/^(eat|drink|touch|smell|listen|look|examine|search|read|attack)$/i,/^(push|pull|turn|switch|climb|enter|exit|go|wait|sleep|wake)$/i,/^(lift|carry|hold|throw|catch|break|fix|use|try|need|want)$/i,/^(see|hear|feel|find|know|think|say|tell|ask|answer)$/i,/^(be|have|do|can|can't|will|won't|would|could|should|must|may|might)$/i,/^[a-z]+'t$/i,/^(respond|greet|introduce|swing|graze|land|punch|kick|smash|destroy|strike)$/i,/^(quaff|gulp|sip|nibble|taste|devour|munch|doze|fall|enjoy)$/i,/^(sniff|detect|discover|insert|adjust|lower|raise|tug|drag|press)$/i,/^(inform|grow|toss|poke|prod|pat|stroke|crank|rotate|spin)$/i,/^(toggle|apply|activate|greet|acknowledge)$/i].some(c=>c.test(o))){let c=XK(i,e);return i[0]===i[0].toUpperCase()?gI(c):c}return n}),t}function gI(t){return t&&t.charAt(0).toUpperCase()+t.slice(1)}});var PM=p(na=>{"use strict";Object.defineProperty(na,"__esModule",{value:!0});na.resolvePerspectivePlaceholders=na.conjugateVerb=na.DEFAULT_NARRATIVE_CONTEXT=na.PRONOUNS=void 0;var hI=ZK();Object.defineProperty(na,"PRONOUNS",{enumerable:!0,get:function(){return hI.PRONOUNS}});Object.defineProperty(na,"DEFAULT_NARRATIVE_CONTEXT",{enumerable:!0,get:function(){return hI.DEFAULT_NARRATIVE_CONTEXT}});Object.defineProperty(na,"conjugateVerb",{enumerable:!0,get:function(){return hI.conjugateVerb}});Object.defineProperty(na,"resolvePerspectivePlaceholders",{enumerable:!0,get:function(){return hI.resolvePerspectivePlaceholders}})});var MM=p(bn=>{"use strict";Object.defineProperty(bn,"__esModule",{value:!0});bn.yourFormatter=bn.someFormatter=bn.theFormatter=bn.aFormatter=void 0;function Hde(t){if(!t||t.length===0)return"a";let e=t.toLowerCase();if(e.startsWith("hour")||e.startsWith("honest")||e.startsWith("heir"))return"an";if(e.startsWith("uni")||e.startsWith("one"))return"a";let r=e[0];return["a","e","i","o","u"].includes(r)?"an":"a"}function Ude(t){return typeof t=="string"?t:t.name}function LM(t){return typeof t=="string"?{name:t}:t}var qde=(t,e)=>{if(Array.isArray(t))return t.map(o=>(0,bn.aFormatter)(o,e)).join(", ");let r=LM(t),n=r.name;switch(r.nounType??(r.properName?"proper":"common")){case"proper":return n;case"mass":return`some ${n}`;case"unique":return`the ${n}`;case"plural":return n;default:return r.article&&r.article!=="a"&&r.article!=="an"?`${r.article} ${n}`:`${Hde(n)} ${n}`}};bn.aFormatter=qde;var Fde=(t,e)=>{if(Array.isArray(t))return t.map(o=>(0,bn.theFormatter)(o,e)).join(", ");let r=LM(t),n=r.name;return(r.nounType??(r.properName?"proper":"common"))==="proper"?n:`the ${n}`};bn.theFormatter=Fde;var Gde=(t,e)=>{if(Array.isArray(t))return t.map(o=>(0,bn.someFormatter)(o,e)).join(", ");let r=LM(t),n=r.name;return(r.nounType??(r.properName?"proper":"common"))==="proper"?n:`some ${n}`};bn.someFormatter=Gde;var Vde=(t,e)=>Array.isArray(t)?t.map(n=>(0,bn.yourFormatter)(n,e)).join(", "):`your ${Ude(t)}`;bn.yourFormatter=Vde});var kM=p(ia=>{"use strict";Object.defineProperty(ia,"__esModule",{value:!0});ia.countFormatter=ia.commaListFormatter=ia.orListFormatter=ia.listFormatter=void 0;function JK(t){return typeof t=="string"?t:t.name}function yI(t){return Array.isArray(t)?t.map(e=>JK(e)):[JK(t)]}var Yde=(t,e)=>{let r=yI(t);if(r.length===0)return"";if(r.length===1)return r[0];if(r.length===2)return`${r[0]} and ${r[1]}`;let n=r.slice(0,-1),i=r[r.length-1];return`${n.join(", ")}, and ${i}`};ia.listFormatter=Yde;var zde=(t,e)=>{let r=yI(t);if(r.length===0)return"";if(r.length===1)return r[0];if(r.length===2)return`${r[0]} or ${r[1]}`;let n=r.slice(0,-1),i=r[r.length-1];return`${n.join(", ")}, or ${i}`};ia.orListFormatter=zde;var $de=(t,e)=>yI(t).join(", ");ia.commaListFormatter=$de;var Kde=(t,e)=>{let r=yI(t),n=r.length;return n===0?"nothing":n===1?`1 ${r[0]}`:`${n} items`};ia.countFormatter=Kde});var xM=p(On=>{"use strict";Object.defineProperty(On,"__esModule",{value:!0});On.titleFormatter=On.lowerFormatter=On.upperFormatter=On.capFormatter=void 0;function vI(t){return typeof t=="string"?t:t.name}var Qde=(t,e)=>{if(Array.isArray(t))return t.map(n=>(0,On.capFormatter)(n,e)).join(", ");let r=vI(t);return r?r.charAt(0).toUpperCase()+r.slice(1):""};On.capFormatter=Qde;var Xde=(t,e)=>Array.isArray(t)?t.map(n=>(0,On.upperFormatter)(n,e)).join(", "):vI(t).toUpperCase();On.upperFormatter=Xde;var Zde=(t,e)=>Array.isArray(t)?t.map(n=>(0,On.lowerFormatter)(n,e)).join(", "):vI(t).toLowerCase();On.lowerFormatter=Zde;var Jde=(t,e)=>{if(Array.isArray(t))return t.map(n=>(0,On.titleFormatter)(n,e)).join(", ");let r=vI(t);return r?r.split(" ").map(n=>n.charAt(0).toUpperCase()+n.slice(1).toLowerCase()).join(" "):""};On.titleFormatter=Jde});var r5=p(km=>{"use strict";Object.defineProperty(km,"__esModule",{value:!0});km.createFormatterRegistry=eme;km.parsePlaceholder=e5;km.applyFormatters=t5;km.formatMessage=tme;var dg=MM(),EI=kM(),TI=xM();function eme(){let t=new Map;return t.set("a",dg.aFormatter),t.set("an",dg.aFormatter),t.set("the",dg.theFormatter),t.set("some",dg.someFormatter),t.set("your",dg.yourFormatter),t.set("list",EI.listFormatter),t.set("or-list",EI.orListFormatter),t.set("comma-list",EI.commaListFormatter),t.set("count",EI.countFormatter),t.set("cap",TI.capFormatter),t.set("upper",TI.upperFormatter),t.set("lower",TI.lowerFormatter),t.set("title",TI.titleFormatter),t}function e5(t){let e=t.split(":");if(e.length===1)return{formatters:[],name:e[0]};let r=e[e.length-1];return{formatters:e.slice(0,-1),name:r}}function t5(t,e,r,n){let i=typeof t=="number"||typeof t=="boolean"?String(t):t;for(let o of e){let a=r.get(o);a&&(i=a(i,n))}return Array.isArray(i)?i.map(o=>typeof o=="string"?o:o.name).join(", "):typeof i=="string"?i:i.name}function tme(t,e,r,n={}){return t.replace(/\{([^}]+)\}/g,(i,o)=>{let{formatters:a,name:s}=e5(o),c=e[s];return c===void 0?i:a.length>0?t5(c,a,r,n):Array.isArray(c)?c.map(l=>typeof l=="string"?l:l.name).join(", "):typeof c=="string"?c:typeof c=="number"||typeof c=="boolean"?String(c):c.name})}});var BM=p(Oe=>{"use strict";Object.defineProperty(Oe,"__esModule",{value:!0});Oe.titleFormatter=Oe.lowerFormatter=Oe.upperFormatter=Oe.capFormatter=Oe.countFormatter=Oe.commaListFormatter=Oe.orListFormatter=Oe.listFormatter=Oe.yourFormatter=Oe.someFormatter=Oe.theFormatter=Oe.aFormatter=Oe.formatMessage=Oe.applyFormatters=Oe.parsePlaceholder=Oe.createFormatterRegistry=void 0;var _I=r5();Object.defineProperty(Oe,"createFormatterRegistry",{enumerable:!0,get:function(){return _I.createFormatterRegistry}});Object.defineProperty(Oe,"parsePlaceholder",{enumerable:!0,get:function(){return _I.parsePlaceholder}});Object.defineProperty(Oe,"applyFormatters",{enumerable:!0,get:function(){return _I.applyFormatters}});Object.defineProperty(Oe,"formatMessage",{enumerable:!0,get:function(){return _I.formatMessage}});var bI=MM();Object.defineProperty(Oe,"aFormatter",{enumerable:!0,get:function(){return bI.aFormatter}});Object.defineProperty(Oe,"theFormatter",{enumerable:!0,get:function(){return bI.theFormatter}});Object.defineProperty(Oe,"someFormatter",{enumerable:!0,get:function(){return bI.someFormatter}});Object.defineProperty(Oe,"yourFormatter",{enumerable:!0,get:function(){return bI.yourFormatter}});var OI=kM();Object.defineProperty(Oe,"listFormatter",{enumerable:!0,get:function(){return OI.listFormatter}});Object.defineProperty(Oe,"orListFormatter",{enumerable:!0,get:function(){return OI.orListFormatter}});Object.defineProperty(Oe,"commaListFormatter",{enumerable:!0,get:function(){return OI.commaListFormatter}});Object.defineProperty(Oe,"countFormatter",{enumerable:!0,get:function(){return OI.countFormatter}});var II=xM();Object.defineProperty(Oe,"capFormatter",{enumerable:!0,get:function(){return II.capFormatter}});Object.defineProperty(Oe,"upperFormatter",{enumerable:!0,get:function(){return II.upperFormatter}});Object.defineProperty(Oe,"lowerFormatter",{enumerable:!0,get:function(){return II.lowerFormatter}});Object.defineProperty(Oe,"titleFormatter",{enumerable:!0,get:function(){return II.titleFormatter}})});var jM=p(mg=>{"use strict";Object.defineProperty(mg,"__esModule",{value:!0});mg.EnglishLanguageProvider=void 0;var rme=GK(),Ri=DL(),SI=NM(),n5=DM(),i5=PM(),o5=BM(),AI=class{constructor(){d(this,"languageCode","en-US");d(this,"languageName","English (US)");d(this,"textDirection","ltr");d(this,"messages",new Map);d(this,"customActionPatterns",new Map);d(this,"narrativeContext",i5.DEFAULT_NARRATIVE_CONTEXT);d(this,"formatterRegistry");d(this,"entityLookup");this.formatterRegistry=(0,o5.createFormatterRegistry)(),this.loadCoreMessages(),this.loadActionMessages(),this.loadNpcMessages()}loadCoreMessages(){let e={"core.entity_not_found":"You can't see any such thing.","core.ambiguous_reference":"Which do you mean?","core.disambiguation_prompt":"Which do you mean: {options}?","core.command_not_understood":"I don't understand that command.","core.command_failed":"I don't understand that.","game.started.banner":`{title}
By {author}

Type HELP for instructions.`};for(let[r,n]of Object.entries(e))this.messages.set(r,n)}setNarrativeSettings(e){this.narrativeContext=e}getNarrativeContext(){return this.narrativeContext}loadActionMessages(){for(let e of SI.standardActionLanguage)e.messages&&Object.entries(e.messages).forEach(([r,n])=>{let i=`${e.actionId}.${r}`;this.messages.set(i,n)})}loadNpcMessages(){if(n5.npcLanguage.messages)for(let[e,r]of Object.entries(n5.npcLanguage.messages))this.messages.set(e,r)}getMessage(e,r){let n=this.messages.get(e);if(!n)return e;if(n=(0,i5.resolvePerspectivePlaceholders)(n,this.narrativeContext),r){let i={getEntity:this.entityLookup};n=(0,o5.formatMessage)(n,r,this.formatterRegistry,i)}return n}setEntityLookup(e){this.entityLookup=e}registerFormatter(e,r){this.formatterRegistry.set(e,r)}getFormatterRegistry(){return this.formatterRegistry}hasMessage(e){return this.messages.has(e)}getActionPatterns(e){let r=this.customActionPatterns.get(e),i=SI.standardActionLanguage.find(o=>o.actionId===e)?.patterns;return r&&i?[...i,...r]:r||i}getActionHelp(e){let r=SI.standardActionLanguage.find(o=>o.actionId===e);if(!r)return;let n=[];r.patterns&&r.patterns.forEach(o=>{let a=o.match(/^(\w+)/);if(a){let s=a[1].toUpperCase();n.includes(s)||n.push(s)}});let i=[];return r.help?.examples&&(i=r.help.examples.split(",").map(o=>o.trim())),{description:r.help?.description||"No description available.",verbs:n,examples:i,summary:r.help?.summary}}getSupportedActions(){return SI.standardActionLanguage.map(e=>e.actionId)}getEntityName(e){if(!e)return"something";if(typeof e=="string")return e;if(e.name)return e.name;if(e.traits&&e.traits.get){let r=e.traits.get("IDENTITY");if(r&&r.name)return r.name}if(e.get&&typeof e.get=="function"){let r=e.get("IDENTITY");if(r&&r.name)return r.name}return e.id?e.id:"something"}getActionMessages(e){let r=new Map,n=`${e}.`;for(let[i,o]of this.messages)if(i.startsWith(n)){let a=i.substring(n.length);r.set(a,o)}return r.size>0?r:null}getVerbs(){return rme.englishVerbs.map(e=>({actionId:e.action,verbs:e.verbs,pattern:e.requiresObject?e.allowsIndirectObject?"VERB_OBJ_PREP_OBJ":"VERB_OBJ":"VERB_ONLY",prepositions:e.allowsIndirectObject?["in","on","to","with"]:void 0}))}getDirections(){return[{direction:"north",words:["north"],abbreviations:["n"]},{direction:"south",words:["south"],abbreviations:["s"]},{direction:"east",words:["east"],abbreviations:["e"]},{direction:"west",words:["west"],abbreviations:["w"]},{direction:"northeast",words:["northeast"],abbreviations:["ne"]},{direction:"northwest",words:["northwest"],abbreviations:["nw"]},{direction:"southeast",words:["southeast"],abbreviations:["se"]},{direction:"southwest",words:["southwest"],abbreviations:["sw"]},{direction:"up",words:["up","upward","upwards"],abbreviations:["u"]},{direction:"down",words:["down","downward","downwards"],abbreviations:["d"]},{direction:"in",words:["in","inside"]},{direction:"out",words:["out","outside"]}]}getSpecialVocabulary(){return{articles:Ri.englishWords.articles,pronouns:Ri.englishWords.pronouns,allWords:["all","everything","every"],exceptWords:["except","but"]}}getCommonAdjectives(){return Ri.englishWords.commonAdjectives}getCommonNouns(){return Ri.englishWords.commonNouns||[]}getPrepositions(){return Ri.englishWords.prepositions}getDeterminers(){return Ri.englishWords.determiners||[]}getConjunctions(){return Ri.englishWords.conjunctions||[]}getNumbers(){return Ri.englishWords.numberWords||[]}getGrammarPatterns(){return[{name:"verb_noun_prep_noun",pattern:"VERB NOUN+ PREP NOUN+",example:"put ball in box",priority:100},{name:"verb_prep_noun",pattern:"VERB PREP NOUN+",example:"look at painting",priority:90},{name:"verb_noun",pattern:"VERB NOUN+",example:"take ball",priority:80},{name:"verb_only",pattern:"VERB",example:"look",priority:70},{name:"direction_only",pattern:"DIRECTION",example:"north",priority:60}]}lemmatize(e){if(!e)return"";let r=e.toLowerCase(),n=Ri.irregularPlurals.get(r);return n||(r==="yes"||r==="ties"?r:r.endsWith("ies")&&r.length>4?r.slice(0,-3)+"y":r.endsWith("es")&&r.length>3?r==="yes"?r:r.slice(0,-2):r.endsWith("s")&&!r.endsWith("ss")&&r.length>2?r.slice(0,-1):r.endsWith("ed")&&r.length>3?r.length>4&&r[r.length-3]===r[r.length-4]?r.slice(0,-3):r.slice(0,-2):r.endsWith("ing")&&r.length>4&&!r.includes("-")?r.slice(0,-3):r)}expandAbbreviation(e){return Ri.abbreviations.get(e.toLowerCase())||null}formatList(e,r="and"){if(e.length===0)return"";if(e.length===1)return e[0];if(e.length===2)return`${e[0]} ${r} ${e[1]}`;let n=e.slice(0,-1),i=e[e.length-1];return`${n.join(", ")}, ${r} ${i}`}getIndefiniteArticle(e){if(!e||e.length===0)return"a";let r=e[0].toLowerCase(),n=["a","e","i","o","u"];return e.toLowerCase().startsWith("hour")||e.toLowerCase().startsWith("honest")?"an":e.toLowerCase().startsWith("uni")||e.toLowerCase().startsWith("one")?"a":n.includes(r)?"an":"a"}pluralize(e){if(!e)return"s";let r=e.toLowerCase();for(let[n,i]of Ri.irregularPlurals)if(i===r)return e===e.toUpperCase()?n.toUpperCase():e[0]===e[0].toUpperCase()?n[0].toUpperCase()+n.slice(1):n;return r.endsWith("s")||r.endsWith("x")||r.endsWith("z")||r.endsWith("ch")||r.endsWith("sh")?e+"es":r.endsWith("y")&&!["a","e","i","o","u"].includes(r[r.length-2])?e===e.toUpperCase()?e.slice(0,-1)+"IES":e.slice(0,-1)+"ies":r.endsWith("f")?e.slice(0,-1)+"ves":r.endsWith("fe")?e.slice(0,-2)+"ves":e+"s"}isIgnoreWord(e){return Ri.englishWords.ignoreWords.includes(e.toLowerCase())}addMessage(e,r){this.messages.set(e,r)}addActionHelp(e,r){r.summary&&this.messages.set(`${e}.help.summary`,r.summary),r.description&&this.messages.set(`${e}.help.description`,r.description),r.examples&&r.examples.forEach((n,i)=>{this.messages.set(`${e}.help.example.${i}`,n)})}addActionPatterns(e,r){let i=[...this.customActionPatterns.get(e)||[]];for(let o of r)i.includes(o)||i.push(o);this.customActionPatterns.set(e,i)}};mg.EnglishLanguageProvider=AI;mg.default=new AI});var a5=p(Jn=>{"use strict";var nme=Jn&&Jn.__createBinding||(Object.create?(function(t,e,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}):(function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]})),ime=Jn&&Jn.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&nme(e,t,r)};Object.defineProperty(Jn,"__esModule",{value:!0});Jn.EnglishGrammarUtils=Jn.EnglishGrammarPatterns=Jn.EnglishPartsOfSpeech=void 0;Jn.EnglishPartsOfSpeech=Object.freeze({VERB:"verb",NOUN:"noun",ADJECTIVE:"adjective",ARTICLE:"article",PREPOSITION:"preposition",PRONOUN:"pronoun",DETERMINER:"determiner",CONJUNCTION:"conjunction",INTERJECTION:"interjection",DIRECTION:"direction",ADVERB:"adverb",AUXILIARY:"auxiliary"});Jn.EnglishGrammarPatterns={VERB_ONLY:{name:"verb_only",elements:["VERB"],example:"look",description:"Simple intransitive verb"},VERB_NOUN:{name:"verb_noun",elements:["VERB","NOUN_PHRASE"],example:"take ball",description:"Transitive verb with direct object"},VERB_NOUN_PREP_NOUN:{name:"verb_noun_prep_noun",elements:["VERB","NOUN_PHRASE","PREP","NOUN_PHRASE"],example:"put ball in box",description:"Ditransitive verb with direct and indirect objects"},VERB_PREP_NOUN:{name:"verb_prep_noun",elements:["VERB","PREP","NOUN_PHRASE"],example:"look at painting",description:"Verb with prepositional phrase"},VERB_PARTICLE_NOUN:{name:"verb_particle_noun",elements:["VERB","PARTICLE","NOUN_PHRASE"],example:"pick up ball",description:"Phrasal verb with direct object"},VERB_NOUN_PARTICLE:{name:"verb_noun_particle",elements:["VERB","NOUN_PHRASE","PARTICLE"],example:"put ball down",description:"Phrasal verb with object before particle"},VERB_DIRECTION:{name:"verb_direction",elements:["VERB","DIRECTION"],example:"go north",description:"Movement verb with direction"},DIRECTION_ONLY:{name:"direction_only",elements:["DIRECTION"],example:"north",description:"Implicit movement command"}};Jn.EnglishGrammarUtils={isArticle(t){return["a","an","the"].includes(t.toLowerCase())},isDeterminer(t){return["all","every","some","any","no","each","this","that","these","those","my","your","his","her","its","our","their","much","many","few","little","several"].includes(t.toLowerCase())},isPronoun(t){return["i","me","you","he","him","she","her","it","we","us","they","them","myself","yourself","himself","herself","itself","ourselves","yourselves","themselves","this","that","these","those","who","whom","whose","which","what"].includes(t.toLowerCase())},isConjunction(t){return["and","or","but","nor","for","yet","so","although","because","since","unless","while","when","where","if"].includes(t.toLowerCase())},getIndefiniteArticle(t){if(!t||t.length===0)throw new Error("Cannot determine article for empty string");let e=t.toLowerCase(),r=e[0],n=["a","e","i","o","u"],i={8:"an",11:"an",18:"an",80:"an",800:"an",1:"a",2:"a",3:"a",4:"a",5:"a",6:"a",7:"a",9:"a",10:"a",12:"a",13:"a",14:"a",15:"a",16:"a",17:"a",19:"a"};return t in i?i[t]:["hour","honest","honor","heir"].some(s=>e.startsWith(s))?"an":["unit","university","unique","uniform"].some(s=>e.startsWith(s))?"a":n.includes(r)?"an":"a"}};ime(fg(),Jn)});var s5=p(q=>{"use strict";Object.defineProperty(q,"__esModule",{value:!0});q.parserErrors=q.systemMessages=q.failureMessages=q.ActionFailureReason=void 0;q.getParserErrorMessage=ome;q.ActionFailureReason={NOT_VISIBLE:"not_visible",NOT_REACHABLE:"not_reachable",NOT_IN_SCOPE:"not_in_scope",FIXED_IN_PLACE:"fixed_in_place",ALREADY_OPEN:"already_open",ALREADY_CLOSED:"already_closed",NOT_OPENABLE:"not_openable",LOCKED:"locked",NOT_LOCKABLE:"not_lockable",ALREADY_LOCKED:"already_locked",ALREADY_UNLOCKED:"already_unlocked",STILL_OPEN:"still_open",CONTAINER_FULL:"container_full",CONTAINER_CLOSED:"container_closed",NOT_A_CONTAINER:"not_a_container",NOT_A_SUPPORTER:"not_a_supporter",ALREADY_IN_CONTAINER:"already_in_container",NOT_IN_CONTAINER:"not_in_container",NOT_WEARABLE:"not_wearable",ALREADY_WEARING:"already_wearing",NOT_WEARING:"not_wearing",WORN_BY_OTHER:"worn_by_other",TOO_HEAVY:"too_heavy",CARRYING_TOO_MUCH:"carrying_too_much",WRONG_KEY:"wrong_key",NO_KEY_SPECIFIED:"no_key_specified",NOT_A_KEY:"not_a_key",NOT_HOLDING_KEY:"not_holding_key",ALREADY_ON:"already_on",ALREADY_OFF:"already_off",NOT_SWITCHABLE:"not_switchable",NO_POWER:"no_power",NO_EXIT_THAT_WAY:"no_exit_that_way",CANT_GO_THAT_WAY:"cant_go_that_way",DOOR_CLOSED:"door_closed",DOOR_LOCKED:"door_locked",TOO_DARK:"too_dark",CANT_TALK_TO_THAT:"cant_talk_to_that",NO_RESPONSE:"no_response",NOT_A_PERSON:"not_a_person",CANT_DO_THAT:"cant_do_that",NOT_IMPLEMENTED:"not_implemented",INVALID_TARGET:"invalid_target",AMBIGUOUS_TARGET:"ambiguous_target",NOTHING_HAPPENS:"nothing_happens",ACTOR_CANT_SEE:"actor_cant_see",ACTOR_CANT_REACH:"actor_cant_reach",ACTOR_BUSY:"actor_busy",NOT_EDIBLE:"not_edible",NOT_READABLE:"not_readable",NOTHING_WRITTEN:"nothing_written",WONT_ACCEPT:"wont_accept",CANT_GIVE_TO_SELF:"cant_give_to_self",CANT_USE_THAT:"cant_use_that",CANT_USE_TOGETHER:"cant_use_together",NOTHING_TO_USE_WITH:"nothing_to_use_with",CANT_PUSH_THAT:"cant_push_that",CANT_PULL_THAT:"cant_pull_that",CANT_TURN_THAT:"cant_turn_that",WONT_BUDGE:"wont_budge",WEARING_IT:"wearing_it",NO_TARGET:"no_target"};q.failureMessages={[q.ActionFailureReason.NOT_VISIBLE]:"You can't see any such thing.",[q.ActionFailureReason.NOT_REACHABLE]:"You can't reach that from here.",[q.ActionFailureReason.NOT_IN_SCOPE]:"That's not available right now.",[q.ActionFailureReason.FIXED_IN_PLACE]:"That's fixed in place.",[q.ActionFailureReason.ALREADY_OPEN]:"That's already open.",[q.ActionFailureReason.ALREADY_CLOSED]:"That's already closed.",[q.ActionFailureReason.NOT_OPENABLE]:"That's not something you can open.",[q.ActionFailureReason.LOCKED]:"It seems to be locked.",[q.ActionFailureReason.NOT_LOCKABLE]:"That doesn't have a lock.",[q.ActionFailureReason.ALREADY_LOCKED]:"It's already locked.",[q.ActionFailureReason.ALREADY_UNLOCKED]:"It's already unlocked.",[q.ActionFailureReason.STILL_OPEN]:"You can't do that while it's open.",[q.ActionFailureReason.CONTAINER_FULL]:"There's no more room inside.",[q.ActionFailureReason.CONTAINER_CLOSED]:"You'll need to open it first.",[q.ActionFailureReason.NOT_A_CONTAINER]:"That can't contain things.",[q.ActionFailureReason.NOT_A_SUPPORTER]:"You can't put things on top of that.",[q.ActionFailureReason.ALREADY_IN_CONTAINER]:"It's already there.",[q.ActionFailureReason.NOT_IN_CONTAINER]:"It's not in there.",[q.ActionFailureReason.NOT_WEARABLE]:"You can't wear that.",[q.ActionFailureReason.ALREADY_WEARING]:"You're already wearing that.",[q.ActionFailureReason.NOT_WEARING]:"You're not wearing that.",[q.ActionFailureReason.WORN_BY_OTHER]:"Someone else is wearing that.",[q.ActionFailureReason.TOO_HEAVY]:"That's too heavy to carry.",[q.ActionFailureReason.CARRYING_TOO_MUCH]:"You're carrying too much already.",[q.ActionFailureReason.WRONG_KEY]:"That doesn't seem to be the right key.",[q.ActionFailureReason.NO_KEY_SPECIFIED]:"You'll need to specify what to unlock it with.",[q.ActionFailureReason.NOT_A_KEY]:"That doesn't look like it would unlock anything.",[q.ActionFailureReason.NOT_HOLDING_KEY]:"You need to be holding the key.",[q.ActionFailureReason.ALREADY_ON]:"It's already on.",[q.ActionFailureReason.ALREADY_OFF]:"It's already off.",[q.ActionFailureReason.NOT_SWITCHABLE]:"That's not something you can switch.",[q.ActionFailureReason.NO_POWER]:"It doesn't seem to have any power.",[q.ActionFailureReason.NO_EXIT_THAT_WAY]:"You can't go that way.",[q.ActionFailureReason.CANT_GO_THAT_WAY]:"You can't go that way.",[q.ActionFailureReason.DOOR_CLOSED]:"The door is closed.",[q.ActionFailureReason.DOOR_LOCKED]:"The door is locked.",[q.ActionFailureReason.TOO_DARK]:"It's too dark to see where you're going.",[q.ActionFailureReason.CANT_TALK_TO_THAT]:"You can only talk to people.",[q.ActionFailureReason.NO_RESPONSE]:"There is no response.",[q.ActionFailureReason.NOT_A_PERSON]:"You can only do that to a person.",[q.ActionFailureReason.CANT_DO_THAT]:"You can't do that.",[q.ActionFailureReason.NOT_IMPLEMENTED]:"That action isn't available.",[q.ActionFailureReason.INVALID_TARGET]:"That's not a valid target.",[q.ActionFailureReason.AMBIGUOUS_TARGET]:"You'll need to be more specific.",[q.ActionFailureReason.NOTHING_HAPPENS]:"Nothing happens.",[q.ActionFailureReason.ACTOR_CANT_SEE]:"You can't see in the dark.",[q.ActionFailureReason.ACTOR_CANT_REACH]:"You can't reach that from your current position.",[q.ActionFailureReason.ACTOR_BUSY]:"You're too busy to do that right now.",[q.ActionFailureReason.NOT_EDIBLE]:"That's not something you can eat.",[q.ActionFailureReason.NOT_READABLE]:"There's nothing written on that.",[q.ActionFailureReason.NOTHING_WRITTEN]:"You see nothing special written there.",[q.ActionFailureReason.WONT_ACCEPT]:"They don't seem interested.",[q.ActionFailureReason.CANT_GIVE_TO_SELF]:"You can't give something to yourself.",[q.ActionFailureReason.CANT_USE_THAT]:"You can't use that.",[q.ActionFailureReason.CANT_USE_TOGETHER]:"You can't use those things together.",[q.ActionFailureReason.NOTHING_TO_USE_WITH]:"You need to specify what to use it with.",[q.ActionFailureReason.CANT_PUSH_THAT]:"You can't push that.",[q.ActionFailureReason.CANT_PULL_THAT]:"You can't pull that.",[q.ActionFailureReason.CANT_TURN_THAT]:"You can't turn that.",[q.ActionFailureReason.WONT_BUDGE]:"It won't budge.",[q.ActionFailureReason.WEARING_IT]:"You can't do that while wearing it.",[q.ActionFailureReason.NO_TARGET]:"What do you want to push?"};q.systemMessages={inventoryEmpty:"You are carrying nothing.",inventoryHeader:"You are carrying:",inventoryWearing:" (being worn)",locationDescription:"You are in {location}.",canSee:"You can see {items} here.",canAlsoSee:"You can also see {items} here.",nothingSpecial:"You see nothing special.",insideContainer:"In the {container}:",onSupporter:"On the {supporter}:",savePrompt:"Enter save game name:",saveSuccess:"Game saved.",saveFailed:"Failed to save game.",restorePrompt:"Enter save game name:",restoreSuccess:"Game restored.",restoreFailed:"Failed to restore game.",saving_game:"Saving game...",game_saved:"Game saved successfully.",save_failed:"Save failed: {error}",restoring_game:"Restoring game...",game_restored:"Game restored successfully.",restore_failed:"Restore failed: {error}",quitting_game:"Quitting game...",quit_confirmed:"Thanks for playing!",quit_cancelled:"Quit cancelled.",restarting_game:"Restarting game...",game_restarted:"Game restarted.",restart_cancelled:"Restart cancelled.",quitConfirm:"Are you sure you want to quit? (yes/no)",scoreDisplay:"Your score is {score} out of {maxScore}.",turnsDisplay:"You have taken {turns} turn(s).",unknownVerb:"I don't understand that verb.",unknownObject:"I don't know what '{object}' refers to.",ambiguousObject:"Which do you mean: {options}?",missingObject:"What do you want to {verb}?",missingIndirectObject:"What do you want to {verb} it {preposition}?",ok:"Okay.",done:"Done.",taken:"Taken.",dropped:"Dropped."};q.parserErrors={"parser.error.noInput":"I beg your pardon?","parser.error.unknownVerb":t=>t.verb?`I don't know the word "${t.verb}".`:"I don't understand that sentence.","parser.error.missingObject":t=>t.verb?`What do you want to ${t.verb}?`:"What do you want to do that to?","parser.error.missingIndirect":t=>t.verb&&t.slot?["container","location","destination"].includes(t.slot)?`Where do you want to ${t.verb} it?`:`What do you want to ${t.verb} it ${t.slot}?`:"I need more information to understand that.","parser.error.entityNotFound":t=>t.noun?`You can't see any "${t.noun}" here.`:"You can't see any such thing.","parser.error.scopeViolation":t=>t.noun?`You can't reach the ${t.noun}.`:"You can't reach that.","parser.error.ambiguous":t=>t.candidates&&t.candidates.length>0?`Which do you mean: ${t.candidates.join(", ")}?`:t.noun?`Which ${t.noun} do you mean?`:"Which do you mean?","parser.error.invalidSyntax":t=>t.extraWords?`I understood you as far as "${t.verb}" but got confused by "${t.extraWords}".`:"I don't understand that sentence."};function ome(t,e={}){let r=q.parserErrors[t];return r?typeof r=="function"?r(e):r.replace(/\{(\w+)\}/g,(n,i)=>e[i]||""):"I don't understand that."}});var fg=p(Ee=>{"use strict";var ame=Ee&&Ee.__createBinding||(Object.create?(function(t,e,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}):(function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]})),pg=Ee&&Ee.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&ame(e,t,r)},sme=Ee&&Ee.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(Ee,"__esModule",{value:!0});Ee.getParserErrorMessage=Ee.parserErrors=Ee.irregularPlurals=Ee.abbreviations=Ee.englishWords=Ee.directionMap=Ee.ordinalNumbers=Ee.cardinalNumbers=Ee.LanguageProvider=Ee.default=Ee.EnglishLanguageProvider=void 0;var c5=jM();Object.defineProperty(Ee,"EnglishLanguageProvider",{enumerable:!0,get:function(){return c5.EnglishLanguageProvider}});Object.defineProperty(Ee,"default",{enumerable:!0,get:function(){return sme(c5).default}});var cme=jM();Object.defineProperty(Ee,"LanguageProvider",{enumerable:!0,get:function(){return cme.EnglishLanguageProvider}});pg(a5(),Ee);pg(NM(),Ee);pg(DM(),Ee);pg(PM(),Ee);pg(BM(),Ee);var xm=DL();Object.defineProperty(Ee,"cardinalNumbers",{enumerable:!0,get:function(){return xm.cardinalNumbers}});Object.defineProperty(Ee,"ordinalNumbers",{enumerable:!0,get:function(){return xm.ordinalNumbers}});Object.defineProperty(Ee,"directionMap",{enumerable:!0,get:function(){return xm.directionMap}});Object.defineProperty(Ee,"englishWords",{enumerable:!0,get:function(){return xm.englishWords}});Object.defineProperty(Ee,"abbreviations",{enumerable:!0,get:function(){return xm.abbreviations}});Object.defineProperty(Ee,"irregularPlurals",{enumerable:!0,get:function(){return xm.irregularPlurals}});var l5=s5();Object.defineProperty(Ee,"parserErrors",{enumerable:!0,get:function(){return l5.parserErrors}});Object.defineProperty(Ee,"getParserErrorMessage",{enumerable:!0,get:function(){return l5.getParserErrorMessage}})});var wI=p(RI=>{"use strict";Object.defineProperty(RI,"__esModule",{value:!0});RI.getNextPatternToken=lme;RI.isPatternDelimiter=ume;function lme(t){return t.pattern.tokens[t.slotTokenIndex+1]}function ume(t,e){return e?!!(e.type==="literal"&&t.normalized===e.value||e.type==="alternates"&&e.alternates.includes(t.normalized)):!1}});var u5=p(CI=>{"use strict";Object.defineProperty(CI,"__esModule",{value:!0});CI.ScopeEvaluator=void 0;var WM=class{static getEntitiesInScope(e,r){if(!r.world)return[];let n=[];switch(e.base){case"all":n=this.getAllEntities(r);break;case"visible":n=this.getVisibleEntities(r);break;case"touchable":n=this.getTouchableEntities(r);break;case"carried":n=this.getCarriedEntities(r);break;case"nearby":n=this.getNearbyEntities(r);break;default:n=[]}for(let o of e.filters)n=n.filter(a=>this.matchesFilter(a,o,r));if(e.traitFilters&&e.traitFilters.length>0&&(n=n.filter(o=>e.traitFilters.every(a=>this.entityHasTrait(o,a)))),e.explicitEntities.length>0){let o=e.explicitEntities.map(a=>r.world.getEntity(a)).filter(Boolean);n=[...n,...o]}let i=new Set(n.map(o=>o.id));return n.filter((o,a,s)=>s.findIndex(c=>c.id===o.id)===a)}static entityMatchesScope(e,r,n){return this.getEntitiesInScope(r,n).some(o=>o.id===e.id)}static getAllEntities(e){return e.world?.getAllEntities?e.world.getAllEntities():[]}static getVisibleEntities(e){return e.world?.getVisibleEntities?e.world.getVisibleEntities(e.actorId,e.currentLocation):[]}static getTouchableEntities(e){return e.world?.getTouchableEntities?e.world.getTouchableEntities(e.actorId,e.currentLocation):[]}static getCarriedEntities(e){return e.world?.getCarriedEntities?e.world.getCarriedEntities(e.actorId):[]}static getNearbyEntities(e){return e.world?.getNearbyEntities?e.world.getNearbyEntities(e.actorId,e.currentLocation):this.getVisibleEntities(e)}static matchesFilter(e,r,n){if(typeof r=="function")return r(e,n);for(let[i,o]of Object.entries(r))if(e[i]!==o)return!1;return!0}static entityHasTrait(e,r){if(typeof e.has=="function")return e.has(r);if(typeof e.get=="function"){let n=e.get(r);return n!=null}return!1}static getEntityNames(e){let r=[];if(e.attributes&&(e.attributes.displayName&&r.push(String(e.attributes.displayName)),e.attributes.name&&r.push(String(e.attributes.name))),typeof e.get=="function"){let n=e.get("identity");n&&typeof n=="object"&&(n.name&&r.push(String(n.name)),Array.isArray(n.aliases)&&r.push(...n.aliases.map(String)))}return r}static findEntitiesByName(e,r,n){let i=this.getEntitiesInScope(r,n),o=e.toLowerCase(),a=i.filter(c=>c?this.getEntityNames(c).some(u=>u.toLowerCase()===o):!1);return a.length>0?a:i.filter(c=>c?this.getEntityNames(c).some(u=>u.toLowerCase().includes(o)):!1)}};CI.ScopeEvaluator=WM});var NI=p(In=>{"use strict";Object.defineProperty(In,"__esModule",{value:!0});In.PronounContextManager=In.INANIMATE_THEM=In.INANIMATE_IT=In.RECOGNIZED_PRONOUNS=void 0;In.isRecognizedPronoun=dme;In.setPronounContextManager=mme;In.getPronounContextManager=fme;In.RECOGNIZED_PRONOUNS=["it","them","him","her","xem","zir","hir","em","faer"];function dme(t){return In.RECOGNIZED_PRONOUNS.includes(t.toLowerCase())}In.INANIMATE_IT={subject:"it",object:"it",possessive:"its",possessiveAdj:"its",reflexive:"itself",verbForm:"singular"};In.INANIMATE_THEM={subject:"they",object:"them",possessive:"theirs",possessiveAdj:"their",reflexive:"themselves",verbForm:"plural"};var d5=null;function mme(t){d5=t}function fme(){return d5}var HM=class{constructor(){d(this,"context");this.context=this.createEmptyContext()}createEmptyContext(){return{it:null,them:null,animateByPronoun:new Map,lastCommand:null}}reset(){this.context=this.createEmptyContext()}getContext(){return this.context}resolve(e){let r=e.toLowerCase();switch(r){case"it":return this.context.it?[this.context.it]:null;case"them":if(this.context.them&&this.context.them.length>0)return this.context.them;let n=this.context.animateByPronoun.get("them");return n?[n]:null;case"him":case"her":case"xem":case"zir":case"hir":case"em":case"faer":let i=this.context.animateByPronoun.get(r);return i?[i]:null;default:let o=this.context.animateByPronoun.get(r);return o?[o]:null}}updateFromCommand(e,r,n){this.context.lastCommand=e.parsed,e.directObject&&this.processValidatedReference(e.directObject,r,n),e.indirectObject&&this.processValidatedReference(e.indirectObject,r,n),e.instrument&&this.processValidatedReference(e.instrument,r,n)}processValidatedReference(e,r,n){let i=e.entity;if(!i)return;let o={entityId:i.id,text:e.parsed?.text||i.id,turnNumber:n},a=i.get("actor");if(a?.pronouns){let s=Array.isArray(a.pronouns)?a.pronouns[0]:a.pronouns;if(this.context.animateByPronoun.set(s.object,o),Array.isArray(a.pronouns))for(let c of a.pronouns)this.context.animateByPronoun.set(c.object,o)}else i.get("identity")?.grammaticalNumber==="plural"?this.context.them=[o]:this.context.it=o}registerEntity(e,r,n,i){let o=n.getEntity(e);if(!o)return;let a={entityId:e,text:r,turnNumber:i},s=o.get("actor");if(s?.pronouns){let c=Array.isArray(s.pronouns)?s.pronouns[0]:s.pronouns;if(this.context.animateByPronoun.set(c.object,a),Array.isArray(s.pronouns))for(let l of s.pronouns)this.context.animateByPronoun.set(l.object,a)}else o.get("identity")?.grammaticalNumber==="plural"?this.context.them=[a]:this.context.it=a}getLastCommand(){return this.context.lastCommand}};In.PronounContextManager=HM});var FM=p(DI=>{"use strict";Object.defineProperty(DI,"__esModule",{value:!0});DI.EntitySlotConsumer=void 0;var UM=Xt(),pme=wI(),gme=u5(),m5=NI(),qM=class{constructor(){d(this,"slotTypes",[UM.SlotType.ENTITY,UM.SlotType.INSTRUMENT])}consume(e){let{tokens:r,startIndex:n,slotType:i}=e,o=e.DEBUG||!1,a=(0,pme.getNextPatternToken)(e);if(n<r.length){let s=r[n].normalized;if(o&&console.log(`consumeEntitySlot: startIndex=${n}, token.word='${r[n]?.word}', token.normalized='${s}'`),(0,m5.isRecognizedPronoun)(s)){let c=this.tryResolvePronoun(e,s,o);if(c)return c;o&&console.log(`Pronoun '${s}' could not be resolved, trying standard entity resolution`)}}return n<r.length&&r[n].normalized==="all"?(o&&console.log('Detected "all" keyword, calling consumeAllSlot'),this.consumeAllSlot(e,a,o)):this.consumeEntityWithListDetection(e,o)}tryResolvePronoun(e,r,n){let{tokens:i,startIndex:o,slotType:a,context:s}=e,c=(0,m5.getPronounContextManager)();if(!c)return n&&console.log("No pronoun context manager available"),null;let l=c.resolve(r);if(!l||l.length===0)return n&&console.log(`Pronoun '${r}' did not resolve to any entity`),null;if(n&&console.log(`Pronoun '${r}' resolved to: ${l.map(m=>m.entityId).join(", ")}`),l.length===1){let m=l[0],f={tokens:[o],text:m.text,confidence:1,slotType:a};return f.entityId=m.entityId,f.resolvedText=m.text,f.isPronoun=!0,f}let u={tokens:[o],text:r,confidence:1,slotType:a,isList:!0,items:l.map(m=>({tokens:[o],text:m.text,entityId:m.entityId}))};return u.isPronoun=!0,u}consumeAllSlot(e,r,n){let{tokens:i,startIndex:o,slotType:a}=e,s=[o],c=o+1,l=[];if(c<i.length){let u=i[c].normalized;if(u==="but"||u==="except"){s.push(c),c++;let m=this.consumeExcludedEntities(e,c,r,n);m&&(s.push(...m.tokens),l.push(...m.items))}}return n&&console.log(`Consumed "all" slot with ${l.length} exclusions`),{tokens:s,text:"all",confidence:1,slotType:a,isAll:!0,excluded:l.length>0?l:void 0}}consumeExcludedEntities(e,r,n,i){let{tokens:o}=e,a=[],s=[],c=r;for(;c<o.length;){if(n){let m=o[c].normalized;if(n.type==="literal"&&m===n.value||n.type==="alternates"&&n.alternates.includes(m))break}if(o[c].normalized==="and"){s.push(c),c++;continue}let l=[],u=[];for(;c<o.length;){let m=o[c].normalized;if(m==="and"||n?.type==="literal"&&m===n.value||n?.type==="alternates"&&n.alternates.includes(m))break;l.push(c),u.push(o[c].word),c++}l.length>0&&(a.push({tokens:l,text:u.join(" ")}),s.push(...l))}return a.length===0?null:{tokens:s,items:a}}consumeEntityWithListDetection(e,r){let{slotName:n,tokens:i,startIndex:o,pattern:a,slotTokenIndex:s,rule:c,context:l,slotType:u}=e,m=a.tokens[s+1],f=[],g=[],h=[],y=o,_=m?.type==="slot";for(;y<i.length;){if(m){let I=i[y].normalized;if(m.type==="literal"&&I===m.value||m.type==="alternates"&&m.alternates.includes(I))break}let O=[],R=[];if(_&&f.length===0){let I=c.slots.get(n),w=null;for(let N=1;N<=i.length-y;N++){let G=[],k=[];for(let oe=0;oe<N&&y+oe<i.length&&i[y+oe].normalized!=="and";oe++)G.push(y+oe),k.push(i[y+oe].word);if(G.length===0)break;let pe=k.join(" ");if(I&&I.constraints.length>0&&l.world){let oe=this.evaluateSlotConstraints(pe,I,l);if(oe>0){w={tokens:G,words:k,confidence:oe};break}}else{w={tokens:G,words:k,confidence:1};break}}w&&(O.push(...w.tokens),R.push(...w.words),g.push(...w.tokens),h.push(...w.words),y+=w.tokens.length)}else for(;y<i.length;){let I=i[y].normalized;if(I==="and"||m?.type==="literal"&&I===m.value||m?.type==="alternates"&&m.alternates.includes(I))break;O.push(y),R.push(i[y].word),g.push(y),h.push(i[y].word),y++}if(O.length>0&&f.push({tokens:O,text:R.join(" ")}),y<i.length&&i[y].normalized==="and")g.push(y),h.push(i[y].word),y++;else break}if(g.length===0)return null;let v=c.slots.get(n),E=1;if(r&&(console.log(`Checking constraints for slot '${n}':`),console.log(`  slotConstraints exists: ${!!v}`),console.log(`  constraints count: ${v?.constraints?.length??0}`),console.log(`  context.world exists: ${!!l.world}`)),v&&v.constraints.length>0&&l.world){for(let O of f){let R=this.evaluateSlotConstraints(O.text,v,l);E=Math.min(E,R)}if(E===0)return r&&console.log(`Failed to consume slot '${n}'`),null}let T={tokens:g,text:h.join(" "),confidence:E,slotType:u};return f.length>1&&(T.isList=!0,T.items=f,r&&console.log(`Consumed list slot with ${f.length} items: ${f.map(O=>O.text).join(", ")}`)),T}evaluateSlotConstraints(e,r,n){let i=!1;for(let o of r.constraints)if(typeof o=="function")if(o.length===1){let a=new UM.ScopeBuilderImpl,c=o(a).build(),l=gme.ScopeEvaluator.findEntitiesByName(e,c,n);if(l.length>0){i=!0;let u=n.slots.get(e)||[];n.slots.set(e,[...u,...l])}}else console.warn("FunctionConstraint in slot constraints not yet supported");else console.warn("PropertyConstraint in slot constraints not yet supported");return i?1:0}};DI.EntitySlotConsumer=qM});var VM=p(LI=>{"use strict";Object.defineProperty(LI,"__esModule",{value:!0});LI.TextSlotConsumer=void 0;var lo=Xt(),PI=wI(),GM=class{constructor(){d(this,"slotTypes",[lo.SlotType.TEXT,lo.SlotType.TEXT_GREEDY,lo.SlotType.QUOTED_TEXT,lo.SlotType.TOPIC])}consume(e){let{slotType:r}=e;switch(r){case lo.SlotType.TEXT:return this.consumeText(e);case lo.SlotType.TEXT_GREEDY:return this.consumeGreedyText(e);case lo.SlotType.QUOTED_TEXT:return this.consumeQuotedText(e);case lo.SlotType.TOPIC:return this.consumeTopic(e);default:return null}}consumeText(e){let{tokens:r,startIndex:n,slotType:i}=e;if(n>=r.length)return null;let o=r[n];return{tokens:[n],text:o.word,confidence:1,slotType:i}}consumeGreedyText(e){let{tokens:r,startIndex:n,slotType:i}=e,o=(0,PI.getNextPatternToken)(e),a=[],s=[];for(let c=n;c<r.length;c++){let l=r[c];if((0,PI.isPatternDelimiter)(l,o))break;a.push(c),s.push(l.word)}return a.length===0?null:{tokens:a,text:s.join(" "),confidence:1,slotType:i}}consumeQuotedText(e){let{tokens:r,startIndex:n}=e;if(n>=r.length)return null;let o=r[n].word;if(!o.startsWith('"'))return null;if(o.endsWith('"')&&o.length>2)return{tokens:[n],text:o.slice(1,-1),confidence:1,slotType:lo.SlotType.QUOTED_TEXT};let a=[n],s=[o.slice(1)];for(let c=n+1;c<r.length;c++){let l=r[c];if(a.push(c),l.word.endsWith('"'))return s.push(l.word.slice(0,-1)),{tokens:a,text:s.join(" "),confidence:1,slotType:lo.SlotType.QUOTED_TEXT};s.push(l.word)}return null}consumeTopic(e){let{tokens:r,startIndex:n}=e;if(n>=r.length)return null;let i=(0,PI.getNextPatternToken)(e),o=[],a=[];for(let s=n;s<r.length;s++){let c=r[s];if((0,PI.isPatternDelimiter)(c,i))break;o.push(s),a.push(c.word)}return o.length===0?null:{tokens:o,text:a.join(" "),confidence:1,slotType:lo.SlotType.TOPIC}}};LI.TextSlotConsumer=GM});var $M=p(MI=>{"use strict";Object.defineProperty(MI,"__esModule",{value:!0});MI.TypedSlotConsumer=void 0;var Sn=Xt(),YM=fg(),zM=class{constructor(){d(this,"slotTypes",[Sn.SlotType.NUMBER,Sn.SlotType.ORDINAL,Sn.SlotType.TIME,Sn.SlotType.DIRECTION])}consume(e){let{slotType:r}=e;switch(r){case Sn.SlotType.NUMBER:return this.consumeNumber(e);case Sn.SlotType.ORDINAL:return this.consumeOrdinal(e);case Sn.SlotType.TIME:return this.consumeTime(e);case Sn.SlotType.DIRECTION:return this.consumeDirection(e);default:return null}}consumeNumber(e){let{tokens:r,startIndex:n}=e;if(n>=r.length)return null;let i=r[n],o=i.normalized;return o in YM.cardinalNumbers?{tokens:[n],text:i.word,confidence:1,slotType:Sn.SlotType.NUMBER}:/^\d+$/.test(o)?{tokens:[n],text:i.word,confidence:1,slotType:Sn.SlotType.NUMBER}:null}consumeOrdinal(e){let{tokens:r,startIndex:n}=e;if(n>=r.length)return null;let i=r[n],o=i.normalized;return o in YM.ordinalNumbers?{tokens:[n],text:i.word,confidence:1,slotType:Sn.SlotType.ORDINAL}:o.match(/^(\d+)(st|nd|rd|th)$/)?{tokens:[n],text:i.word,confidence:1,slotType:Sn.SlotType.ORDINAL}:null}consumeTime(e){let{tokens:r,startIndex:n}=e;if(n>=r.length)return null;let o=r[n].word,a=o.match(/^(\d{1,2}):(\d{2})$/);if(a){let s=parseInt(a[1],10),c=parseInt(a[2],10);if(s>=0&&s<=23&&c>=0&&c<=59)return{tokens:[n],text:o,confidence:1,slotType:Sn.SlotType.TIME}}return null}consumeDirection(e){let{tokens:r,startIndex:n}=e;if(n>=r.length)return null;let i=r[n];return i.normalized in YM.directionMap?{tokens:[n],text:i.word,confidence:1,slotType:Sn.SlotType.DIRECTION}:null}};MI.TypedSlotConsumer=zM});var QM=p(kI=>{"use strict";Object.defineProperty(kI,"__esModule",{value:!0});kI.VocabularySlotConsumer=void 0;var ei=Xt(),hme=new Set(["carefully","quietly","quickly","slowly","forcefully","gently","loudly","softly","cautiously","boldly","stealthily","silently","hastily","deliberately","violently","tenderly"]),KM=class{constructor(){d(this,"slotTypes",[ei.SlotType.ADJECTIVE,ei.SlotType.NOUN,ei.SlotType.VOCABULARY,ei.SlotType.MANNER])}consume(e){let{slotType:r}=e;switch(r){case ei.SlotType.ADJECTIVE:return this.consumeAdjective(e);case ei.SlotType.NOUN:return this.consumeNoun(e);case ei.SlotType.VOCABULARY:return this.consumeVocabulary(e);case ei.SlotType.MANNER:return this.consumeManner(e);default:return null}}consumeAdjective(e){let{tokens:r,startIndex:n,context:i}=e;if(n>=r.length)return null;let o=r[n],a=o.normalized,s=this.getVocabulary(i,"adjectives");return s&&s.has(a)?{tokens:[n],text:o.word,confidence:1,slotType:ei.SlotType.ADJECTIVE}:null}consumeNoun(e){let{tokens:r,startIndex:n,context:i}=e;if(n>=r.length)return null;let o=r[n],a=o.normalized,s=this.getVocabulary(i,"nouns");return s&&s.has(a)?{tokens:[n],text:o.word,confidence:1,slotType:ei.SlotType.NOUN}:null}consumeVocabulary(e){let{tokens:r,startIndex:n,context:i,slotConstraints:o}=e,a=o?.vocabularyCategory;if(n>=r.length||!a)return null;let s=r[n],c=s.normalized,l=i.world;return l?.getGrammarVocabularyProvider&&l.getGrammarVocabularyProvider().match(a,c,i)?{tokens:[n],text:s.word,confidence:1,slotType:ei.SlotType.VOCABULARY,category:a,matchedWord:c}:null}consumeManner(e){let{tokens:r,startIndex:n,context:i}=e;if(n>=r.length)return null;let o=r[n],a=o.normalized;if(hme.has(a))return{tokens:[n],text:o.word,confidence:1,slotType:ei.SlotType.MANNER,manner:a};let s=i.world;return s?.getGrammarVocabularyProvider&&s.getGrammarVocabularyProvider().match("manner",a,i)?{tokens:[n],text:o.word,confidence:1,slotType:ei.SlotType.MANNER,manner:a}:null}getVocabulary(e,r){let n=e.world;if(!n)return null;let i=n.getVocabularyProvider?.();if(!i)return null;switch(r){case"adjectives":return i.getAdjectives?.()||null;case"nouns":return i.getNouns?.()||null;default:return null}}};kI.VocabularySlotConsumer=KM});var p5=p(Jt=>{"use strict";Object.defineProperty(Jt,"__esModule",{value:!0});Jt.SlotConsumerRegistry=Jt.VocabularySlotConsumer=Jt.TypedSlotConsumer=Jt.TextSlotConsumer=Jt.EntitySlotConsumer=Jt.isPatternDelimiter=Jt.getNextPatternToken=void 0;Jt.createDefaultRegistry=Sme;var yme=FM(),vme=VM(),Eme=$M(),Tme=QM(),f5=wI();Object.defineProperty(Jt,"getNextPatternToken",{enumerable:!0,get:function(){return f5.getNextPatternToken}});Object.defineProperty(Jt,"isPatternDelimiter",{enumerable:!0,get:function(){return f5.isPatternDelimiter}});var _me=FM();Object.defineProperty(Jt,"EntitySlotConsumer",{enumerable:!0,get:function(){return _me.EntitySlotConsumer}});var bme=VM();Object.defineProperty(Jt,"TextSlotConsumer",{enumerable:!0,get:function(){return bme.TextSlotConsumer}});var Ome=$M();Object.defineProperty(Jt,"TypedSlotConsumer",{enumerable:!0,get:function(){return Ome.TypedSlotConsumer}});var Ime=QM();Object.defineProperty(Jt,"VocabularySlotConsumer",{enumerable:!0,get:function(){return Ime.VocabularySlotConsumer}});var xI=class{constructor(){d(this,"consumers",new Map)}register(e){for(let r of e.slotTypes)this.consumers.set(r,e)}hasConsumer(e){return this.consumers.has(e)}consume(e){let r=this.consumers.get(e.slotType);if(!r)throw new Error(`No consumer registered for slot type: ${e.slotType}`);return r.consume(e)}getRegisteredTypes(){return Array.from(this.consumers.keys())}};Jt.SlotConsumerRegistry=xI;function Sme(){let t=new xI;return t.register(new yme.EntitySlotConsumer),t.register(new vme.TextSlotConsumer),t.register(new Eme.TypedSlotConsumer),t.register(new Tme.VocabularySlotConsumer),t}});var g5=p(BI=>{"use strict";Object.defineProperty(BI,"__esModule",{value:!0});BI.EnglishGrammarEngine=void 0;var Bm=Xt(),Ame=FK(),gg=fg(),Rme=p5(),XM=class extends Bm.GrammarEngine{constructor(r){super(new Ame.EnglishPatternCompiler);d(this,"slotConsumerRegistry");d(this,"lastFailures",[]);this.slotConsumerRegistry=r||(0,Rme.createDefaultRegistry)()}getLastFailures(){return this.lastFailures}findMatches(r,n,i={}){let o=[],a=[],{minConfidence:s=.1,maxMatches:c=10}=i;for(let l of this.rules){if(!l.compiledPattern)continue;let u=this.tryMatchRuleWithFailure(l,r,n);if(u.success){if(u.match.confidence>=s&&(o.push(u.match),o.length>=c))break}else a.push(u.failure)}return this.lastFailures=a,o.sort((l,u)=>u.confidence!==l.confidence?u.confidence-l.confidence:u.rule.priority-l.rule.priority),o}tryMatchRule(r,n,i){let o=r.compiledPattern,a=!1;if(a&&(console.log(`
Trying to match rule: ${r.pattern}`),console.log("Tokens:",n.map(g=>g.word).join(" "))),n.length<o.minTokens)return null;let s=new Map,c=0,l=1,u=0,m={};for(let g of o.tokens){if(c>=n.length){if(g.optional)continue;return null}let h=n[c];switch(g.type){case"literal":if(h.normalized===g.value)c===0&&(m.verb=h.normalized),c++;else if(g.optional){u++;continue}else return a&&console.log(`Literal mismatch at token ${c}: expected '${g.value}', got '${h.normalized}'`),null;break;case"alternates":if(g.alternates.includes(h.normalized))c===0&&(m.verb=h.normalized),a&&console.log(`Alternates match: token '${h.normalized}' matches alternates [${g.alternates.join(", ")}]`),c++;else if(g.optional){u++;continue}else return a&&console.log(`Alternates mismatch: token '${h.normalized}' not in alternates [${g.alternates.join(", ")}]`),null;break;case"slot":a&&console.log(`Consuming slot '${g.value}' starting at token ${c}`);let y=this.consumeSlot(g.value,n,c,o,r,i);if(!y)if(g.optional){u++;continue}else return a&&console.log(`Failed to consume slot '${g.value}'`),null;a&&console.log(`Consumed slot '${g.value}': "${y.text}"`),s.set(g.value,y),g.value==="direction"?m.direction=y.text:g.value==="preposition"&&(m.preposition=y.text),c=y.tokens[y.tokens.length-1]+1,l*=y.confidence||.9;break}}if(c!==n.length)return a&&console.log(`Pattern match failed: consumed ${c} tokens but have ${n.length} total`),null;l*=Math.pow(.9,u),r.experimentalConfidence&&(l*=r.experimentalConfidence),a&&console.log(`Pattern matched successfully! Skipped ${u} optional elements`);let f=this.buildSemantics(r,m);return{rule:r,confidence:l,slots:s,consumed:c,semantics:f,matchedTokens:m}}tryMatchRuleWithFailure(r,n,i){let o=r.compiledPattern,a=!1,s=o.tokens.length;if(n.length<o.minTokens)return{success:!1,failure:{pattern:r.pattern,action:r.action,progress:0,tokensConsumed:0,reason:"NOT_ENOUGH_TOKENS",expected:o.tokens[0]?.value}};let c=new Map,l=0,u=0,m=1,f=0,g={},h;for(let _ of o.tokens){if(u++,l>=n.length){if(_.optional)continue;return{success:!1,failure:{pattern:r.pattern,action:r.action,progress:u/s,tokensConsumed:l,reason:"NOT_ENOUGH_TOKENS",matchedVerb:h,expected:_.type==="slot"?`:${_.value}`:_.value}}}let v=n[l];switch(_.type){case"literal":if(v.normalized===_.value)l===0&&(g.verb=v.normalized,h=v.normalized),l++;else if(_.optional){f++;continue}else{let T=l===0?"VERB_MISMATCH":"LITERAL_MISMATCH";return{success:!1,failure:{pattern:r.pattern,action:r.action,progress:u/s,tokensConsumed:l,reason:T,matchedVerb:h,failedAtToken:v.normalized,expected:_.value}}}break;case"alternates":if(_.alternates.includes(v.normalized))l===0&&(g.verb=v.normalized,h=v.normalized),l++;else if(_.optional){f++;continue}else{let T=l===0?"VERB_MISMATCH":"LITERAL_MISMATCH";return{success:!1,failure:{pattern:r.pattern,action:r.action,progress:u/s,tokensConsumed:l,reason:T,matchedVerb:h,failedAtToken:v.normalized,expected:_.alternates.join("/")}}}break;case"slot":let E=this.consumeSlot(_.value,n,l,o,r,i);if(!E){if(_.optional){f++;continue}let T=n.slice(l),O=T.map(R=>R.word).join(" ");return{success:!1,failure:{pattern:r.pattern,action:r.action,progress:u/s,tokensConsumed:l,reason:"SLOT_FAILED",matchedVerb:h,slotFailure:{slotName:_.value,attemptedText:O||"(nothing)",reason:"NO_MATCH",unknownWord:T[0]?.word}}}}c.set(_.value,E),_.value==="direction"?g.direction=E.text:_.value==="preposition"&&(g.preposition=E.text),l=E.tokens[E.tokens.length-1]+1,m*=E.confidence||.9;break}}if(l!==n.length)return{success:!1,failure:{pattern:r.pattern,action:r.action,progress:.9,tokensConsumed:l,reason:"LEFTOVER_TOKENS",matchedVerb:h,failedAtToken:n[l]?.word}};m*=Math.pow(.9,f),r.experimentalConfidence&&(m*=r.experimentalConfidence);let y=this.buildSemantics(r,g);return{success:!0,match:{rule:r,confidence:m,slots:c,consumed:l,semantics:y,matchedTokens:g}}}buildSemantics(r,n){let o={};if(r.defaultSemantics&&(o={...r.defaultSemantics}),r.semantics){if(r.semantics.verbs&&n.verb){let a=r.semantics.verbs[n.verb];a&&(o={...o,...a})}if(r.semantics.directions&&n.direction){let a=r.semantics.directions[n.direction];a&&(o.direction=a)}if(r.semantics.prepositions&&n.preposition){let a=r.semantics.prepositions[n.preposition];a&&(o.spatialRelation=a)}}return Object.keys(o).length>0?o:void 0}consumeSlot(r,n,i,o,a,s){let l=-1,u;for(let g=0;g<o.tokens.length;g++){let h=o.tokens[g];if(h.type==="slot"&&h.value===r){l=g,u=h;break}}if(l===-1)return null;let m=a.slots.get(r),f=m?.slotType||u?.slotType||Bm.SlotType.ENTITY;if(this.slotConsumerRegistry.hasConsumer(f)){let g={slotName:r,tokens:n,startIndex:i,pattern:o,slotTokenIndex:l,rule:a,context:s,slotType:f,slotConstraints:m,patternToken:u,DEBUG:!1};return this.slotConsumerRegistry.consume(g)}throw new Error(`Unknown slot type: ${f}`)}static extractNumberValue(r){if(r.slotType!==Bm.SlotType.NUMBER)return null;let n=r.text.toLowerCase();return n in gg.cardinalNumbers?gg.cardinalNumbers[n]:/^\d+$/.test(n)?parseInt(n,10):null}static extractOrdinalValue(r){if(r.slotType!==Bm.SlotType.ORDINAL)return null;let n=r.text.toLowerCase();if(n in gg.ordinalNumbers)return gg.ordinalNumbers[n];let i=n.match(/^(\d+)(st|nd|rd|th)$/);return i?parseInt(i[1],10):null}static extractDirectionValue(r){if(r.slotType!==Bm.SlotType.DIRECTION)return null;let n=r.text.toLowerCase();return gg.directionMap[n]||null}static extractTimeValue(r){if(r.slotType!==Bm.SlotType.TIME)return null;let n=r.text.match(/^(\d{1,2}):(\d{2})$/);return n?{hours:parseInt(n[1],10),minutes:parseInt(n[2],10)}:null}};BI.EnglishGrammarEngine=XM});var h5=p(ZM=>{"use strict";Object.defineProperty(ZM,"__esModule",{value:!0});ZM.defineGrammar=wme;var Pe=b();function wme(t){t.forAction("if.action.looking").verbs(["look","l"]).build(),t.forAction("if.action.examining").verbs(["examine","x","inspect"]).pattern(":target").build(),t.define("look at :target").mapsTo("if.action.examining").withPriority(95).build(),t.define("look [carefully] at :target").mapsTo("if.action.examining_carefully").withPriority(96).build(),t.define("look [around]").mapsTo("if.action.looking").withPriority(101).build(),t.define("search [carefully]").mapsTo("if.action.searching").withPriority(100).build(),t.define("search :target").mapsTo("if.action.searching").withPriority(100).build(),t.define("look in|inside :target").mapsTo("if.action.searching").withPriority(100).build(),t.define("look through :target").mapsTo("if.action.searching").withPriority(100).build(),t.define("rummage in|through :target").mapsTo("if.action.searching").withPriority(95).build(),t.forAction("if.action.taking").verbs(["take","get","grab"]).pattern(":item").build(),t.define("pick up :item").mapsTo("if.action.taking").withPriority(100).build(),t.forAction("if.action.dropping").verbs(["drop","discard"]).pattern(":item").build(),t.define("put down :item").mapsTo("if.action.dropping").withPriority(100).build(),t.define("put :item in|into|inside :container").hasTrait("container",Pe.TraitType.CONTAINER).mapsTo("if.action.inserting").withPriority(100).build(),t.define("insert :item in|into :container").hasTrait("container",Pe.TraitType.CONTAINER).mapsTo("if.action.inserting").withPriority(100).build(),t.define("put :item on|onto :supporter").hasTrait("supporter",Pe.TraitType.SUPPORTER).mapsTo("if.action.putting").withPriority(100).build(),t.define("hang :item on :hook").mapsTo("if.action.putting").withPriority(110).build(),t.forAction("if.action.reading").verbs(["read","peruse","study"]).pattern(":target").build(),t.forAction("if.action.inventory").verbs(["inventory","inv","i"]).build(),t.define("go :direction").where("direction",{type:"direction"}).mapsTo("if.action.going").withPriority(100).build(),t.forAction("if.action.going").directions({north:["north","n"],south:["south","s"],east:["east","e"],west:["west","w"],northeast:["northeast","ne"],northwest:["northwest","nw"],southeast:["southeast","se"],southwest:["southwest","sw"],up:["up","u"],down:["down","d"],in:["in"],out:["out"]}).build(),t.define("open :door").hasTrait("door",Pe.TraitType.OPENABLE).mapsTo("if.action.opening").withPriority(100).build(),t.define("close :door").hasTrait("door",Pe.TraitType.OPENABLE).mapsTo("if.action.closing").withPriority(100).build(),t.forAction("if.action.switching_on").verbs(["turn","switch","flip"]).pattern("on :device").hasTrait("device",Pe.TraitType.SWITCHABLE).build(),t.forAction("if.action.switching_off").verbs(["turn","switch","flip"]).pattern("off :device").hasTrait("device",Pe.TraitType.SWITCHABLE).build(),t.define("turn :device on").hasTrait("device",Pe.TraitType.SWITCHABLE).mapsTo("if.action.switching_on").build(),t.define("turn :device off").hasTrait("device",Pe.TraitType.SWITCHABLE).mapsTo("if.action.switching_off").build(),t.forAction("if.action.pushing").verbs(["push","press","shove","move"]).pattern(":target").build(),t.forAction("if.action.pulling").verbs(["pull","drag","yank"]).pattern(":target").build(),t.forAction("if.action.lowering").verbs(["lower"]).pattern(":target").build(),t.forAction("if.action.raising").verbs(["raise","lift"]).pattern(":target").build(),t.forAction("if.action.waiting").verbs(["wait","z"]).build(),t.define("save").mapsTo("if.action.saving").withPriority(100).build(),t.define("restore").mapsTo("if.action.restoring").withPriority(100).build(),t.define("restart").mapsTo("if.action.restarting").withPriority(100).build(),t.forAction("if.action.quitting").verbs(["quit","q"]).build(),t.define("undo").mapsTo("if.action.undoing").withPriority(100).build(),t.define("score").mapsTo("if.action.scoring").withPriority(100).build(),t.define("version").mapsTo("if.action.version").withPriority(100).build(),t.define("help").mapsTo("if.action.help").withPriority(100).build(),t.define("trace").mapsTo("author.trace").withPriority(100).build(),t.define("trace on").mapsTo("author.trace").withPriority(100).build(),t.define("trace off").mapsTo("author.trace").withPriority(100).build(),t.define("trace parser on").mapsTo("author.trace").withPriority(100).build(),t.define("trace parser off").mapsTo("author.trace").withPriority(100).build(),t.define("trace validation on").mapsTo("author.trace").withPriority(100).build(),t.define("trace validation off").mapsTo("author.trace").withPriority(100).build(),t.define("trace system on").mapsTo("author.trace").withPriority(100).build(),t.define("trace system off").mapsTo("author.trace").withPriority(100).build(),t.define("trace all on").mapsTo("author.trace").withPriority(100).build(),t.define("trace all off").mapsTo("author.trace").withPriority(100).build(),t.define("give :item to :recipient").hasTrait("recipient",Pe.TraitType.ACTOR).mapsTo("if.action.giving").withPriority(100).build(),t.define("give :recipient :item").hasTrait("recipient",Pe.TraitType.ACTOR).mapsTo("if.action.giving").withPriority(95).build(),t.define("offer :item to :recipient").hasTrait("recipient",Pe.TraitType.ACTOR).mapsTo("if.action.giving").withPriority(100).build(),t.define("show :item to :recipient").hasTrait("recipient",Pe.TraitType.ACTOR).mapsTo("if.action.showing").withPriority(100).build(),t.define("show :recipient :item").hasTrait("recipient",Pe.TraitType.ACTOR).mapsTo("if.action.showing").withPriority(95).build(),t.define("throw :item at :target").mapsTo("if.action.throwing").withPriority(100).build(),t.define("throw :item to :recipient").mapsTo("if.action.throwing").withPriority(100).build(),t.define("take :item from :container with :tool").mapsTo("if.action.taking_with").withPriority(110).build(),t.define("unlock :door with :key").mapsTo("if.action.unlocking").withPriority(110).build(),t.define("open :container with :tool").hasTrait("container",Pe.TraitType.OPENABLE).mapsTo("if.action.opening_with").withPriority(110).build(),t.define("cut :object with :tool").mapsTo("if.action.cutting").withPriority(110).build(),t.forAction("if.action.attacking").verbs(["attack","kill","fight","slay","murder","hit","strike"]).pattern(":target").build(),t.define("attack :target with :weapon").mapsTo("if.action.attacking").withPriority(110).build(),t.define("kill :target with :weapon").mapsTo("if.action.attacking").withPriority(110).build(),t.define("hit :target with :weapon").mapsTo("if.action.attacking").withPriority(110).build(),t.define("strike :target with :weapon").mapsTo("if.action.attacking").withPriority(110).build(),t.define("dig :location with :tool").mapsTo("if.action.digging").withPriority(110).build(),t.define("say :message").mapsTo("if.action.saying").withPriority(100).build(),t.define("say :message to :recipient").hasTrait("recipient",Pe.TraitType.ACTOR).mapsTo("if.action.saying_to").withPriority(105).build(),t.define("write :message").mapsTo("if.action.writing").withPriority(100).build(),t.define("write :message on :surface").mapsTo("if.action.writing_on").withPriority(105).build(),t.define("shout :message").mapsTo("if.action.shouting").withPriority(100).build(),t.define("whisper :message to :recipient").hasTrait("recipient",Pe.TraitType.ACTOR).mapsTo("if.action.whispering").withPriority(100).build(),t.define("tell :recipient about :topic").hasTrait("recipient",Pe.TraitType.ACTOR).mapsTo("if.action.telling").withPriority(100).build(),t.define("ask :recipient about :topic").hasTrait("recipient",Pe.TraitType.ACTOR).mapsTo("if.action.asking").withPriority(100).build(),t.forAction("if.action.touching").verbs(["touch","rub","feel","pat","stroke","poke","prod"]).pattern(":target").build(),t.define("enter :portal").hasTrait("portal",Pe.TraitType.ENTERABLE).mapsTo("if.action.entering").withPriority(100).build(),t.define("get in :portal").hasTrait("portal",Pe.TraitType.ENTERABLE).mapsTo("if.action.entering").withPriority(100).build(),t.define("get into :portal").hasTrait("portal",Pe.TraitType.ENTERABLE).mapsTo("if.action.entering").withPriority(100).build(),t.define("climb in :portal").hasTrait("portal",Pe.TraitType.ENTERABLE).mapsTo("if.action.entering").withPriority(100).build(),t.define("climb into :portal").hasTrait("portal",Pe.TraitType.ENTERABLE).mapsTo("if.action.entering").withPriority(100).build(),t.define("go in :portal").hasTrait("portal",Pe.TraitType.ENTERABLE).mapsTo("if.action.entering").withPriority(100).build(),t.define("go into :portal").hasTrait("portal",Pe.TraitType.ENTERABLE).mapsTo("if.action.entering").withPriority(100).build(),t.define("exit").mapsTo("if.action.exiting").withPriority(100).build(),t.define("get out").mapsTo("if.action.exiting").withPriority(100).build(),t.define("leave").mapsTo("if.action.exiting").withPriority(95).build(),t.define("climb out").mapsTo("if.action.exiting").withPriority(100).build(),t.define("board :vehicle").hasTrait("vehicle",Pe.TraitType.ENTERABLE).mapsTo("if.action.entering").withPriority(100).build(),t.define("get on :vehicle").hasTrait("vehicle",Pe.TraitType.ENTERABLE).mapsTo("if.action.entering").withPriority(100).build(),t.define("exit :container").hasTrait("container",Pe.TraitType.ENTERABLE).mapsTo("if.action.exiting").withPriority(100).build(),t.define("disembark").mapsTo("if.action.exiting").withPriority(100).build(),t.define("disembark :vehicle").hasTrait("vehicle",Pe.TraitType.ENTERABLE).mapsTo("if.action.exiting").withPriority(100).build(),t.define("get off :vehicle").hasTrait("vehicle",Pe.TraitType.ENTERABLE).mapsTo("if.action.exiting").withPriority(100).build(),t.define("alight").mapsTo("if.action.exiting").withPriority(95).build(),t.define("again").mapsTo("if.action.again").withPriority(100).build(),t.define("g").mapsTo("if.action.again").withPriority(90).build()}});var y5=p(ti=>{"use strict";Object.defineProperty(ti,"__esModule",{value:!0});ti.DirectionAbbreviations=ti.DirectionWords=void 0;ti.parseDirection=Cme;ti.getDirectionWord=Nme;var $e=b();ti.DirectionWords={north:$e.Direction.NORTH,south:$e.Direction.SOUTH,east:$e.Direction.EAST,west:$e.Direction.WEST,northeast:$e.Direction.NORTHEAST,northwest:$e.Direction.NORTHWEST,southeast:$e.Direction.SOUTHEAST,southwest:$e.Direction.SOUTHWEST,up:$e.Direction.UP,down:$e.Direction.DOWN,in:$e.Direction.IN,inside:$e.Direction.IN,out:$e.Direction.OUT,outside:$e.Direction.OUT};ti.DirectionAbbreviations={n:$e.Direction.NORTH,s:$e.Direction.SOUTH,e:$e.Direction.EAST,w:$e.Direction.WEST,ne:$e.Direction.NORTHEAST,nw:$e.Direction.NORTHWEST,se:$e.Direction.SOUTHEAST,sw:$e.Direction.SOUTHWEST,u:$e.Direction.UP,d:$e.Direction.DOWN};function Cme(t){if(!t)return null;let e=t.toLowerCase().trim();return ti.DirectionAbbreviations[e]?ti.DirectionAbbreviations[e]:ti.DirectionWords[e]?ti.DirectionWords[e]:null}function Nme(t){for(let[e,r]of Object.entries(ti.DirectionWords))if(r===t){if(t===$e.Direction.IN&&e==="inside"||t===$e.Direction.OUT&&e==="outside")continue;return e}return t.toLowerCase()}});var ek=p(JM=>{"use strict";Object.defineProperty(JM,"__esModule",{value:!0});JM.analyzeBestFailure=Dme;function Dme(t,e,r){if(t.length===0)return e.trim()?{code:"UNKNOWN_VERB",messageId:"parser.error.unknownVerb",context:{verb:e.split(/\s+/)[0]}}:{code:"NO_VERB",messageId:"parser.error.noInput",context:{}};let i=[...t].sort((o,a)=>a.progress-o.progress)[0];if(i.matchedVerb&&i.slotFailure){let o=i.slotFailure;if(o.reason==="NO_MATCH")return{code:"ENTITY_NOT_FOUND",messageId:"parser.error.entityNotFound",context:{verb:i.matchedVerb,noun:o.unknownWord||o.attemptedText,slot:o.slotName}};if(o.reason==="SCOPE_VIOLATION")return{code:"SCOPE_VIOLATION",messageId:"parser.error.scopeViolation",context:{verb:i.matchedVerb,noun:o.attemptedText,slot:o.slotName}};if(o.reason==="AMBIGUOUS")return{code:"AMBIGUOUS_INPUT",messageId:"parser.error.ambiguous",context:{verb:i.matchedVerb,noun:o.attemptedText,candidates:o.candidates}}}if(i.matchedVerb&&i.reason==="NOT_ENOUGH_TOKENS"){if(i.expected?.startsWith(":")){let o=i.expected.slice(1);return o==="target"||o==="item"||o==="object"?{code:"MISSING_OBJECT",messageId:"parser.error.missingObject",context:{verb:i.matchedVerb}}:{code:"MISSING_INDIRECT",messageId:"parser.error.missingIndirect",context:{verb:i.matchedVerb,slot:o}}}return{code:"MISSING_OBJECT",messageId:"parser.error.missingObject",context:{verb:i.matchedVerb}}}return i.matchedVerb&&i.reason==="SLOT_FAILED"?{code:"MISSING_OBJECT",messageId:"parser.error.missingObject",context:{verb:i.matchedVerb}}:i.matchedVerb&&i.reason==="LEFTOVER_TOKENS"?{code:"INVALID_SYNTAX",messageId:"parser.error.invalidSyntax",context:{verb:i.matchedVerb,extraWords:i.failedAtToken}}:r?{code:"INVALID_SYNTAX",messageId:"parser.error.invalidSyntax",context:{}}:{code:"UNKNOWN_VERB",messageId:"parser.error.unknownVerb",context:{verb:e.split(/\s+/)[0]}}}});var nk=p(jI=>{"use strict";Object.defineProperty(jI,"__esModule",{value:!0});jI.EnglishParser=void 0;var Ie=Xt(),Gr=b(),Pme=g5(),Lme=h5(),tk=y5(),Mme=ek(),v5=NI(),kme={allowPartial:!0,expandAbbreviations:!0,ignoreArticles:!1,minConfidence:.1};function xme(t){switch(t){case Ie.PartOfSpeech.VERB:return Gr.PartOfSpeech.VERB;case Ie.PartOfSpeech.NOUN:return Gr.PartOfSpeech.NOUN;case Ie.PartOfSpeech.ADJECTIVE:return Gr.PartOfSpeech.ADJECTIVE;case Ie.PartOfSpeech.ARTICLE:return Gr.PartOfSpeech.ARTICLE;case Ie.PartOfSpeech.PREPOSITION:return Gr.PartOfSpeech.PREPOSITION;case Ie.PartOfSpeech.PRONOUN:return Gr.PartOfSpeech.PRONOUN;case Ie.PartOfSpeech.SPECIAL:return Gr.PartOfSpeech.DETERMINER;default:return Gr.PartOfSpeech.UNKNOWN}}var rk=class{constructor(e,r={}){d(this,"options");d(this,"language");d(this,"onDebugEvent");d(this,"platformEventEmitter");d(this,"grammarEngine");d(this,"worldContext",null);d(this,"pronounContext");this.language=e,this.options={...kme,...r},this.grammarEngine=new Pme.EnglishGrammarEngine;let n=this.grammarEngine.createBuilder();(0,Lme.defineGrammar)(n),this.pronounContext=new v5.PronounContextManager,(0,v5.setPronounContextManager)(this.pronounContext),this.initializeVocabulary()}initializeVocabulary(){Ie.vocabularyRegistry.clear();let e=(0,Ie.adaptVerbVocabulary)(this.language);Ie.vocabularyRegistry.registerVerbs(e);let r=(0,Ie.adaptDirectionVocabulary)(this.language);Ie.vocabularyRegistry.registerDirections(r);let n=(0,Ie.adaptSpecialVocabulary)(this.language);Ie.vocabularyRegistry.registerSpecial(n);let i=this.language.getPrepositions();Ie.vocabularyRegistry.registerPrepositions(i);let o=this.language.getDeterminers();Ie.vocabularyRegistry.registerDeterminers(o);let a=this.language.getConjunctions();Ie.vocabularyRegistry.registerConjunctions(a);let s=this.language.getNumbers();Ie.vocabularyRegistry.registerNumbers(s)}setDebugCallback(e){this.onDebugEvent=e}setPlatformEventEmitter(e){this.platformEventEmitter=e}setWorldContext(e,r,n){this.worldContext={world:e,actorId:r,currentLocation:n}}emitPlatformEvent(e,r){this.platformEventEmitter&&this.platformEventEmitter({id:`parser_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,timestamp:Date.now(),type:`platform.parser.${e}`,entities:{},payload:{subsystem:"parser",...r},tags:["platform","parser","debug"],priority:0,narrate:!1})}registerVerbs(e){Ie.vocabularyRegistry.registerDynamicVerbs(e,"story")}registerVocabulary(e){let r=[];for(let n of e)if(n.partOfSpeech===Ie.PartOfSpeech.VERB){let i=r.find(o=>o.actionId===n.mapsTo);i||(i={actionId:n.mapsTo,verbs:[],pattern:n.metadata?.pattern,prepositions:n.metadata?.prepositions},r.push(i)),i.verbs.push(n.word)}r.length>0&&this.registerVerbs(r)}parse(e){this.emitPlatformEvent("parse_start",{input:e});let r=this.tokenizeRich(e);if(this.emitPlatformEvent("tokenize_complete",{input:e,tokens:r.map(a=>({word:a.word,normalized:a.normalized,partOfSpeech:a.partOfSpeech,candidateCount:a.candidates.length}))}),this.onDebugEvent){let a=r.filter(s=>s.partOfSpeech.includes(Gr.PartOfSpeech.UNKNOWN)||s.candidates.length===0).map(s=>s.word);this.onDebugEvent({id:`parser_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,timestamp:Date.now(),subsystem:"parser",type:"tokenize",data:{input:e,tokens:r.map(s=>({word:s.word,normalized:s.normalized,position:s.position,length:s.length,partOfSpeech:s.partOfSpeech,candidateCount:s.candidates.length})),unknownWords:a}})}let n=this.findCommandStructures(r,e);if(this.emitPlatformEvent("pattern_matching_complete",{input:e,candidateCount:n.length,patterns:n.map(a=>({pattern:a.pattern,action:a.action,confidence:a.confidence}))}),this.onDebugEvent&&this.onDebugEvent({id:`parser_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,timestamp:Date.now(),subsystem:"parser",type:"pattern_match",data:{input:e,patternsAttempted:n.map(a=>({name:a.pattern,matched:!0,confidence:a.confidence})),totalCandidates:n.length}}),n.length===0){let a=this.grammarEngine.getLastFailures(),s=r.some(u=>u.partOfSpeech.includes(Gr.PartOfSpeech.VERB)),c=(0,Mme.analyzeBestFailure)(a,e,s);return this.emitPlatformEvent("parse_failed",{input:e,reason:"no_matching_patterns",tokenCount:r.length,hadVerb:s,errorCode:c.code,errorContext:c.context}),this.onDebugEvent&&this.onDebugEvent({id:`parser_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,timestamp:Date.now(),subsystem:"parser",type:"parse_error",data:{input:e,errorType:c.code,errorDetails:{messageId:c.messageId,context:c.context,hadTokens:r.length>0,hadVerb:s,failureCount:a.length}}}),{success:!1,error:this.buildParseError(e,c)}}n.sort((a,s)=>s.confidence-a.confidence);let i=n[0];this.onDebugEvent&&this.onDebugEvent({id:`parser_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,timestamp:Date.now(),subsystem:"parser",type:"candidate_selection",data:{input:e,candidates:n.map((a,s)=>({action:a.action,pattern:a.pattern,confidence:a.confidence,selected:s===0})),selectionReason:n.length===1?"only_candidate":"highest_confidence"}});let o={rawInput:e,tokens:i.tokens,structure:{verb:i.verb,directObject:i.directObject,preposition:i.preposition,indirectObject:i.indirectObject},pattern:i.pattern,confidence:i.confidence,action:i.action,textSlots:i.textSlots,instrument:i.instrument,excluded:i.excluded,vocabularySlots:i.vocabularySlots,manner:i.manner};if(i.direction){let a=(0,tk.parseDirection)(i.direction);o.extras={direction:a||i.direction}}else if(i.extras){let a={...i.extras};if(a.direction&&typeof a.direction=="string"){let s=(0,tk.parseDirection)(a.direction);s&&(a.direction=s)}o.extras=a}return this.emitPlatformEvent("parse_success",{input:e,action:o.action,pattern:o.pattern,confidence:o.confidence,structure:{verb:o.structure.verb?.text,directObject:o.structure.directObject?.text,preposition:o.structure.preposition?.text,indirectObject:o.structure.indirectObject?.text}}),{success:!0,value:o}}parseChain(e){let r=this.splitOnPeriods(e),n=[];for(let i of r){let o=this.splitOnCommasIfChain(i);n.push(...o)}return n.map(i=>this.parse(i))}splitOnCommasIfChain(e){let r=new Map,n=e,i=0;n=n.replace(/"[^"]*"/g,u=>{let m=`__COMMA_QUOTE_${i++}__`;return r.set(m,u),m}),n=n.replace(/'[^']*'/g,u=>{let m=`__COMMA_QUOTE_${i++}__`;return r.set(m,u),m});let o=n.indexOf(",");if(o===-1)return[e];let s=n.slice(o+1).trim().match(/^(\w+)/);if(!s)return[e];let c=s[1].toLowerCase();if(Ie.vocabularyRegistry.hasWord(c,Ie.PartOfSpeech.VERB)){let u=n.split(","),m=[];for(let f of u){let g=f;for(let[y,_]of r)g=g.replace(y,_);let h=g.trim();h.length>0&&m.push(h)}return m}return[e]}splitOnPeriods(e){let r=new Map,n=e,i=0;n=n.replace(/"[^"]*"/g,s=>{let c=`__PERIOD_QUOTE_${i++}__`;return r.set(c,s),c}),n=n.replace(/'[^']*'/g,s=>{let c=`__PERIOD_QUOTE_${i++}__`;return r.set(c,s),c});let o=n.split("."),a=[];for(let s of o){let c=s;for(let[u,m]of r)c=c.replace(u,m);let l=c.trim();l.length>0&&a.push(l)}return a}tokenizeRich(e){let r=[],n=0,i=[],o=e,a=/"([^"]*)"/g,s,c=0;for(;(s=a.exec(e))!==null;){let u=`__QUOTE_${c}__`,m=s[1],f=s.index;i.push({placeholder:u,content:m,position:f}),o=o.replace(s[0],u),c++}let l=o.trim().split(/(\s+)/);for(let u of l){if(/^\s+$/.test(u)){n+=u.length;continue}let m=i.find(_=>_.placeholder===u);if(m){r.push({word:`"${m.content}"`,normalized:m.content.toLowerCase(),position:n,length:m.content.length+2,partOfSpeech:[Gr.PartOfSpeech.NOUN],candidates:[{id:"quoted_string",type:"noun",confidence:1}]}),n+=u.length;continue}let f=u.toLowerCase(),g=this.getTokenCandidates(f),h=g.map(_=>({id:_.mapsTo,type:_.partOfSpeech,confidence:_.priority||1})),y=Array.from(new Set(g.map(_=>xme(_.partOfSpeech))));y.length===0&&y.push(Gr.PartOfSpeech.UNKNOWN),r.push({word:u,normalized:f,position:n,length:u.length,partOfSpeech:y,candidates:h}),n+=u.length}return r}findCommandStructures(e,r){let n={world:this.worldContext?.world||null,actorId:this.worldContext?.actorId||"player",currentLocation:this.worldContext?.currentLocation||"current",slots:new Map},i=e.map(s=>({word:s.word,normalized:s.normalized,position:s.position,candidates:s.candidates.map(c=>({partOfSpeech:c.type,mapsTo:c.id,priority:c.confidence||0}))})),o=this.grammarEngine.findMatches(i,n),a=[];for(let s of o){let c=this.convertGrammarMatch(s,e);c?a.push(c):r.includes("throw")&&console.log("Failed to convert match:",s.rule.pattern)}return a}convertGrammarMatch(e,r){let n=e.rule,i=[],o=0;for(let I=0;I<r.length&&r[I].partOfSpeech.includes(Gr.PartOfSpeech.VERB);I++)i.push(I),o=I+1;let a={tokens:i,text:i.map(I=>r[I].word).join(" "),head:i.length>0?r[i[0]].normalized:""},s=Array.from(e.slots.entries());s.sort((I,w)=>(I[1].tokens[0]||0)-(w[1].tokens[0]||0));let c,l,u,m={},f=n.pattern.split(/\s+/),g={},h=0;for(let I of f)if(I.startsWith(":")){let w=I.substring(1);g[w]=h++}let y,_,v,E,T;for(let[I,w]of s){let N=w.tokens.map(oe=>r[oe]),G=w.slotType;if(G===Ie.SlotType.TEXT||G===Ie.SlotType.TEXT_GREEDY){y||(y=new Map),y.set(I,w.text);continue}if(G===Ie.SlotType.VOCABULARY){let oe=w;E||(E=new Map),E.set(I,{word:oe.matchedWord||w.text.toLowerCase(),category:oe.category||""});continue}if(G===Ie.SlotType.MANNER){T=w.manner||w.text.toLowerCase();continue}if(G===Ie.SlotType.DIRECTION){let oe=w.text.toLowerCase(),le=(0,tk.parseDirection)(oe);m.direction=le||oe;continue}let k={tokens:w.tokens,text:w.text,head:N[N.length-1]?.normalized||w.text,modifiers:[],articles:[],determiners:[],candidates:[w.text]},pe=w;if(pe.isAll&&(k.isAll=!0,pe.excluded&&pe.excluded.length>0&&(v=pe.excluded.map(oe=>({tokens:oe.tokens,text:oe.text,head:oe.text.split(" ").pop()||oe.text,modifiers:[],articles:[],determiners:[],candidates:[oe.text]})))),pe.isList&&pe.items&&(k.isList=!0,k.items=pe.items.map(oe=>({tokens:oe.tokens,text:oe.text,head:oe.text.split(" ").pop()||oe.text,modifiers:[],articles:[],determiners:[],candidates:[oe.text],entityId:oe.entityId}))),pe.entityId&&(k.entityId=pe.entityId),pe.isPronoun&&(k.wasPronoun=!0),G===Ie.SlotType.INSTRUMENT){_=k;continue}if(n.pattern.includes(" with :"+I))m[I]=k;else if(n.pattern.includes("give :recipient :item"))I==="item"?c=k:I==="recipient"&&(u=k);else if(n.pattern.includes("give :item to :recipient"))I==="item"?c=k:I==="recipient"&&(u=k);else if(n.pattern.includes("show :recipient :item"))I==="item"?c=k:I==="recipient"&&(u=k);else if(n.pattern.includes("show :item to :recipient"))I==="item"?c=k:I==="recipient"&&(u=k);else if(n.pattern.includes(":item from :container"))I==="item"?c=k:I==="container"&&(u=k);else{let oe=g[I];oe===0&&!c?c=k:oe===1&&!u?u=k:m[I]||(m[I]=k)}}if(c&&u){let I=c.tokens[c.tokens.length-1],w=u.tokens[0];for(let N=I+1;N<w;N++)if(r[N].partOfSpeech.includes(Gr.PartOfSpeech.PREPOSITION)){l={tokens:[N],text:r[N].word};break}}if(n.action==="if.action.going"&&!c){let I=r.find(w=>w.candidates.some(N=>N.type===Ie.PartOfSpeech.DIRECTION)||["north","south","east","west","up","down","in","out","n","s","e","w","u","d"].includes(w.normalized));if(I)return{tokens:r,verb:a,pattern:"DIRECTION_ONLY",confidence:e.confidence,action:n.action,direction:I.normalized}}let O="VERB_ONLY";c&&u?l?O="VERB_NOUN_PREP_NOUN":O="VERB_NOUN_NOUN":c&&(O="VERB_NOUN");let R={tokens:r,verb:a,directObject:c,preposition:l,indirectObject:u,pattern:O,confidence:e.confidence,action:n.action,textSlots:y,instrument:_,excluded:v,vocabularySlots:E,manner:T};return Object.keys(m).length>0&&(R.extras=m),R}registerGrammar(e,r,n){let i=this.grammarEngine.createBuilder().define(e).mapsTo(r);if(n)for(let[o,a]of Object.entries(n))i.where(o,a);i.build()}getStoryGrammar(){return this.grammarEngine.createBuilder()}getTokenCandidates(e){return Ie.vocabularyRegistry.lookup(e).map(n=>({partOfSpeech:n.partOfSpeech,mapsTo:n.mapsTo,priority:n.priority||0,source:n.source,metadata:n.metadata}))}tokenize(e){return this.tokenizeRich(e).map(n=>({word:n.word,normalized:n.normalized,position:n.position,candidates:this.getTokenCandidates(n.normalized)}))}parseWithErrors(e,r){let n={...this.options,...r},i=this.tokenizeRich(e),o=[];for(let l of i)l.partOfSpeech.includes(Gr.PartOfSpeech.UNKNOWN)&&l.candidates.length===0&&o.push({type:Ie.ParseErrorType.UNKNOWN_WORD,message:`Unknown word: ${l.word}`,words:[l.word],position:l.position});let a=o.length>0;if(!(!a||n.allowPartial))return{candidates:[],errors:o,partial:!1};let c=this.parse(e);if(c.success){let l={action:c.value.action,originalInput:e,tokens:this.tokenize(e),pattern:c.value.pattern,confidence:c.value.confidence};c.value.structure.directObject&&(l.nounText=c.value.structure.directObject.text,l.nounCandidates=c.value.structure.directObject.candidates),c.value.structure.preposition&&(l.preposition=c.value.structure.preposition.text),c.value.structure.indirectObject&&(l.secondNounText=c.value.structure.indirectObject.text,l.secondNounCandidates=c.value.structure.indirectObject.candidates);let u=l.confidence||0;return{candidates:n.minConfidence!==void 0&&u<n.minConfidence?[]:[l],errors:o,partial:a&&n.allowPartial===!0}}else{if(o.length>0)return{candidates:[],errors:o,partial:n.allowPartial===!0};let l={type:Ie.ParseErrorType.PATTERN_MISMATCH,message:c.error.message,position:c.error.position};return{candidates:[],errors:[l],partial:!1}}}addVerb(e,r,n,i){let o={actionId:e,verbs:r,pattern:n||"VERB_ONLY",prepositions:i};Ie.vocabularyRegistry.registerDynamicVerbs([o],"story");let a=this.grammarEngine.createBuilder();for(let s of r)if(n==="VERB_OBJ"||n==="VERB_NOUN")a.define(`${s} :object`).mapsTo(e).withPriority(150).build();else if(n==="VERB_PREP_NOUN"&&i)for(let c of i)a.define(`${s} ${c} :object`).mapsTo(e).withPriority(150).build();else if(n==="VERB_NOUN_PREP_NOUN"&&i)for(let c of i)a.define(`${s} :object1 ${c} :object2`).mapsTo(e).withPriority(150).build();else a.define(s).mapsTo(e).withPriority(150).build();this.onDebugEvent&&this.onDebugEvent({id:`parser_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,timestamp:Date.now(),subsystem:"parser",type:"vocabulary.add_verb",data:{actionId:e,verbs:r,pattern:n,prepositions:i}})}addNoun(e,r){this.onDebugEvent&&this.onDebugEvent({id:`parser_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,timestamp:Date.now(),subsystem:"parser",type:"vocabulary.add_noun",data:{word:e,canonical:r}})}addAdjective(e){this.onDebugEvent&&this.onDebugEvent({id:`parser_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,timestamp:Date.now(),subsystem:"parser",type:"vocabulary.add_adjective",data:{word:e}})}addPreposition(e){Ie.vocabularyRegistry.registerPrepositions([e]);let r=this.grammarEngine.createBuilder();r.define(`put :object ${e} :location`).mapsTo("if.action.putting").withPriority(150).build(),r.define(`place :object ${e} :location`).mapsTo("if.action.putting").withPriority(150).build(),this.onDebugEvent&&this.onDebugEvent({id:`parser_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,timestamp:Date.now(),subsystem:"parser",type:"vocabulary.add_preposition",data:{word:e}})}buildParseError(e,r){let{code:n,messageId:i,context:o}=r,a;switch(n){case"NO_VERB":a="I beg your pardon?";break;case"UNKNOWN_VERB":a=o.verb?`I don't know the verb "${o.verb}".`:"I don't understand that sentence.";break;case"MISSING_OBJECT":a=o.verb?`What do you want to ${o.verb}?`:"What do you want to do that to?";break;case"MISSING_INDIRECT":a=o.verb?`${Bme(o.verb)} it where?`:"Where do you want to do that?";break;case"ENTITY_NOT_FOUND":a=o.noun?`I don't see any "${o.noun}" here.`:"I don't see that here.";break;case"SCOPE_VIOLATION":a=o.noun?`You can't reach the ${o.noun}.`:"You can't reach that.";break;case"AMBIGUOUS_INPUT":a=o.noun?`Which ${o.noun} do you mean?`:"Which do you mean?";break;default:a="I don't understand that."}return{type:"PARSE_ERROR",code:n,messageId:i,message:a,input:e,verb:o.verb,failedWord:o.noun||o.verb,slot:o.slot}}updatePronounContext(e,r){this.worldContext?.world&&this.pronounContext.updateFromCommand(e,this.worldContext.world,r)}registerPronounEntity(e,r,n){this.worldContext?.world&&this.pronounContext.registerEntity(e,r,this.worldContext.world,n)}resetPronounContext(){this.pronounContext.reset()}getLastCommand(){return this.pronounContext.getLastCommand()}getPronounContextManager(){return this.pronounContext}};jI.EnglishParser=rk;function Bme(t){return t.charAt(0).toUpperCase()+t.slice(1)}});var E5=p(St=>{"use strict";Object.defineProperty(St,"__esModule",{value:!0});St.metadata=St.INANIMATE_THEM=St.INANIMATE_IT=St.RECOGNIZED_PRONOUNS=St.isRecognizedPronoun=St.PronounContextManager=St.analyzeBestFailure=St.Parser=St.EnglishParser=void 0;var jme=nk();Object.defineProperty(St,"EnglishParser",{enumerable:!0,get:function(){return jme.EnglishParser}});var Wme=nk();Object.defineProperty(St,"Parser",{enumerable:!0,get:function(){return Wme.EnglishParser}});var Hme=ek();Object.defineProperty(St,"analyzeBestFailure",{enumerable:!0,get:function(){return Hme.analyzeBestFailure}});var hg=NI();Object.defineProperty(St,"PronounContextManager",{enumerable:!0,get:function(){return hg.PronounContextManager}});Object.defineProperty(St,"isRecognizedPronoun",{enumerable:!0,get:function(){return hg.isRecognizedPronoun}});Object.defineProperty(St,"RECOGNIZED_PRONOUNS",{enumerable:!0,get:function(){return hg.RECOGNIZED_PRONOUNS}});Object.defineProperty(St,"INANIMATE_IT",{enumerable:!0,get:function(){return hg.INANIMATE_IT}});Object.defineProperty(St,"INANIMATE_THEM",{enumerable:!0,get:function(){return hg.INANIMATE_THEM}});St.metadata={languageCode:"en-US",languageName:"English (United States)",parserVersion:"1.0.0",supportedPatterns:["VERB_ONLY","VERB_NOUN","VERB_PREP_NOUN","VERB_NOUN_PREP_NOUN","DIRECTION_ONLY"],features:["compound-verbs","articles","adjectives","abbreviations","multi-word-nouns"]}});var _5=p(WI=>{"use strict";var Ume=or(),qme=Symbol.for("react.element"),Fme=Symbol.for("react.fragment"),Gme=Object.prototype.hasOwnProperty,Vme=Ume.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Yme={key:!0,ref:!0,__self:!0,__source:!0};function T5(t,e,r){var n,i={},o=null,a=null;r!==void 0&&(o=""+r),e.key!==void 0&&(o=""+e.key),e.ref!==void 0&&(a=e.ref);for(n in e)Gme.call(e,n)&&!Yme.hasOwnProperty(n)&&(i[n]=e[n]);if(t&&t.defaultProps)for(n in e=t.defaultProps,e)i[n]===void 0&&(i[n]=e[n]);return{$$typeof:qme,type:t,key:o,ref:a,props:i,_owner:Vme.current}}WI.Fragment=Fme;WI.jsx=T5;WI.jsxs=T5});var ri=p((yPe,b5)=>{"use strict";b5.exports=_5()});var l8=S(YW()),u8=S(qK()),JS=S(b()),d8=S(E5()),m8=S(fg());var A5=S(ri(),1),vr=S(or(),1);var O5={engine:null,isReady:!1,isPlaying:!1,currentRoom:null,score:0,maxScore:0,turns:0,transcript:[],lastTurnEvents:[]};function I5(t,e){switch(e.type){case"ENGINE_READY":return{...t,engine:e.engine,isReady:!0};case"GAME_STARTED":return{...t,isPlaying:!0};case"ROOM_CHANGED":return{...t,currentRoom:e.room};case"SCORE_CHANGED":return{...t,score:e.score,maxScore:e.maxScore??t.maxScore};case"TURN_COMPLETED":{let r={id:`turn-${e.turn}-${Date.now()}`,turn:e.turn,command:e.command,text:e.text,timestamp:Date.now()};return{...t,turns:e.turn,transcript:[...t.transcript,r],lastTurnEvents:e.events}}case"TRANSCRIPT_CLEARED":return{...t,transcript:[]};case"ENGINE_STOPPED":return{...t,isPlaying:!1};default:return t}}var HI=(0,vr.createContext)(null);function yg(){let t=(0,vr.useContext)(HI);if(!t)throw new Error("useGameContext must be used within a GameProvider");return t}function wi(){return yg().state}function S5(t,e){let r=t.getEntity(e);if(!r)return null;let i=r.getTrait("identity")?.name||r.id,a=r.getTrait("room")?.exits||{},s=Object.entries(a).map(([c,l])=>({direction:c,destination:l.destination,via:l.via}));return{id:r.id,name:i,exits:s,firstVisit:!1}}function UI({engine:t,children:e}){let[r,n]=(0,vr.useReducer)(I5,O5),i=(0,vr.useRef)(),o=(0,vr.useRef)(t),a=(0,vr.useRef)([]);(0,vr.useEffect)(()=>{let l=o.current,u=l.getWorld(),m=(g,h)=>{console.log("[text:output]",{text:g,turn:h});let y=[...a.current];a.current=[],n({type:"TURN_COMPLETED",turn:h,text:g,command:i.current,events:y}),i.current=void 0},f=g=>{let h=g;if(console.log("[event]",h.type,h.data),a.current.push(h),h.type==="if.event.actor_moved"){let y=h.data;if(y.toRoom||y.destinationRoom?.id){let _=y.toRoom||y.destinationRoom.id,v=S5(u,_);v&&(v.firstVisit=y.firstVisit??!1,v.arrivedFrom=y.direction?.toLowerCase(),n({type:"ROOM_CHANGED",room:v}))}}if(h.type==="game.score_changed"){let y=h.data;y.newScore!==void 0&&n({type:"SCORE_CHANGED",score:y.newScore,maxScore:y.maxScore})}if(h.type==="game.started"){n({type:"GAME_STARTED"});let y=u.getPlayer();if(y){let _=u.getLocation(y.id);if(_){let v=S5(u,_);v&&(v.firstVisit=!0,n({type:"ROOM_CHANGED",room:v}))}}}};return l.on("text:output",m),l.on("event",f),n({type:"ENGINE_READY",engine:l}),l.start(),l.executeTurn("look"),()=>{l.off("text:output",m),l.off("event",f),n({type:"ENGINE_STOPPED"})}},[]);let s=(0,vr.useCallback)(async l=>{r.isPlaying&&(i.current=l,await o.current.executeTurn(l))},[r.isPlaying]),c=(0,vr.useMemo)(()=>({state:r,dispatch:n,executeCommand:s}),[r,s]);return(0,A5.jsx)(HI.Provider,{value:c,children:e})}var ws=S(or(),1);function qI(t=100){let[e,r]=(0,ws.useState)(""),[n,i]=(0,ws.useState)([]),o=(0,ws.useRef)(-1),a=(0,ws.useRef)(""),s=(0,ws.useCallback)(l=>{l.trim()&&(i(u=>{if(u.length>0&&u[u.length-1]===l)return u;let m=[...u,l];return m.length>t?m.slice(-t):m}),o.current=-1,a.current="",r(""))},[t]),c=(0,ws.useCallback)(l=>{if(l.key==="ArrowUp"){if(l.preventDefault(),n.length===0)return;o.current===-1&&(a.current=e);let u=o.current===-1?n.length-1:Math.max(0,o.current-1);o.current=u,r(n[u])}else if(l.key==="ArrowDown"){if(l.preventDefault(),o.current===-1)return;let u=o.current+1;u>=n.length?(o.current=-1,r(a.current)):(o.current=u,r(n[u]))}else o.current!==-1&&(o.current=-1,a.current="")},[n,e]);return{value:e,setValue:r,addToHistory:s,handleKeyDown:c,history:n}}var jm=S(or(),1);function FI(){let{transcript:t,turns:e}=wi(),r=(0,jm.useRef)(null);(0,jm.useEffect)(()=>{r.current&&(r.current.scrollTop=r.current.scrollHeight)},[t]);let n=(0,jm.useCallback)(()=>{r.current&&(r.current.scrollTop=r.current.scrollHeight)},[]);return{entries:t,containerRef:r,scrollToBottom:n,turn:e}}var Cs=S(or(),1),$me="sharpee-notes-";function GI(t="default"){let e=`${$me}${t}`,[r,n]=(0,Cs.useState)(()=>{try{return localStorage.getItem(e)||""}catch{return""}}),[i,o]=(0,Cs.useState)(!1),a=(0,Cs.useCallback)(()=>{try{localStorage.setItem(e,r),o(!1)}catch(l){console.warn("Failed to save notes to localStorage:",l)}},[e,r]),s=(0,Cs.useCallback)(l=>{n(l),o(!0)},[]),c=(0,Cs.useCallback)(()=>{n("");try{localStorage.removeItem(e)}catch{}o(!1)},[e]);return(0,Cs.useEffect)(()=>{if(!i)return;let l=setTimeout(()=>{a()},500);return()=>clearTimeout(l)},[r,i,a]),{notes:r,setNotes:s,clearNotes:c,isDirty:i,saveNotes:a}}var R5=S(or(),1);function VI(){let{score:t,maxScore:e,turns:r}=wi(),n=(0,R5.useMemo)(()=>{let a=e>0?Math.round(t/e*100):0;return{score:t,maxScore:e,percentage:a,turns:r,roomsVisited:0,roomsDiscovered:0}},[t,e,r]),i=e>0?`${t}/${e}`:String(t),o=`${n.percentage}%`;return{stats:n,scoreText:i,percentageText:o}}var Ns=S(or(),1);var w5={north:{dx:0,dy:-1,dz:0},south:{dx:0,dy:1,dz:0},east:{dx:1,dy:0,dz:0},west:{dx:-1,dy:0,dz:0},northeast:{dx:1,dy:-1,dz:0},northwest:{dx:-1,dy:-1,dz:0},southeast:{dx:1,dy:1,dz:0},southwest:{dx:-1,dy:1,dz:0},up:{dx:0,dy:0,dz:1},down:{dx:0,dy:0,dz:-1},n:{dx:0,dy:-1,dz:0},s:{dx:0,dy:1,dz:0},e:{dx:1,dy:0,dz:0},w:{dx:-1,dy:0,dz:0},ne:{dx:1,dy:-1,dz:0},nw:{dx:-1,dy:-1,dz:0},se:{dx:1,dy:1,dz:0},sw:{dx:-1,dy:1,dz:0},u:{dx:0,dy:0,dz:1},d:{dx:0,dy:0,dz:-1}},ik="sharpee-map-";function Kme(t){try{let e=localStorage.getItem(ik+t);if(e)return JSON.parse(e)}catch{}return null}function Qme(t,e){try{let r={rooms:Array.from(e.rooms.entries()),connections:e.connections};localStorage.setItem(ik+t,JSON.stringify(r))}catch{}}function C5(t){let e=0,r=0,n=0,i=0;for(let o of t.values())e=Math.min(e,o.x),r=Math.max(r,o.x),n=Math.min(n,o.y),i=Math.max(i,o.y);return{minX:e,maxX:r,minY:n,maxY:i}}function YI(t){let{currentRoom:e}=wi(),r=(0,Ns.useRef)(null),[n,i]=(0,Ns.useState)(()=>{let s=Kme(t);if(s){let c=new Map(s.rooms);return{rooms:c,connections:s.connections,currentRoomId:null,currentLevel:0,bounds:C5(c)}}return{rooms:new Map,connections:[],currentRoomId:null,currentLevel:0,bounds:{minX:0,maxX:0,minY:0,maxY:0}}}),o=(0,Ns.useCallback)(s=>s.arrivedFrom||null,[]);(0,Ns.useEffect)(()=>{if(!e)return;let s=r.current,c=o(e);i(l=>{let u=new Map(l.rooms),m=[...l.connections],f=l.currentLevel,g=(O,R,I)=>{for(let w of u.values())if(w.x===O&&w.y===R&&w.z===I)return!0;return!1},h=(O,R,I,w)=>{let N=w5[w]||{dx:0,dy:0,dz:0},G=O+N.dx,k=R+N.dy,pe=I+N.dz;if(!g(G,k,pe))return{x:G,y:k,z:pe};let oe=[];N.dx!==0&&N.dy===0?oe.push({dx:0,dy:-1},{dx:0,dy:1}):N.dx===0&&N.dy!==0?oe.push({dx:1,dy:0},{dx:-1,dy:0}):N.dx!==0&&N.dy!==0&&oe.push({dx:-N.dx,dy:0},{dx:0,dy:-N.dy},{dx:N.dx,dy:0},{dx:0,dy:N.dy});for(let le=1;le<=5;le++){for(let Ml of oe){let en=G+Ml.dx*le,Xs=k+Ml.dy*le;if(!g(en,Xs,pe))return{x:en,y:Xs,z:pe}}let Bi=O+N.dx*(le+1),jn=R+N.dy*(le+1);if(!g(Bi,jn,pe))return{x:Bi,y:jn,z:pe};for(let Ml of oe)for(let en=1;en<=le;en++){let Xs=Bi+Ml.dx*en,kl=jn+Ml.dy*en;if(!g(Xs,kl,pe))return{x:Xs,y:kl,z:pe}}}for(let le=1;le<=10;le++)for(let Bi=-le;Bi<=le;Bi++)for(let jn=-le;jn<=le;jn++)if(!g(O+Bi,R+jn,I))return{x:O+Bi,y:R+jn,z:I};return{x:O+10,y:R,z:I}},y=(O,R,I)=>{let w=["east","south","west","north","southeast","southwest","northeast","northwest"];for(let N of w){let G=w5[N];if(!g(O+G.dx,R+G.dy,I+G.dz))return{x:O+G.dx,y:R+G.dy,z:I+G.dz}}for(let N=2;N<=5;N++)for(let G=-N;G<=N;G++)for(let k=-N;k<=N;k++)if((Math.abs(G)===N||Math.abs(k)===N)&&!g(O+G,R+k,I))return{x:O+G,y:R+k,z:I};return{x:O+10,y:R,z:I}},_=0,v=0,E=0;if(u.has(e.id)){let O=u.get(e.id);_=O.x,v=O.y,E=O.z,f=E}else if(s&&u.has(s.id)&&c){let O=u.get(s.id),R=h(O.x,O.y,O.z,c);_=R.x,v=R.y,E=R.z,f=E}else if(s&&u.has(s.id)){let O=u.get(s.id),R=y(O.x,O.y,O.z);_=R.x,v=R.y,E=R.z,f=E}s&&u.has(s.id)&&!u.has(e.id)&&(m.some(R=>R.fromId===s.id&&R.toId===e.id||R.fromId===e.id&&R.toId===s.id)||m.push({fromId:s.id,toId:e.id,direction:c||"unknown"})),u.set(e.id,{id:e.id,name:e.name,x:_,y:v,z:E,exits:e.exits,visited:!0});let T={rooms:u,connections:m,currentRoomId:e.id,currentLevel:f,bounds:C5(u)};return Qme(t,T),T}),r.current=e},[e,t,o]);let a=(0,Ns.useCallback)(()=>{try{localStorage.removeItem(ik+t)}catch{}i({rooms:new Map,connections:[],currentRoomId:null,currentLevel:0,bounds:{minX:0,maxX:0,minY:0,maxY:0}}),r.current=null},[t]);return{...n,clearMap:a}}var uo=S(or(),1);var Xme={categories:new Set(["movement","manipulation","state","perception","combat","score"]),showSystemEvents:!1},N5=500;function Zme(t){return t.includes("moved")||t.includes("entered")||t.includes("exited")||t.includes("room")||t.includes("going")?"movement":t.includes("taken")||t.includes("dropped")||t.includes("put_")||t.includes("removed")||t.includes("given")||t.includes("thrown")?"manipulation":t.includes("opened")||t.includes("closed")||t.includes("locked")||t.includes("unlocked")||t.includes("switched")||t.includes("worn")||t.includes("eaten")||t.includes("drunk")||t.includes("light")?"state":t.includes("examined")||t.includes("searched")||t.includes("listened")||t.includes("smelled")||t.includes("touched")||t.includes("read")?"perception":t.includes("attack")||t.includes("combat")||t.includes("damage")||t.includes("killed")||t.includes("died")?"combat":t.includes("score")?"score":t.includes("error")||t.includes("failed")?"error":"system"}function Jme(t){switch(t){case"movement":return"\u2192";case"manipulation":return"\u270B";case"state":return"\u2699";case"perception":return"\u{1F441}";case"combat":return"\u2694";case"score":return"\u2605";case"error":return"\u26A0";case"system":return"\u2139"}}function efe(t,e){let r=e&&typeof e=="object"?e:{},n=l=>{let u=r[l];if(typeof u=="string")return u;if(u&&typeof u=="object"&&"name"in u)return String(u.name)},i=n("entityName")||n("name")||n("targetName")||n("itemName"),o=n("direction"),a=n("toRoom")||r.destinationRoom?.name,s=n("fromRoom")||n("from");if(t==="if.event.actor_moved")return o&&a?{text:`Moved ${o} to ${a}`}:a?{text:`Entered ${a}`}:{text:"Moved to a new location"};if(t==="if.event.room_entered")return{text:a?`Arrived at ${a}`:"Entered a room"};if(t==="if.event.taken")return{text:i?`Picked up ${i}`:"Picked up something"};if(t==="if.event.dropped")return{text:i?`Dropped ${i}`:"Dropped something"};if(t==="if.event.put_in"){let l=n("itemName")||n("entityName"),u=n("containerName")||n("targetName");return l&&u?{text:`Put ${l} in ${u}`}:{text:"Put something in a container"}}if(t==="if.event.put_on"){let l=n("itemName")||n("entityName"),u=n("supporterName")||n("targetName");return l&&u?{text:`Put ${l} on ${u}`}:{text:"Put something on a surface"}}if(t==="if.event.removed_from"){let l=n("itemName")||n("entityName"),u=n("containerName")||n("targetName");return l&&u?{text:`Took ${l} from ${u}`}:{text:"Removed something from a container"}}if(t==="if.event.opened")return{text:i?`Opened ${i}`:"Opened something"};if(t==="if.event.closed")return{text:i?`Closed ${i}`:"Closed something"};if(t==="if.event.locked"){let l=n("keyName");return i&&l?{text:`Locked ${i} with ${l}`}:{text:i?`Locked ${i}`:"Locked something"}}if(t==="if.event.unlocked"){let l=n("keyName");return i&&l?{text:`Unlocked ${i} with ${l}`}:{text:i?`Unlocked ${i}`:"Unlocked something"}}if(t==="if.event.switched_on")return{text:i?`Turned on ${i}`:"Turned something on"};if(t==="if.event.switched_off")return{text:i?`Turned off ${i}`:"Turned something off"};if(t==="if.event.examined")return{text:i?`Examined ${i}`:"Looked at something"};if(t==="if.event.searched")return{text:i?`Searched ${i}`:"Searched something"};if(t==="if.event.listened")return{text:i?`Listened to ${i}`:"Listened"};if(t==="if.event.smelled")return{text:i?`Smelled ${i}`:"Smelled the air"};if(t==="if.event.touched")return{text:i?`Touched ${i}`:"Touched something"};if(t==="if.event.read")return{text:i?`Read ${i}`:"Read something"};if(t==="if.event.worn")return{text:i?`Put on ${i}`:"Wore something"};if(t==="if.event.taken_off")return{text:i?`Took off ${i}`:"Removed clothing"};if(t==="if.event.eaten")return{text:i?`Ate ${i}`:"Ate something"};if(t==="if.event.drunk")return{text:i?`Drank ${i}`:"Drank something"};if(t.includes("attack")){let l=n("targetName")||n("victimName"),u=n("weaponName");return l&&u?{text:`Attacked ${l} with ${u}`}:{text:l?`Attacked ${l}`:"Attacked"}}if(t.includes("damage")){let l=r.amount,u=n("targetName");return l&&u?{text:`${u} took ${l} damage`}:{text:"Damage dealt"}}if(t.includes("killed")||t.includes("died")){let l=n("victimName")||n("entityName");return{text:l?`${l} was killed`:"Something died"}}if(t==="game.score_changed"){let l=r.newScore,u=r.points,m=r.reason;if(u!==void 0){let f=u>=0?"+":"",g=m?` for ${m}`:"";return{text:`${f}${u} points${g}`,details:`Total: ${l}`}}return{text:`Score: ${l}`}}if(t.includes("illuminated")||t.includes("light_on"))return{text:"Area is now lit"};if(t.includes("darkened")||t.includes("light_off"))return{text:"Area is now dark"};if(t==="game.started")return{text:"Game started"};if(t==="game.saved")return{text:"Game saved"};if(t==="game.restored")return{text:"Game restored"};let c=t.replace(/^(if\.event\.|game\.|if\.action\.)/,"");return c=c.split(/[._]/).map(l=>l.charAt(0).toUpperCase()+l.slice(1).toLowerCase()).join(" "),{text:c,details:i}}function tfe(t,e){let r=Zme(t.type),n=Jme(r),{text:i,details:o}=efe(t.type,t.data);return{id:`event-${t.turn}-${e}-${Date.now()}`,turn:t.turn,timestamp:Date.now(),type:t.type,category:r,icon:n,text:i,details:o}}function zI(){let t=wi(),[e,r]=(0,uo.useState)([]),[n,i]=(0,uo.useState)(Xme),o=(0,uo.useRef)(new Set);(0,uo.useEffect)(()=>{let u=t.lastTurnEvents;if(u.length===0)return;let m=t.turns;if(o.current.has(m))return;o.current.add(m);let f=u.map((g,h)=>tfe(g,h));r(g=>{let h=[...g,...f];return h.length>N5?h.slice(h.length-N5):h})},[t.lastTurnEvents,t.turns]);let a=e.filter(u=>u.category==="system"&&!n.showSystemEvents?!1:n.categories.has(u.category)),s=(0,uo.useCallback)(u=>{i(m=>{let f=new Set(m.categories);return f.has(u)?f.delete(u):f.add(u),{...m,categories:f}})},[]),c=(0,uo.useCallback)(()=>{i(u=>({...u,showSystemEvents:!u.showSystemEvents}))},[]),l=(0,uo.useCallback)(()=>{r([]),o.current.clear()},[]);return{entries:a,allEntries:e,filter:n,toggleCategory:s,toggleSystemEvents:c,clearHistory:l,totalCount:e.length,filteredCount:a.length}}var Tr=S(ri(),1),k5=S(or(),1);var cl=S(ri(),1);function vg({className:t=""}){let{currentRoom:e,score:r,maxScore:n,turns:i}=wi(),o=e?.name||"Unknown",a=n>0?`${r}/${n}`:String(r);return(0,cl.jsxs)("div",{className:`status-line ${t}`,children:[(0,cl.jsx)("span",{className:"status-location",children:o}),(0,cl.jsxs)("span",{className:"status-right",children:[(0,cl.jsxs)("span",{className:"status-score",children:["Score: ",a]}),(0,cl.jsx)("span",{className:"status-separator",children:" | "}),(0,cl.jsxs)("span",{className:"status-turns",children:["Turns: ",i]})]})]})}var Pu=S(ri(),1);function Eg({className:t=""}){let{entries:e,containerRef:r}=FI();return(0,Pu.jsx)("div",{className:`transcript ${t}`,ref:r,children:e.map(n=>(0,Pu.jsxs)("div",{className:"transcript-entry",children:[n.command&&(0,Pu.jsxs)("div",{className:"transcript-command",children:[(0,Pu.jsx)("span",{className:"transcript-prompt",children:"> "}),n.command]}),(0,Pu.jsx)("div",{className:"transcript-text",dangerouslySetInnerHTML:{__html:rfe(n.text)}})]},n.id))})}function rfe(t){return t.split(/\n\n+/).map(r=>`<p>${r.split(`
`).join("<br>")}</p>`).join("")}var Tg=S(ri(),1),Lu=S(or(),1);function _g({className:t="",placeholder:e="",autoFocus:r=!0}){let{executeCommand:n,state:i}=yg(),{value:o,setValue:a,addToHistory:s,handleKeyDown:c}=qI(),l=(0,Lu.useRef)(null);(0,Lu.useEffect)(()=>{r&&l.current&&l.current.focus()},[r,i.turns]);let u=(0,Lu.useCallback)(async f=>{f.preventDefault();let g=o.trim();g&&(s(g),await n(g))},[o,s,n]),m=(0,Lu.useCallback)(f=>{a(f.target.value)},[a]);return(0,Tg.jsxs)("form",{className:`command-input-form ${t}`,onSubmit:u,children:[(0,Tg.jsx)("span",{className:"command-prompt",children:">"}),(0,Tg.jsx)("input",{ref:l,type:"text",className:"command-input",value:o,onChange:m,onKeyDown:c,placeholder:e,autoComplete:"off",autoCapitalize:"none",autoCorrect:"off",spellCheck:!1,disabled:!i.isPlaying})]})}var ll=S(ri(),1),D5=S(or(),1);function bg({tabs:t,defaultTab:e,className:r=""}){let[n,i]=(0,D5.useState)(e||t[0]?.id||""),o=t.find(a=>a.id===n);return(0,ll.jsxs)("div",{className:`tab-panel ${r}`,children:[(0,ll.jsx)("div",{className:"tab-panel__header",children:t.map(a=>(0,ll.jsxs)("button",{className:`tab-panel__tab ${n===a.id?"tab-panel__tab--active":""}`,onClick:()=>i(a.id),type:"button",children:[a.icon&&(0,ll.jsx)("span",{className:"tab-panel__icon",children:a.icon}),(0,ll.jsx)("span",{className:"tab-panel__label",children:a.label})]},a.id))}),(0,ll.jsx)("div",{className:"tab-panel__content",children:o?.content})]})}var Ds=S(ri(),1),ok=S(or(),1);function Og({storyId:t="default",className:e="",placeholder:r=`Type your notes here...

Hints, puzzle solutions, map sketches...`}){let{notes:n,setNotes:i,clearNotes:o,isDirty:a}=GI(t),s=(0,ok.useCallback)(l=>{i(l.target.value)},[i]),c=(0,ok.useCallback)(()=>{window.confirm("Clear all notes? This cannot be undone.")&&o()},[o]);return(0,Ds.jsxs)("div",{className:`notes-panel ${e}`,children:[(0,Ds.jsxs)("div",{className:"notes-panel__header",children:[(0,Ds.jsx)("span",{className:"notes-panel__title",children:"Notes"}),(0,Ds.jsx)("span",{className:"notes-panel__status",children:a?"Saving...":"Saved"})]}),(0,Ds.jsx)("textarea",{className:"notes-panel__textarea",value:n,onChange:s,placeholder:r,spellCheck:!1}),(0,Ds.jsx)("div",{className:"notes-panel__footer",children:(0,Ds.jsx)("button",{type:"button",className:"notes-panel__clear",onClick:c,disabled:!n,children:"Clear Notes"})})]})}var ht=S(ri(),1);function Ig({className:t=""}){let{stats:e,scoreText:r,percentageText:n}=VI();return(0,ht.jsxs)("div",{className:`progress-panel ${t}`,children:[(0,ht.jsxs)("div",{className:"progress-panel__section",children:[(0,ht.jsx)("h3",{className:"progress-panel__heading",children:"Score"}),(0,ht.jsxs)("div",{className:"progress-panel__score",children:[(0,ht.jsx)("span",{className:"progress-panel__score-value",children:r}),(0,ht.jsxs)("span",{className:"progress-panel__score-percent",children:["(",n,")"]})]}),(0,ht.jsx)("div",{className:"progress-panel__bar",children:(0,ht.jsx)("div",{className:"progress-panel__bar-fill",style:{width:`${e.percentage}%`}})})]}),(0,ht.jsxs)("div",{className:"progress-panel__section",children:[(0,ht.jsx)("h3",{className:"progress-panel__heading",children:"Statistics"}),(0,ht.jsxs)("dl",{className:"progress-panel__stats",children:[(0,ht.jsxs)("div",{className:"progress-panel__stat",children:[(0,ht.jsx)("dt",{children:"Turns"}),(0,ht.jsx)("dd",{children:e.turns})]}),e.roomsVisited>0&&(0,ht.jsxs)("div",{className:"progress-panel__stat",children:[(0,ht.jsx)("dt",{children:"Rooms Visited"}),(0,ht.jsx)("dd",{children:e.roomsVisited})]}),e.roomsDiscovered>0&&(0,ht.jsxs)("div",{className:"progress-panel__stat",children:[(0,ht.jsx)("dt",{children:"Rooms Discovered"}),(0,ht.jsx)("dd",{children:e.roomsDiscovered})]})]})]})]})}var Ne=S(ri(),1),Er=S(or(),1);var Sg=80,$I=32,P5=100,L5=52,KI=20;function QI(t,e,r){let n=(t-r.minX)*P5+KI+Sg/2,i=(e-r.minY)*L5+KI+$I/2;return{svgX:n,svgY:i}}function nfe({room:t,bounds:e,isCurrent:r}){let{svgX:n,svgY:i}=QI(t.x,t.y,e),o=n-Sg/2,a=i-$I/2,s=t.name.length>12?t.name.substring(0,10)+"...":t.name;return(0,Ne.jsxs)("g",{className:`map-room ${r?"map-room--current":""}`,children:[(0,Ne.jsx)("rect",{x:o,y:a,width:Sg,height:$I,rx:4,className:"map-room__box"}),(0,Ne.jsx)("text",{x:n,y:i,className:"map-room__name",textAnchor:"middle",dy:"0.35em",children:s}),t.z!==0&&(0,Ne.jsx)("text",{x:o+Sg-4,y:a+10,className:"map-room__level",textAnchor:"end",fontSize:"10",children:t.z>0?`\u2191${t.z}`:`\u2193${Math.abs(t.z)}`})]})}function ife({connection:t,rooms:e,bounds:r}){let n=e.get(t.fromId),i=e.get(t.toId);if(!n||!i||n.z!==i.z)return null;let o=QI(n.x,n.y,r),a=QI(i.x,i.y,r);return(0,Ne.jsx)("line",{x1:o.svgX,y1:o.svgY,x2:a.svgX,y2:a.svgY,className:"map-connection"})}function ofe({room:t,bounds:e,connections:r}){let{svgX:n,svgY:i}=QI(t.x,t.y,e),o=new Set(r.filter(c=>c.fromId===t.id||c.toId===t.id).map(c=>c.direction)),a=15,s={north:-90,south:90,east:0,west:180,northeast:-45,northwest:-135,southeast:45,southwest:135,n:-90,s:90,e:0,w:180,ne:-45,nw:-135,se:45,sw:135};return(0,Ne.jsx)(Ne.Fragment,{children:t.exits.filter(c=>{let l=c.direction.toLowerCase();return l==="up"||l==="down"||l==="u"||l==="d"?!1:!o.has(l)}).map(c=>{let l=c.direction.toLowerCase(),u=s[l];if(u===void 0)return null;let m=u*Math.PI/180,f=n+Sg/2*Math.cos(m),g=i+$I/2*Math.sin(m),h=f+a*Math.cos(m),y=g+a*Math.sin(m);return(0,Ne.jsxs)("g",{className:"map-exit-stub",children:[(0,Ne.jsx)("line",{x1:f,y1:g,x2:h,y2:y}),(0,Ne.jsx)("circle",{cx:h,cy:y,r:3})]},`${t.id}-${l}`)})})}function Ag({storyId:t,className:e=""}){let{rooms:r,connections:n,currentRoomId:i,bounds:o,clearMap:a}=YI(t),[s,c]=(0,Er.useState)(1),[l,u]=(0,Er.useState)({x:0,y:0}),m=(0,Er.useRef)(null),f=(0,Er.useRef)(!1),g=(0,Er.useRef)({x:0,y:0}),{width:h,height:y}=(0,Er.useMemo)(()=>{let I=(o.maxX-o.minX+1)*P5+KI*2,w=(o.maxY-o.minY+1)*L5+KI*2;return{width:Math.max(I,200),height:Math.max(w,150)}},[o]),_=(0,Er.useMemo)(()=>Array.from(r.values()),[r]),v=(0,Er.useCallback)(I=>{f.current=!0,g.current={x:I.clientX,y:I.clientY}},[]),E=(0,Er.useCallback)(I=>{if(!f.current)return;let w=I.clientX-g.current.x,N=I.clientY-g.current.y;u(G=>({x:G.x+w,y:G.y+N})),g.current={x:I.clientX,y:I.clientY}},[]),T=(0,Er.useCallback)(()=>{f.current=!1},[]),O=(0,Er.useCallback)(I=>{I.preventDefault();let w=I.deltaY>0?.9:1.1;c(N=>Math.max(.5,Math.min(3,N*w)))},[]),R=(0,Er.useCallback)(()=>{c(1),u({x:0,y:0})},[]);return r.size===0?(0,Ne.jsx)("div",{className:`map-panel map-panel--empty ${e}`,children:(0,Ne.jsx)("p",{className:"map-panel__empty-message",children:"No rooms explored yet. Move around to build your map!"})}):(0,Ne.jsxs)("div",{className:`map-panel ${e}`,children:[(0,Ne.jsxs)("div",{className:"map-panel__controls",children:[(0,Ne.jsxs)("div",{className:"map-panel__zoom-controls",children:[(0,Ne.jsx)("button",{type:"button",onClick:()=>c(I=>Math.min(3,I*1.2)),children:"+"}),(0,Ne.jsx)("button",{type:"button",onClick:()=>c(I=>Math.max(.5,I/1.2)),children:"\u2212"}),(0,Ne.jsx)("button",{type:"button",onClick:R,children:"\u27F2"})]}),(0,Ne.jsx)("button",{type:"button",className:"map-panel__clear",onClick:a,children:"Clear"})]}),(0,Ne.jsx)("div",{className:"map-panel__canvas",children:(0,Ne.jsx)("svg",{ref:m,className:"map-panel__svg",width:h,height:y,viewBox:`0 0 ${h} ${y}`,onMouseDown:v,onMouseMove:E,onMouseUp:T,onMouseLeave:T,onWheel:O,children:(0,Ne.jsxs)("g",{transform:`translate(${l.x}, ${l.y}) scale(${s})`,children:[n.map((I,w)=>(0,Ne.jsx)(ife,{connection:I,rooms:r,bounds:o},`${I.fromId}-${I.toId}-${w}`)),_.map(I=>(0,Ne.jsx)(ofe,{room:I,bounds:o,connections:n},`stubs-${I.id}`)),_.map(I=>(0,Ne.jsx)(nfe,{room:I,bounds:o,isCurrent:I.id===i},I.id))]})})}),(0,Ne.jsxs)("div",{className:"map-panel__legend",children:[(0,Ne.jsx)("span",{className:"map-panel__legend-item map-panel__legend-item--current",children:"\u25CF Current"}),(0,Ne.jsx)("span",{className:"map-panel__legend-item map-panel__legend-item--visited",children:"\u25CB Visited"}),(0,Ne.jsx)("span",{className:"map-panel__legend-item map-panel__legend-item--unexplored",children:"\u25E6 Unexplored"})]})]})}var At=S(ri(),1),Rg=S(or(),1);function M5({category:t,icon:e,label:r,active:n,onClick:i}){return(0,At.jsxs)("button",{className:`commentary-filter__btn ${n?"commentary-filter__btn--active":""}`,onClick:i,title:r,"aria-pressed":n,children:[(0,At.jsx)("span",{className:"commentary-filter__icon",children:e}),(0,At.jsx)("span",{className:"commentary-filter__label",children:r})]})}function afe({entry:t}){return(0,At.jsxs)("div",{className:`commentary-entry commentary-entry--${t.category}`,children:[(0,At.jsx)("span",{className:"commentary-entry__icon",title:t.category,children:t.icon}),(0,At.jsxs)("span",{className:"commentary-entry__turn",children:["T",t.turn]}),(0,At.jsx)("span",{className:"commentary-entry__text",children:t.text}),t.details&&(0,At.jsx)("span",{className:"commentary-entry__details",children:t.details})]})}function wg({className:t="",autoScroll:e=!0}){let{entries:r,filter:n,toggleCategory:i,toggleSystemEvents:o,totalCount:a,filteredCount:s}=zI(),c=(0,Rg.useRef)(null),l=(0,Rg.useRef)(!0),u=()=>{if(!c.current)return;let{scrollTop:f,scrollHeight:g,clientHeight:h}=c.current;l.current=g-f-h<10};(0,Rg.useEffect)(()=>{e&&l.current&&c.current&&(c.current.scrollTop=c.current.scrollHeight)},[r,e]);let m=[{category:"movement",icon:"\u2192",label:"Movement"},{category:"manipulation",icon:"\u270B",label:"Items"},{category:"state",icon:"\u2699",label:"State"},{category:"perception",icon:"\u{1F441}",label:"Look"},{category:"combat",icon:"\u2694",label:"Combat"},{category:"score",icon:"\u2605",label:"Score"}];return(0,At.jsxs)("div",{className:`commentary-panel ${t}`,children:[(0,At.jsxs)("div",{className:"commentary-filter",children:[m.map(({category:f,icon:g,label:h})=>(0,At.jsx)(M5,{category:f,icon:g,label:h,active:n.categories.has(f),onClick:()=>i(f)},f)),(0,At.jsx)(M5,{category:"system",icon:"\u2139",label:"System",active:n.showSystemEvents,onClick:o})]}),(0,At.jsx)("div",{className:"commentary-status",children:s<a?(0,At.jsxs)("span",{children:["Showing ",s," of ",a," events"]}):(0,At.jsxs)("span",{children:[a," events"]})}),(0,At.jsx)("div",{className:"commentary-log",ref:c,onScroll:u,children:r.length===0?(0,At.jsx)("div",{className:"commentary-empty",children:"No events yet. Start playing to see game events here."}):r.map(f=>(0,At.jsx)(afe,{entry:f},f.id))})]})}function XI({sidePanel:t,storyId:e="default",className:r="",showSidePanel:n=!0}){let i=(0,k5.useMemo)(()=>[{id:"map",label:"Map",content:(0,Tr.jsx)(Ag,{storyId:e})},{id:"commentary",label:"Events",content:(0,Tr.jsx)(wg,{})},{id:"notes",label:"Notes",content:(0,Tr.jsx)(Og,{storyId:e})},{id:"progress",label:"Progress",content:(0,Tr.jsx)(Ig,{})}],[e]),o=t??(0,Tr.jsx)(bg,{tabs:i,defaultTab:"map"});return(0,Tr.jsxs)("div",{className:`game-shell ${r}`,children:[(0,Tr.jsx)(vg,{className:"game-shell__status"}),(0,Tr.jsxs)("div",{className:"game-shell__content",children:[(0,Tr.jsxs)("div",{className:`game-shell__main ${n?"":"game-shell__main--full"}`,children:[(0,Tr.jsx)("div",{className:"game-shell__transcript-container",children:(0,Tr.jsx)(Eg,{className:"game-shell__transcript"})}),(0,Tr.jsx)("div",{className:"game-shell__input-container",children:(0,Tr.jsx)(_g,{className:"game-shell__input"})})]}),n&&(0,Tr.jsx)("div",{className:"game-shell__sidebar",children:o})]})]})}var f8=S(so());var Se=S(b());var x5=S(b()),B5=S(so()),j5=[{threshold:0,messageId:"dungeo.rank.beginner",name:"Beginner"},{threshold:25,messageId:"dungeo.rank.amateur",name:"Amateur Adventurer"},{threshold:50,messageId:"dungeo.rank.novice",name:"Novice Adventurer"},{threshold:100,messageId:"dungeo.rank.junior",name:"Junior Adventurer"},{threshold:200,messageId:"dungeo.rank.adventurer",name:"Adventurer"},{threshold:300,messageId:"dungeo.rank.master",name:"Master"},{threshold:400,messageId:"dungeo.rank.wizard",name:"Wizard"},{threshold:500,messageId:"dungeo.rank.master_adventurer",name:"Master Adventurer"}],Cg=class extends B5.ScoringService{constructor(e){let r={maxScore:616,enabled:!0,ranks:j5};super(e,r)}scoreTreasureTake(e,r){let n=this.getScoringData();return!n||(n.takenTreasures||(n.takenTreasures=[]),n.takenTreasures.includes(e))?!1:(n.takenTreasures.push(e),this.addPoints(r,`Took ${e}`),!0)}isTreasureTakeScored(e){return this.getScoringData()?.takenTreasures?.includes(e)??!1}scoreTreasureCase(e,r){let n=this.getScoringData();return!n||(n.scoredTreasures||(n.scoredTreasures=[]),n.scoredTreasures.includes(e))?!1:(n.scoredTreasures.push(e),this.addPoints(r,`Placed ${e} in trophy case`),!0)}isTreasureCaseScored(e){return this.getScoringData()?.scoredTreasures?.includes(e)??!1}scoreTreasure(e,r){return this.scoreTreasureCase(e,r)}isTreasureScored(e){return this.isTreasureCaseScored(e)}addAchievement(e,r){let n=this.getScoringData();return!n||(n.achievements||(n.achievements=[]),n.achievements.includes(e))?!1:(n.achievements.push(e),this.addPoints(r,e),!0)}hasAchievement(e){return this.getScoringData()?.achievements?.includes(e)??!1}isThiefDead(){return this.getScoringData()?.thiefDead??!1}isRealityAlteredPending(){return this.getScoringData()?.realityAlteredPending??!1}clearRealityAlteredPending(){let e=this.getScoringData();e&&(e.realityAlteredPending=!1)}getRank(){let e=this.getScore(),r=this.getScoringData();return e>=500&&r?.thiefDead&&this.hasAchievement("canvas-revealed")?"Master of Secrets":super.getRank()}getRankMessageId(){let e=this.getScore(),r=this.getScoringData();return e>=500&&r?.thiefDead&&this.hasAchievement("canvas-revealed")?"dungeo.rank.master_secrets":super.getRankMessageId()}getScoringData(){return this.world.getCapability(x5.StandardCapabilities.SCORING)??null}};var Qs=S(so());var W5={active:!1,immortal:!1,verbose:!1,trollDisabled:!1,thiefDisabled:!1,cyclopsDisabled:!1},ak="gdt",oa="dungeo.action.gdt",Vr="dungeo.action.gdt_command";var Ng={ENTERED:"dungeo.gdt.entered",EXITED:"dungeo.gdt.exited",OUTPUT:"dungeo.gdt.output",UNKNOWN_COMMAND:"dungeo.gdt.unknown_command"};var Dg=S(b());function ul(t){let e=t.getStateValue(ak);return{...W5,...e}}function ZI(t,e){t.setStateValue(ak,e)}function Pg(t){return ul(t).active}function sk(t){let e=t.getPlayer();if(!e)throw new Error("No player entity found");let r=ul(t),n=new Dg.AuthorModel(t.getDataStore(),t);return{world:t,player:e,flags:r,findEntity(i){let o=t.getEntity(i);if(o)return o;let a=i.toLowerCase();for(let s of t.getAllEntities()){let c=s.get("identity");if(c?.name?.toLowerCase()===a)return s;if(c?.aliases){for(let l of c.aliases)if(l.toLowerCase()===a)return s}}},findRoom(i){let o=this.findEntity(i);if(o&&o.has("room"))return o},listRooms(){return t.getAllEntities().filter(i=>i.has("room"))},listObjects(){return t.getAllEntities().filter(i=>i.type===Dg.EntityType.OBJECT||i.type===Dg.EntityType.CONTAINER)},getPlayerLocation(){let i=t.getLocation(e.id);if(i)return t.getEntity(i)},getInventory(){return t.getContents(e.id)},setFlag(i,o){let a=ul(t);a[i]=o,ZI(t,a),this.flags[i]=o},teleportPlayer(i){let o=this.findRoom(i);return o?(n.moveEntity(e.id,o.id),!0):!1},moveObject(i,o){let a=this.findEntity(i);if(!a)return!1;let s=o==="player"||o==="inventory"?e.id:o;return!this.findEntity(s)&&s!==e.id?!1:(n.moveEntity(a.id,s),!0)}}}var sfe=new Set(["DA","DR","DO","DE","DC","DX","DH","DL","DV","DF","DS","DN","DM","DT","DP","D2","DZ","AH","AO","AR","AF","AC","AA","AX","AV","AN","AZ","NC","ND","NR","NT","RC","RD","RR","RT","TK","PD","HE","EX","PZ","TQ","KL","KO","WU","FO"]);function ck(t){let e=t.trim();if(!e)return null;let r=e.match(/^([A-Za-z]{2})(?:\s+(.*))?$/);if(!r)return null;let n=r[1].toUpperCase();if(!sfe.has(n))return null;let o=(r[2]||"").split(/\s+/).filter(Boolean);return{code:n,args:o,raw:e}}var lk={code:"HE",name:"Help",description:"Display list of GDT commands",execute(t,e){return{success:!0,output:["GDT COMMANDS:","","DISPLAY:","  DA  Display Adventurer    - Show player state","  DR  Display Room          - Show room properties","  DO  Display Object        - Show object properties","  DE  Describe Entity       - Full entity inspection","  DS  Display State         - Show game state","  DX  Display Exits         - Show room exits","  DC  Display Clock         - Show timer events","  DV  Display Villains      - Show NPC state","  DF  Display Flags         - Show game flags","","ALTER:","  AH  Alter Here            - Teleport to room","  AO  Alter Object          - Move object","  AF  Alter Flags           - Set game flag","","TOGGLE:","  ND  No Deaths             - Toggle immortality","  NT  No Troll              - Disable troll","  NR  No Robber             - Disable thief","  NC  No Cyclops            - Disable cyclops","  RD  Restore Deaths        - Enable deaths","  RT  Restore Troll         - Enable troll","  RR  Restore Robber        - Enable thief","  RC  Restore Cyclops       - Enable cyclops","","UTILITY:","  TK  Take                  - Acquire any object","  HE  Help                  - This message","  EX  Exit                  - Return to game"]}}};var uk={code:"EX",name:"Exit",description:"Exit GDT and return to game",execute(t,e){return t.setFlag("active",!1),{success:!0,output:["Returning to game."]}}};var H5=S(b()),dk={code:"DA",name:"Display Adventurer",description:"Show player state (location, score, inventory)",execute(t,e){let{world:r,player:n}=t,i=[];i.push("=== ADVENTURER ==="),i.push(""),i.push(`ID: ${n.id}`);let o=t.getPlayerLocation();if(o){let m=o.get("identity");i.push(`Location: ${m?.name??o.id} (${o.id})`)}else i.push("Location: <none>");let a=r.getCapability(H5.StandardCapabilities.SCORING),s=a?.scoreValue??0,c=a?.maxScore??0,l=a?.moves??0;i.push(`Score: ${s}/${c}`),i.push(`Moves: ${l}`);let u=t.getInventory();if(i.push(""),i.push("Inventory:"),u.length===0)i.push("  <empty>");else for(let m of u){let f=m.get("identity");i.push(`  - ${f?.name??m.id} (${m.id})`)}return i.push(""),i.push("GDT Flags:"),i.push(`  Immortal: ${t.flags.immortal?"YES":"no"}`),i.push(`  Troll disabled: ${t.flags.trollDisabled?"YES":"no"}`),i.push(`  Thief disabled: ${t.flags.thiefDisabled?"YES":"no"}`),i.push(`  Cyclops disabled: ${t.flags.cyclopsDisabled?"YES":"no"}`),{success:!0,output:i}}};var mk={code:"DR",name:"Display Room",description:"Show room properties (DR [room-id])",execute(t,e){let r=[],n;if(e.length>0){if(n=t.findRoom(e[0]),!n)return{success:!1,output:[`Room not found: ${e[0]}`],error:"NOT_FOUND"}}else if(n=t.getPlayerLocation(),!n)return{success:!1,output:["Player has no location"],error:"NO_LOCATION"};let i=n.get("identity"),o=n.get("room");if(r.push("=== ROOM ==="),r.push(""),r.push(`ID: ${n.id}`),r.push(`Name: ${i?.name??"<unnamed>"}`),o&&(r.push(""),r.push("Properties:"),r.push(`  Visited: ${o.visited?"yes":"no"}`),r.push(`  Dark: ${o.isDark?"YES":"no"}`),r.push(`  Outdoors: ${o.isOutdoors?"yes":"no"}`),r.push(`  Underground: ${o.isUnderground?"yes":"no"}`),o.region&&r.push(`  Region: ${o.region}`),o.tags&&o.tags.length>0&&r.push(`  Tags: ${o.tags.join(", ")}`)),r.push(""),r.push("Exits:"),o?.exits){let s=Object.entries(o.exits);if(s.length===0)r.push("  <none>");else for(let[c,l]of s){let u=t.findRoom(l.destination),m=u?u.get("identity")?.name??l.destination:l.destination,f=`  ${c.toUpperCase()}: ${m}`;l.via&&(f+=` (via ${l.via})`),r.push(f)}}else r.push("  <none>");let a=t.world.getContents(n.id);if(r.push(""),r.push("Contents:"),a.length===0)r.push("  <empty>");else for(let s of a){let c=s.get("identity"),l=Array.from(s.traits.keys()).filter(m=>m!=="identity"),u=l.length>0?` [${l.join(", ")}]`:"";r.push(`  - ${c?.name??s.id} (${s.id})${u}`)}return{success:!0,output:r}}};var fk={code:"DO",name:"Display Object",description:"Show object properties (DO <object-id>)",execute(t,e){let r=[];if(e.length===0)return{success:!1,output:["Usage: DO <object-id or name>"],error:"MISSING_ARG"};let n=t.findEntity(e.join(" "));if(!n)return{success:!1,output:[`Object not found: ${e.join(" ")}`],error:"NOT_FOUND"};let i=n.get("identity");r.push("=== OBJECT ==="),r.push(""),r.push(`ID: ${n.id}`),r.push(`Type: ${n.type}`),r.push(`Name: ${i?.name??"<unnamed>"}`),i?.aliases&&i.aliases.length>0&&r.push(`Aliases: ${i.aliases.join(", ")}`);let o=t.world.getLocation(n.id);if(o){let s=t.findEntity(o),c=s?s.get("identity")?.name??o:o;r.push(`Location: ${c} (${o})`)}else r.push("Location: <nowhere>");(i?.weight!==void 0||i?.volume!==void 0)&&(r.push(""),r.push("Physical:"),i.weight!==void 0&&r.push(`  Weight: ${i.weight}`),i.volume!==void 0&&r.push(`  Volume: ${i.volume}`)),r.push(""),r.push("Traits:");let a=Array.from(n.traits.keys());if(a.length===0)r.push("  <none>");else for(let s of a){let c=n.get(s);if(!c)continue;let l=cfe(s,c);l?r.push(`  ${s}: ${l}`):r.push(`  ${s}`)}if(n.has("container")||n.has("supporter")||n.has("room")){let s=t.world.getContents(n.id);if(r.push(""),r.push("Contents:"),s.length===0)r.push("  <empty>");else for(let c of s){let l=c.get("identity");r.push(`  - ${l?.name??c.id} (${c.id})`)}}return{success:!0,output:r}}};function cfe(t,e){switch(t){case"identity":return null;case"openable":return`isOpen=${e.isOpen}`;case"lockable":return`isLocked=${e.isLocked}, keyId=${e.keyId??"none"}`;case"switchable":return`isOn=${e.isOn}`;case"lightSource":return`lit=${e.lit}, brightness=${e.brightness??"default"}`;case"container":return`capacity=${e.capacity??"unlimited"}, transparent=${e.isTransparent}`;case"edible":return`portions=${e.portions??1}`;case"readable":return`text="${(e.text??"").substring(0,30)}${(e.text?.length??0)>30?"...":""}"`;case"wearable":case"clothing":return`worn=${e.worn}`;case"door":return`connects=${e.room1??"?"}<->${e.room2??"?"}`;case"scenery":return"fixed";case"room":return`visited=${e.visited}, dark=${e.isDark}`;default:return null}}var mo=S(b()),pk={code:"DE",name:"Describe Entity",description:"Full entity inspection (DE <entity-id or name>)",execute(t,e){let r=[];if(e.length===0)return{success:!1,output:["Usage: DE <entity-id or name>"],error:"MISSING_ARG"};let n=t.findEntity(e.join(" "));if(!n)return{success:!1,output:[`Entity not found: ${e.join(" ")}`],error:"NOT_FOUND"};r.push("\u2554\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2557"),r.push(`\u2551 ENTITY: ${n.id.padEnd(53)} \u2551`),r.push("\u255A\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u255D"),r.push(""),r.push("\u250C\u2500 BASIC INFO \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510"),r.push(`\u2502 ID:   ${n.id}`),r.push(`\u2502 Type: ${n.type}`);let i=n.get("identity");i&&(r.push(`\u2502 Name: ${i.name??"<unnamed>"}`),i.aliases?.length>0&&r.push(`\u2502 Aliases: ${i.aliases.join(", ")}`),i.article&&r.push(`\u2502 Article: "${i.article}"`)),r.push("\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518"),r.push(""),r.push("\u250C\u2500 LOCATION \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510");let o=t.world.getLocation(n.id);if(o){let g=t.findEntity(o)?.get("identity");r.push(`\u2502 In: ${g?.name??o} (${o})`)}else r.push("\u2502 In: <nowhere>");r.push("\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518"),r.push(""),r.push("\u250C\u2500 COMPUTED PROPERTIES \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510");let a=[["enterable",n.enterable],["portable",n.portable],["isOpen",n.isOpen],["isLocked",n.isLocked],["isOn",n.isOn],["isSwitchable",n.isSwitchable],["isInflated",n.isInflated],["isTreasure",n.isTreasure]];for(let[f,g]of a)g!==void 0&&r.push(`\u2502 ${f}: ${g}`);r.push("\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518"),r.push(""),r.push("\u250C\u2500 TRAITS \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510");let s=Array.from(n.traits.keys());if(s.length===0)r.push("\u2502 <none>");else for(let f of s){let g=n.get(f);if(!g)continue;r.push("\u2502"),r.push(`\u2502 \u25B8 ${f.toUpperCase()}`);let h=Object.entries(g).filter(([y])=>!y.startsWith("_"));if(h.length>0)for(let[y,_]of h){let v=Wm(_);r.push(`\u2502   ${y}: ${v}`)}}r.push("\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518"),r.push(""),r.push("\u250C\u2500 TRAIT TYPE CHECKS \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510");let c=[["ENTERABLE",n.has(mo.TraitType.ENTERABLE)],["VEHICLE",n.has(mo.TraitType.VEHICLE)],["CONTAINER",n.has(mo.TraitType.CONTAINER)],["SUPPORTER",n.has(mo.TraitType.SUPPORTER)],["OPENABLE",n.has(mo.TraitType.OPENABLE)],["LOCKABLE",n.has(mo.TraitType.LOCKABLE)],["SWITCHABLE",n.has(mo.TraitType.SWITCHABLE)],["LIGHT_SOURCE",n.has(mo.TraitType.LIGHT_SOURCE)],["SCENERY",n.has(mo.TraitType.SCENERY)]],l=c.filter(([f,g])=>g),u=c.filter(([f,g])=>!g);r.push(`\u2502 Present: ${l.map(([f])=>f).join(", ")||"<none>"}`),r.push(`\u2502 Absent:  ${u.map(([f])=>f).join(", ")}`),r.push("\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518"),r.push(""),r.push("\u250C\u2500 ATTRIBUTES \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510");let m=Object.entries(n.attributes||{});if(m.length===0)r.push("\u2502 <none>");else for(let[f,g]of m)r.push(`\u2502 ${f}: ${Wm(g)}`);if(r.push("\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518"),r.push(""),n.has("container")||n.has("supporter")||n.has("room")||n.has(mo.TraitType.VEHICLE)){r.push("\u250C\u2500 CONTENTS \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510");let f=t.world.getContents(n.id);if(f.length===0)r.push("\u2502 <empty>");else for(let g of f){let h=g.get("identity");r.push(`\u2502 \u2022 ${h?.name??g.id} (${g.id})`)}r.push("\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518")}return{success:!0,output:r}}};function Wm(t){if(t===null)return"null";if(t===void 0)return"undefined";if(typeof t=="string")return`"${t}"`;if(typeof t=="boolean")return t?"true":"false";if(typeof t=="number")return String(t);if(Array.isArray(t))return t.length===0?"[]":t.length<=5?`[${t.map(e=>Wm(e)).join(", ")}]`:`[${t.slice(0,3).map(e=>Wm(e)).join(", ")}, ... (${t.length} items)]`;if(typeof t=="object"){let e=Object.keys(t);return e.length===0?"{}":e.length<=3?`{${e.map(r=>`${r}: ${Wm(t[r])}`).join(", ")}}`:`{${e.slice(0,2).map(r=>`${r}: ${Wm(t[r])}`).join(", ")}, ... (${e.length} keys)}`}return String(t)}var U5=S(b()),gk={code:"DS",name:"Display State",description:"Show game state (turn count, score, phase)",execute(t,e){let{world:r}=t,n=[];n.push("=== GAME STATE ==="),n.push("");let i=r.getCapability(U5.StandardCapabilities.SCORING),o=i?.scoreValue??0,a=i?.maxScore??0,s=i?.moves??r.getStateValue("moves")??0,c=r.getStateValue("turnCount")??s;n.push(`Turn: ${c}`),n.push(`Moves: ${s}`),n.push(`Score: ${o}/${a}`);let l=r.getStateValue("gamePhase")??"playing",u=r.getStateValue("gameOver")??!1;n.push(""),n.push(`Phase: ${l}`),n.push(`Game Over: ${u?"YES":"no"}`),n.push(""),n.push("Story State:");let m=["lampTurns","candleTurns","thirstLevel","hungerLevel","trollState","thiefState","cyclopsState","damGateOpen","loudRoomState","coalMineState","volcanoState"],f=!1;for(let _ of m){let v=r.getStateValue(_);v!==void 0&&(n.push(`  ${_}: ${JSON.stringify(v)}`),f=!0)}f||n.push("  <no story-specific flags set>"),n.push(""),n.push("Entity Counts:");let g=t.listRooms(),h=t.listObjects(),y=r.getAllEntities();return n.push(`  Rooms: ${g.length}`),n.push(`  Objects: ${h.length}`),n.push(`  Total entities: ${y.length}`),n.push(""),n.push("GDT Flags:"),n.push(`  Immortal: ${t.flags.immortal?"YES":"no"}`),n.push(`  Troll disabled: ${t.flags.trollDisabled?"YES":"no"}`),n.push(`  Thief disabled: ${t.flags.thiefDisabled?"YES":"no"}`),n.push(`  Cyclops disabled: ${t.flags.cyclopsDisabled?"YES":"no"}`),{success:!0,output:n}}};var hk={code:"DX",name:"Display Exits",description:"Show room exits in detail (DX [room-id])",execute(t,e){let r=[],n;if(e.length>0){if(n=t.findRoom(e[0]),!n)return{success:!1,output:[`Room not found: ${e[0]}`],error:"NOT_FOUND"}}else if(n=t.getPlayerLocation(),!n)return{success:!1,output:["Player has no location"],error:"NO_LOCATION"};let i=n.get("identity"),o=n.get("room");r.push("=== EXITS ==="),r.push(""),r.push(`Room: ${i?.name??n.id} (${n.id})`),r.push("");let a=["NORTH","SOUTH","EAST","WEST","NORTHEAST","NORTHWEST","SOUTHEAST","SOUTHWEST","UP","DOWN","IN","OUT"],s=o?.exits??{},c=o?.blockedExits??{};for(let u of a){let m=s[u],f=c[u];if(m){let y=t.findRoom(m.destination)?.get("identity")?.name??m.destination,_=`  ${u.padEnd(10)} -> ${y} (${m.destination})`;if(m.via){let v=t.findEntity(m.via),T=v?.get("identity")?.name??m.via;if(_+=` [via: ${T}]`,v){let O=v.get("openable"),R=v.get("lockable");O&&(_+=O.isOpen?" (open)":" (closed)"),R?.isLocked&&(_+=" (LOCKED)")}}r.push(_)}else f&&r.push(`  ${u.padEnd(10)} -> BLOCKED: ${f}`)}let l=Object.keys(s).length;return r.push(""),r.push(`Total exits: ${l}`),{success:!0,output:r}}};var yk={code:"AH",name:"Alter Here",description:"Teleport player to room (AH <room-id>)",execute(t,e){if(e.length===0){let a=t.listRooms(),s=["Usage: AH <room-id>","","Available rooms:"],c=new Map;for(let u of a){let m=u.get("identity"),g=u.get("room")?.region??"Other";c.has(g)||c.set(g,[]),c.get(g).push({id:u.id,name:m?.name??u.id})}let l=Array.from(c.keys()).sort();for(let u of l){s.push(`  [${u}]`);let m=c.get(u);for(let f of m.slice(0,10))s.push(`    ${f.id}: ${f.name}`);m.length>10&&s.push(`    ... and ${m.length-10} more`)}return{success:!0,output:s}}let r=e.join(" "),n=t.findRoom(r);return n?t.teleportPlayer(n.id)?{success:!0,output:[`Teleported to: ${n.get("identity")?.name??n.id} (${n.id})`]}:{success:!1,output:[`Failed to teleport to: ${n.id}`],error:"TELEPORT_FAILED"}:{success:!1,output:[`Room not found: ${r}`],error:"NOT_FOUND"}}};var vk={code:"TK",name:"Take",description:"Acquire any object (TK <object-id>)",execute(t,e){if(e.length===0)return{success:!1,output:["Usage: TK <object-id or name>"],error:"MISSING_ARG"};let r=e.join(" "),n=t.findEntity(r);return n?n.has("room")?{success:!1,output:[`Cannot take a room: ${r}`],error:"INVALID_TARGET"}:t.moveObject(n.id,"player")?{success:!0,output:[`Taken: ${n.get("identity")?.name??n.id} (${n.id})`]}:{success:!1,output:[`Failed to take: ${n.id}`],error:"MOVE_FAILED"}:{success:!1,output:[`Object not found: ${r}`],error:"NOT_FOUND"}}};var Ek={code:"AO",name:"Alter Object",description:"Move object to location (AO <object-id> <location-id>)",execute(t,e){if(e.length<2)return{success:!1,output:["Usage: AO <object-name> <location-name>","","Special locations:","  player - Move to player inventory","  here   - Move to current room","  <room-name> - Move to specific room","  <object-name> - Move into container/supporter"],error:"MISSING_ARGS"};let r=e[e.length-1],n=e.slice(0,-1).join(" "),i=t.findEntity(n);if(!i)return{success:!1,output:[`Object not found: ${n}`],error:"OBJECT_NOT_FOUND"};if(r==="here"){let c=t.getPlayerLocation();if(!c)return{success:!1,output:["Player has no current location"],error:"NO_LOCATION"};r=c.id}let o=r;if(r!=="player"&&r!=="inventory"){let c=t.findEntity(r);if(!c)return{success:!1,output:[`Location not found: ${r}`],error:"LOCATION_NOT_FOUND"};o=c.get("identity")?.name??c.id,r=c.id}else o="player inventory";return t.moveObject(i.id,r)?{success:!0,output:[`Moved: ${i.get("identity")?.name??i.id} -> ${o}`]}:{success:!1,output:[`Failed to move ${i.id} to ${r}`],error:"MOVE_FAILED"}}};var Tk={code:"DF",name:"Display Flags",description:"Deprecated - use DO instead",execute(t,e){return{success:!0,output:["DF (Display Flags) was used in the FORTRAN/MDL versions of Zork","where objects had bit flags (TAKEBIT, OPENBIT, LIGHTBIT, etc.).","","Sharpee uses trait-based composition instead.","Use DO <entity> to view entity state and traits."]}}};var _k={code:"AF",name:"Alter Flags",description:"Deprecated - use game commands instead",execute(t,e){return{success:!0,output:["AF (Alter Flags) was used in the FORTRAN/MDL versions of Zork","where objects had bit flags that could be directly toggled.","","Sharpee uses trait-based composition instead.","To modify entity state, use:","  - Game commands (open, close, turn on, etc.)","  - AO to move objects","  - AH to teleport the player"]}}};var bk={code:"ND",name:"No Deaths",description:"Enable immortality mode",execute(t,e){return t.flags.immortal?{success:!0,output:["Immortality already enabled."]}:(t.setFlag("immortal",!0),{success:!0,output:["Immortality ENABLED. You cannot die."]})}};var Ok={code:"RD",name:"Restore Deaths",description:"Disable immortality mode",execute(t,e){return t.flags.immortal?(t.setFlag("immortal",!1),{success:!0,output:["Immortality DISABLED. You can die again."]}):{success:!0,output:["Immortality already disabled."]}}};var o3=S(b());var xe={APPEARS:"dungeo.thief.appears",LEAVES:"dungeo.thief.leaves",LURKS:"dungeo.thief.lurks",STEALS_FROM_PLAYER:"dungeo.thief.steals_from_player",STEALS_FROM_ROOM:"dungeo.thief.steals_from_room",NOTICES_VALUABLES:"dungeo.thief.notices_valuables",GLOATS:"dungeo.thief.gloats",OPENS_EGG:"dungeo.thief.opens_egg",ATTACKS:"dungeo.thief.attacks",COUNTERATTACKS:"dungeo.thief.counterattacks",DODGES:"dungeo.thief.dodges",WOUNDED:"dungeo.thief.wounded",FLEES:"dungeo.thief.flees",DIES:"dungeo.thief.dies",DROPS_LOOT:"dungeo.thief.drops_loot",FRAME_SPAWNS:"dungeo.thief.frame_spawns"};var Yt=S(b());var aa=S(b());function q5(t){let e=t.createEntity("empty frame",aa.EntityType.ITEM);return e.add(new aa.IdentityTrait({name:"empty frame",aliases:["frame","picture frame","ornate frame","empty picture frame"],description:"An ornate but empty picture frame. The craftsmanship is exquisite, though the canvas it once held is missing. There appears to be something carved on the back.",properName:!1,article:"an",weight:5})),e.isEmptyFrame=!0,e.isBreakable=!0,e.backDescription='Carved into the back of the frame in rough letters: "Only devotion can reveal my location."',e}function F5(t){let e=t.createEntity("frame piece",aa.EntityType.ITEM);return e.add(new aa.IdentityTrait({name:"frame piece",aliases:["piece","carved piece","piece of frame","frame fragment"],description:'A piece of the broken frame bearing a carved inscription: "Only devotion can reveal my location."',properName:!1,article:"a",weight:2})),e.isFramePiece=!0,e}function G5(t){let e=t.createEntity("incense",aa.EntityType.ITEM);return e.add(new aa.IdentityTrait({name:"incense",aliases:["incense","incense stick","stick of incense","joss stick"],description:"A stick of ancient incense, still fragrant after all these years. It was clutched in the skeleton's bony fingers.",properName:!1,article:"a",weight:5})),e.isIncense=!0,e.isBurning=!1,e.burnedOut=!1,e}function V5(t){let e=t.createEntity("rolled up canvas",aa.EntityType.ITEM);return e.add(new aa.IdentityTrait({name:"rolled up canvas",aliases:["canvas","rolled canvas","painting","thief's canvas","portrait"],description:"The thief apparently had a superior artistic streak, for this is one of the greatest creations in all of Zork. It is a faithful rendering of The Implementors, the mythical Gods remembered by all inhabitants.",properName:!1,article:"a",weight:5})),e.isTreasure=!0,e.treasureId="thiefs-canvas",e.treasureValue=10,e.trophyCaseValue=24,e}function z5(t){return{state:"WANDERING",lairRoomId:t,turnsWithEgg:0,turnsInRoom:0,lastKnownPlayerRoom:null,stealCooldown:0,hasBeenAttacked:!1}}var lfe=0;function Y5(){return`thief-evt-${Date.now()}-${++lfe}`}function Ik(t,e,r=[]){let n=t.createEntity("thief",Yt.EntityType.ACTOR);return n.add(new Yt.IdentityTrait({name:"seedy-looking thief",aliases:["thief","robber","seedy thief","seedy gentleman","gentleman","man"],description:"A seedy-looking gentleman, shabbily dressed but with an air of confidence. His eyes dart about, assessing everything of value.",properName:!1,article:"a"})),n.add(new Yt.ActorTrait({isPlayer:!1})),n.add(new Yt.NpcTrait({behaviorId:"thief",isHostile:!1,canMove:!0,forbiddenRooms:r,customProperties:z5(e)})),n.add(new Yt.CombatantTrait({health:25,maxHealth:25,skill:70,baseDamage:4,armor:0,hostile:!1,canRetaliate:!0,dropsInventory:!0,deathMessage:"The thief falls to the ground, a look of surprise frozen on his face."})),n.add(new Yt.ContainerTrait({capacity:{maxItems:50,maxWeight:500}})),n.on={"if.event.death":(i,o)=>{let a=[],s=o.getCapability(Yt.StandardCapabilities.SCORING);s&&(s.scoreValue=(s.scoreValue||0)+25,s.achievements||(s.achievements=[]),s.achievements.push("Defeated the thief"),s.thiefDead=!0,s.maxScore=650,s.realityAlteredPending=!0),a.push({id:Y5(),type:"game.message",entities:{actor:n.id},data:{messageId:xe.DROPS_LOOT},timestamp:Date.now(),narrate:!0});let c=q5(o);return o.moveEntity(c.id,e),a.push({id:Y5(),type:"game.message",entities:{actor:n.id,target:c.id},data:{messageId:xe.FRAME_SPAWNS},timestamp:Date.now(),narrate:!0}),a}},t.moveEntity(n.id,e),ufe(t,n.id),n}function ufe(t,e){let r=t.createEntity("stiletto",Yt.EntityType.ITEM);return r.add(new Yt.IdentityTrait({name:"nasty stiletto",aliases:["stiletto","knife","dagger","nasty knife","thief knife"],description:"A long, thin, wickedly sharp knife. The kind of weapon favored by cutthroats and thieves.",properName:!1,article:"a"})),r.add(new Yt.WeaponTrait({damage:6,skillBonus:10,weaponType:"piercing"})),r.isTreasure=!1,t.moveEntity(r.id,e),r}var Yr=S(b());var Hm=S(b()),$5="dungeo.thief.disabled";function K5(t){let e=t;return e.isTreasure===!0||typeof e.treasureValue=="number"&&e.treasureValue>0||typeof e.trophyCaseValue=="number"&&e.trophyCaseValue>0}function Sk(t){let e=t,r=e.treasureValue??0,n=e.trophyCaseValue??0;return r+n}function Ak(t,e){return t.getEntity(e)?t.getContents(e).filter(i=>K5(i)).sort((i,o)=>Sk(o)-Sk(i)):[]}function Um(t){let e=t.world.getPlayer();return e?Ak(t.world,e.id):[]}function JI(t){return Ak(t.world,t.npcLocation)}function Rk(t){return t.npcInventory.some(e=>(e.get(Hm.IdentityTrait)?.name?.toLowerCase()??"").includes("egg")||e.treasureId==="egg")}function Q5(t){return t.npcInventory.find(e=>(e.get(Hm.IdentityTrait)?.name?.toLowerCase()??"").includes("egg")||e.treasureId==="egg")}function fo(t){let e=t.get(Hm.NpcTrait);if(e?.customProperties)return e.customProperties}function eS(t){let e=fo(t.npc);return e?t.npcLocation===e.lairRoomId:!1}function dfe(t){return(t.get(Hm.IdentityTrait)?.name?.toLowerCase()??"").includes("stiletto")}function tS(t){return t.npcInventory.filter(e=>!dfe(e))}function rS(t){return t.getDataStore().state[$5]===!0}function Lg(t,e){let r=t.getDataStore();r.state[$5]=e}function X5(t){t.stealCooldown>0&&t.stealCooldown--}function mfe(t){return t.getCapability?.("scoring")?.scoreValue??0}function Z5(t){return mfe(t.world)>=150&&t.playerVisible?t.random.chance(.3):!1}var ffe=.33,pfe=.4,gfe=3,J5=5,e3=3,hfe=.3,yfe=0;function vfe(){return`thief-bhv-${Date.now()}-${++yfe}`}var Ck={id:"thief",name:"Thief Behavior",onTurn(t){let e=fo(t.npc);if(!e)return[];if(rS(t.world))return[];if(e.state==="DISABLED")return[];if(X5(e),e.state==="FIGHTING")return t3(t,e);if(n3(t))return e.state="FLEEING",wk(t,e);let r=_fe(t,e);if(r.length>0)return r;if(Z5(t)&&!e.hasBeenAttacked)return e.state="FIGHTING",t3(t,e);switch(e.state){case"WANDERING":return Efe(t,e);case"STALKING":return r3(t,e);case"STEALING":return Nk(t,e);case"RETURNING":return Tfe(t,e);case"FLEEING":return wk(t,e);default:return[]}},onPlayerEnters(t){let e=fo(t.npc);return!e||e.state==="DISABLED"?[]:rS(t.world)?[]:(e.lastKnownPlayerRoom=t.playerLocation,Um(t).length>0&&t.random.chance(.5)?[{type:"emote",messageId:xe.NOTICES_VALUABLES,data:{npcName:t.npc.name}}]:[{type:"emote",messageId:xe.APPEARS,data:{npcName:t.npc.name}}])},onPlayerLeaves(t){let e=fo(t.npc);return!e||e.state==="DISABLED"?[]:(e.lastKnownPlayerRoom=t.playerLocation,[])},onAttacked(t,e){let r=fo(t.npc);if(!r)return[];r.hasBeenAttacked=!0,r.state="FIGHTING";let n=t.npc.get(Yr.CombatantTrait);return n&&(n.hostile=!0),[{type:"emote",messageId:xe.COUNTERATTACKS,data:{npcName:t.npc.name}},{type:"attack",target:e.id}]},getState(t){return t.get(Yr.NpcTrait)?.customProperties??{}},setState(t,e){let r=t.get(Yr.NpcTrait);r&&(r.customProperties=e)}};function Efe(t,e){let r=[];if(t.playerVisible&&Um(t).length>0)return e.state="STALKING",e.lastKnownPlayerRoom=t.playerLocation,r3(t,e);if(JI(t).length>0&&!t.playerVisible)return e.state="STEALING",Nk(t,e);if(t.random.chance(ffe)){let i=t.getAvailableExits();if(i.length>0){let o=t.random.pick(i);r.push({type:"move",direction:o.direction}),e.turnsInRoom=0}}else e.turnsInRoom++;return r}function r3(t,e){if(t.playerVisible)return e.lastKnownPlayerRoom=t.playerLocation,Um(t).length>0&&e.stealCooldown<=0&&t.random.chance(pfe)?(e.state="STEALING",Nk(t,e)):t.random.chance(.2)?[{type:"emote",messageId:xe.GLOATS,data:{npcName:t.npc.name}}]:[];if(e.lastKnownPlayerRoom&&e.lastKnownPlayerRoom!==t.npcLocation){let n=t.getAvailableExits().find(i=>i.destination===e.lastKnownPlayerRoom);if(n)return[{type:"move",direction:n.direction}]}return e.state="WANDERING",e.lastKnownPlayerRoom=null,[]}function Nk(t,e){let r=[];if(t.playerVisible){let i=Um(t);if(i.length>0){let o=i[0],s=o.get(Yr.IdentityTrait)?.name??"item";return r.push({type:"take",target:o.id}),r.push({type:"speak",messageId:xe.STEALS_FROM_PLAYER,data:{itemName:s}}),e.stealCooldown=J5,tS(t).length>=e3?e.state="RETURNING":e.state="WANDERING",r}}let n=JI(t);if(n.length>0){let i=n[0];if(r.push({type:"take",target:i.id}),t.playerVisible){let a=i.get(Yr.IdentityTrait);r.push({type:"emote",messageId:xe.STEALS_FROM_ROOM,data:{itemName:a?.name??"something"}})}return e.stealCooldown=J5,tS(t).length>=e3?e.state="RETURNING":e.state="WANDERING",r}return e.state="WANDERING",[]}function Tfe(t,e){if(eS(t)){let n=[],i=tS(t);for(let o of i)n.push({type:"drop",target:o.id});return e.state="WANDERING",n}let r=t.getAvailableExits();if(r.length>0){let n=r.find(o=>o.destination===e.lairRoomId);return n?[{type:"move",direction:n.direction}]:[{type:"move",direction:t.random.pick(r).direction}]}return[]}function t3(t,e){if(n3(t))return e.state="FLEEING",wk(t,e);if(t.playerVisible){let r=t.world.getPlayer();if(r)return[{type:"emote",messageId:xe.ATTACKS,data:{npcName:t.npc.name}},{type:"attack",target:r.id}]}if(e.lastKnownPlayerRoom&&e.lastKnownPlayerRoom!==t.npcLocation){let n=t.getAvailableExits().find(i=>i.destination===e.lastKnownPlayerRoom);if(n)return[{type:"move",direction:n.direction}]}return e.state="WANDERING",[]}function wk(t,e){let r=[];if(e.state!=="FLEEING"&&r.push({type:"emote",messageId:xe.FLEES,data:{npcName:t.npc.name}}),eS(t))return e.state="WANDERING",r;let n=t.getAvailableExits();if(n.length>0){let i=n.find(o=>o.destination===e.lairRoomId);if(i)r.push({type:"move",direction:i.direction});else if(t.playerVisible){let o=t.random.pick(n);r.push({type:"move",direction:o.direction})}else{let o=t.random.pick(n);r.push({type:"move",direction:o.direction})}}return r}function n3(t){let e=t.npc.get(Yr.CombatantTrait);return e?e.health/e.maxHealth<=hfe:!1}function _fe(t,e){if(Rk(t)){if(e.turnsWithEgg++,e.turnsWithEgg>=gfe)return e.turnsWithEgg=0,[{type:"custom",handler:()=>{let r=Q5(t);if(!r)return[];let n=r.get(Yr.OpenableTrait);if(n&&!n.isOpen){n.isOpen=!0;let i=t.world.getAllEntities().find(o=>o.get(Yr.IdentityTrait)?.name?.includes("canary"));return i||(i=t.world.createEntity("clockwork canary",Yr.EntityType.ITEM),i.add(new Yr.IdentityTrait({name:"clockwork canary",aliases:["canary","bird","clockwork bird","mechanical bird"],description:"A beautifully crafted mechanical songbird. Its delicate clockwork is exposed, revealing gears of the finest craftsmanship.",properName:!1,article:"a"})),i.isTreasure=!0,i.treasureId="clockwork-canary",i.treasureValue=6,i.trophyCaseValue=2),t.world.moveEntity(i.id,t.npcLocation),[{id:vfe(),type:"npc.emoted",timestamp:Date.now(),entities:{actor:t.npc.id},data:{npc:t.npc.id,messageId:xe.OPENS_EGG}}]}return[]}}]}else e.turnsWithEgg=0;return[]}function i3(t,e,r,n=[]){return t.registerBehavior(Ck),Ik(e,r,n)}var Dk={code:"NR",name:"No Robber",description:"Disable the thief NPC",execute(t,e){if(t.flags.thiefDisabled)return{success:!0,output:["Thief already disabled."]};let r=t.world.getAllEntities().find(i=>i.get(o3.NpcTrait)?.behaviorId==="thief");if(!r)return{success:!1,output:["Thief not found in world."],error:"NOT_FOUND"};let n=fo(r);return n&&(n.state="DISABLED"),t.setFlag("thiefDisabled",!0),Lg(t.world,!0),{success:!0,output:["Thief DISABLED.","The thief will not wander, steal, or attack.","Use RR to restore thief behavior."]}}};var a3=S(b());var Pk={code:"RR",name:"Restore Robber",description:"Re-enable the thief NPC",execute(t,e){if(!t.flags.thiefDisabled)return{success:!0,output:["Thief already enabled."]};let r=t.world.getAllEntities().find(i=>i.get(a3.NpcTrait)?.behaviorId==="thief");if(!r)return{success:!1,output:["Thief not found in world."],error:"NOT_FOUND"};let n=fo(r);return n&&(n.state="WANDERING"),t.setFlag("thiefDisabled",!1),Lg(t.world,!1),{success:!0,output:["Thief RESTORED to active duty.","The thief will resume wandering and stealing."]}}};var Lk="dungeo.scheduler.ref";function bfe(t){return t.world.getCapability(Lk)}var Mk={code:"DC",name:"Display Clock",description:"Show active daemons and fuses (timed events)",execute(t,e){let r=[];r.push("=== CLOCK EVENTS (ADR-071) ==="),r.push("");let n=bfe(t);if(!n)return r.push("ERROR: Scheduler not available"),r.push("(Scheduler reference not set in world capability)"),{success:!1,output:r,error:"NO_SCHEDULER"};r.push("DAEMONS (persistent):");let i=n.getActiveDaemons();if(i.length===0)r.push("  <no daemons registered>");else for(let a of i){let s=a.isPaused?"paused":"active",c=a.priority??0;r.push(`  [${s}] ${a.id} - "${a.name}" (priority: ${c})`)}r.push(""),r.push("FUSES (countdown):");let o=n.getActiveFuses();if(o.length===0)r.push("  <no fuses active>");else for(let a of o){let s=a.isPaused?"paused ":"running",c=a.priority??0,l=a.repeat?" [repeating]":"",u=a.entityId?` (entity: ${a.entityId})`:"";r.push(`  [${s}] ${a.id} - "${a.name}" turns: ${a.turnsRemaining} (priority: ${c})${l}${u}`)}if(r.push(""),r.push(`Total: ${i.length} daemons, ${o.length} fuses`),e.length>0){let a=e[0].toLowerCase();r.push(""),r.push(`Filter: "${a}"`);let s=i.filter(l=>l.id.toLowerCase().includes(a)||l.name.toLowerCase().includes(a)),c=o.filter(l=>l.id.toLowerCase().includes(a)||l.name.toLowerCase().includes(a));s.length>0||c.length>0?r.push(`Matched: ${s.length} daemons, ${c.length} fuses`):r.push("No matches found.")}return{success:!0,output:r}}};function kk(t,e){if(typeof t.registerCapability=="function")try{t.registerCapability(Lk,{initialData:e})}catch{let r=t.getCapability(Lk);r&&Object.assign(r,e)}}var v3=S(b());var at=S(b()),Ofe=1,sa=0,nS=-1,Ps=-2,c3=-3,ml={north:-8,south:8,east:1,west:-1,northeast:-7,northwest:-9,southeast:9,southwest:7},l3=[1,1,1,1,1,1,1,1,1,0,-1,0,0,-1,0,1,1,-1,0,1,0,-2,0,1,1,0,0,0,0,1,0,1,1,-3,0,0,-1,-1,0,1,1,0,0,-1,0,0,0,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1],po=9,Fm=10;function Ife(t){let e=t.createEntity("Royal Puzzle Controller",at.EntityType.OBJECT);e.add(new at.IdentityTrait({name:"Royal Puzzle Controller",aliases:[],description:"Puzzle state controller (not visible to player)",properName:!0,article:"the"}));let r={grid:[...l3],playerPos:po,cardTaken:!1,hasExited:!1,inPuzzle:!1,pushCount:0};return e.puzzleState=r,e}function zr(t){return t.puzzleState}function u3(t){let e=zr(t);e.grid=[...l3],e.playerPos=po,e.cardTaken=!1,e.hasExited=!1,e.inPuzzle=!1,e.pushCount=0}function Sfe(t){return Math.floor(t/8)}function Afe(t){return t%8}function dl(t){return t>=0&&t<64}function qm(t,e){let r=Afe(t),n=Sfe(t);switch(e){case"east":case"northeast":case"southeast":return r===7;case"west":case"northwest":case"southwest":return r===0;case"north":return n===0;case"south":return n===7;default:return!1}}function Rfe(t,e){if(qm(t.playerPos,e))return!1;let r=t.playerPos+ml[e];return dl(r)?t.grid[r]===sa:!1}function wfe(t,e){if(qm(t.playerPos,e))return!1;let r=t.playerPos+ml[e];if(!dl(r)||t.grid[r]!==sa)return!1;let n,i;switch(e){case"northeast":n=1,i=-8;break;case"northwest":n=-1,i=-8;break;case"southeast":n=1,i=8;break;case"southwest":n=-1,i=8;break}let o=t.playerPos+n,a=t.playerPos+i,s=dl(o)&&t.grid[o]===sa,c=dl(a)&&t.grid[a]===sa;return s||c}function Bk(t,e){return["north","south","east","west"].includes(e)?Rfe(t,e):wfe(t,e)}function d3(t,e){t.playerPos=t.playerPos+ml[e]}function m3(t,e){let r=ml[e];if(qm(t.playerPos,e))return"boundary";let n=t.playerPos+r;if(!dl(n))return"boundary";let i=t.grid[n];if(i===sa)return"no-wall";if(i===Ofe)return"immovable";if(qm(n,e))return"no-room";let o=n+r;return!dl(o)||t.grid[o]!==sa?"no-room":"success"}function f3(t,e){let r=ml[e],n=t.playerPos+r,i=n+r;t.grid[i]=t.grid[n],t.grid[n]=sa,t.playerPos=n,t.pushCount++}function iS(t){return t.playerPos!==po?!1:t.grid[Fm]===Ps}function Gm(t){if(t.cardTaken)return!1;for(let e of["north","south","east","west"]){if(qm(t.playerPos,e))continue;let r=t.playerPos+ml[e];if(dl(r)&&t.grid[r]===c3)return!0}return!1}function p3(t){let e=t.grid.indexOf(c3);e!==-1&&(t.grid[e]=nS,t.cardTaken=!0)}function Cfe(t){let e=[];for(let r of Object.keys(ml))Bk(t,r)&&e.push(r);return iS(t)&&e.push("up"),e}function jk(t){for(let e of["north","south","east","west"]){if(qm(t.playerPos,e))continue;let r=t.playerPos+ml[e];if(dl(r)&&t.grid[r]===Ps)return!0}return!1}function Nfe(t){return t.length===0?"nowhere":t.length===1?t[0]:t.length===2?`${t[0]} and ${t[1]}`:t.slice(0,-1).join(", ")+", and "+t[t.length-1]}function Mu(t){let e=["You are in a maze of sandstone walls."],r=Cfe(t);if(r.length>0){let n=r.map(i=>{switch(i){case"north":return"north";case"south":return"south";case"east":return"east";case"west":return"west";case"northeast":return"northeast";case"northwest":return"northwest";case"southeast":return"southeast";case"southwest":return"southwest";case"up":return"up";default:return i}});e.push(`Passages lead ${Nfe(n)}.`)}return t.playerPos===po&&(iS(t)?e.push("Above you is a hole in the ceiling. A wooden ladder on the eastern wall reaches up to it."):e.push("Above you is a hole in the ceiling, but there is no way to reach it.")),jk(t)&&t.playerPos!==po&&e.push("One of the sandstone walls has a wooden ladder attached to it."),Gm(t)&&e.push("Set into one wall is a small depression. Within it rests a gold card, embossed with the royal crest."),e.join(" ")}function xk(t,e,r,n=[],i=!0){let o=t.createEntity(e,at.EntityType.ROOM);return o.add(new at.RoomTrait({exits:{},isDark:i,isOutdoors:!1})),o.add(new at.IdentityTrait({name:e,aliases:n,description:r,properName:!0,article:"the"})),o}function s3(t,e){let r=t.get(at.RoomTrait);if(r)for(let[n,i]of Object.entries(e))r.exits[n]={destination:i}}function g3(t){let e=xk(t,"Square Room","This is a small square room, with passages leading west and down.",["square room","small square room"]),r=xk(t,"Puzzle Room","This is a small room with a hole in the floor. Through the hole, you can see a sandstone room below.",["puzzle room","royal puzzle entrance","puzzle entrance"]),n=xk(t,"Room in a Puzzle","You are in a maze of sandstone walls.",["room in puzzle","puzzle room","sandstone room"],!1),i=Ife(t),o={squareRoom:e.id,puzzleRoom:r.id,roomInPuzzle:n.id,puzzleController:i.id,goldCard:"",warningNote:""},a=Mfe(t,{puzzleRoom:r.id,roomInPuzzle:n.id});return o.goldCard=a.goldCard.id,o.warningNote=a.warningNote.id,Dfe(t,o),o}function Dfe(t,e){let r=t.getEntity(e.squareRoom);r&&s3(r,{[at.Direction.DOWN]:e.puzzleRoom});let n=t.getEntity(e.puzzleRoom);n&&s3(n,{[at.Direction.UP]:e.squareRoom,[at.Direction.DOWN]:e.roomInPuzzle});let i=t.getEntity(e.roomInPuzzle);if(i){let o=i.get(at.RoomTrait);o&&(o.exits={})}}function h3(t,e,r){let n=t.getEntity(e.squareRoom);if(n){let o=n.get(at.RoomTrait);o&&(o.exits[at.Direction.WEST]={destination:r})}let i=t.getEntity(r);if(i){let o=i.get(at.RoomTrait);o&&(o.exits[at.Direction.EAST]={destination:e.squareRoom})}}function Pfe(t){let e=t.createEntity("gold card",at.EntityType.ITEM);return e.add(new at.IdentityTrait({name:"gold card",aliases:["card","royal card","gold","golden card"],description:"This is an ornate gold card, beautifully embossed with the royal crest of the Great Underground Empire.",properName:!1,article:"a",weight:2})),e}function Lfe(t,e){let r=t.createEntity("warning note",at.EntityType.ITEM);return r.add(new at.IdentityTrait({name:"warning note",aliases:["note","warning","small note"],description:"This is a small yellowed note with faded writing.",properName:!1,article:"a",weight:2})),r.add(new at.ReadableTrait({text:`Warning:

The Royal Puzzle is dangerous. Many who have entered
have never returned, trapped forever within its confines.
If you do enter, be warned: there is only one way out,
and that requires pushing the sandstone walls.

The treasure within is yours for the taking, but only
if you can find your way back.`})),t.moveEntity(r.id,e),r}function Mfe(t,e){let r=Pfe(t),n=Lfe(t,e.puzzleRoom);return t.moveEntity(r.id,e.roomInPuzzle),{goldCard:r,warningNote:n}}var kfe="dungeo.royal_puzzle.controllerId",y3="dungeo.royal_puzzle.roomInPuzzleId";function xfe(t){let e=t.world.getStateValue(kfe);return e?t.world.getEntity(e):t.world.getAllEntities().find(n=>n.get(v3.IdentityTrait)?.name==="Royal Puzzle Controller")}function ku(t){let e=["Royal Puzzle State:",`  In Puzzle: ${t.inPuzzle}`,`  Player Position: ${t.playerPos} (row ${Math.floor(t.playerPos/8)}, col ${t.playerPos%8})`,`  Card Taken: ${t.cardTaken}`,`  Has Exited: ${t.hasExited}`,`  Push Count: ${t.pushCount}`,""],r=t.grid.indexOf(Ps);e.push(`  Ladder Position: ${r>=0?`${r} (row ${Math.floor(r/8)}, col ${r%8})`:"N/A"}`),e.push(`  Exit Position: ${Fm} (ladder must be here to exit)`),e.push(`  Entry Position: ${po} (player must be here to exit)`),e.push(""),e.push("Grid (M=marble, .=empty, S=sand, L=ladder, C=card):");for(let n=0;n<8;n++){let i="  ";for(let o=0;o<8;o++){let a=n*8+o,s=t.grid[a],c;switch(s){case 1:c="M";break;case 0:c=a===t.playerPos?"@":".";break;case-1:c="S";break;case-2:c="L";break;case-3:c="C";break;default:c="?"}i+=c+" "}e.push(i)}return e}var Wk={code:"PZ",name:"Puzzle",description:"Manipulate Royal Puzzle state for testing",execute(t,e){let r=xfe(t);if(!r)return{success:!1,output:["Royal Puzzle controller not found."],error:"NO_CONTROLLER"};let n=zr(r),i=e[0]?.toUpperCase();if(!i)return{success:!0,output:ku(n)};switch(i){case"RESET":return u3(r),{success:!0,output:["Puzzle reset to initial state.",...ku(zr(r))]};case"ENTER":n.inPuzzle=!0,n.playerPos=po;let o=t.world.getStateValue(y3),a=t.world.getPlayer();return o&&a&&t.world.moveEntity(a.id,o),{success:!0,output:["Entered puzzle at entry position.",...ku(n)]};case"EXIT":n.inPuzzle=!0,n.playerPos=po;let s=n.grid.indexOf(Ps);s>=0&&(n.grid[s]=sa),n.grid[Fm]===nS?n.grid[Fm]=Ps:n.grid[Fm]=Ps;let c=t.world.getStateValue(y3),l=t.world.getPlayer();return c&&l&&t.world.moveEntity(l.id,c),{success:!0,output:["Set up for exit: player at entry, ladder at exit position.",...ku(n)]};case"L":case"LADDER":let u=parseInt(e[1],10);if(isNaN(u)||u<0||u>=64)return{success:!1,output:["Invalid position. Use PZ L <0-63>"],error:"INVALID_POSITION"};let m=n.grid.indexOf(Ps);return m>=0&&(n.grid[m]=sa),n.grid[u]=Ps,{success:!0,output:[`Ladder moved to position ${u}.`,...ku(n)]};case"P":case"PLAYER":let f=parseInt(e[1],10);return isNaN(f)||f<0||f>=64?{success:!1,output:["Invalid position. Use PZ P <0-63>"],error:"INVALID_POSITION"}:(n.playerPos=f,n.inPuzzle=!0,{success:!0,output:[`Player moved to position ${f}.`,...ku(n)]});case"CARD":n.cardTaken=!0;let g=n.grid.indexOf(-3);return g>=0&&(n.grid[g]=nS),{success:!0,output:["Card marked as taken.",...ku(n)]};default:return{success:!1,output:["Unknown subcommand. Usage:","  PZ          - Display puzzle state","  PZ RESET    - Reset puzzle","  PZ ENTER    - Enter puzzle at entry","  PZ EXIT     - Set up for exit test","  PZ L <pos>  - Move ladder","  PZ P <pos>  - Move player","  PZ CARD     - Take card"],error:"UNKNOWN_SUBCOMMAND"}}}};var fl=S(b());var Z={DESCRIPTION:"dungeo.dm.description",APPEARS_AT_DOOR:"dungeo.dm.appears_at_door",QUESTION_0:"dungeo.dm.question_0",QUESTION_1:"dungeo.dm.question_1",QUESTION_2:"dungeo.dm.question_2",QUESTION_3:"dungeo.dm.question_3",QUESTION_4:"dungeo.dm.question_4",QUESTION_5:"dungeo.dm.question_5",QUESTION_6:"dungeo.dm.question_6",QUESTION_7:"dungeo.dm.question_7",CORRECT_ANSWER:"dungeo.dm.correct_answer",WRONG_ANSWER_1:"dungeo.dm.wrong_answer_1",WRONG_ANSWER_2:"dungeo.dm.wrong_answer_2",WRONG_ANSWER_3:"dungeo.dm.wrong_answer_3",WRONG_ANSWER_4:"dungeo.dm.wrong_answer_4",WRONG_ANSWER_5:"dungeo.dm.wrong_answer_5",TRIVIA_PASSED:"dungeo.dm.trivia_passed",TRIVIA_FAILED:"dungeo.dm.trivia_failed",DOOR_OPENS:"dungeo.dm.door_opens",NO_ANSWER_YET:"dungeo.dm.no_answer_yet",ALREADY_PASSED:"dungeo.dm.already_passed",FOLLOWING:"dungeo.dm.following",STAYING:"dungeo.dm.staying",SETS_DIAL:"dungeo.dm.sets_dial",PUSHES_BUTTON:"dungeo.dm.pushes_button",CANNOT_DO_THAT:"dungeo.dm.cannot_do_that"};var Vm=[{id:0,messageId:Z.QUESTION_0,answers:["temple"]},{id:1,messageId:Z.QUESTION_1,answers:["forest","the forest","clearing"]},{id:2,messageId:Z.QUESTION_2,answers:["30003","30,003"]},{id:3,messageId:Z.QUESTION_3,answers:["flask","bottle","glass bottle","the flask","the bottle"]},{id:4,messageId:Z.QUESTION_4,answers:["rub","fondle","caress","touch","rub it","rub mirror"]},{id:5,messageId:Z.QUESTION_5,answers:["bones","body","skeleton","skull","the skeleton","the bones"]},{id:6,messageId:Z.QUESTION_6,answers:["rusty knife","nasty knife","knife","the rusty knife","the knife"]},{id:7,messageId:Z.QUESTION_7,answers:["none","no","nowhere","never","nope","not at all"]}];function E3(t){let e=Math.floor(Math.random()*8);return{...t,currentQuestion:e,questionsAnswered:0,wrongAttempts:0,isComplete:!1,passed:!1}}function Bfe(t){return(t+3)%8}function jfe(t,e){let r=Vm[t];if(!r)return!1;let n=e.toLowerCase().trim();return r.answers.some(i=>n===i.toLowerCase())}function T3(t,e){if(t.isComplete)return{state:t,isCorrect:!1,message:t.passed?Z.ALREADY_PASSED:Z.TRIVIA_FAILED};if(t.currentQuestion===-1)return{state:t,isCorrect:!1,message:Z.NO_ANSWER_YET};if(jfe(t.currentQuestion,e)){let n=t.questionsAnswered+1;return n>=3?{state:{...t,questionsAnswered:n,isComplete:!0,passed:!0},isCorrect:!0,message:Z.TRIVIA_PASSED}:{state:{...t,questionsAnswered:n,currentQuestion:Bfe(t.currentQuestion)},isCorrect:!0,message:Z.CORRECT_ANSWER}}else{let n=t.wrongAttempts+1;if(n>=5)return{state:{...t,wrongAttempts:n,isComplete:!0,passed:!1},isCorrect:!1,message:Z.TRIVIA_FAILED};{let i=[Z.WRONG_ANSWER_1,Z.WRONG_ANSWER_2,Z.WRONG_ANSWER_3,Z.WRONG_ANSWER_4];return{state:{...t,wrongAttempts:n},isCorrect:!1,message:i[n-1]}}}}function Mg(t){return t.currentQuestion===-1||t.isComplete?null:Vm[t.currentQuestion]?.messageId||null}var ca=S(b());function Wfe(){return{state:"GUARDING_DOOR",triviaPassed:!1,triviaStarted:!1,doorOpen:!1}}function _3(t,e){let r=t.createEntity("dungeon-master",ca.EntityType.ACTOR);return r.add(new ca.IdentityTrait({name:"Dungeon Master",aliases:["dungeon master","master","dm","old man","elderly man","strange man","man"],description:"A strange old man with a long, flowing beard and penetrating eyes. He carries himself with an air of quiet authority, as one who has seen much and knows more.",properName:!0,article:"the"})),r.add(new ca.ActorTrait({isPlayer:!1})),r.add(new ca.NpcTrait({behaviorId:"dungeon-master",isHostile:!1,canMove:!0,forbiddenRooms:[],customProperties:Wfe()})),t.setStateValue("trivia.questionsAnswered",0),t.setStateValue("trivia.wrongAttempts",0),t.setStateValue("trivia.currentQuestion",-1),t.setStateValue("trivia.isComplete",!1),t.setStateValue("trivia.passed",!1),t.setStateValue("dungeonMaster.doorOpen",!1),t.setStateValue("dungeonMaster.state","GUARDING_DOOR"),t.moveEntity(r.id,e),r}function kg(t){return t.getAllEntities().find(r=>r.get(ca.IdentityTrait)?.name==="Dungeon Master")}function Hk(t){return t.getStateValue("dungeonMaster.state")??"GUARDING_DOOR"}function xu(t,e){t.setStateValue("dungeonMaster.state",e);let r=kg(t);if(r){let n=r.get(ca.NpcTrait);n&&n.customProperties&&(n.customProperties.state=e)}}function Hfe(t){let e=t.world;return{questionsAnswered:e.getStateValue("trivia.questionsAnswered")??0,wrongAttempts:e.getStateValue("trivia.wrongAttempts")??0,currentQuestion:e.getStateValue("trivia.currentQuestion")??-1,isComplete:e.getStateValue("trivia.isComplete")??!1,passed:e.getStateValue("trivia.passed")??!1}}function xg(t,e){let r=t.world;r.setStateValue("trivia.questionsAnswered",e.questionsAnswered),r.setStateValue("trivia.wrongAttempts",e.wrongAttempts),r.setStateValue("trivia.currentQuestion",e.currentQuestion),r.setStateValue("trivia.isComplete",e.isComplete),r.setStateValue("trivia.passed",e.passed)}function Ym(t){let e=["Trivia State:",`  Started: ${t.currentQuestion!==-1}`,`  Current Question: ${t.currentQuestion} (${t.currentQuestion>=0?Vm[t.currentQuestion]?.answers[0]:"N/A"})`,`  Correct Answers: ${t.questionsAnswered}/3`,`  Wrong Attempts: ${t.wrongAttempts}/5`,`  Complete: ${t.isComplete}`,`  Passed: ${t.passed}`,""];if(t.currentQuestion>=0&&t.currentQuestion<Vm.length){let r=Vm[t.currentQuestion];e.push(`Current Question ${r.id}: "${r.messageId}"`),e.push(`  Answers: ${r.answers.join(", ")}`)}return e}function b3(t,e){for(let r of t.world.getAllEntities())if(r.get(fl.IdentityTrait)?.name===e)return r.id;return null}function Ufe(t){let e=b3(t,"Dungeon Entrance"),r=b3(t,"Narrow Corridor");if(!e||!r)return;let n=t.world.getEntity(e);if(!n)return;let i=n.get(fl.RoomTrait);i&&(i.exits[fl.Direction.NORTH]={destination:r})}function O3(t){let e=t.world;e.setStateValue("dungeonMaster.doorOpen",!0),xu(e,"FOLLOWING"),Ufe(t);let r=kg(e);if(r){let n=r.get(fl.NpcTrait);if(n?.customProperties){let i=n.customProperties;i.triviaPassed=!0,i.doorOpen=!0,i.state="FOLLOWING"}}}var Uk={code:"TQ",name:"Trivia Questions",description:"Manipulate Dungeon Master trivia for testing",execute(t,e){let r=Hfe(t),n=e[0]?.toUpperCase();if(!n)return{success:!0,output:Ym(r)};switch(n){case"RESET":let i={questionsAnswered:0,wrongAttempts:0,currentQuestion:0,isComplete:!1,passed:!1};return xg(t,i),{success:!0,output:["Trivia reset to question 0.",...Ym(i)]};case"SOLVE":let o={questionsAnswered:3,wrongAttempts:0,currentQuestion:-1,isComplete:!0,passed:!0};return xg(t,o),O3(t),{success:!0,output:["Trivia auto-solved. Door is now open.",...Ym(o)]};case"Q":case"QUESTION":let a=parseInt(e[1],10);if(isNaN(a)||a<0||a>=8)return{success:!1,output:["Invalid question number. Use TQ Q <0-7>"],error:"INVALID_QUESTION"};let s={...r,currentQuestion:a,isComplete:!1,passed:!1};return xg(t,s),{success:!0,output:[`Current question set to ${a}.`,...Ym(s)]};case"PASS":let c={questionsAnswered:3,wrongAttempts:r.wrongAttempts,currentQuestion:-1,isComplete:!0,passed:!0};return xg(t,c),O3(t),{success:!0,output:["Trivia marked as passed. Door is now open.",...Ym(c)]};case"FAIL":let l={questionsAnswered:r.questionsAnswered,wrongAttempts:5,currentQuestion:-1,isComplete:!0,passed:!1};return xg(t,l),{success:!0,output:["Trivia marked as failed.",...Ym(l)]};default:return{success:!1,output:["Unknown subcommand. Usage:","  TQ          - Display trivia state","  TQ RESET    - Reset to question 0","  TQ SOLVE    - Auto-solve trivia","  TQ Q <n>    - Set current question (0-7)","  TQ PASS     - Mark as passed","  TQ FAIL     - Mark as failed"],error:"UNKNOWN_SUBCOMMAND"}}}};var la=S(b());function zm(t){let e=t.world;return{dialSetting:e.getStateValue("parapet.dialSetting")??1,activatedCell:e.getStateValue("parapet.activatedCell")??0,bronzeDoorVisible:e.getStateValue("prisonCell.bronzeDoorVisible")??!1,bronzeDoorOpen:e.getStateValue("prisonCell.bronzeDoorOpen")??!1}}function $m(t){return["Dial State:",`  Dial Setting: ${t.dialSetting}`,`  Activated Cell: ${t.activatedCell||"None (button not pushed)"}`,`  Bronze Door Visible: ${t.bronzeDoorVisible}`,`  Bronze Door Open: ${t.bronzeDoorOpen}`,"","Cell 4 required for bronze door to be visible.","Bronze door leads to Treasury of Zork."]}function oS(t,e){for(let r of t.world.getAllEntities())if(r.get(la.IdentityTrait)?.name===e)return r.id;return null}function I3(t,e){let r=t.world;r.setStateValue("parapet.activatedCell",e),r.setStateValue("prisonCell.currentCell",e),e===4?r.setStateValue("prisonCell.bronzeDoorVisible",!0):r.setStateValue("prisonCell.bronzeDoorVisible",!1);let n=oS(t,"Prison Cell"),i=oS(t,"Parapet");if(n&&i){let o=r.getEntity(i);if(o){let s=o.get(la.RoomTrait);s&&(s.exits[la.Direction.DOWN]={destination:n})}let a=r.getEntity(n);if(a){let s=a.get(la.RoomTrait);s&&(s.exits[la.Direction.UP]={destination:i})}}}function qfe(t){let e=t.world;e.setStateValue("prisonCell.bronzeDoorOpen",!0);let r=oS(t,"Prison Cell"),n=oS(t,"Treasury of Zork");if(r&&n){let i=e.getEntity(r);if(i){let o=i.get(la.RoomTrait);o&&(o.exits[la.Direction.SOUTH]={destination:n})}}}var qk={code:"DL",name:"Dial",description:"Manipulate Parapet dial puzzle for testing",execute(t,e){let r=zm(t),n=e[0]?.toUpperCase();if(!n)return{success:!0,output:$m(r)};switch(n){case"SET":let i=parseInt(e[1],10);return isNaN(i)||i<1||i>8?{success:!1,output:["Invalid dial setting. Use DL SET <1-8>"],error:"INVALID_DIAL"}:(t.world.setStateValue("parapet.dialSetting",i),{success:!0,output:[`Dial set to ${i}.`,...$m(zm(t))]});case"PUSH":let o=t.world.getStateValue("parapet.dialSetting")??1;return I3(t,o),{success:!0,output:[`Button pushed. Cell ${o} activated.`,...$m(zm(t))]};case"CELL":let a=parseInt(e[1],10);return isNaN(a)||a<1||a>8?{success:!1,output:["Invalid cell number. Use DL CELL <1-8>"],error:"INVALID_CELL"}:(I3(t,a),{success:!0,output:[`Cell ${a} activated directly.`,...$m(zm(t))]});case"DOOR":let s=t.world.getStateValue("prisonCell.bronzeDoorVisible")??!1;return t.world.setStateValue("prisonCell.bronzeDoorVisible",!s),{success:!0,output:[`Bronze door visibility toggled to ${!s}.`,...$m(zm(t))]};case"OPEN":return qfe(t),{success:!0,output:["Bronze door opened. Treasury is now accessible via S from Prison Cell.",...$m(zm(t))]};case"ENDGAME":return t.world.setStateValue("game.endgameStarted",!0),{success:!0,output:["Endgame mode activated. Victory will trigger when entering Treasury."]};default:return{success:!1,output:["Unknown subcommand. Usage:","  DL          - Display dial state","  DL SET <n>  - Set dial to n (1-8)","  DL PUSH     - Push button (activate cell)","  DL CELL <n> - Directly set active cell (1-8)","  DL DOOR     - Toggle bronze door visibility","  DL OPEN     - Open bronze door to Treasury","  DL ENDGAME  - Activate endgame mode (for victory testing)"],error:"UNKNOWN_SUBCOMMAND"}}}};var Bu=S(b()),Fk=null;function Gk(t){Fk=t}var Vk={code:"KL",name:"Kill Entity",description:"Kill an NPC or entity (usage: KL <name-or-id>)",execute(t,e){let{world:r}=t,n=[];if(e.length===0)return{success:!1,output:["Usage: KL <entity-name-or-id>"],error:"MISSING_ARGUMENT"};let i=e.join(" ").toLowerCase(),o=r.getAllEntities(),a=null;if(a=o.find(g=>g.id.toLowerCase()===i),a||(a=o.find(g=>{if(!g.has("actor"))return!1;let h=g.get(Bu.IdentityTrait);return h?(h.name?.toLowerCase()||"")===i:!1})),a||(a=o.find(g=>{if(!g.has("actor"))return!1;let h=g.get(Bu.IdentityTrait);return h?(h.name?.toLowerCase()||"").includes(i):!1})),a||(a=o.filter(h=>!h.has("room")).find(h=>{let y=h.get(Bu.IdentityTrait);if(!y)return!1;let _=y.name?.toLowerCase()||"";return _===i||_.includes(i)})),!a)return{success:!1,output:[`Entity not found: ${e.join(" ")}`],error:"ENTITY_NOT_FOUND"};let c=a.get(Bu.IdentityTrait)?.name||a.id,l=a.on,u=l&&typeof l["if.event.death"]=="function",m={id:`gdt-kill-${a.id}-${Date.now()}`,type:"if.event.death",timestamp:Date.now(),entities:{target:a.id},data:{entityId:a.id,entityName:c,cause:"gdt",killedBy:"GDT command"}};a.isDead=!0,a.isAlive=!1;let f=a.get(Bu.TraitType.COMBATANT);if(f&&f.kill(),Fk)try{let g=Fk.getEventProcessor();g&&g.process([m],r,t.player)}catch{if(u)try{l["if.event.death"](m,r)}catch{}}else if(u)try{l["if.event.death"](m,r)}catch{}return n.push(`Killed: ${c} (${a.id})`),u&&n.push("Death handler triggered."),{success:!0,output:n}}};var Km=S(b()),Yk={code:"KO",name:"Knock Out Entity",description:"Knock out an NPC (unconscious but alive) (usage: KO <name-or-id>)",execute(t,e){let{world:r}=t,n=[];if(e.length===0)return{success:!1,output:["Usage: KO <entity-name-or-id>"],error:"MISSING_ARGUMENT"};let i=e.join(" ").toLowerCase(),o=r.getAllEntities(),a=null;if(a=o.find(m=>m.id.toLowerCase()===i),a||(a=o.find(m=>{if(!m.has("actor"))return!1;let f=m.get(Km.IdentityTrait);return f?(f.name?.toLowerCase()||"")===i:!1})),a||(a=o.find(m=>{if(!m.has("actor"))return!1;let f=m.get(Km.IdentityTrait);return f?(f.name?.toLowerCase()||"").includes(i):!1})),!a)return{success:!1,output:[`Entity not found: ${e.join(" ")}`],error:"ENTITY_NOT_FOUND"};let c=a.get(Km.IdentityTrait)?.name||a.id,l=a.get(Km.TraitType.COMBATANT);if(!l)return{success:!1,output:[`${c} doesn't have CombatantTrait - cannot knock out`],error:"NOT_COMBATANT"};if(!l.isAlive)return{success:!1,output:[`${c} is already dead`],error:"ALREADY_DEAD"};if(!l.isConscious)return{success:!1,output:[`${c} is already unconscious`],error:"ALREADY_UNCONSCIOUS"};l.knockOut(),n.push(`Knocked out: ${c} (${a.id})`),n.push(`isAlive: ${l.isAlive}, isConscious: ${l.isConscious}`);let u=a.on;if(u&&typeof u["if.event.knocked_out"]=="function"){let m={id:`gdt-knockout-${Date.now()}`,type:"if.event.knocked_out",timestamp:Date.now(),entities:{target:a.id},data:{source:"gdt"}};u["if.event.knocked_out"](m,r),n.push("(triggered entity knocked_out handler)")}return{success:!0,output:n}}};var Qm=S(b()),zk={code:"WU",name:"Wake Up Entity",description:"Wake up an unconscious NPC (usage: WU <name-or-id>)",execute(t,e){let{world:r}=t,n=[];if(e.length===0)return{success:!1,output:["Usage: WU <entity-name-or-id>"],error:"MISSING_ARGUMENT"};let i=e.join(" ").toLowerCase(),o=r.getAllEntities(),a=null;if(a=o.find(u=>u.id.toLowerCase()===i),a||(a=o.find(u=>{if(!u.has("actor"))return!1;let m=u.get(Qm.IdentityTrait);return m?(m.name?.toLowerCase()||"")===i:!1})),a||(a=o.find(u=>{if(!u.has("actor"))return!1;let m=u.get(Qm.IdentityTrait);return m?(m.name?.toLowerCase()||"").includes(i):!1})),!a)return{success:!1,output:[`Entity not found: ${e.join(" ")}`],error:"ENTITY_NOT_FOUND"};let c=a.get(Qm.IdentityTrait)?.name||a.id,l=a.get(Qm.TraitType.COMBATANT);return l?l.isAlive?l.isConscious?{success:!1,output:[`${c} is already conscious`],error:"ALREADY_CONSCIOUS"}:(l.wakeUp(),n.push(`Woke up: ${c} (${a.id})`),n.push(`isAlive: ${l.isAlive}, isConscious: ${l.isConscious}`),{success:!0,output:n}):{success:!1,output:[`${c} is dead - cannot wake up`],error:"IS_DEAD"}:{success:!1,output:[`${c} doesn't have CombatantTrait - cannot wake up`],error:"NOT_COMBATANT"}}};var Xm=S(b()),$k={code:"FO",name:"Force Open",description:"Force open a container, bypassing restrictions (usage: FO <name-or-id>)",execute(t,e){let{world:r}=t,n=[];if(e.length===0)return{success:!1,output:["Usage: FO <entity-name-or-id>"],error:"MISSING_ARGUMENT"};let i=e.join(" ").toLowerCase(),o=r.getAllEntities(),a=null;if(a=o.find(u=>u.id.toLowerCase()===i),a||(a=o.find(u=>{let m=u.get(Xm.IdentityTrait);return m?(m.name?.toLowerCase()||"")===i:!1})),a||(a=o.find(u=>{let m=u.get(Xm.IdentityTrait);return m?(m.name?.toLowerCase()||"").includes(i):!1})),!a)return{success:!1,output:[`Entity not found: ${e.join(" ")}`],error:"ENTITY_NOT_FOUND"};let c=a.get(Xm.IdentityTrait)?.name||a.id,l=a.get(Xm.TraitType.OPENABLE);return l?l.isOpen?{success:!0,output:[`${c} is already open`]}:(l.isOpen=!0,n.push(`Force opened: ${c} (${a.id})`),n.push(`isOpen: ${l.isOpen}`),{success:!0,output:n}):{success:!1,output:[`${c} doesn't have OpenableTrait - cannot open`],error:"NOT_OPENABLE"}}};var Ke=new Map;Ke.set("HE",lk);Ke.set("EX",uk);Ke.set("DA",dk);Ke.set("DR",mk);Ke.set("DO",fk);Ke.set("DE",pk);Ke.set("DS",gk);Ke.set("DX",hk);Ke.set("AH",yk);Ke.set("TK",vk);Ke.set("AO",Ek);Ke.set("DF",Tk);Ke.set("AF",_k);Ke.set("ND",bk);Ke.set("RD",Ok);Ke.set("NR",Dk);Ke.set("RR",Pk);Ke.set("DC",Mk);Ke.set("PZ",Wk);Ke.set("TQ",Uk);Ke.set("DL",qk);Ke.set("KL",Vk);Ke.set("KO",Yk);Ke.set("WU",zk);Ke.set("FO",$k);function Kk(t,e,r){let n=Ke.get(t);return n?n.execute(e,r):{success:!1,output:[`Command ${t} not yet implemented.`],error:"NOT_IMPLEMENTED"}}var Qk={id:oa,group:"debug",validate(t){return{valid:!0}},execute(t){let e=t.world,r=ul(e);r.active=!0,ZI(e,r)},blocked(t,e){return[t.event("action.blocked",{actionId:oa,messageId:e.error,reason:e.error,params:e.params||{}})]},report(t){let e=['A BOOMING VOICE CALLS OUT, "WHO SUMMONS THE GAME DEBUGGING TOOL?"',"","GDT ready. Type HE for help, EX to exit."].join(`
`);return[t.event("action.success",{actionId:oa,messageId:"gdt_entered",message:e})]}};function Xk(t){return t.sharedData}var Zk={id:Vr,group:"debug",validate(t){if(!Pg(t.world))return{valid:!1,error:"not_in_gdt_mode",params:{}};let e=t.command.parsed.rawInput||"",r=ck(e);if(!r)return{valid:!1,error:"invalid_gdt_command",params:{input:e}};let n=Xk(t);return n.code=r.code,n.args=r.args,n.rawInput=e,{valid:!0}},execute(t){let e=Xk(t),r=e.code,n=e.args,i=sk(t.world),o=Kk(r,i,n);e.result=o},blocked(t,e){return e.error==="not_in_gdt_mode"?[t.event("action.blocked",{actionId:Vr,messageId:"not_in_gdt_mode",message:"GDT mode is not active.",params:{}})]:[t.event("action.blocked",{actionId:Vr,messageId:"invalid_gdt_command",message:"Unknown GDT command. Type HE for help.",params:{}})]},report(t){let e=Xk(t),r=e.result,n=e.code;return[t.event("action.success",{actionId:Vr,messageId:`gdt_${n.toLowerCase()}`,message:r.output.join(`
`)})]}};var S3=[Qk,Zk];var Ci="walk_through",Jk="dungeo.bank.puzzle",A3={curtainLeadsToViewingRoom:!1},Ni={WALK_THROUGH:"dungeo.bank.walk_through",NO_WALL:"dungeo.bank.no_wall",CANT_WALK_THROUGH:"dungeo.bank.cant_walk_through"};var e0=S(b());var Ffe="dungeo.bank.roomIds";function R3(t){return t.getStateValue(Jk)||{...A3}}function Gfe(t,e){t.setStateValue(Jk,e)}function w3(t){return t.getStateValue(Ffe)}function C3(t){let e=t.command,r=e.parsed?.rawInput?.toLowerCase()||"";if(r.includes("north wall")||r.includes("n wall"))return"north_wall";if(r.includes("south wall")||r.includes("s wall"))return"south_wall";if(r.includes("curtain"))return"curtain";if(e.directObject?.entity){let o=e.directObject.entity.get(e0.IdentityTrait);if(o){let a=o.name.toLowerCase();if(a.includes("curtain")||a.includes("light"))return"curtain";if(a.includes("north wall"))return"north_wall";if(a.includes("south wall"))return"south_wall"}}let i=(e.parsed?.extras||{}).arg?.toLowerCase()||"";if(i.includes("north wall")||i.includes("north"))return"north_wall";if(i.includes("south wall")||i.includes("south"))return"south_wall";if(i.includes("curtain")||i.includes("light"))return"curtain"}function N3(t,e,r,n){let i=t.currentLocation.id;return i===r.safetyDeposit?e==="curtain"?n.curtainLeadsToViewingRoom?{destination:r.viewingRoom,updateState:{curtainLeadsToViewingRoom:!1}}:{destination:r.smallRoom}:e==="north_wall"?{destination:r.vault}:{error:Ni.NO_WALL}:i===r.smallRoom?e==="south_wall"?{destination:r.safetyDeposit,updateState:{curtainLeadsToViewingRoom:!0}}:{error:Ni.NO_WALL}:i===r.vault?e==="north_wall"?{destination:r.safetyDeposit}:{error:Ni.NO_WALL}:{error:Ni.CANT_WALK_THROUGH}}var D3={id:Ci,group:"movement",validate(t){let e=w3(t.world);if(!e)return{valid:!1,error:Ni.CANT_WALK_THROUGH};let r=C3(t);if(!r)return{valid:!1,error:Ni.CANT_WALK_THROUGH};let n=R3(t.world),i=N3(t,r,e,n);return"error"in i?{valid:!1,error:i.error,params:{direction:r.replace("_"," ")}}:{valid:!0}},execute(t){let e=w3(t.world),r=C3(t),n=R3(t.world),i=N3(t,r,e,n);if(!("error"in i)){if(t.sharedData.previousLocation=t.currentLocation.id,t.sharedData.destination=i.destination,i.updateState){let o={...n,...i.updateState};Gfe(t.world,o)}t.world.moveEntity(t.player.id,i.destination)}},blocked(t,e){let r=e.params?.direction||"that";return[t.event("action.blocked",{actionId:Ci,messageId:e.error,reason:e.error,params:{direction:r}})]},report(t){let r=t.world.getEntity(t.sharedData.destination)?.get(e0.IdentityTrait),n=r?.name||"somewhere",i=r?.description||"";return[t.event("action.success",{actionId:Ci,messageId:Ni.WALK_THROUGH,message:"You feel somewhat disoriented as you pass through..."}),t.event("player.moved",{destination:t.sharedData.destination,destinationName:n}),t.event("if.event.room.description",{roomId:t.sharedData.destination,roomName:n,roomDescription:i,includeContents:!0,verbose:!0})]}};var P3=[D3];var kt="dungeo.say",st={NOTHING_TO_SAY:"dungeo.say.nothing",SAY_TO_AIR:"dungeo.say.to_air",NPC_RESPONDS:"dungeo.say.npc_responds",LOUD_ROOM_ECHO_DEATH:"dungeo.loud_room.echo_death",LOUD_ROOM_ECHO_SAFE:"dungeo.loud_room.echo_safe",LOUD_ROOM_ACOUSTICS:"dungeo.loud_room.acoustics",RIDDLE_CORRECT:"dungeo.riddle.correct",RIDDLE_WRONG:"dungeo.riddle.wrong",RIDDLE_ALREADY_SOLVED:"dungeo.riddle.already_solved"};var ni=S(b());var Rt=S(b());var Fe={BLOCKS:"dungeo.cyclops.blocks",GROWLS:"dungeo.cyclops.growls",IGNORES:"dungeo.cyclops.ignores",PANICS:"dungeo.cyclops.panics",FLEES:"dungeo.cyclops.flees",PASSAGE_OPENS:"dungeo.cyclops.passage_opens",ATTACKS:"dungeo.cyclops.attacks",COUNTERATTACKS:"dungeo.cyclops.counterattacks",WOUNDED:"dungeo.cyclops.wounded",DIES:"dungeo.cyclops.dies"};function L3(t){return{state:"GUARDING",roomId:t}}var Vfe=0;function Yfe(){return`cyclops-evt-${Date.now()}-${++Vfe}`}function t0(t,e){let r=t.createEntity("cyclops",Rt.EntityType.ACTOR);return r.add(new Rt.IdentityTrait({name:"huge cyclops",aliases:["cyclops","giant","monster","one-eyed giant","one-eyed monster"],description:"A huge cyclops stands here, blocking the northern passage. Its single eye glares at you menacingly.",properName:!1,article:"a"})),r.add(new Rt.ActorTrait({isPlayer:!1})),r.add(new Rt.NpcTrait({behaviorId:"cyclops",isHostile:!0,canMove:!1,customProperties:L3(e)})),r.add(new Rt.CombatantTrait({health:30,maxHealth:30,skill:60,baseDamage:8,armor:2,hostile:!0,canRetaliate:!0,dropsInventory:!1,deathMessage:"The cyclops crashes to the ground with a tremendous thud!"})),t.moveEntity(r.id,e),r.on={"if.event.death":(n,i)=>{let o=[],a=i.getEntity(e);a&&Rt.RoomBehavior.unblockExit(a,Rt.Direction.NORTH);let s=i.getCapability(Rt.StandardCapabilities.SCORING);return s&&(s.scoreValue=(s.scoreValue||0)+10,s.achievements||(s.achievements=[]),s.achievements.push("Defeated the cyclops")),o.push({id:Yfe(),type:"game.message",entities:{},data:{messageId:Fe.PASSAGE_OPENS},timestamp:Date.now(),narrate:!0}),o}},r}function Bg(t,e,r){let n=[],i=t.getEntity(r);i&&Rt.RoomBehavior.unblockExit(i,Rt.Direction.NORTH);let o=t.getCapability(Rt.StandardCapabilities.SCORING);o&&(o.scoreValue=(o.scoreValue||0)+10,o.achievements||(o.achievements=[]),o.achievements.push("Frightened away the cyclops"));let a=e.get(Rt.NpcTrait);return a?.customProperties&&(a.customProperties.state="FLED"),t.moveEntity(e.id,"void"),n}function M3(t){let e=t.command,r=e.parsed?.rawInput?.toLowerCase()||"";if(["echo","ulysses","odysseus","xyzzy"].includes(r))return r;let i=r.match(/^say\s+(?:to\s+\w+\s+)?["']?(.+?)["']?$/);if(i)return i[1].trim();let o=e.parsed?.extras||{};if(o.message)return String(o.message);if(o.arg)return String(o.arg);let a=r.replace(/^say\s*/,"");if(a)return a}function zfe(t){let e=t.currentLocation.get(ni.IdentityTrait);return e&&e.name?.toLowerCase().includes("loud room")||!1}function $fe(t){let e=t.currentLocation.get(ni.IdentityTrait);return e&&e.name?.toLowerCase().includes("riddle room")||!1}function Kfe(t){let e=t.player;if(!e)return!1;let r=t.world.getContents(e.id);for(let n of r){let i=n.get(ni.IdentityTrait);if(i&&(i.name?.toLowerCase().includes("platinum bar")||i.aliases?.some(o=>o.toLowerCase().includes("platinum"))))return!0}return!1}function Qfe(t){let e=[],r=t.currentLocation;return r.echoSolved?(e.push(t.event("action.success",{actionId:kt,messageId:st.LOUD_ROOM_ACOUSTICS})),e):(Kfe(t)?e.push(t.event("player.died",{actionId:kt,messageId:st.LOUD_ROOM_ECHO_DEATH,cause:"echo_reverberations"})):(r.echoSolved=!0,e.push(t.event("action.success",{actionId:kt,messageId:st.LOUD_ROOM_ECHO_SAFE}))),e)}function Xfe(t,e){let r=[],n=t.currentLocation;if(n.riddleSolved)return r.push(t.event("action.success",{actionId:kt,messageId:st.RIDDLE_ALREADY_SOLVED})),r;let i=e.toLowerCase().trim();if(i=i.replace(/^(answer|say|reply)\s+/,""),i=i.replace(/^["']|["']$/g,""),i==="well"||i==="a well"){n.riddleSolved=!0;let o=t.currentLocation.get(ni.RoomTrait);if(o){let s=t.world.getAllEntities().find(c=>c.get(ni.IdentityTrait)?.name?.toLowerCase()==="pearl room");s&&(o.exits[ni.Direction.EAST]={destination:s.id})}r.push(t.event("action.success",{actionId:kt,messageId:st.RIDDLE_CORRECT}))}else r.push(t.event("action.success",{actionId:kt,messageId:st.RIDDLE_WRONG}));return r}function Zfe(t){let e=t.currentLocation.id;return t.world.getAllEntities().filter(n=>n.get(ni.NpcTrait)?t.world.getLocation(n.id)===e:!1)}function Jfe(t){let e=t.get(ni.IdentityTrait);return e?e.name?.toLowerCase().includes("cyclops"):!1}function k3(t){let e=t.get(ni.NpcTrait);return e?.customProperties?e.customProperties:null}function epe(t,e,r){let n=[],i=r.toLowerCase();if(i.includes("odysseus")||i.includes("ulysses")){let o=k3(e);if(o?.state==="FLED")return[];let a=o?.roomId||t.currentLocation.id;n.push(t.event("npc.emoted",{npc:e.id,messageId:Fe.PANICS,npcName:"cyclops"})),n.push(t.event("npc.emoted",{npc:e.id,messageId:Fe.FLEES,npcName:"cyclops"}));let s=Bg(t.world,e,a);return n.push(...s),n.push(t.event("game.message",{messageId:Fe.PASSAGE_OPENS})),n}return n.push(t.event("npc.emoted",{npc:e.id,messageId:Fe.IGNORES,npcName:"cyclops"})),n}var x3={id:kt,group:"communication",validate(t){let e=M3(t);return!e||e.trim().length===0?{valid:!1,error:st.NOTHING_TO_SAY}:{valid:!0}},execute(t){let e=M3(t)||"";t.sharedData.spokenWords=e;let r=e.toLowerCase();if(zfe(t)&&r==="echo"){t.sharedData.isLoudRoomEcho=!0;return}if($fe(t)){t.sharedData.isRiddleAnswer=!0;return}let n=Zfe(t);t.sharedData.npcsInRoom=n,t.sharedData.npcResponses=[];let i=n.find(Jfe);i&&k3(i)?.state!=="FLED"&&(t.sharedData.hasCyclops=!0,t.sharedData.cyclops=i)},blocked(t,e){return[t.event("action.blocked",{actionId:kt,messageId:e.error||st.NOTHING_TO_SAY,reason:e.error})]},report(t){let e=[],r=t.sharedData.spokenWords;if(t.sharedData.isLoudRoomEcho)return Qfe(t);if(t.sharedData.isRiddleAnswer)return Xfe(t,r);let n=t.sharedData.npcsInRoom;if(t.sharedData.hasCyclops&&t.sharedData.cyclops){let i=epe(t,t.sharedData.cyclops,r);return e.push(...i),e}return!n||n.length===0?(e.push(t.event("action.success",{actionId:kt,messageId:st.SAY_TO_AIR,message:`You say "${r}" but nobody is here to listen.`})),e):(e.push(t.event("action.success",{actionId:kt,messageId:"npc.no_response",message:`You say "${r}".`})),e)}};var B3=[x3];var aS=S(b());var pl="DUNGEO_RING",Di={RING_SUCCESS:"dungeo.ring.success",RING_BELL:"dungeo.ring.bell",NOT_RINGABLE:"dungeo.ring.not_ringable",NO_TARGET:"dungeo.ring.no_target"};function r0(t){let e=t.get(aS.IdentityTrait);if(!e)return!1;let r=e.name?.toLowerCase()||"",n=e.aliases||[];return r.includes("bell")||n.some(i=>i.toLowerCase().includes("bell"))}function tpe(t){let{world:e,player:r}=t,n=e.getContents(r.id);for(let o of n)if(r0(o))return o;let i=e.getLocation(r.id);if(i){let o=e.getContents(i);for(let a of o)if(r0(a))return a}}function rpe(t){let e=t.command.parsed?.structure;if(!e?.directObject)return;let r=e.directObject.text||"";return{entity:t.world.getAllEntities().find(i=>{let o=i.get(aS.IdentityTrait);if(!o)return!1;let a=o.name?.toLowerCase()||"",s=o.aliases||[],c=r.toLowerCase();return a===c||s.some(l=>l.toLowerCase()===c)}),text:r}}var n0={id:pl,group:"manipulation",validate(t){let e=rpe(t);if(!e||!e.text){let n=tpe(t);return n?(t.sharedData.ringTarget=n,{valid:!0}):{valid:!1,error:Di.NO_TARGET}}let r=e.entity;return r?r0(r)?(t.sharedData.ringTarget=r,{valid:!0}):{valid:!1,error:Di.NOT_RINGABLE}:{valid:!1,error:"stdlib.errors.not_visible"}},execute(t){let{world:e,player:r,sharedData:n}=t,i=n.ringTarget;if(!i)return;let o=e.getLocation(r.id)||"",a=i.exorcismRole==="bell";a&&(e.setStateValue("dungeo.exorcism.bell_rung_location",o),e.setStateValue("dungeo.exorcism.bell_rung_turn",Date.now())),n.isExorcismBell=a,n.playerLocation=o},blocked(t,e){return[t.event("action.blocked",{actionId:pl,messageId:e.error||Di.NO_TARGET,reason:e.error})]},report(t){let{player:e,sharedData:r}=t,n=[],i=r.ringTarget;if(!i)return n;let a=i.get(aS.IdentityTrait)?.name||"item",s=r.isExorcismBell,c=r.playerLocation;return n.push(t.event("game.message",{messageId:s?Di.RING_BELL:Di.RING_SUCCESS,target:a,isExorcismItem:s,location:c})),n}};var ju="dungeo.action.push_wall",mt={NOT_IN_PUZZLE:"dungeo.push_wall.not_in_puzzle",NO_DIRECTION:"dungeo.push_wall.no_direction",INVALID_DIRECTION:"dungeo.push_wall.invalid_direction",NO_WALL:"dungeo.push_wall.no_wall",IMMOVABLE:"dungeo.push_wall.immovable",NO_ROOM:"dungeo.push_wall.no_room",BOUNDARY:"dungeo.push_wall.boundary",SUCCESS:"dungeo.push_wall.success",SUCCESS_FIRST:"dungeo.push_wall.success_first",LADDER_VISIBLE:"dungeo.push_wall.ladder_visible",CARD_VISIBLE:"dungeo.push_wall.card_visible"};var gl=S(b());var npe={[gl.Direction.NORTH]:"north",[gl.Direction.SOUTH]:"south",[gl.Direction.EAST]:"east",[gl.Direction.WEST]:"west"};function j3(t){let e=t.command.parsed?.extras?.direction;if(e)return npe[e]}function ipe(t){let e=t.currentLocation.get(gl.IdentityTrait);return e?e.name==="Room in a Puzzle":!1}function W3(t){return t.world.getAllEntities().find(r=>r.get(gl.IdentityTrait)?.name==="Royal Puzzle Controller")}var i0={id:ju,group:"puzzle",validate(t){let e=j3(t);if(!e)return{valid:!1,error:mt.NO_DIRECTION};if(!ipe(t))return{valid:!1,error:mt.NOT_IN_PUZZLE};let r=W3(t);if(!r)return{valid:!1,error:mt.NOT_IN_PUZZLE};let n=zr(r),i=m3(n,e);return i!=="success"?{valid:!1,error:{"no-wall":mt.NO_WALL,immovable:mt.IMMOVABLE,"no-room":mt.NO_ROOM,boundary:mt.BOUNDARY}[i]||mt.NO_ROOM}:{valid:!0}},execute(t){let e=W3(t),r=zr(e),n=j3(t),i=r.pushCount===0;t.sharedData.isFirstPush=i,t.sharedData.direction=n,t.sharedData.oldPosition=r.playerPos,f3(r,n),t.sharedData.newPosition=r.playerPos,t.sharedData.ladderVisible=jk(r),t.sharedData.cardVisible=Gm(r),t.sharedData.newDescription=Mu(r)},blocked(t,e){return[t.event("action.blocked",{actionId:ju,messageId:e.error,reason:e.error})]},report(t){let e=[],r=t.sharedData.isFirstPush?mt.SUCCESS_FIRST:mt.SUCCESS;return e.push(t.event("action.success",{actionId:ju,messageId:r,direction:t.sharedData.direction})),e.push(t.event("game.message",{messageId:"dungeo.puzzle.room_description",text:t.sharedData.newDescription})),e}};var H3=[i0];var o0=S(b());var ct={ENTER_PUZZLE:"dungeo.puzzle.enter",EXIT_PUZZLE:"dungeo.puzzle.exit",CANT_EXIT:"dungeo.puzzle.cant_exit",MOVE_BLOCKED:"dungeo.puzzle.move_blocked",MOVE_SUCCESS:"dungeo.puzzle.move_success",ROOM_DESCRIPTION:"dungeo.puzzle.room_description",TAKE_CARD:"dungeo.puzzle.take_card",CANT_TAKE_CARD:"dungeo.puzzle.cant_take_card",PUSH_SUCCESS:"dungeo.puzzle.push_success",PUSH_NO_WALL:"dungeo.puzzle.push_no_wall",PUSH_IMMOVABLE:"dungeo.puzzle.push_immovable",PUSH_NO_ROOM:"dungeo.puzzle.push_no_room"},U3="dungeo.royal_puzzle.controllerId",a0="dungeo.royal_puzzle.roomInPuzzleId",s0="dungeo.royal_puzzle.puzzleRoomId",q3="dungeo.royal_puzzle.goldCardId",ope=0;function ua(){return`royal-puzzle-${Date.now()}-${++ope}`}function sS(t){let e=t.getStateValue(U3);return e?t.getEntity(e):t.getAllEntities().find(n=>n.get(o0.IdentityTrait)?.name==="Royal Puzzle Controller")}function ape(t){let e=t.getStateValue(a0);if(!e)return!1;let r=t.getPlayer();return r?t.getLocation(r.id)===e:!1}function spe(t){let e=t.toLowerCase().replace(/[^a-z]/g,"");return{n:"north",north:"north",s:"south",south:"south",e:"east",east:"east",w:"west",west:"west",ne:"northeast",northeast:"northeast",nw:"northwest",northwest:"northwest",se:"southeast",southeast:"southeast",sw:"southwest",southwest:"southwest",u:"up",up:"up",d:"down",down:"down"}[e]||null}function F3(t,e){let r=sS(t);if(!r)return null;let n=zr(r);if(!n.inPuzzle)return null;let i=spe(e);if(!i)return null;let o=[];if(i==="up")if(iS(n)){n.inPuzzle=!1,n.hasExited=!0;let s=t.getStateValue(s0),c=t.getPlayer();if(s&&c&&t.moveEntity(c.id,s),o.push({id:ua(),type:"game.message",timestamp:Date.now(),entities:{},data:{messageId:ct.EXIT_PUZZLE},narrate:!0}),s){let u=t.getEntity(s)?.get(o0.IdentityTrait);o.push({id:ua(),type:"if.event.room.description",timestamp:Date.now(),entities:{},data:{roomId:s,roomName:u?.name||"Puzzle Room",roomDescription:u?.description||"",includeContents:!0,verbose:!0},narrate:!0})}return o}else return o.push({id:ua(),type:"game.message",timestamp:Date.now(),entities:{},data:{messageId:ct.CANT_EXIT},narrate:!0}),o;if(i==="down")return o.push({id:ua(),type:"game.message",timestamp:Date.now(),entities:{},data:{messageId:ct.MOVE_BLOCKED,direction:"down"},narrate:!0}),o;let a=i;return Bk(n,a)?(d3(n,a),o.push({id:ua(),type:"action.success",timestamp:Date.now(),entities:{},data:{actionId:"dungeo.puzzle.move",messageId:"puzzle_move_description",message:Mu(n)},narrate:!0}),o):(o.push({id:ua(),type:"game.message",timestamp:Date.now(),entities:{},data:{messageId:ct.MOVE_BLOCKED,direction:i},narrate:!0}),o)}function G3(t){let e=sS(t);if(!e)return null;let r=zr(e);if(!r.inPuzzle)return null;let n=[];if(Gm(r)){p3(r);let i=t.getStateValue(q3),o=t.getPlayer();return i&&o&&t.moveEntity(i,o.id),n.push({id:ua(),type:"game.message",timestamp:Date.now(),entities:{},data:{messageId:ct.TAKE_CARD},narrate:!0}),n.push({id:ua(),type:"if.event.taken",timestamp:Date.now(),entities:{target:i||"gold-card"},data:{targetId:i,targetName:"gold card"},narrate:!1}),n}return null}function cpe(t){let e=t.rawInput?.toLowerCase()||"",r=t.structure?.directObject?.head?.toLowerCase()||"";return!!(["card","gold card","golden card","royal card"].some(i=>r.includes(i.split(" ")[0]))||e.includes("card"))}function V3(){return(t,e)=>{if(!ape(e))return t;let r=t.action?.toLowerCase();if(r==="look"||r==="looking"||r==="if.action.looking")return{...t,action:"dungeo.puzzle.look",extras:{...t.extras,originalAction:r,isPuzzleLook:!0}};if(r==="take"||r==="taking"||r==="if.action.taking"||r==="get"){if(cpe(t)){let i=sS(e);if(i){let o=zr(i);return o.cardTaken?t:Gm(o)?{...t,action:"dungeo.puzzle.take_card",extras:{...t.extras,originalAction:r,isPuzzleTakeCard:!0}}:{...t,action:"dungeo.puzzle.take_card_blocked",extras:{...t.extras,originalAction:r,isPuzzleTakeCardBlocked:!0}}}}return t}if(r!=="go"&&r!=="going"&&r!=="if.action.going")return t;let n;return t.extras?.direction?n=String(t.extras.direction):t.structure?.directObject?.head&&(n=t.structure.directObject.head),n?{...t,action:"dungeo.puzzle.move",extras:{...t.extras,direction:n,originalAction:r,isPuzzleMove:!0}}:t}}function lpe(t){let e=zr(t);e.inPuzzle=!0,e.playerPos=po}function Y3(t,e){let r={id:"dungeo-royal-puzzle-entry",name:"Royal Puzzle Entry",priority:80,condition:i=>{let o=i.world.getStateValue("dungeo.royal_puzzle.prevLocation"),a=i.world.getStateValue(s0),s=i.world.getStateValue(a0);return o===a&&i.playerLocation===s},run:i=>{let{world:o}=i,a=[],s=sS(o);if(!s)return a;lpe(s),a.push({id:ua(),type:"game.message",timestamp:Date.now(),entities:{},data:{messageId:ct.ENTER_PUZZLE},narrate:!0});let c=zr(s);return a.push({id:ua(),type:"action.success",timestamp:Date.now(),entities:{},data:{actionId:"dungeo.puzzle.entry",messageId:"puzzle_entry_description",message:Mu(c)},narrate:!0}),a}},n={id:"dungeo-royal-puzzle-tracking",name:"Royal Puzzle Location Tracking",priority:-100,condition:i=>!0,run:i=>(i.world.setStateValue("dungeo.royal_puzzle.prevLocation",i.playerLocation),[])};t.registerDaemon(r),t.registerDaemon(n)}function z3(t,e){t.setStateValue(U3,e.puzzleController),t.setStateValue(a0,e.roomInPuzzle),t.setStateValue(s0,e.puzzleRoom),t.setStateValue(q3,e.goldCard)}var upe=0;function $3(){return`puzzle-move-${Date.now()}-${++upe}`}var c0={id:"dungeo.puzzle.move",requiredMessages:[],metadata:{requiresDirectObject:!1,requiresIndirectObject:!1},validate(t){let e=t.command.parsed.extras?.direction;return e?(t.sharedData.direction=e,{valid:!0}):{valid:!1,error:"action.going.no_direction"}},execute(t){let e=t.sharedData.direction,r=F3(t.world,e);t.sharedData.puzzleEvents=r},report(t){let e=t.sharedData.puzzleEvents;return e&&e.length>0?e:[{id:$3(),type:"game.message",timestamp:Date.now(),entities:{},data:{messageId:ct.MOVE_BLOCKED,direction:t.sharedData.direction||"unknown"},narrate:!0}]},blocked(t,e){return[{id:$3(),type:"action.error",timestamp:Date.now(),entities:{},data:{actionId:"dungeo.puzzle.move",messageId:e.error||"action.going.no_direction",params:e.params||{}}}]}};var l0="dungeo.puzzle.take_card",dpe=0;function K3(){return`puzzle-take-card-${Date.now()}-${++dpe}`}var u0={id:l0,requiredMessages:[],metadata:{requiresDirectObject:!1,requiresIndirectObject:!1},validate(t){return{valid:!0}},execute(t){let e=G3(t.world);t.sharedData.takeCardEvents=e},report(t){let e=t.sharedData.takeCardEvents;return e&&e.length>0?e:[{id:K3(),type:"game.message",timestamp:Date.now(),entities:{},data:{messageId:ct.CANT_TAKE_CARD},narrate:!0}]},blocked(t,e){return[{id:K3(),type:"action.error",timestamp:Date.now(),entities:{},data:{actionId:l0,messageId:e.error||ct.CANT_TAKE_CARD,params:e.params||{}}}]}};var cS="dungeo.puzzle.take_card_blocked",lS={CANT_REACH:"dungeo.puzzle.cant_reach_card"},mpe=0;function Q3(){return`puzzle-take-card-blocked-${Date.now()}-${++mpe}`}var d0={id:cS,requiredMessages:[lS.CANT_REACH],metadata:{requiresDirectObject:!1,requiresIndirectObject:!1},validate(t){return{valid:!0}},execute(t){},report(t){return[{id:Q3(),type:"action.success",timestamp:Date.now(),entities:{},data:{actionId:cS,messageId:lS.CANT_REACH,message:"You can see the gold card set in a depression in one of the sandstone walls, but you can't reach it from here."},narrate:!0}]},blocked(t,e){return[{id:Q3(),type:"action.error",timestamp:Date.now(),entities:{},data:{actionId:cS,messageId:lS.CANT_REACH}}]}};var X3=S(b());var uS="dungeo.puzzle.look",fpe=0;function m0(){return`puzzle-look-${Date.now()}-${++fpe}`}var ppe="dungeo.royal_puzzle.controllerId";function gpe(t){let e=t.getStateValue(ppe);return e?t.getEntity(e):t.getAllEntities().find(n=>n.get(X3.IdentityTrait)?.name==="Royal Puzzle Controller")}var f0={id:uS,requiredMessages:[],metadata:{requiresDirectObject:!1,requiresIndirectObject:!1},validate(t){return{valid:!0}},execute(t){},report(t){let e=gpe(t.world);if(!e)return[{id:m0(),type:"if.event.room.description",timestamp:Date.now(),entities:{},data:{roomName:"Room in a Puzzle",roomDescription:"You are in a maze of sandstone walls."},narrate:!0}];let r=zr(e),n=Mu(r);return[{id:m0(),type:"action.success",timestamp:Date.now(),entities:{},data:{actionId:uS,messageId:"puzzle_look_description",message:`Room in a Puzzle
${n}`},narrate:!0}]},blocked(t,e){return[{id:m0(),type:"action.error",timestamp:Date.now(),entities:{},data:{actionId:uS,messageId:"puzzle_look_error"}}]}};var g0=S(b());var Wu="DUNGEO_BREAK",An={BREAK_SUCCESS:"dungeo.break.success",BREAK_FRAME:"dungeo.break.frame",CANT_BREAK:"dungeo.break.cant_break",NO_TARGET:"dungeo.break.no_target",NOT_VISIBLE:"dungeo.break.not_visible"};function p0(t){return t.isBreakable===!0}function hpe(t){return t.isEmptyFrame===!0}function ype(t){let e=t.command.parsed?.structure;if(!e?.directObject)return;let r=e.directObject.text||"";return{entity:t.world.getAllEntities().find(i=>{let o=i.get(g0.IdentityTrait);if(!o)return!1;let a=o.name?.toLowerCase()||"",s=o.aliases||[],c=r.toLowerCase();return a.includes(c)||c.includes(a)||s.some(l=>l.toLowerCase().includes(c)||c.includes(l.toLowerCase()))}),text:r}}function vpe(t){let{world:e,player:r}=t,n=e.getContents(r.id);for(let o of n)if(p0(o))return o;let i=e.getLocation(r.id);if(i){let o=e.getContents(i);for(let a of o)if(p0(a))return a}}var h0={id:Wu,group:"manipulation",validate(t){let e=ype(t);if(!e||!e.text){let n=vpe(t);return n?(t.sharedData.breakTarget=n,{valid:!0}):{valid:!1,error:An.NO_TARGET}}let r=e.entity;return r?p0(r)?(t.sharedData.breakTarget=r,{valid:!0}):{valid:!1,error:An.CANT_BREAK,params:{target:e.text}}:{valid:!1,error:An.NOT_VISIBLE}},execute(t){let{world:e,player:r,sharedData:n}=t,i=n.breakTarget;if(!i)return;let o=e.getLocation(r.id)||"";if(hpe(i)){e.removeEntity(i.id);let s=F5(e);e.moveEntity(s.id,o),n.isFrame=!0,n.framePieceId=s.id}n.playerLocation=o},blocked(t,e){return[t.event("action.blocked",{actionId:Wu,messageId:e.error||An.NO_TARGET,reason:e.error,params:e.params})]},report(t){let{sharedData:e}=t,r=[],n=e.breakTarget;if(!n)return r;let o=n.get(g0.IdentityTrait)?.name||"item",a=e.isFrame;return r.push(t.event("game.message",{messageId:a?An.BREAK_FRAME:An.BREAK_SUCCESS,target:o,framePieceId:e.framePieceId})),r}};var dS=S(b());var Hu="DUNGEO_BURN",xt={BURN_SUCCESS:"dungeo.burn.success",BURN_INCENSE:"dungeo.burn.incense",ALREADY_BURNING:"dungeo.burn.already_burning",BURNED_OUT:"dungeo.burn.burned_out",CANT_BURN:"dungeo.burn.cant_burn",NO_TARGET:"dungeo.burn.no_target",NOT_VISIBLE:"dungeo.burn.not_visible"};function y0(t){return t.isIncense===!0}function Z3(t){return t.isBurning===!0}function J3(t){return t.burnedOut===!0}function Epe(t){let e=t.command.parsed?.structure;if(!e?.directObject)return;let r=e.directObject.text||"";return{entity:t.world.getAllEntities().find(i=>{let o=i.get(dS.IdentityTrait);if(!o)return!1;let a=o.name?.toLowerCase()||"",s=o.aliases||[],c=r.toLowerCase();return a.includes(c)||c.includes(a)||s.some(l=>l.toLowerCase().includes(c)||c.includes(l.toLowerCase()))}),text:r}}function Tpe(t){let{world:e,player:r}=t,n=e.getContents(r.id);for(let o of n)if(y0(o))return o;let i=e.getLocation(r.id);if(i){let o=e.getContents(i);for(let a of o)if(y0(a))return a}}var v0={id:Hu,group:"manipulation",validate(t){let e=Epe(t);if(!e||!e.text){let n=Tpe(t);return n?Z3(n)?{valid:!1,error:xt.ALREADY_BURNING}:J3(n)?{valid:!1,error:xt.BURNED_OUT}:(t.sharedData.burnTarget=n,{valid:!0}):{valid:!1,error:xt.NO_TARGET}}let r=e.entity;return r?y0(r)?Z3(r)?{valid:!1,error:xt.ALREADY_BURNING}:J3(r)?{valid:!1,error:xt.BURNED_OUT}:(t.sharedData.burnTarget=r,{valid:!0}):{valid:!1,error:xt.CANT_BURN,params:{target:e.text}}:{valid:!1,error:xt.NOT_VISIBLE}},execute(t){let{world:e,sharedData:r}=t,n=r.burnTarget;if(!n)return;n.isBurning=!0,e.setStateValue("dungeo.incense.burning_id",n.id),r.incenseId=n.id;let i=e.getLocation(t.player.id);if(i){let o=e.getEntity(i);o?.get(dS.IdentityTrait)?.name==="Basin Room"&&(o.basinState="disarmed",r.basinDisarmed=!0)}},blocked(t,e){return[t.event("action.blocked",{actionId:Hu,messageId:e.error||xt.NO_TARGET,reason:e.error,params:e.params})]},report(t){let{sharedData:e}=t,r=[],n=e.burnTarget;if(!n)return r;let o=n.get(dS.IdentityTrait)?.name||"item";return r.push(t.event("game.message",{messageId:xt.BURN_INCENSE,target:o,incenseId:e.incenseId})),r}};var E0=S(b());var hl="DUNGEO_PRAY",da={PRAY_GENERIC:"dungeo.pray.generic",PRAY_TELEPORT:"dungeo.pray.teleport"};function _pe(t){return t.currentLocation.get(E0.IdentityTrait)?.name==="Altar"}function bpe(t){return t.world.getAllEntities().find(r=>{let n=r.get(E0.IdentityTrait);return n?.name==="Forest Path"&&n?.aliases?.includes("forest path 1")})?.id}var T0={id:hl,group:"communication",validate(t){let e=_pe(t);if(t.sharedData.atAltar=e,e){let r=bpe(t);r?t.sharedData.forestId=r:t.sharedData.forestNotFound=!0}return{valid:!0}},execute(t){let{world:e,player:r,sharedData:n}=t;if(!n.atAltar){n.resultMessage=da.PRAY_GENERIC;return}if(n.forestNotFound){n.resultMessage=da.PRAY_GENERIC;return}let i=n.forestId;e.moveEntity(r.id,i),n.teleported=!0,n.resultMessage=da.PRAY_TELEPORT},blocked(t,e){return[]},report(t){let{sharedData:e}=t,r=[],n=e.resultMessage||da.PRAY_GENERIC;return r.push(t.event("game.message",{messageId:n,teleported:e.teleported||!1})),e.teleported&&e.forestId&&r.push(t.event("player.teleported",{actionId:hl,destination:e.forestId,messageId:da.PRAY_TELEPORT})),r}};var jg="dungeo:incant",Ls={success:"dungeo.incant.success",failure:"dungeo.incant.failure",syntax:"dungeo.incant.syntax"};var e2=S(b());function t2(t){let e="ECORMS",r=t.toUpperCase().padEnd(6," ").substring(0,6),n=e.split("").map(m=>m.charCodeAt(0)-64),i=[],o=0,a=r.trim()||" ";for(let m=0;m<6;m++){let f=o<r.length?r[o]:" ";f.charCodeAt(0)<=64&&(o=0,f=a[0]),i.push(f.charCodeAt(0)-64),o=(o+1)%a.length}let s=i.reduce((m,f)=>m+f,0),c=n.reduce((m,f)=>m+f,0),l=s%8+8*(c%8),u=[];for(let m=0;m<6;m++){let f=(i[m]^n[m]^l)&31;l=(l+1)%32,f>26&&(f=f%26),f=Math.max(1,f),u.push(String.fromCharCode(f+64))}return u.join("")}function Ope(t){let e=t.command.parsed?.textSlots;if(e){let r=e.get("challenge"),n=e.get("response");if(r&&n)return{challenge:r.toUpperCase(),response:n.toUpperCase()}}return null}var _0={id:jg,group:"meta",validate(t){let e=Ope(t);if(!e)return{valid:!1,error:Ls.syntax};let r=t2(e.challenge);return e.response!==r?{valid:!1,error:Ls.failure}:{valid:!0}},execute(t){let{world:e,player:r}=t;e.setStateValue("game.endgameStarted",!0),e.setStateValue("game.savingDisabled",!0),e.setStateValue("scoring.endgameScore",15),e.setStateValue("scoring.endgameMaxScore",100);let i=e.getAllEntities().find(a=>{let s=a.get(e2.IdentityTrait);return s?.name?.toLowerCase().includes("elvish sword")||s?.aliases?.some(c=>c.toLowerCase().includes("elvish sword"))});i&&(e.getContents(r.id).some(c=>c.id===i.id)||e.moveEntity(i.id,r.id));let o=e.getStateValue("endgame.topOfStairsId");o?e.moveEntity(r.id,o):e.setStateValue("endgame.pendingTeleport",!0),t.sharedData.incantSuccess=!0},blocked(t,e){return[t.event("action.blocked",{actionId:jg,messageId:e.error||Ls.failure,reason:e.error})]},report(t){let{sharedData:e}=t,r=[];return e.incantSuccess&&r.push(t.event("game.message",{messageId:Ls.success})),r}};var f2=S(b());var Ms="DUNGEO_LIFT",Rn={LIFT_SUCCESS:"dungeo.lift.success",LIFT_POLE:"dungeo.mirror.pole_raised",POLE_ALREADY_RAISED:"dungeo.mirror.pole_already_raised",CANT_LIFT:"dungeo.lift.cant_lift",NO_TARGET:"dungeo.lift.no_target",NOT_VISIBLE:"dungeo.lift.not_visible",NOT_IN_MIRROR:"dungeo.lift.not_in_mirror"};var Hg=S(b()),he={POLE_RAISED:"dungeo.mirror.pole_raised",POLE_LOWERED_CHANNEL:"dungeo.mirror.pole_lowered_channel",POLE_LOWERED_FLOOR:"dungeo.mirror.pole_lowered_floor",POLE_ALREADY_RAISED:"dungeo.mirror.pole_already_raised",POLE_ALREADY_LOWERED:"dungeo.mirror.pole_already_lowered",POLE_CANT_LOWER:"dungeo.mirror.pole_cant_lower",BOX_ROTATES:"dungeo.mirror.box_rotates",BOX_MOVES:"dungeo.mirror.box_moves",BOX_CANT_ROTATE:"dungeo.mirror.box_cant_rotate",BOX_CANT_MOVE_UNLOCKED:"dungeo.mirror.box_cant_move_unlocked",BOX_CANT_MOVE_ORIENTATION:"dungeo.mirror.box_cant_move_orientation",BOX_AT_END:"dungeo.mirror.box_at_end",ENTER_MIRROR:"dungeo.mirror.enter",EXIT_MIRROR:"dungeo.mirror.exit",CANT_EXIT:"dungeo.mirror.cant_exit",NO_MIRROR_HERE:"dungeo.mirror.no_mirror_here",TBAR_DIRECTION:"dungeo.mirror.tbar_direction"},i2="insideMirror.direction",o2="insideMirror.position",gS="insideMirror.poleState",mS="insideMirror.poleJustRaised",Wg="insideMirror.poleJustLowered",fS="insideMirror.boxJustRotated",pS="insideMirror.boxJustMoved",b0="insideMirror.justEntered",O0="insideMirror.justExited",I0="insideMirror.actionBlocked",r2="insideMirror.blockedMessage",hS=0,a2=1,n2=2,S0=0,Ipe=45,Spe=90,Ape=135,s2=180,Rpe=225,wpe=270,Cpe=315;function go(t){return{direction:t.getStateValue(i2)||0,position:t.getStateValue(o2)||0,poleState:t.getStateValue(gS)??a2}}function c2(t){return t===S0||t===s2}function Npe(t){let e=go(t);return e.position===3&&e.direction===S0}function Dpe(t){return{[S0]:"north",[Ipe]:"northeast",[Spe]:"east",[Ape]:"southeast",[s2]:"south",[Rpe]:"southwest",[wpe]:"west",[Cpe]:"northwest"}[t]||"north"}function l2(t){return go(t).poleState===n2?{success:!1,message:he.POLE_ALREADY_RAISED}:(t.setStateValue(gS,n2),t.setStateValue(mS,!0),{success:!0,message:he.POLE_RAISED})}function u2(t){let e=go(t);return e.poleState===hS?{success:!1,message:he.POLE_ALREADY_LOWERED}:c2(e.direction)?(t.setStateValue(gS,hS),t.setStateValue(Wg,"channel"),{success:!0,message:he.POLE_LOWERED_CHANNEL}):(t.setStateValue(gS,a2),t.setStateValue(Wg,"floor"),{success:!0,message:he.POLE_LOWERED_FLOOR})}function A0(t,e){let r=go(t);if(r.poleState===hS)return{success:!1,message:he.BOX_CANT_ROTATE};let n=e?45:-45,i=(r.direction+n)%360;return i<0&&(i+=360),t.setStateValue(i2,i),t.setStateValue(fS,Dpe(i)),{success:!0,message:he.BOX_ROTATES}}function R0(t,e){let r=go(t);if(r.poleState!==hS)return{success:!1,message:he.BOX_CANT_MOVE_UNLOCKED};if(!c2(r.direction))return{success:!1,message:he.BOX_CANT_MOVE_ORIENTATION};let n=e?1:-1,i=r.position+n;return i<0||i>3?{success:!1,message:he.BOX_AT_END}:(t.setStateValue(o2,i),t.setStateValue(pS,i),{success:!0,message:he.BOX_MOVES})}function d2(t,e,r,n,i,o){function a(){let s=e.getEntity(n);if(!s)return;let c=s.get(Hg.RoomTrait);c&&(c.exits={[Hg.Direction.OUT]:{destination:r}},Npe(e)&&(c.exits[Hg.Direction.NORTH]={destination:i}))}if(o){let s={id:"dungeo-inside-mirror-feedback",name:"Inside Mirror Feedback",priority:30,condition:c=>{let{world:l}=c;return l.getStateValue(mS)===!0||l.getStateValue(Wg)!==void 0||l.getStateValue(fS)!==void 0||l.getStateValue(pS)!==void 0||l.getStateValue(b0)===!0||l.getStateValue(O0)===!0||l.getStateValue(I0)===!0},run:c=>{let{world:l}=c,u=[];a(),l.getStateValue(mS)&&(u.push({id:`mirror-pole-raised-${Date.now()}`,type:"game.message",timestamp:Date.now(),entities:{},data:{messageId:he.POLE_RAISED}}),l.setStateValue(mS,void 0));let m=l.getStateValue(Wg);if(m){let h=m==="channel"?he.POLE_LOWERED_CHANNEL:he.POLE_LOWERED_FLOOR;u.push({id:`mirror-pole-lowered-${Date.now()}`,type:"game.message",timestamp:Date.now(),entities:{},data:{messageId:h}}),l.setStateValue(Wg,void 0)}let f=l.getStateValue(fS);f&&(u.push({id:`mirror-box-rotated-${Date.now()}`,type:"game.message",timestamp:Date.now(),entities:{},data:{messageId:he.BOX_ROTATES,params:{direction:f}}}),u.push({id:`mirror-tbar-${Date.now()}`,type:"game.message",timestamp:Date.now(),entities:{},data:{messageId:he.TBAR_DIRECTION,params:{direction:f}}}),l.setStateValue(fS,void 0));let g=l.getStateValue(pS);if(g!==void 0&&(u.push({id:`mirror-box-moved-${Date.now()}`,type:"game.message",timestamp:Date.now(),entities:{},data:{messageId:he.BOX_MOVES,params:{position:g}}}),l.setStateValue(pS,void 0)),l.getStateValue(b0)&&(u.push({id:`mirror-entered-${Date.now()}`,type:"game.message",timestamp:Date.now(),entities:{},data:{messageId:he.ENTER_MIRROR}}),l.setStateValue(b0,void 0)),l.getStateValue(O0)&&(u.push({id:`mirror-exited-${Date.now()}`,type:"game.message",timestamp:Date.now(),entities:{},data:{messageId:he.EXIT_MIRROR}}),l.setStateValue(O0,void 0)),l.getStateValue(I0)){let h=l.getStateValue(r2);u.push({id:`mirror-blocked-${Date.now()}`,type:"game.message",timestamp:Date.now(),entities:{},data:{messageId:h||he.CANT_EXIT}}),l.setStateValue(I0,void 0),l.setStateValue(r2,void 0)}return u}};o.registerDaemon(s)}a()}var m2=2;function p2(t){return t.poleType==="short"}function Ppe(t){let e=t.command.parsed?.structure;if(!e?.directObject)return;let r=e.directObject.text||"";return{entity:t.world.getAllEntities().find(i=>{let o=i.get(f2.IdentityTrait);if(!o)return!1;let a=o.name?.toLowerCase()||"",s=o.aliases||[],c=r.toLowerCase();return a.includes(c)||c.includes(a)||s.some(l=>l.toLowerCase().includes(c)||c.includes(l.toLowerCase()))}),text:r}}function Lpe(t){let{world:e,player:r}=t,n=e.getLocation(r.id);if(!n)return;let i=e.getContents(n);for(let o of i)if(p2(o))return o}var w0={id:Ms,group:"manipulation",validate(t){let{world:e,player:r}=t,n=Ppe(t),i=e.getStateValue("endgame.insideMirrorId");if(e.getLocation(r.id)!==i)return{valid:!1,error:Rn.NOT_IN_MIRROR};if(!n||!n.text){let c=Lpe(t);return c?go(e).poleState===m2?{valid:!1,error:Rn.POLE_ALREADY_RAISED}:(t.sharedData.liftTarget=c,{valid:!0}):{valid:!1,error:Rn.NO_TARGET}}let a=n.entity;return a?p2(a)?go(e).poleState===m2?{valid:!1,error:Rn.POLE_ALREADY_RAISED}:(t.sharedData.liftTarget=a,{valid:!0}):{valid:!1,error:Rn.CANT_LIFT,params:{target:n.text}}:{valid:!1,error:Rn.NOT_VISIBLE}},execute(t){let{world:e,sharedData:r}=t;if(!r.liftTarget)return;let i=l2(e);r.liftResult=i},blocked(t,e){return[t.event("action.blocked",{actionId:Ms,messageId:e.error||Rn.NO_TARGET,reason:e.error,params:e.params})]},report(t){let{sharedData:e}=t,r=[],n=e.liftResult;return!n||!n.success||r.push(t.event("if.event.lifted",{messageId:n.message,targetId:e.liftTarget?.id})),r}};var h2=S(b());var Uu="DUNGEO_LOWER",wn={LOWER_SUCCESS:"dungeo.lower.success",LOWER_POLE_CHANNEL:"dungeo.mirror.pole_lowered_channel",LOWER_POLE_FLOOR:"dungeo.mirror.pole_lowered_floor",POLE_ALREADY_LOWERED:"dungeo.mirror.pole_already_lowered",CANT_LOWER:"dungeo.lower.cant_lower",NO_TARGET:"dungeo.lower.no_target",NOT_VISIBLE:"dungeo.lower.not_visible",NOT_IN_MIRROR:"dungeo.lower.not_in_mirror"};var g2=0;function y2(t){return t.poleType==="short"}function Mpe(t){let e=t.command.parsed?.structure;if(!e?.directObject)return;let r=e.directObject.text||"";return{entity:t.world.getAllEntities().find(i=>{let o=i.get(h2.IdentityTrait);if(!o)return!1;let a=o.name?.toLowerCase()||"",s=o.aliases||[],c=r.toLowerCase();return a.includes(c)||c.includes(a)||s.some(l=>l.toLowerCase().includes(c)||c.includes(l.toLowerCase()))}),text:r}}function kpe(t){let{world:e,player:r}=t,n=e.getLocation(r.id);if(!n)return;let i=e.getContents(n);for(let o of i)if(y2(o))return o}var C0={id:Uu,group:"manipulation",validate(t){let{world:e,player:r}=t,n=Mpe(t),i=e.getStateValue("endgame.insideMirrorId");if(e.getLocation(r.id)!==i)return{valid:!1,error:wn.NOT_IN_MIRROR};if(!n||!n.text){let c=kpe(t);return c?go(e).poleState===g2?{valid:!1,error:wn.POLE_ALREADY_LOWERED}:(t.sharedData.lowerTarget=c,{valid:!0}):{valid:!1,error:wn.NO_TARGET}}let a=n.entity;return a?y2(a)?go(e).poleState===g2?{valid:!1,error:wn.POLE_ALREADY_LOWERED}:(t.sharedData.lowerTarget=a,{valid:!0}):{valid:!1,error:wn.CANT_LOWER,params:{target:n.text}}:{valid:!1,error:wn.NOT_VISIBLE}},execute(t){let{world:e,sharedData:r}=t;if(!r.lowerTarget)return;let i=u2(e);r.lowerResult=i},blocked(t,e){return[t.event("action.blocked",{actionId:Uu,messageId:e.error||wn.NO_TARGET,reason:e.error,params:e.params})]},report(t){let{sharedData:e}=t,r=[],n=e.lowerResult;return!n||!n.success||r.push(t.event("if.event.lowered",{messageId:n.message,targetId:e.lowerTarget?.id})),r}};var v2=S(b());var wt="dungeo.action.push_panel",ho={BOX_ROTATES:"dungeo.mirror.box_rotates",BOX_MOVES:"dungeo.mirror.box_moves",NOT_IN_MIRROR:"dungeo.push_panel.not_in_mirror",NO_TARGET:"dungeo.push_panel.no_target",NOT_VISIBLE:"dungeo.push_panel.not_visible",NOT_A_PANEL:"dungeo.push_panel.not_a_panel",BOX_CANT_ROTATE:"dungeo.mirror.box_cant_rotate",BOX_CANT_MOVE_UNLOCKED:"dungeo.mirror.box_cant_move_unlocked",BOX_CANT_MOVE_ORIENTATION:"dungeo.mirror.box_cant_move_orientation",BOX_AT_END:"dungeo.mirror.box_at_end"};var xpe=["red","yellow","mahogany","pine"];function E2(t){return t.isPanel===!0}function T2(t){return t.panelType}function Bpe(t){let e=t.toLowerCase();for(let r of xpe)if(e.includes(r))return r}function jpe(t,e){let{world:r,player:n}=t,i=r.getLocation(n.id);if(!i)return;let o=r.getContents(i);for(let a of o)if(E2(a)&&T2(a)===e)return a}function Wpe(t,e){let{world:r,player:n}=t,i=r.getLocation(n.id);if(!i)return;let o=r.getContents(i),a=e.toLowerCase();for(let s of o){if(!E2(s))continue;let c=s.get(v2.IdentityTrait);if(!c)continue;let l=c.name?.toLowerCase()||"",u=c.aliases||[];if(l.includes(a)||a.includes(l)||u.some(m=>m.toLowerCase().includes(a)||a.includes(m.toLowerCase())))return s}}function Hpe(t){return t.command.parsed?.structure?.directObject?.text}var N0={id:wt,group:"manipulation",validate(t){let{world:e,player:r}=t,n=e.getStateValue("endgame.insideMirrorId");if(e.getLocation(r.id)!==n)return{valid:!1,error:ho.NOT_IN_MIRROR};let o=Hpe(t),a=t.command.parsed?.rawInput||"",s=Bpe(a),c,l;return s?(c=jpe(t,s),l=s):o&&(c=Wpe(t,o),c&&(l=T2(c))),!c||!l?{valid:!1,error:ho.NOT_VISIBLE,params:{target:o||s||"panel"}}:(t.sharedData.pushTarget=c,t.sharedData.panelType=l,{valid:!0})},execute(t){let{world:e,sharedData:r}=t,n=r.panelType;if(!n)return;let i;n==="red"?i=A0(e,!0):n==="yellow"?i=A0(e,!1):n==="mahogany"?i=R0(e,!0):n==="pine"?i=R0(e,!1):i={success:!1,message:ho.NOT_A_PANEL},r.pushResult=i},blocked(t,e){return[t.event("action.blocked",{actionId:wt,messageId:e.error||ho.NO_TARGET,reason:e.error,params:e.params})]},report(t){let{sharedData:e}=t,r=[],n=e.pushResult;if(!n)return r;let i=e.pushTarget,o=e.panelType;return n.success?r.push(t.event("if.event.pushed",{messageId:n.message,targetId:i?.id,panelType:o})):r.push(t.event("action.blocked",{actionId:wt,messageId:n.message,reason:n.message,params:{target:i?.name}})),r}};var yl="dungeo.knock",$r={KNOCK_GENERIC:"dungeo.knock.generic",KNOCK_DOOR:"dungeo.knock.door",DM_APPEARS:"dungeo.knock.dm_appears",DM_ALREADY_APPEARED:"dungeo.knock.dm_already_appeared",TRIVIA_ALREADY_PASSED:"dungeo.knock.trivia_already_passed",TRIVIA_ALREADY_FAILED:"dungeo.knock.trivia_already_failed",NOTHING_TO_KNOCK:"dungeo.knock.nothing_to_knock"};var _2=S(b());function Upe(t){let{world:e,player:r}=t,n=e.getLocation(r.id);if(!n)return!1;let i=e.getEntity(n);return i?i.get(_2.IdentityTrait)?.name==="Dungeon Entrance":!1}function qpe(t){let{world:e}=t;return{questionsAnswered:e.getStateValue("trivia.questionsAnswered")??0,wrongAttempts:e.getStateValue("trivia.wrongAttempts")??0,currentQuestion:e.getStateValue("trivia.currentQuestion")??-1,isComplete:e.getStateValue("trivia.isComplete")??!1,passed:e.getStateValue("trivia.passed")??!1}}function Fpe(t,e){let{world:r}=t;r.setStateValue("trivia.questionsAnswered",e.questionsAnswered),r.setStateValue("trivia.wrongAttempts",e.wrongAttempts),r.setStateValue("trivia.currentQuestion",e.currentQuestion),r.setStateValue("trivia.isComplete",e.isComplete),r.setStateValue("trivia.passed",e.passed)}var b2={id:yl,group:"interaction",validate(t){let e=Upe(t);if(t.sharedData.atDungeonEntrance=e,e){let r=qpe(t);t.sharedData.triviaState=r}return{valid:!0}},execute(t){let{sharedData:e}=t;if(!e.atDungeonEntrance){e.resultMessage=$r.KNOCK_GENERIC;return}let r=e.triviaState;if(r.isComplete){r.passed?e.resultMessage=$r.TRIVIA_ALREADY_PASSED:e.resultMessage=$r.TRIVIA_ALREADY_FAILED;return}if(r.currentQuestion!==-1){e.resultMessage=$r.DM_ALREADY_APPEARED,e.questionMessageId=Mg(r);return}let n=E3(r);Fpe(t,n),e.newTriviaState=n,e.resultMessage=$r.DM_APPEARS,e.questionMessageId=Mg(n)},blocked(t,e){return[]},report(t){let{sharedData:e}=t,r=[],n=e.resultMessage||$r.KNOCK_GENERIC;return r.push(t.event("game.message",{messageId:n,atDungeonEntrance:e.atDungeonEntrance})),e.questionMessageId&&r.push(t.event("game.message",{messageId:e.questionMessageId})),r}};var Ug="dungeo.answer",Pi={NO_QUESTION:"dungeo.answer.no_question",NO_ANSWER_GIVEN:"dungeo.answer.no_answer_given",TRIVIA_NOT_STARTED:"dungeo.answer.trivia_not_started",TRIVIA_ALREADY_PASSED:"dungeo.answer.trivia_already_passed",TRIVIA_ALREADY_FAILED:"dungeo.answer.trivia_already_failed"};var ii=S(b());function Gpe(t){let{world:e,player:r}=t,n=e.getLocation(r.id);if(!n)return!1;let i=e.getEntity(n);return i?i.get(ii.IdentityTrait)?.name==="Dungeon Entrance":!1}function Vpe(t){let e=t.currentLocation.get(ii.IdentityTrait);return e&&e.name?.toLowerCase().includes("riddle room")||!1}function Ype(t){return t.currentLocation.riddleSolved===!0}function zpe(t,e){let{world:r}=t;for(let n of r.getAllEntities())if(n.get(ii.IdentityTrait)?.name===e)return n.id;return null}function $pe(t){let{world:e,player:r}=t,n=e.getLocation(r.id);if(!n)return;let i=e.getEntity(n);if(!i)return;let o=zpe(t,"Narrow Corridor");if(!o)return;let a=i.get(ii.RoomTrait);a&&(a.exits[ii.Direction.NORTH]={destination:o})}function Kpe(t){let{world:e}=t;return{questionsAnswered:e.getStateValue("trivia.questionsAnswered")??0,wrongAttempts:e.getStateValue("trivia.wrongAttempts")??0,currentQuestion:e.getStateValue("trivia.currentQuestion")??-1,isComplete:e.getStateValue("trivia.isComplete")??!1,passed:e.getStateValue("trivia.passed")??!1}}function Qpe(t,e){let{world:r}=t;r.setStateValue("trivia.questionsAnswered",e.questionsAnswered),r.setStateValue("trivia.wrongAttempts",e.wrongAttempts),r.setStateValue("trivia.currentQuestion",e.currentQuestion),r.setStateValue("trivia.isComplete",e.isComplete),r.setStateValue("trivia.passed",e.passed)}function Xpe(t){let{command:e}=t,r=e.parsed?.textSlots;if(r&&r.size>0){let o=r.get("text");if(o)return o;for(let a of r.values())return a}let i=(e.rawInput||"").match(/^answer\s+(.+)$/i);return i?i[1].trim():""}var O2={id:Ug,group:"communication",validate(t){let e=Xpe(t);if(t.sharedData.answerText=e,!e)return{valid:!1,error:Pi.NO_ANSWER_GIVEN};let r=Vpe(t);if(t.sharedData.inRiddleRoom=r,r)return t.sharedData.riddleAlreadySolved=Ype(t),{valid:!0};let n=Gpe(t);t.sharedData.atDungeonEntrance=n;let i=Kpe(t);return t.sharedData.triviaState=i,i.currentQuestion===-1?{valid:!1,error:Pi.TRIVIA_NOT_STARTED}:i.isComplete?i.passed?{valid:!1,error:Pi.TRIVIA_ALREADY_PASSED}:{valid:!1,error:Pi.TRIVIA_ALREADY_FAILED}:{valid:!0}},execute(t){let{sharedData:e,world:r}=t,n=e.answerText;if(e.inRiddleRoom){if(e.riddleAlreadySolved){e.resultMessage=st.RIDDLE_ALREADY_SOLVED;return}let a=n.toLowerCase().trim();if(a=a.replace(/^["']|["']$/g,""),a==="well"||a==="a well"){t.currentLocation.riddleSolved=!0;let s=t.currentLocation.get(ii.RoomTrait);if(s){let l=r.getAllEntities().find(u=>{let f=u.get(ii.IdentityTrait)?.name?.toLowerCase()||"";return f.includes("pearl")||f.includes("broom closet")});l&&(s.exits[ii.Direction.EAST]={destination:l.id})}e.riddleCorrect=!0,e.resultMessage=st.RIDDLE_CORRECT}else e.riddleCorrect=!1,e.resultMessage=st.RIDDLE_WRONG;return}let i=e.triviaState,o=T3(i,n);if(Qpe(t,o.state),e.newTriviaState=o.state,e.isCorrect=o.isCorrect,e.resultMessage=o.message,o.state.passed){r.setStateValue("dungeonMaster.doorOpen",!0),xu(r,"FOLLOWING"),$pe(t);let a=kg(r);if(a){let s=a.get(ii.NpcTrait);if(s?.customProperties){let c=s.customProperties;c.triviaPassed=!0,c.doorOpen=!0,c.state="FOLLOWING"}}}o.state.isComplete||(e.nextQuestionMessageId=Mg(o.state))},blocked(t,e){let r=[];return r.push(t.event("game.message",{messageId:e.error||Pi.NO_QUESTION})),r},report(t){let{sharedData:e}=t,r=[],n=e.resultMessage;return e.inRiddleRoom?(r.push(t.event("action.success",{actionId:Ug,messageId:n})),r):(r.push(t.event("game.message",{messageId:n,isCorrect:e.isCorrect,questionsAnswered:e.newTriviaState?.questionsAnswered,wrongAttempts:e.newTriviaState?.wrongAttempts})),e.newTriviaState?.passed&&r.push(t.event("game.message",{messageId:Z.DOOR_OPENS})),e.nextQuestionMessageId&&r.push(t.event("game.message",{messageId:e.nextQuestionMessageId})),r)}};var qu="dungeo.set-dial",ma={SET_DIAL:"dungeo.dial.set",DIAL_MUST_BE_1_TO_8:"dungeo.dial.must_be_1_to_8",NOT_AT_PARAPET:"dungeo.dial.not_at_parapet",NO_DIAL_HERE:"dungeo.dial.no_dial_here"};var I2=S(b());function Zpe(t){let{world:e,player:r}=t,n=e.getLocation(r.id);if(!n)return!1;let i=e.getEntity(n);return i?i.get(I2.IdentityTrait)?.name==="Parapet":!1}function Jpe(t){let{command:e}=t,r=e.parsed?.textSlots;if(r&&r.size>0){let o=r.get("number");if(o){let a=parseInt(o,10);if(!isNaN(a))return a}}let i=(e.rawInput||"").match(/(?:set|turn)\s+(?:dial|indicator)\s+to\s+(\d+)/i);if(i){let o=parseInt(i[1],10);if(!isNaN(o))return o}return null}var D0={id:qu,group:"manipulation",validate(t){let e=Zpe(t);if(t.sharedData.atParapet=e,!e)return{valid:!1,error:ma.NOT_AT_PARAPET};let r=Jpe(t);return t.sharedData.dialValue=r,r===null||r<1||r>8?{valid:!1,error:ma.DIAL_MUST_BE_1_TO_8}:{valid:!0}},execute(t){let{world:e,sharedData:r}=t,n=r.dialValue,i=e.getStateValue("parapet.dialSetting")??1;r.previousDialValue=i,e.setStateValue("parapet.dialSetting",n)},blocked(t,e){return[t.event("action.blocked",{messageId:e.error||ma.NOT_AT_PARAPET})]},report(t){let{sharedData:e}=t,r=e.dialValue;return[t.event("game.message",{messageId:ma.SET_DIAL,params:{dialValue:r}})]}};var ks="dungeo.push-dial-button",yo={PUSH_BUTTON:"dungeo.dial.push_button",MACHINERY_SOUNDS:"dungeo.dial.machinery_sounds",CELL_ROTATES:"dungeo.dial.cell_rotates",NOT_AT_PARAPET:"dungeo.dial.not_at_parapet",NO_BUTTON:"dungeo.dial.no_button"};var fa=S(b());function ege(t){let{world:e,player:r}=t,n=e.getLocation(r.id);if(!n)return!1;let i=e.getEntity(n);return i?i.get(fa.IdentityTrait)?.name==="Parapet":!1}function tge(t){let{world:e}=t;for(let r of e.getAllEntities())if(r.get(fa.IdentityTrait)?.name==="Prison Cell")return r.id;return null}function rge(t){let{world:e}=t;for(let r of e.getAllEntities())if(r.get(fa.IdentityTrait)?.name==="Parapet")return r.id;return null}var P0={id:ks,group:"manipulation",validate(t){let e=ege(t);return t.sharedData.atParapet=e,e?{valid:!0}:{valid:!1,error:yo.NOT_AT_PARAPET}},execute(t){let{world:e,sharedData:r}=t,n=e.getStateValue("parapet.dialSetting")??1,i=e.getStateValue("parapet.activatedCell")??0;r.dialSetting=n,r.previousCell=i,e.setStateValue("parapet.activatedCell",n),e.setStateValue("prisonCell.currentCell",n);let o=tge(t),a=rge(t);if(r.prisonCellId=o,n===4?(e.setStateValue("prisonCell.bronzeDoorVisible",!0),r.bronzeDoorNowVisible=!0):i===4&&(e.setStateValue("prisonCell.bronzeDoorVisible",!1),r.bronzeDoorNowVisible=!1),o&&a){let s=e.getEntity(a);if(s){let l=s.get(fa.RoomTrait);l&&(l.exits[fa.Direction.DOWN]={destination:o})}let c=e.getEntity(o);if(c){let l=c.get(fa.RoomTrait);l&&(l.exits[fa.Direction.UP]={destination:a})}}},blocked(t,e){return[t.event("action.blocked",{messageId:e.error||yo.NOT_AT_PARAPET})]},report(t){let{sharedData:e}=t,r=e.dialSetting,n=[];return n.push(t.event("game.message",{messageId:yo.PUSH_BUTTON})),n.push(t.event("game.message",{messageId:yo.MACHINERY_SOUNDS,params:{dialSetting:r}})),n}};var Fu="dungeo.action.wave",_r={SUCCESS:"dungeo.wave.success",RAINBOW_APPEARS:"dungeo.wave.rainbow_appears",RAINBOW_GONE:"dungeo.wave.rainbow_gone",NO_EFFECT:"dungeo.wave.no_effect",NO_TARGET:"dungeo.wave.no_target",NOT_HOLDING:"dungeo.wave.not_holding"};var Kr=S(b());var nge=["aragain falls","on the rainbow","end of rainbow","rainbow"];function ige(t){if(t.isSceptre)return!0;let e=t.get(Kr.IdentityTrait);if(!e)return!1;let r=e.name?.toLowerCase()||"";return r.includes("stick")||r.includes("sharp stick")}function oge(t,e){return t.world.getContents(t.player.id).some(n=>n.id===e.id)}function age(t){let e=t.command.parsed?.structure;if(!e?.directObject)return;let r=e.directObject.text||"";return r?t.world.getAllEntities().find(i=>{let o=i.get(Kr.IdentityTrait);if(!o)return!1;let a=o.name?.toLowerCase()||"",s=o.aliases||[],c=r.toLowerCase();return a===c||a.includes(c)||s.some(l=>l.toLowerCase()===c||l.toLowerCase().includes(c))}):void 0}var S2={id:Fu,group:"manipulation",validate(t){let e=age(t);return e?oge(t,e)?(t.sharedData.waveTarget=e,t.sharedData.isStick=ige(e),{valid:!0}):{valid:!1,error:_r.NOT_HOLDING}:{valid:!1,error:_r.NO_TARGET}},execute(t){let{world:e,player:r,sharedData:n}=t,i=n.waveTarget,o=n.isStick,a=e.getLocation(r.id)||"";n.playerLocation=a;let l=e.getEntity(a)?.get(Kr.IdentityTrait)?.name?.toLowerCase()||"",u=nge.some(m=>l.includes(m)||a.toLowerCase().includes(m.replace(/\s+/g,"-")));if(o&&u){let m=e.getStateValue("dungeo.rainbow.active")||!1,f=e.getAllEntities().find(h=>h.get(Kr.IdentityTrait)?.name==="Aragain Falls"),g=e.getAllEntities().find(h=>h.get(Kr.IdentityTrait)?.name==="On the Rainbow");if(m){if(e.setStateValue("dungeo.rainbow.active",!1),n.rainbowDismissed=!0,f){let h=f.get(Kr.RoomTrait);h&&(delete h.exits[Kr.Direction.EAST],h.blockedExits||(h.blockedExits={}),h.blockedExits[Kr.Direction.EAST]="The rainbow is beautiful, but it looks far too insubstantial to walk on.")}}else if(e.setStateValue("dungeo.rainbow.active",!0),n.rainbowCreated=!0,f&&g){let h=f.get(Kr.RoomTrait);h&&(h.exits[Kr.Direction.EAST]={destination:g.id},h.blockedExits&&delete h.blockedExits[Kr.Direction.EAST])}}},blocked(t,e){return[t.event("action.blocked",{actionId:Fu,messageId:e.error||_r.NO_TARGET,reason:e.error})]},report(t){let{sharedData:e}=t,r=[],n=e.waveTarget;if(!n)return r;let o=n.get(Kr.IdentityTrait)?.name||"item";return e.rainbowCreated?r.push(t.event("game.message",{messageId:_r.RAINBOW_APPEARS,params:{target:o}})):e.rainbowDismissed?r.push(t.event("game.message",{messageId:_r.RAINBOW_GONE,params:{target:o}})):e.isStick?r.push(t.event("game.message",{messageId:_r.NO_EFFECT,params:{target:o}})):r.push(t.event("game.message",{messageId:_r.SUCCESS,params:{target:o}})),r}};var xs="dungeo.action.dig",br={SUCCESS:"dungeo.dig.success",FOUND_STATUE:"dungeo.dig.found_statue",KEEP_DIGGING:"dungeo.dig.keep_digging",NOTHING_HERE:"dungeo.dig.nothing_here",NO_SHOVEL:"dungeo.dig.no_shovel",CANT_DIG_HERE:"dungeo.dig.cant_dig_here"};var yS=S(b());var A2={"sandy-beach":{treasure:"statue",digsRequired:4}};function sge(t){let e=t.get(yS.IdentityTrait);if(!e)return!1;let r=e.name?.toLowerCase()||"",n=e.aliases||[];return r.includes("shovel")||n.some(i=>i.toLowerCase().includes("shovel"))}function cge(t){return t.world.getContents(t.player.id).find(r=>sge(r))}function lge(t,e){let r=t.getEntity(e);if(!r)return;let i=r.get(yS.IdentityTrait)?.name?.toLowerCase()||"";for(let o of Object.keys(A2)){let a=o.replace(/-/g," ");if(e.toLowerCase().includes(o)||e.toLowerCase().includes(a)||i.includes(a)||i.includes(o))return o}}var R2={id:xs,group:"manipulation",validate(t){let{world:e,player:r}=t,n=cge(t);if(!n)return{valid:!1,error:br.NO_SHOVEL};let i=e.getLocation(r.id)||"",o=lge(e,i);return o?(t.sharedData.shovel=n,t.sharedData.roomKey=o,t.sharedData.playerLocation=i,{valid:!0}):{valid:!1,error:br.CANT_DIG_HERE}},execute(t){let{world:e,sharedData:r}=t,n=r.roomKey,i=A2[n];if(!i)return;let o=`dungeo.dig.${n}.count`,s=(e.getStateValue(o)||0)+1;e.setStateValue(o,s);let c=`dungeo.dig.${n}.found`;if(e.getStateValue(c)||!1){r.alreadyFound=!0;return}if(s>=i.digsRequired){e.setStateValue(c,!0),r.foundTreasure=i.treasure,r.digCount=s;let u=e.getStateValue("dungeo.statue.locationId"),m=e.getAllEntities().find(f=>f.get(yS.IdentityTrait)?.name?.toLowerCase().includes("statue"));m&&u&&(e.moveEntity(m.id,u),m.isBuried=!1,m.isVisible=!0),e.setStateValue(`dungeo.${i.treasure}.revealed`,!0)}else r.keepDigging=!0,r.digCount=s,r.digsRemaining=i.digsRequired-s},blocked(t,e){return[t.event("action.blocked",{actionId:xs,messageId:e.error||br.CANT_DIG_HERE,reason:e.error})]},report(t){let{sharedData:e}=t,r=[];return e.alreadyFound?r.push(t.event("game.message",{messageId:br.NOTHING_HERE})):e.foundTreasure?r.push(t.event("game.message",{messageId:br.FOUND_STATUE,treasure:e.foundTreasure})):e.keepDigging?r.push(t.event("game.message",{messageId:br.KEEP_DIGGING,digCount:e.digCount,digsRemaining:e.digsRemaining})):r.push(t.event("game.message",{messageId:br.SUCCESS})),r}};var Gu="dungeo.action.wind",Bt={SUCCESS:"dungeo.wind.success",CANARY_SINGS:"dungeo.wind.canary_sings",BAUBLE_APPEARS:"dungeo.wind.bauble_appears",NOT_IN_FOREST:"dungeo.wind.not_in_forest",NO_TARGET:"dungeo.wind.no_target",NOT_WINDABLE:"dungeo.wind.not_windable",NOT_HOLDING:"dungeo.wind.not_holding",ALREADY_WOUND:"dungeo.wind.already_wound"};var vl=S(b());var uge=["forest","clearing","path"];function dge(t){let e=t.get(vl.IdentityTrait);if(!e)return!1;let r=e.name?.toLowerCase()||"",n=e.aliases||[];return r.includes("canary")||n.some(i=>i.toLowerCase().includes("canary"))}function mge(t,e){return t.world.getContents(t.player.id).some(n=>n.id===e.id)}function fge(t){let{world:e,player:r}=t,n=e.getLocation(r.id)||"",i=e.getEntity(n);if(!i)return!1;let a=i.get(vl.IdentityTrait)?.name?.toLowerCase()||"";return uge.some(s=>n.toLowerCase().includes(s)||a.includes(s))}function pge(t){let e=t.command.parsed?.structure;if(!e?.directObject)return;let r=e.directObject.text||"";return r?t.world.getAllEntities().find(i=>{let o=i.get(vl.IdentityTrait);if(!o)return!1;let a=o.name?.toLowerCase()||"",s=o.aliases||[],c=r.toLowerCase();return a===c||a.includes(c)||s.some(l=>l.toLowerCase()===c||l.toLowerCase().includes(c))}):void 0}var w2={id:Gu,group:"manipulation",validate(t){let e=pge(t);return e?mge(t,e)?dge(e)?(t.sharedData.windTarget=e,t.sharedData.isCanary=!0,{valid:!0}):{valid:!1,error:Bt.NOT_WINDABLE}:{valid:!1,error:Bt.NOT_HOLDING}:{valid:!1,error:Bt.NO_TARGET}},execute(t){let{world:e,player:r,sharedData:n}=t;if(!n.isCanary)return;if(e.getStateValue("dungeo.canary.bauble_produced")||!1){n.alreadyWound=!0;return}let a=fge(t);if(n.inForest=a,a){e.setStateValue("dungeo.canary.bauble_produced",!0),e.setStateValue("dungeo.bauble.revealed",!0),n.baubleAppeared=!0;let s=e.getLocation(r.id);if(s){let c=e.createEntity("brass bauble",vl.EntityType.ITEM);c.add(new vl.IdentityTrait({name:"brass bauble",aliases:["bauble","shiny bauble","brass ball","ball"],description:"A shiny brass bauble, dropped by an unseen songbird in response to the canary's tune.",properName:!1,article:"a"})),c.isTreasure=!0,c.treasureId="brass-bauble",c.treasureValue=1,c.trophyCaseValue=1,e.moveEntity(c.id,s)}}},blocked(t,e){return[t.event("action.blocked",{actionId:Gu,messageId:e.error||Bt.NO_TARGET,reason:e.error})]},report(t){let{sharedData:e}=t,r=[],n=e.windTarget;if(!n)return r;let o=n.get(vl.IdentityTrait)?.name||"item";return e.alreadyWound?r.push(t.event("game.message",{messageId:Bt.ALREADY_WOUND,params:{target:o}})):e.baubleAppeared?r.push(t.event("game.message",{messageId:Bt.BAUBLE_APPEARS,params:{target:o}})):e.isCanary?r.push(t.event("game.message",{messageId:Bt.CANARY_SINGS,params:{target:o}})):r.push(t.event("game.message",{messageId:Bt.SUCCESS,params:{target:o}})),r}};var Cn=S(b());var pa="dungeo.action.send",Li={SEND_FOR_BROCHURE:"dungeo.send.brochure",ALREADY_SENT:"dungeo.send.already_sent",NO_TARGET:"dungeo.send.no_target",BROCHURE_KNOCK:"dungeo.send.knock"};function gge(t){let{world:e}=t,r=e.getAllEntities().find(s=>s.get(Cn.IdentityTrait)?.name?.toLowerCase().includes("mailbox"));if(!r)return;let n=e.createEntity("brochure",Cn.EntityType.CONTAINER);n.add(new Cn.IdentityTrait({name:"large brochure",aliases:["brochure","MIT brochure","pamphlet","free brochure"],description:"A large brochure from the MIT Tech Correspondence School. It contains pictures of wealthy graduates and a small stamp.",properName:!1,article:"a"})),n.add(new Cn.ContainerTrait({capacity:{maxItems:1}})),n.add(new Cn.OpenableTrait({isOpen:!0})),n.add(new Cn.ReadableTrait({text:`*** MIT TECH CORRESPONDENCE SCHOOL ***

Congratulations on your interest in our fine institution!

Our graduates have gone on to careers in:
  - Paper shuffling
  - Bit twiddling
  - Yak shaving
  - GRUEsome occupations

Enclosed please find a valuable collector's stamp as a FREE gift!

      ** ENROLL TODAY! **`}));let i=e.createEntity("stamp",Cn.EntityType.ITEM);i.add(new Cn.IdentityTrait({name:"Don Woods stamp",aliases:["stamp","woods stamp","postage stamp","spelunker's stamp"],description:`A small postage stamp depicting a spelunker with a lamp. The caption reads:

   SPELUNKER TODAY
   ---------------
   |    ___      |
   |   (o o)     |
   |   /| |\\     |
   |   / \\       |
   ---------------
   Don Woods, Editor

   1 Zorkmid`,properName:!1,article:"a"})),i.isTreasure=!0,i.treasureId="don-woods-stamp",i.treasureValue=1,i.trophyCaseValue=0,e.moveEntity(i.id,n.id);let o=r.get(Cn.OpenableTrait),a=o?.isOpen??!1;o&&(o.isOpen=!0),e.moveEntity(n.id,r.id),o&&!a&&(o.isOpen=!1)}var L0={id:pa,group:"communication",validate(t){let{world:e}=t;return e.getStateValue("dungeo.brochure.ordered")||!1?{valid:!1,error:Li.ALREADY_SENT}:{valid:!0}},execute(t){let{world:e}=t;e.setStateValue("dungeo.brochure.ordered",!0),gge(t)},blocked(t,e){return[t.event("action.blocked",{actionId:pa,messageId:e.error||Li.NO_TARGET,reason:e.error})]},report(t){return[t.event("game.message",{messageId:Li.SEND_FOR_BROCHURE}),t.event("game.message",{messageId:Li.BROCHURE_KNOCK})]}};var C2="dungeo.rainbow.blocked",M0={BLOCKED:"dungeo.rainbow.blocked"};var hge=0;function yge(){return`rainbow-blocked-${Date.now()}-${++hge}`}var N2={id:C2,group:"movement",validate(t){return{valid:!1,error:M0.BLOCKED}},execute(t){},blocked(t,e){return[{id:yge(),type:"game.message",timestamp:Date.now(),entities:{},data:{messageId:M0.BLOCKED,message:"The rainbow is beautiful, but it looks far too insubstantial to walk on."},narrate:!0}]},report(t){return[]}};var er="dungeo.action.pour",jt={SUCCESS:"dungeo.pour.success",INTO_BUCKET:"dungeo.pour.into_bucket",BUCKET_RISES:"dungeo.pour.bucket_rises",BUCKET_AT_TOP:"dungeo.pour.bucket_at_top",NO_WATER:"dungeo.pour.no_water",NO_TARGET:"dungeo.pour.no_target",NOTHING_HAPPENS:"dungeo.pour.nothing_happens",NOT_IN_BUCKET:"dungeo.pour.not_in_bucket"};var El=S(b()),Vu=S(b());function vge(t){let{world:e,player:r}=t,n=e.getContents(r.id);for(let i of n){if(i.get(El.IdentityTrait)?.name?.toLowerCase().includes("water"))return{water:i,container:void 0};let a=e.getContents(i.id);for(let s of a)if(s.get(El.IdentityTrait)?.name?.toLowerCase().includes("water"))return{water:s,container:i}}return{water:void 0,container:void 0}}function Ege(t){let{world:e,player:r}=t,n=(0,Vu.getActorVehicle)(e,r.id);if(n&&n.get(El.IdentityTrait)?.name?.toLowerCase().includes("bucket"))return n;let i=e.getLocation(r.id);if(!i)return;let o=n?e.getLocation(n.id):i;if(!o)return;let a=e.getContents(o);for(let s of a)if(s.get(El.IdentityTrait)?.name?.toLowerCase().includes("bucket"))return s}var D2={id:er,group:"manipulation",validate(t){let{water:e,container:r}=vge(t);if(!e)return{valid:!1,error:jt.NO_WATER};let n=Ege(t);return t.sharedData.water=e,t.sharedData.waterContainer=r,t.sharedData.bucket=n,{valid:!0}},execute(t){let{world:e,player:r,sharedData:n}=t,i=n.water,o=n.waterContainer,a=n.bucket,s=!1;if(s&&(console.log("[POUR] water:",i?.id),console.log("[POUR] bucket:",a?.id),a&&console.log("[POUR] bucket traits:",Array.from(a._traits?.keys?.()||[]))),a){let c=a.get(El.VehicleTrait);if(s&&(console.log("[POUR] vehicleTrait:",c),console.log("[POUR] vehicleType:",c?.vehicleType),console.log("[POUR] currentPosition:",c?.currentPosition)),c&&c.vehicleType==="counterweight"){if(e.moveEntity(i.id,a.id),a.hasWater=!0,n.pouredIntoBucket=!0,c.currentPosition==="bottom"&&c.positionRooms){let l=c.positionRooms.top;l&&((0,Vu.moveVehicle)(e,a.id,l),c.currentPosition="top",n.bucketRose=!0,(0,Vu.isActorInVehicle)(e,r.id)&&(n.playerRose=!0))}else c.currentPosition==="top"&&(n.bucketAlreadyAtTop=!0);return}}i&&(e.moveEntity(i.id,"limbo"),n.pouredOnGround=!0)},blocked(t,e){return[t.event("action.blocked",{actionId:er,messageId:e.error||jt.NO_WATER,reason:e.error})]},report(t){let{sharedData:e,world:r,player:n}=t,i=[];if(e.bucketRose&&e.playerRose){i.push(t.event("action.success",{actionId:er,messageId:jt.BUCKET_RISES}));let o=(0,Vu.getActorVehicle)(r,n.id),a=o?r.getLocation(o.id):void 0;if(a){let c=r.getEntity(a)?.get(El.IdentityTrait);i.push(t.event("room.described",{roomId:a,roomName:c?.name||"Top of Well"}))}}else e.bucketRose?i.push(t.event("action.success",{actionId:er,messageId:jt.BUCKET_RISES})):e.bucketAlreadyAtTop&&e.pouredIntoBucket?i.push(t.event("action.success",{actionId:er,messageId:jt.BUCKET_AT_TOP})):e.pouredIntoBucket?i.push(t.event("action.success",{actionId:er,messageId:jt.INTO_BUCKET})):e.pouredOnGround?i.push(t.event("action.success",{actionId:er,messageId:jt.SUCCESS})):i.push(t.event("action.success",{actionId:er,messageId:jt.NOTHING_HAPPENS}));return i}};var Or="dungeo.action.fill",_t={SUCCESS:"dungeo.fill.success",FROM_BUCKET:"dungeo.fill.from_bucket",BUCKET_DESCENDS:"dungeo.fill.bucket_descends",BUCKET_AT_BOTTOM:"dungeo.fill.bucket_at_bottom",NO_BOTTLE:"dungeo.fill.no_bottle",BOTTLE_FULL:"dungeo.fill.bottle_full",NO_SOURCE:"dungeo.fill.no_source",NO_WATER_IN_BUCKET:"dungeo.fill.no_water_in_bucket",NOTHING_HAPPENS:"dungeo.fill.nothing_happens"};var vo=S(b()),Yu=S(b());function Tge(t){let{world:e,player:r}=t,n=e.getContents(r.id);for(let i of n)if(i.get(vo.IdentityTrait)?.name?.toLowerCase().includes("bottle"))return i}function _ge(t,e){let r=t.world.getContents(e.id);for(let n of r)if(n.get(vo.IdentityTrait)?.name?.toLowerCase().includes("water"))return!0;return!1}function bge(t){let{world:e,player:r}=t,n=(0,Yu.getActorVehicle)(e,r.id);if(n&&n.get(vo.IdentityTrait)?.name?.toLowerCase().includes("bucket")&&n.hasWater)return n;let i=e.getLocation(r.id);if(!i)return;let o=n?e.getLocation(n.id):i;if(!o)return;let a=e.getContents(o);for(let s of a)if(s.get(vo.IdentityTrait)?.name?.toLowerCase().includes("bucket")&&s.hasWater)return s}function Oge(t,e){let r=t.world.getContents(e.id);for(let n of r)if(n.get(vo.IdentityTrait)?.name?.toLowerCase().includes("water"))return n}var P2={id:Or,group:"manipulation",validate(t){let e=Tge(t);if(!e)return{valid:!1,error:_t.NO_BOTTLE};if(_ge(t,e))return{valid:!1,error:_t.BOTTLE_FULL};let r=bge(t);return t.sharedData.bottle=e,t.sharedData.bucket=r,{valid:!0}},execute(t){let{world:e,player:r,sharedData:n}=t,i=n.bottle,o=n.bucket;if(o){let a=o.get(vo.VehicleTrait),s=Oge(t,o);if(a&&a.vehicleType==="counterweight"&&s){let c=i.get(vo.OpenableTrait),l=c?.isOpen??!0;if(c&&(c.isOpen=!0),e.moveEntity(s.id,i.id),c&&(c.isOpen=l),o.hasWater=!1,n.filledFromBucket=!0,a.currentPosition==="top"&&a.positionRooms){let u=a.positionRooms.bottom;u&&((0,Yu.moveVehicle)(e,o.id,u),a.currentPosition="bottom",n.bucketDescended=!0,(0,Yu.isActorInVehicle)(e,r.id)&&(n.playerDescended=!0))}else a.currentPosition==="bottom"&&(n.bucketAlreadyAtBottom=!0);return}}n.noSource=!0},blocked(t,e){return[t.event("action.blocked",{actionId:Or,messageId:e.error||_t.NO_BOTTLE,reason:e.error})]},report(t){let{sharedData:e,world:r,player:n}=t,i=[];if(e.bucketDescended&&e.playerDescended){i.push(t.event("action.success",{actionId:Or,messageId:_t.BUCKET_DESCENDS}));let o=(0,Yu.getActorVehicle)(r,n.id),a=o?r.getLocation(o.id):void 0;if(a){let c=r.getEntity(a)?.get(vo.IdentityTrait);i.push(t.event("room.described",{roomId:a,roomName:c?.name||"Well Bottom"}))}}else e.bucketDescended?i.push(t.event("action.success",{actionId:Or,messageId:_t.BUCKET_DESCENDS})):e.bucketAlreadyAtBottom&&e.filledFromBucket?i.push(t.event("action.success",{actionId:Or,messageId:_t.BUCKET_AT_BOTTOM})):e.filledFromBucket?i.push(t.event("action.success",{actionId:Or,messageId:_t.FROM_BUCKET})):e.noSource?i.push(t.event("action.success",{actionId:Or,messageId:_t.NO_SOURCE})):i.push(t.event("action.success",{actionId:Or,messageId:_t.NOTHING_HAPPENS}));return i}};var Tl="dungeo.action.light",tr={SUCCESS:"dungeo.light.success",NO_FIRE_SOURCE:"dungeo.light.no_fire_source",NOT_FLAMMABLE:"dungeo.light.not_flammable",ALREADY_BURNING:"dungeo.light.already_burning",GUIDEBOOK_LIT:"dungeo.light.guidebook_lit",IN_RECEPTACLE:"dungeo.light.in_receptacle"};var Zm=S(b());var Ige=["guidebook","book","newspaper","leaves","paper","coal"],Sge=["match","matches","matchbook","candle","candles","torch","lantern"];function Age(t){let e=t.get(Zm.IdentityTrait);if(!e)return!1;let r=e.name?.toLowerCase()||"",n=(e.aliases||[]).map(i=>i.toLowerCase());return Ige.some(i=>r.includes(i)||n.some(o=>o.includes(i)))}function Rge(t){let e=t.get(Zm.IdentityTrait);if(!e)return!1;let r=e.name?.toLowerCase()||"",n=(e.aliases||[]).map(i=>i.toLowerCase());return Sge.some(i=>r.includes(i)||n.some(o=>o.includes(i)))}function wge(t){let e=t.get(Zm.IdentityTrait);if(!e)return!1;let r=e.name?.toLowerCase()||"",n=(e.aliases||[]).map(i=>i.toLowerCase());return r.includes("guidebook")||n.some(i=>i.includes("guidebook")||i.includes("guide book"))}function L2(t,e){if(!e)return;let r=e.toLowerCase();return t.world.getAllEntities().find(n=>{let i=n.get(Zm.IdentityTrait);if(!i)return!1;let o=i.name?.toLowerCase()||"",a=i.aliases||[];return o===r||o.includes(r)||a.some(s=>s.toLowerCase()===r||s.toLowerCase().includes(r))})}function Cge(t){let e=t.command.parsed?.structure;if(!e?.directObject)return;let r=e.directObject.text||"";return L2(t,r)}function Nge(t){let e=t.command.parsed?.structure;if(!e?.indirectObject)return;let r=e.indirectObject.text||"";return L2(t,r)}var M2={id:Tl,group:"manipulation",validate(t){let e=Cge(t),r=Nge(t);return e?e.isBurning?{valid:!1,error:tr.ALREADY_BURNING}:Age(e)?r?Rge(r)?(t.sharedData.lightTarget=e,t.sharedData.lightTool=r,t.sharedData.isGuidebook=wge(e),{valid:!0}):{valid:!1,error:tr.NO_FIRE_SOURCE}:{valid:!1,error:tr.NO_FIRE_SOURCE}:{valid:!1,error:tr.NOT_FLAMMABLE}:{valid:!1,error:tr.NOT_FLAMMABLE}},execute(t){let e=t.sharedData.lightTarget;if(!e)return;e.isBurning=!0;let r=e.size||2;e.burnTurnsRemaining=r*20,t.sharedData.lightSuccess=!0},blocked(t,e){return[t.event("action.blocked",{actionId:Tl,messageId:e.error||tr.NOT_FLAMMABLE,reason:e.error})]},report(t){let e=[],r=t.sharedData.lightTarget;if(!r||!t.sharedData.lightSuccess)return e;let i=r.get(Zm.IdentityTrait)?.name||"object";return t.sharedData.isGuidebook?e.push(t.event("game.message",{messageId:tr.GUIDEBOOK_LIT,params:{target:i}})):e.push(t.event("game.message",{messageId:tr.SUCCESS,params:{target:i}})),e}};var Bs="dungeo.action.tie",ft={SUCCESS:"dungeo.tie.success",NO_ROPE:"dungeo.tie.no_rope",NOT_AT_LEDGE:"dungeo.tie.not_at_ledge",ALREADY_TIED:"dungeo.tie.already_tied",NO_HOOK:"dungeo.tie.no_hook",NOT_IN_BALLOON:"dungeo.tie.not_in_balloon",ROPE_TIED_TO_RAILING:"dungeo.tie.rope_to_railing",ROPE_ALREADY_TIED:"dungeo.tie.rope_already_tied",NO_RAILING:"dungeo.tie.no_railing",NEED_ROPE:"dungeo.tie.need_rope"};var ga=S(b());var W=S(b());function Nn(t,e,r,n=!0){let i=t.createEntity(e,W.EntityType.ROOM);return i.add(new W.RoomTrait({exits:{},isDark:n,isOutdoors:!1})),i.add(new W.IdentityTrait({name:e,description:r,properName:!0,article:"the"})),i}function Eo(t,e){let r=t.get(W.RoomTrait);if(r)for(let[n,i]of Object.entries(e))r.exits[n]={destination:i}}function k2(t){let e=Nn(t,"Egyptian Room","This is a room which looks like an Egyptian tomb. Hieroglyphics cover the walls."),r=Nn(t,"Glacier Room","You are in a room carved from ice. The walls sparkle with reflected light."),n=Nn(t,"Volcano View","You are on a ledge overlooking a vast volcanic crater. Molten lava bubbles far below."),i=Nn(t,"Ruby Room","This is a small room with walls that glitter with embedded rubies."),o=Nn(t,"Lava Room","You are in a room filled with the glow of molten lava. The heat is intense."),a=Nn(t,"Volcano Bottom","You are at the bottom of the volcano. Lava pools nearby."),s=Nn(t,"Volcano Core","You are in the very core of the volcano. The heat is almost unbearable."),c=Nn(t,"Wide Ledge","You are on a wide ledge overlooking the volcano interior."),l=Nn(t,"Narrow Ledge","You are on a narrow ledge. One wrong step could be fatal."),u=Nn(t,"Dusty Room","This is a dusty room that appears to have been abandoned long ago."),m=Nn(t,"Library","This is an ancient library. Dusty books line the walls."),f=Nn(t,"Volcano Near Wide Ledge","You are in the middle of the volcano, near a wide ledge.",!1),g=Nn(t,"Volcano Near Viewing Ledge","You are in the middle of the volcano, near a viewing ledge.",!1),h=Nn(t,"Volcano Near Small Ledge","You are in the middle of the volcano, near a small ledge.",!1);return Eo(e,{[W.Direction.WEST]:r.id}),Eo(r,{[W.Direction.EAST]:e.id}),Eo(n,{[W.Direction.SOUTH]:r.id,[W.Direction.DOWN]:c.id}),Eo(c,{[W.Direction.UP]:n.id,[W.Direction.WEST]:l.id,[W.Direction.DOWN]:a.id}),Eo(l,{[W.Direction.EAST]:c.id,[W.Direction.WEST]:u.id}),Eo(u,{[W.Direction.EAST]:l.id,[W.Direction.NORTH]:m.id}),Eo(m,{[W.Direction.SOUTH]:u.id}),Eo(a,{[W.Direction.UP]:c.id,[W.Direction.NORTH]:o.id}),Eo(o,{[W.Direction.SOUTH]:a.id,[W.Direction.NORTH]:s.id}),Eo(s,{[W.Direction.SOUTH]:o.id,[W.Direction.EAST]:i.id}),Eo(i,{[W.Direction.WEST]:s.id}),{egyptianRoom:e.id,glacierRoom:r.id,volcanoView:n.id,rubyRoom:i.id,lavaRoom:o.id,volcanoBottom:a.id,volcanoCore:s.id,wideLedge:c.id,narrowLedge:l.id,dustyRoom:u.id,library:m.id,volcanoNearWideLedge:f.id,volcanoNearViewingLedge:g.id,volcanoNearSmallLedge:h.id}}function x2(t,e,r){let n=t.getEntity(e.egyptianRoom),i=t.getEntity(r);n&&(n.get(W.RoomTrait).exits[W.Direction.SOUTHEAST]={destination:r}),i&&(i.get(W.RoomTrait).exits[W.Direction.NORTHWEST]={destination:e.egyptianRoom})}function zu(t){return t==="ledg2"||t==="ledg3"||t==="ledg4"}function k0(t){return t==="vair1"||t==="vair2"||t==="vair3"||t==="vair4"}function B2(t){return{vlbot:"vair1",vair1:"vair2",vair2:"vair3",vair3:"vair4",vair4:null,ledg2:"vair2",ledg3:"vair3",ledg4:"vair4"}[t]}function j2(t){return{vlbot:null,vair1:"vlbot",vair2:"vair1",vair3:"vair2",vair4:"vair3",ledg2:"vair2",ledg3:"vair3",ledg4:"vair4"}[t]}function W2(t,e){return Dge(t,e.egyptianRoom),Pge(t,e.glacierRoom),Lge(t,e.dustyRoom),Mge(t,e.rubyRoom),kge(t,e.library),xge(t,e)}function Dge(t,e){let r=t.createEntity("gold coffin",W.EntityType.ITEM);r.add(new W.IdentityTrait({name:"gold coffin",aliases:["coffin","golden coffin","sarcophagus","casket"],description:"The solid gold coffin used for the burial of Ramses II is here.",properName:!1,article:"a",weight:10})),r.isTreasure=!0,r.treasureId="gold-coffin",r.treasureValue=3,r.trophyCaseValue=7,t.moveEntity(r.id,e)}function Pge(t,e){let r=t.createEntity("glacier",W.EntityType.SCENERY);r.add(new W.IdentityTrait({name:"glacier",aliases:["ice","massive glacier","ice wall","wall of ice"],description:"A massive wall of ice fills the northern part of the room, blocking any passage in that direction. It glistens with an inner cold light.",properName:!1,article:"a"})),r.add(new W.SceneryTrait),r.isMelted=!1,t.moveEntity(r.id,e)}function Lge(t,e){let r=t.createEntity("large emerald",W.EntityType.ITEM);r.add(new W.IdentityTrait({name:"large emerald",aliases:["emerald","green gem","gem"],description:"A large emerald of exceptional clarity. It glows with an inner green fire.",properName:!1,article:"a",weight:5})),r.isTreasure=!0,r.treasureId="large-emerald",r.treasureValue=5,r.trophyCaseValue=10,t.moveEntity(r.id,e)}function Mge(t,e){let r=t.createEntity("ruby",W.EntityType.ITEM);r.add(new W.IdentityTrait({name:"ruby",aliases:["large ruby","red gem","gem","jewel"],description:"This is an enormous ruby, the size of a robin's egg. It sparkles brilliantly in the light.",properName:!1,article:"a",weight:5})),r.isTreasure=!0,r.treasureId="ruby",r.treasureValue=15,r.trophyCaseValue=8,t.moveEntity(r.id,e)}function kge(t,e){let r=t.createEntity("purple book",W.EntityType.ITEM);r.add(new W.IdentityTrait({name:"purple book",aliases:["book","purple volume","volume"],description:'This is an old book bound in purple leather. The title reads "The History of the Great Underground Empire".',properName:!1,article:"a",weight:5})),r.add(new W.ReadableTrait({text:`THE HISTORY OF THE GREAT UNDERGROUND EMPIRE

This volume chronicles the rise and fall of the Flathead dynasty. Lord Dimwit Flathead the Excessive was the most extravagant of the Flatheads, known for his grandiose projects including Flood Control Dam #3.

A stamp falls out of the book as you read it.`})),r.add(new W.ContainerTrait({capacity:{maxItems:5,maxWeight:10}})),t.moveEntity(r.id,e);let n=t.createEntity("stamp",W.EntityType.ITEM);n.add(new W.IdentityTrait({name:"stamp",aliases:["flathead stamp","postage stamp","lord dimwit flathead stamp"],description:"This is a rare stamp depicting Lord Dimwit Flathead. It is quite valuable to collectors.",properName:!1,article:"a",weight:2})),n.isTreasure=!0,n.treasureId="flathead-stamp",n.treasureValue=4,n.trophyCaseValue=10,t.moveEntity(n.id,r.id)}function xge(t,e){let r=t.createEntity("balloon",W.EntityType.ITEM);r.add(new W.IdentityTrait({name:"balloon",aliases:["wicker basket","basket","hot air balloon","balloon basket"],description:"This is a large and extremely heavy wicker basket. An enormous cloth bag is draped over the side and is firmly attached to the basket. A metal receptacle is fastened to the center of the basket. Dangling from the basket is a piece of braided wire.",properName:!1,article:"a"})),r.add(new W.ContainerTrait({capacity:{maxItems:10,maxWeight:100}})),r.add(new W.EnterableTrait),r.add(new W.VehicleTrait({vehicleType:"aircraft",transparent:!0,blocksWalkingMovement:!0,requiresExitBeforeLeaving:!0,currentPosition:"vlbot",isOperational:!1,notOperationalReason:"The balloon is not inflated.",positionRooms:{vlbot:e.volcanoBottom,ledg2:e.narrowLedge,ledg3:e.narrowLedge,ledg4:e.wideLedge}}));let n={position:"vlbot",tetheredTo:null,burningObject:null,daemonEnabled:!0};r.balloonState=n,t.moveEntity(r.id,e.volcanoBottom);let i=t.createEntity("receptacle",W.EntityType.ITEM);i.add(new W.IdentityTrait({name:"receptacle",aliases:["brazier","burner","fire holder"],description:"This is a metal receptacle designed to hold burning objects. It has an opening that can be covered to control the heat.",properName:!1,article:"a"})),i.add(new W.ContainerTrait({capacity:{maxItems:1,maxWeight:10},enterable:!1})),i.add(new W.OpenableTrait({isOpen:!1})),i.add(new W.SceneryTrait),t.moveEntity(i.id,r.id);let o=t.createEntity("cloth bag",W.EntityType.SCENERY);o.add(new W.IdentityTrait({name:"cloth bag",aliases:["silk bag","balloon bag","silk balloon","bag"],description:"The cloth bag is draped over the basket.",properName:!1,article:"a"})),o.add(new W.SceneryTrait),o.isInflated=!1,t.moveEntity(o.id,r.id);let a=t.createEntity("hook1",W.EntityType.SCENERY);a.add(new W.IdentityTrait({name:"hook",aliases:["metal hook","balloon hook"],description:"A sturdy metal hook attached to the side of the basket.",properName:!1,article:"a"})),a.add(new W.SceneryTrait),a.hookId="hook1",t.moveEntity(a.id,r.id);let s=t.createEntity("hook2",W.EntityType.SCENERY);s.add(new W.IdentityTrait({name:"hook",aliases:["metal hook","balloon hook"],description:"A sturdy metal hook attached to the side of the basket.",properName:!1,article:"a"})),s.add(new W.SceneryTrait),s.hookId="hook2",t.moveEntity(s.id,r.id);let c=t.createEntity("braided wire",W.EntityType.SCENERY);c.add(new W.IdentityTrait({name:"braided wire",aliases:["wire","braided rope","rope","cord","line","tether"],description:"A piece of braided wire dangles from the basket.",properName:!1,article:"a"})),c.add(new W.SceneryTrait),c.tiedTo=null,t.moveEntity(c.id,r.id);let l=t.createEntity("dead balloon",W.EntityType.SCENERY);return l.add(new W.IdentityTrait({name:"dead balloon",aliases:["crashed balloon","destroyed balloon","wreckage"],description:"The remains of the balloon lie scattered about. The basket is smashed and the silk is torn beyond repair.",properName:!1,article:"a"})),l.add(new W.SceneryTrait),{balloonId:r.id,receptacleId:i.id,hook1Id:a.id,hook2Id:s.id}}function Bge(t){let e=t.get(ga.IdentityTrait);if(!e)return!1;let r=e.name?.toLowerCase()||"",n=(e.aliases||[]).map(i=>i.toLowerCase());return r.includes("wire")||r.includes("braided")||n.some(i=>i.includes("wire")||i.includes("braided"))}function jge(t){let e=t.get(ga.IdentityTrait);if(!e)return!1;let r=e.name?.toLowerCase()||"",n=(e.aliases||[]).map(i=>i.toLowerCase());return r.includes("hook")||n.some(i=>i.includes("hook"))}function Wge(t){let e=t.get(ga.IdentityTrait);if(!e)return!1;let r=e.name?.toLowerCase()||"",n=(e.aliases||[]).map(i=>i.toLowerCase());return r.includes("balloon")||r.includes("basket")||n.some(i=>i.includes("balloon")||i.includes("basket"))}function Hge(t){let e=t.get(ga.IdentityTrait);if(!e)return!1;let r=e.name?.toLowerCase()||"",n=(e.aliases||[]).map(i=>i.toLowerCase());return r.includes("rope")||r.includes("coil")||n.some(i=>i.includes("rope")||i.includes("coil"))}function Uge(t){return t.hasRailing===!0}function qge(t){return t.ropeAttached===!0}function Fge(t){let{world:e,player:r}=t,n=e.getLocation(r.id);if(!n)return null;let i=e.getEntity(n);if(!i||!Wge(i))return null;let o=i,a=o.balloonState;if(!a||!zu(a.position))return{valid:!1,error:ft.NOT_AT_LEDGE};if(a.tetheredTo)return{valid:!1,error:ft.ALREADY_TIED};let s=e.getContents(o.id),c=s.find(u=>Bge(u)),l=s.find(u=>jge(u));return c?l?(t.sharedData.tieScenario="balloon",t.sharedData.tieBalloon=o,t.sharedData.tieWire=c,t.sharedData.tieHook=l,{valid:!0}):{valid:!1,error:ft.NO_HOOK}:{valid:!1,error:ft.NO_ROPE}}function Gge(t){let{world:e,player:r}=t,n=e.getLocation(r.id);if(!n)return null;let i=e.getEntity(n);if(!i||!Uge(i))return null;if(qge(i))return{valid:!1,error:ft.ROPE_ALREADY_TIED};let a=e.getContents(r.id).find(s=>Hge(s));return a?(t.sharedData.tieScenario="railing",t.sharedData.tieRoom=i,t.sharedData.tieRope=a,{valid:!0}):{valid:!1,error:ft.NEED_ROPE}}var H2={id:Bs,group:"manipulation",validate(t){let e=Fge(t);if(e!==null)return e;let r=Gge(t);return r!==null?r:{valid:!1,error:ft.NO_RAILING}},execute(t){let e=t.sharedData.tieScenario;if(e==="balloon"){let r=t.sharedData.tieBalloon,n=t.sharedData.tieHook;if(!r||!n)return;let i=r.balloonState,o=n.hookId||"hook1";i.tetheredTo=o,i.daemonEnabled=!1,t.sharedData.tieSuccess=!0}else if(e==="railing"){let r=t.sharedData.tieRoom,n=t.sharedData.tieRope,{world:i}=t;if(!r||!n)return;r.ropeAttached=!0,i.moveEntity(n.id,r.id);let o=n.get(ga.IdentityTrait);o&&(o.description="A rope is tied to the railing, dangling down into the darkness below.");let a=r.torchRoomId;if(a){let s=r.get(ga.RoomTrait);s&&(s.exits[ga.Direction.DOWN]={destination:a})}t.sharedData.tieSuccess=!0,t.sharedData.tieRailingSuccess=!0}},blocked(t,e){return[t.event("action.blocked",{actionId:Bs,messageId:e.error||ft.NO_RAILING,reason:e.error})]},report(t){let e=[];return t.sharedData.tieSuccess&&(t.sharedData.tieRailingSuccess?e.push(t.event("game.message",{messageId:ft.ROPE_TIED_TO_RAILING,params:{}})):e.push(t.event("game.message",{messageId:ft.SUCCESS,params:{}}))),e}};var js="dungeo.action.untie",Mi={SUCCESS:"dungeo.untie.success",NOT_TIED:"dungeo.untie.not_tied",NO_ROPE:"dungeo.untie.no_rope"};var x0=S(b());function Vge(t){let e=t.get(x0.IdentityTrait);if(!e)return!1;let r=e.name?.toLowerCase()||"",n=(e.aliases||[]).map(i=>i.toLowerCase());return r.includes("wire")||r.includes("braided")||n.some(i=>i.includes("wire")||i.includes("braided"))}function Yge(t){let e=t.get(x0.IdentityTrait);if(!e)return!1;let r=e.name?.toLowerCase()||"",n=(e.aliases||[]).map(i=>i.toLowerCase());return r.includes("balloon")||r.includes("basket")||n.some(i=>i.includes("balloon")||i.includes("basket"))}var U2={id:js,group:"manipulation",validate(t){let{world:e,player:r}=t,n=e.getLocation(r.id);if(!n)return{valid:!1,error:Mi.NO_ROPE};let i=e.getEntity(n);if(!i||!Yge(i))return{valid:!1,error:Mi.NO_ROPE};let o=i,a=o.balloonState;if(!a||!a.tetheredTo)return{valid:!1,error:Mi.NOT_TIED};let c=e.getContents(o.id).find(l=>Vge(l));return c?(t.sharedData.untieBalloon=o,t.sharedData.untieWire=c,{valid:!0}):{valid:!1,error:Mi.NO_ROPE}},execute(t){let e=t.sharedData.untieBalloon;if(!e)return;let r=e.balloonState;r.tetheredTo=null,r.daemonEnabled=!0,t.sharedData.untieSuccess=!0},blocked(t,e){return[t.event("action.blocked",{actionId:js,messageId:e.error||Mi.NO_ROPE,reason:e.error})]},report(t){let e=[];return t.sharedData.untieSuccess&&e.push(t.event("game.message",{messageId:Mi.SUCCESS,params:{}})),e}};var Z2=S(b());var $u="DUNGEO_PRESS_BUTTON",Ct={CLICK:"dungeo.button.click",NOT_A_BUTTON:"dungeo.button.not_a_button",LIGHTS_ON:"dungeo.button.lights_on",LIGHTS_OFF:"dungeo.button.lights_off",BLUE_JAMMED:"dungeo.button.blue_jammed",BLUE_LEAK_STARTED:"dungeo.button.blue_leak_started"};var Ku=S(b());var K={LANTERN_DIM:"dungeo.lantern.dim",LANTERN_FLICKERS:"dungeo.lantern.flickers",LANTERN_DIES:"dungeo.lantern.dies",LANTERN_DEAD:"dungeo.lantern.dead",CANDLES_LOW:"dungeo.candles.low",CANDLES_FLICKER:"dungeo.candles.flicker",CANDLES_OUT:"dungeo.candles.out",MATCH_BURNING:"dungeo.match.burning",MATCH_OUT:"dungeo.match.out",DAM_GATES_OPEN:"dungeo.dam.gates_open",DAM_GATES_CLOSE:"dungeo.dam.gates_close",DAM_DRAINING:"dungeo.dam.draining",DAM_NEARLY_EMPTY:"dungeo.dam.nearly_empty",DAM_EMPTY:"dungeo.dam.empty",DAM_TRUNK_REVEALED:"dungeo.dam.trunk_revealed",FOREST_BIRD:"dungeo.forest.bird",FOREST_RUSTLE:"dungeo.forest.rustle",FOREST_BREEZE:"dungeo.forest.breeze",FOREST_BRANCH:"dungeo.forest.branch",UNDERGROUND_DRIP:"dungeo.underground.drip",UNDERGROUND_ECHO:"dungeo.underground.echo",UNDERGROUND_CREAK:"dungeo.underground.creak",INCENSE_BURNING:"dungeo.incense.burning",INCENSE_BURNS_OUT:"dungeo.incense.burns_out",BALLOON_RISING:"dungeo.balloon.rising",BALLOON_FALLING:"dungeo.balloon.falling",BALLOON_AT_LEDGE:"dungeo.balloon.at_ledge",BALLOON_LANDED:"dungeo.balloon.landed",BALLOON_CRASH:"dungeo.balloon.crash",BALLOON_HOOK_VISIBLE:"dungeo.balloon.hook_visible",BALLOON_INFLATING:"dungeo.balloon.inflating",BALLOON_DEFLATING:"dungeo.balloon.deflating",TROLL_KNOCKED_OUT:"dungeo.troll.knocked_out",TROLL_WAKES_UP:"dungeo.troll.wakes_up"};var q2="dungeo.dam.drain.stage1",F2="dungeo.dam.drain.stage2",V2="dungeo.dam.drain.stage3",zge=5,$ge=3,Kge=2,oi="dungeo.dam.state",vS="dungeo.maintenance.flooding",G2=16,Qr={LEAK_STARTED:"dungeo.flooding.leak_started",WATER_ANKLES:"dungeo.flooding.water_ankles",WATER_SHINS:"dungeo.flooding.water_shins",WATER_KNEES:"dungeo.flooding.water_knees",WATER_HIPS:"dungeo.flooding.water_hips",WATER_WAIST:"dungeo.flooding.water_waist",WATER_CHEST:"dungeo.flooding.water_chest",WATER_NECK:"dungeo.flooding.water_neck",WATER_HEAD:"dungeo.flooding.water_head",ROOM_FLOODED:"dungeo.flooding.room_flooded",DROWNED:"dungeo.flooding.drowned",BUTTON_JAMMED:"dungeo.flooding.button_jammed"};function Y2(t,e,r){let n=e.getCapability(oi);return n||(n={isDraining:!1,isDrained:!1,buttonPressed:!1,floodingLevel:0,isFlooded:!1},e.registerCapability(oi,{initialData:n})),n.isDraining||n.isDrained?[]:(n.isDraining=!0,t.setFuse({id:q2,name:"Dam Draining - Stage 2",turns:zge,priority:15,trigger:i=>(t.setFuse({id:F2,name:"Dam Draining - Stage 3",turns:$ge,priority:15,trigger:o=>(t.setFuse({id:V2,name:"Dam Draining - Complete",turns:Kge,priority:15,trigger:a=>Qge(a.world,r)}),[{id:`dam-nearly-empty-${o.turn}`,type:"scheduler.fuse.triggered",timestamp:Date.now(),entities:{},data:{messageId:K.DAM_NEARLY_EMPTY,fuseId:F2}}])}),[{id:`dam-draining-${i.turn}`,type:"scheduler.fuse.triggered",timestamp:Date.now(),entities:{},data:{messageId:K.DAM_DRAINING,fuseId:q2}}])}),[{id:`dam-gates-open-${Date.now()}`,type:"game.message",timestamp:Date.now(),entities:{},data:{messageId:K.DAM_DRAINING}}])}function Qge(t,e){let r=t.getCapability(oi);r&&(r.isDraining=!1,r.isDrained=!0);let n=t.getEntity(e);if(n){let o=n.get(Ku.IdentityTrait);o&&(o.description="This is the bed of a large reservoir, now drained. The muddy bottom stretches in all directions. You can walk freely here now that the water is gone.");let a=n.get(Ku.RoomTrait);a&&(a.requiresBoat=!1)}let i=t.getAllEntities().find(o=>o.get("identity")?.name==="trunk");if(i){let o=i.get(Ku.IdentityTrait);o&&(o.description="This is an old trunk, covered in mud and sediment from the drained reservoir. It appears to contain a fortune in jewels!"),t.moveEntity(i.id,e),i.revealed=!0}return[{id:`dam-empty-trunk-${Date.now()}`,type:"scheduler.fuse.triggered",timestamp:Date.now(),entities:{target:i?.id},data:{messageId:K.DAM_TRUNK_REVEALED,fuseId:V2,trunkRevealed:!0,trunkId:i?.id}}]}function z2(t){return t.getCapability(oi)?.isDrained??!1}function $2(t){let e=t.getCapability(oi);e&&(e.isDrained=!1,e.isDraining=!1)}function K2(t){return t.getCapability(oi)?.isDraining??!1}function Q2(t){return t.getCapability(oi)?.buttonPressed??!1}function Xge(t){switch(Math.floor((t-1)/2)){case 0:return Qr.WATER_ANKLES;case 1:return Qr.WATER_SHINS;case 2:return Qr.WATER_KNEES;case 3:return Qr.WATER_HIPS;case 4:return Qr.WATER_WAIST;case 5:return Qr.WATER_CHEST;case 6:return Qr.WATER_NECK;default:return Qr.WATER_HEAD}}function X2(t,e,r,n){let i=e.getCapability(oi);if(i||(i={isDraining:!1,isDrained:!1,buttonPressed:!1,floodingLevel:0,isFlooded:!1},e.registerCapability(oi,{initialData:i})),i.floodingLevel>0||i.isFlooded)return[{id:`flooding-jammed-${Date.now()}`,type:"game.message",timestamp:Date.now(),entities:{},data:{messageId:Qr.BUTTON_JAMMED}}];if(i.floodingLevel=1,i.floodingJustStarted=!0,n){let o=e.getEntity(n);o&&o.get(Ku.IdentityTrait)&&(o.isHidden=!1)}return t.registerDaemon({id:vS,name:"Maintenance Room Flooding",priority:20,run:o=>{let a=o.world.getCapability(oi);if(!a||a.floodingLevel===0)return[];if(a.floodingJustStarted)return a.floodingJustStarted=!1,[];let s=[],c=o.world.getPlayer();if(!c)return[];let l=c.id,m=o.world.getLocation(l)===r;if(m&&a.floodingLevel>0&&s.push({id:`flooding-level-${o.turn}`,type:"game.message",timestamp:Date.now(),entities:{},data:{messageId:Xge(a.floodingLevel),daemonId:vS,floodingLevel:a.floodingLevel}}),a.floodingLevel+=2,a.floodingLevel>G2){t.removeDaemon(vS),a.isFlooded=!0,a.floodingLevel=G2+1;let f=o.world.getEntity(r);if(f){let g=f.get(Ku.IdentityTrait);g&&(g.description="The room is full of water and cannot be entered.")}m&&(s.push({id:`flooding-drowned-${o.turn}`,type:"game.message",timestamp:Date.now(),entities:{},data:{messageId:Qr.DROWNED}}),s.push({id:`flooding-death-${o.turn}`,type:"player.died",timestamp:Date.now(),entities:{actor:l},data:{cause:"drowning",daemonId:vS}}))}return s}}),[{id:`flooding-started-${Date.now()}`,type:"game.message",timestamp:Date.now(),entities:{},data:{messageId:Qr.LEAK_STARTED}}]}var B0=null,j0="",J2;function ES(t,e,r){B0=t,j0=e,J2=r}function Zge(t){return t.buttonColor!==void 0}function Jge(t){return t.buttonColor}var W0={id:$u,group:"manipulation",validate(t){let e=t.command.directObject?.entity;return e?Zge(e)?(t.sharedData.buttonTarget=e,t.sharedData.buttonColor=Jge(e),{valid:!0}):{valid:!1,error:Ct.NOT_A_BUTTON}:{valid:!1,error:Ct.NOT_A_BUTTON}},execute(t){let{world:e,sharedData:r}=t,n=r.buttonColor,i=r.buttonTarget;if(!n||!i)return;let o=e.getCapability(oi);switch(o||(o={isDraining:!1,isDrained:!1,buttonPressed:!1,floodingLevel:0,isFlooded:!1},e.registerCapability(oi,{initialData:o})),n){case"yellow":o.buttonPressed=!0,r.resultMessage=Ct.CLICK;break;case"brown":o.buttonPressed=!1,r.resultMessage=Ct.CLICK;break;case"red":let a=e.getLocation(t.player.id);if(a){let s=e.getEntity(a);if(s){let c=s.get(Z2.RoomTrait);if(c){let l=!c.isDark;c.isDark=l,r.resultMessage=l?Ct.LIGHTS_OFF:Ct.LIGHTS_ON}}}break;case"blue":if(B0&&j0){let s=X2(B0,e,j0,J2),c=s[0]?.data;s.length>0&&c?.messageId===Qr.BUTTON_JAMMED?r.resultMessage=Qr.BUTTON_JAMMED:(r.resultMessage=Qr.LEAK_STARTED,r.floodingEvents=s)}else r.resultMessage=Ct.BLUE_JAMMED;break;default:r.resultMessage=Ct.CLICK}},blocked(t,e){return[t.event("action.blocked",{actionId:$u,messageId:e.error||Ct.NOT_A_BUTTON,reason:e.error})]},report(t){let{sharedData:e}=t,r=[],n=e.resultMessage||Ct.CLICK,i=e.buttonColor||"unknown";return r.push(t.event("game.message",{messageId:n,buttonColor:i})),r}};var Ws="dungeo.action.turn_bolt",rr={NOT_A_BOLT:"dungeo.turn_bolt.not_a_bolt",WONT_TURN:"dungeo.turn_bolt.wont_turn",NO_TOOL:"dungeo.turn_bolt.no_tool",WRONG_TOOL:"dungeo.turn_bolt.wrong_tool",GATES_OPEN:"dungeo.turn_bolt.gates_open",GATES_CLOSE:"dungeo.turn_bolt.gates_close",NO_BOLT:"dungeo.turn_bolt.not_a_bolt",GATE_LOCKED:"dungeo.turn_bolt.wont_turn",NO_WRENCH:"dungeo.turn_bolt.no_tool",DAM_OPENED:"dungeo.turn_bolt.gates_open",DAM_CLOSED:"dungeo.turn_bolt.gates_close",DAM_ALREADY_OPEN:"dungeo.turn_bolt.gates_open"};var H0=S(b());var e4=null,t4="";function ehe(t){let e=t.get(H0.IdentityTrait);if(!e)return!1;let r=e.name?.toLowerCase()||"";return r==="bolt"||r.includes("bolt")}function the(t){let e=t.get(H0.IdentityTrait);if(!e)return!1;let r=e.name?.toLowerCase()||"",n=e.aliases||[];return r.includes("wrench")||n.some(i=>i.toLowerCase().includes("wrench"))}function rhe(t){let{world:e,player:r}=t,n=e.getLocation(r.id);return n?e.getContents(n).find(o=>ehe(o)):void 0}function nhe(t){let{world:e,player:r}=t;return e.getContents(r.id).some(i=>the(i))}var r4={id:Ws,group:"manipulation",validate(t){let e=rhe(t);if(!e)return{valid:!1,error:rr.NO_BOLT};if(!nhe(t))return{valid:!1,error:rr.NO_WRENCH};if(!Q2(t.world))return{valid:!1,error:rr.GATE_LOCKED};let r=z2(t.world),n=K2(t.world);return t.sharedData.bolt=e,t.sharedData.alreadyDrained=r,t.sharedData.currentlyDraining=n,{valid:!0}},execute(t){let{world:e,sharedData:r}=t,n=r.alreadyDrained;if(r.currentlyDraining){r.startedDraining=!1,r.closedDam=!1;return}if(n){$2(e),r.closedDam=!0,r.startedDraining=!1;return}if(e4&&t4){let o=Y2(e4,e,t4);r.drainingEvents=o,r.startedDraining=!0,r.closedDam=!1}else r.startedDraining=!0,r.closedDam=!1},blocked(t,e){return[t.event("action.blocked",{actionId:Ws,messageId:e.error||rr.NO_BOLT,reason:e.error})]},report(t){let{sharedData:e}=t,r=e.currentlyDraining,n=e.startedDraining,i=e.closedDam,o=[],a;return i?(a=rr.DAM_CLOSED,o.push(t.event("dungeo.dam.closed",{actionId:Ws}))):r?a=rr.DAM_OPENED:n?a=rr.DAM_OPENED:a=rr.DAM_OPENED,o.push(t.event("game.message",{messageId:a})),o}};var Jm=S(b());var ki="dungeo.action.turn_switch",ai={NO_SWITCH:"dungeo.turn_switch.no_switch",NO_COAL:"dungeo.turn_switch.no_coal",ALREADY_USED:"dungeo.turn_switch.already_used",SUCCESS:"dungeo.turn_switch.success",DIAMOND_CREATED:"dungeo.turn_switch.diamond_created"};function ihe(t){let e=t.get(Jm.IdentityTrait);if(!e)return!1;let r=e.name?.toLowerCase()||"";return r==="machine"||r.includes("coal machine")}function ohe(t){let e=t.get(Jm.IdentityTrait);if(!e)return!1;let r=e.name?.toLowerCase()||"",n=e.aliases||[];return r.includes("coal")||n.some(i=>i.toLowerCase()==="coal")}function ahe(t){let{world:e,player:r}=t,n=e.getLocation(r.id);return n?e.getContents(n).find(o=>ihe(o)):void 0}function she(t,e){let{world:r}=t;return r.getContents(e).find(i=>ohe(i))}function che(t,e){let{world:r}=t,n=r.createEntity("huge diamond",Jm.EntityType.ITEM);return n.add(new Jm.IdentityTrait({name:"huge diamond",aliases:["diamond","large diamond","gem"],description:"This is an enormous diamond, perfectly cut and dazzlingly brilliant. It must be worth a fortune.",properName:!1,article:"a"})),n.isTreasure=!0,n.treasureId="huge-diamond",n.treasureValue=10,n.trophyCaseValue=6,r.moveEntity(n.id,e),n}var U0={id:ki,group:"manipulation",validate(t){let e=ahe(t);if(!e)return{valid:!1,error:ai.NO_SWITCH};if(e.machineActivated)return{valid:!1,error:ai.ALREADY_USED};let r=she(t,e.id);return r?(t.sharedData.machine=e,t.sharedData.coal=r,{valid:!0}):{valid:!1,error:ai.NO_COAL}},execute(t){let{world:e,sharedData:r}=t,n=r.machine,i=r.coal;if(!n||!i)return;e.removeEntity(i.id);let o=che(t,n.id);r.diamond=o,n.machineActivated=!0},blocked(t,e){return[t.event("action.blocked",{actionId:ki,messageId:e.error||ai.NO_SWITCH,reason:e.error})]},report(t){return[t.event("game.message",{messageId:ai.SUCCESS})]}};var _l="dungeo.action.put_under",Hs={MAT_PLACED:"dungeo.tiny_room.mat_placed",MAT_NOT_HELD:"dungeo.tiny_room.mat_not_held",MAT_ALREADY_PLACED:"dungeo.tiny_room.mat_already_placed",NO_DOOR_HERE:"dungeo.tiny_room.no_door_here",GENERIC_FAIL:"dungeo.put_under.generic_fail"};var Fg=S(b());var qg="dungeo.action.door_blocked",ef={DOOR_LOCKED:"dungeo.tiny_room.door_locked"};var lhe=0;function uhe(){return`door-blocked-${Date.now()}-${++lhe}`}var n4={id:qg,group:"movement",validate(t){return{valid:!1,error:ef.DOOR_LOCKED}},execute(t){},blocked(t,e){return[{id:uhe(),type:"game.message",timestamp:Date.now(),entities:{},data:{messageId:ef.DOOR_LOCKED,message:"The door is locked, and there is no keyhole on this side."},narrate:!0}]},report(t){return[]}};var tf="dungeo.action.pull_mat",Qu={MAT_PULLED:"dungeo.tiny_room.mat_pulled",MAT_PULLED_WITH_KEY:"dungeo.tiny_room.mat_pulled_with_key",MAT_NOT_UNDER_DOOR:"dungeo.tiny_room.mat_not_under_door",NO_DOOR_HERE:"dungeo.tiny_room.no_door_here"};var dhe=0;function i4(){return`pull-mat-${Date.now()}-${++dhe}`}var q0={id:tf,group:"manipulation",validate(t){let{world:e}=t,r=e.getPlayer();if(!r)return{valid:!1,error:"error.no_player"};let n=e.getLocation(r.id);if(!n)return{valid:!1,error:"error.no_location"};let i=To(e,n);return i?i.matUnderDoor?{valid:!0}:{valid:!1,error:Qu.MAT_NOT_UNDER_DOOR}:{valid:!1,error:Qu.NO_DOOR_HERE}},execute(t){let{world:e,sharedData:r}=t,n=e.getPlayer();if(!n)return;let i=e.getLocation(n.id);if(!i)return;let o=o4(e,n.id,i);r.pullMatResult=o},blocked(t,e){return[{id:i4(),type:"game.message",timestamp:Date.now(),entities:{},data:{messageId:e.error||Qu.MAT_NOT_UNDER_DOOR},narrate:!0}]},report(t){let e=t.sharedData.pullMatResult;return e&&e.events&&e.events.length>0?e.events:[{id:i4(),type:"game.message",timestamp:Date.now(),entities:{},data:{messageId:Qu.MAT_PULLED},narrate:!0}]}};var Te={MAT_PLACED:"dungeo.tiny_room.mat_placed",MAT_NOT_HELD:"dungeo.tiny_room.mat_not_held",MAT_ALREADY_PLACED:"dungeo.tiny_room.mat_already_placed",NO_DOOR_HERE:"dungeo.tiny_room.no_door_here",KEY_PUSHED:"dungeo.tiny_room.key_pushed",KEY_PUSHED_NO_MAT:"dungeo.tiny_room.key_pushed_no_mat",KEY_ALREADY_PUSHED:"dungeo.tiny_room.key_already_pushed",NO_SCREWDRIVER:"dungeo.tiny_room.no_screwdriver",MAT_PULLED:"dungeo.tiny_room.mat_pulled",MAT_PULLED_WITH_KEY:"dungeo.tiny_room.mat_pulled_with_key",MAT_NOT_UNDER_DOOR:"dungeo.tiny_room.mat_not_under_door",DOOR_LOCKED:"dungeo.tiny_room.door_locked",DOOR_UNLOCKED:"dungeo.tiny_room.door_unlocked",WRONG_KEY:"dungeo.tiny_room.wrong_key",KEYHOLE_BLOCKED:"dungeo.tiny_room.keyhole_blocked",LOOK_AT_DOOR:"dungeo.tiny_room.look_at_door",LOOK_AT_DOOR_WITH_MAT:"dungeo.tiny_room.look_at_door_with_mat",LOOK_AT_DOOR_KEY_ON_MAT:"dungeo.tiny_room.look_at_door_key_on_mat",LOOK_AT_DOOR_UNLOCKED:"dungeo.tiny_room.look_at_door_unlocked"};function To(t,e){let n=t.getContents(e).find(o=>o.isTinyRoomDoor===!0);if(n)return n;let i=t.findWhere(o=>o.isTinyRoomDoor===!0);if(i.length>0)return n=i.find(o=>t.getLocation(o.id)===e),n||i[0]}function mhe(t){let e=t.entities?.values?.()||[];for(let r of e)if(r.isTinyRoomKey===!0)return r}function F0(t,e){let r=t.getContents(e);for(let n of r){let i=n.get(Fg.IdentityTrait);if(i){let o=i.name?.toLowerCase()||"",a=i.aliases||[];if(o.includes("mat")||a.some(s=>s.toLowerCase().includes("mat")))return n}}}function G0(t,e){let r=t.getContents(e);for(let n of r){let i=n.get(Fg.IdentityTrait);if(i){let o=i.name?.toLowerCase()||"",a=i.aliases||[];if(o.includes("screwdriver")||a.some(s=>s.toLowerCase().includes("screwdriver")))return n}}}function a4(t,e,r){let n=To(t,r);if(!n)return{success:!1,messageId:Te.NO_DOOR_HERE,events:[]};let i=F0(t,e);return i?n.matUnderDoor?{success:!1,messageId:Te.MAT_ALREADY_PLACED,events:[]}:(n.matUnderDoor=!0,t.moveEntity(i.id,r),i.isUnderDoor=!0,{success:!0,messageId:Te.MAT_PLACED,events:[{id:`tiny-room-mat-placed-${Date.now()}`,type:"game.message",timestamp:Date.now(),entities:{},data:{messageId:Te.MAT_PLACED}}]}):{success:!1,messageId:Te.MAT_NOT_HELD,events:[]}}function s4(t,e,r){let n=To(t,r);return n?G0(t,e)?n.keyInLock?(n.keyInLock=!1,n.matUnderDoor?(n.keyOnMat=!0,{success:!0,messageId:Te.KEY_PUSHED,events:[{id:`tiny-room-key-pushed-${Date.now()}`,type:"game.message",timestamp:Date.now(),entities:{},data:{messageId:Te.KEY_PUSHED}}]}):{success:!0,messageId:Te.KEY_PUSHED_NO_MAT,events:[{id:`tiny-room-key-lost-${Date.now()}`,type:"game.message",timestamp:Date.now(),entities:{},data:{messageId:Te.KEY_PUSHED_NO_MAT}}]}):{success:!1,messageId:Te.KEY_ALREADY_PUSHED,events:[]}:{success:!1,messageId:Te.NO_SCREWDRIVER,events:[]}:{success:!1,messageId:Te.NO_DOOR_HERE,events:[]}}function o4(t,e,r){let n=To(t,r);if(!n)return{success:!1,messageId:Te.NO_DOOR_HERE,events:[]};if(!n.matUnderDoor)return{success:!1,messageId:Te.MAT_NOT_UNDER_DOOR,events:[]};let o=t.getContents(r).find(a=>a.isUnderDoor===!0);if(!o)return{success:!1,messageId:Te.MAT_NOT_UNDER_DOOR,events:[]};if(n.matUnderDoor=!1,o.isUnderDoor=!1,t.moveEntity(o.id,e),n.keyOnMat){n.keyOnMat=!1;let a=mhe(t);return a&&(a.isHidden=!1,t.moveEntity(a.id,e)),{success:!0,messageId:Te.MAT_PULLED_WITH_KEY,events:[{id:`tiny-room-mat-key-${Date.now()}`,type:"game.message",timestamp:Date.now(),entities:{},data:{messageId:Te.MAT_PULLED_WITH_KEY}}]}}return{success:!0,messageId:Te.MAT_PULLED,events:[{id:`tiny-room-mat-pulled-${Date.now()}`,type:"game.message",timestamp:Date.now(),entities:{},data:{messageId:Te.MAT_PULLED}}]}}function c4(t){let e=t.getPlayer();if(!e)return!1;let r=t.getLocation(e.id);if(!r)return!1;let n=t.getEntity(r);return n?(n.get(Fg.IdentityTrait)?.name||"")==="Tiny Room":!1}function fhe(t){let e=t.action?.toLowerCase();if(e!=="go"&&e!=="going"&&e!=="if.action.going")return!1;let r;return t.extras?.direction?r=String(t.extras.direction).toLowerCase():t.structure?.directObject?.head&&(r=t.structure.directObject.head.toLowerCase()),r==="north"||r==="n"}function phe(t){let e=t.getPlayer();if(!e)return!1;let r=t.getLocation(e.id);if(!r)return!1;let n=To(t,r);return n?n.isLocked:!1}function l4(){return(t,e)=>!c4(e)||!fhe(t)||!phe(e)?t:{...t,action:qg,extras:{...t.extras,originalAction:t.action,isDoorBlocked:!0}}}function ghe(t){if(t.action!=="if.action.taking")return!1;let e=t.structure?.directObject?.head?.toLowerCase();return e==="mat"||e==="welcome mat"}function hhe(t){let e=t.getPlayer();if(!e)return!1;let r=t.getLocation(e.id);if(!r)return!1;let n=To(t,r);return n?n.matUnderDoor===!0:!1}function u4(){return(t,e)=>!c4(e)||!ghe(t)||!hhe(e)?t:{...t,action:tf,extras:{...t.extras,originalAction:t.action,isPullingMatFromDoor:!0}}}var yhe=0;function d4(){return`put-under-${Date.now()}-${++yhe}`}var m4={id:_l,group:"manipulation",validate(t){let{world:e}=t,r=e.getPlayer();if(!r)return{valid:!1,error:"error.no_player"};let n=e.getLocation(r.id);if(!n)return{valid:!1,error:"error.no_location"};let i=To(e,n);return i?i.matUnderDoor?{valid:!1,error:Hs.MAT_ALREADY_PLACED}:F0(e,r.id)?{valid:!0}:{valid:!1,error:Hs.MAT_NOT_HELD}:{valid:!1,error:Hs.NO_DOOR_HERE}},execute(t){let{world:e}=t,r=e.getPlayer();if(!r)return;let n=e.getLocation(r.id);n&&a4(e,r.id,n)},blocked(t,e){return[{id:d4(),type:"game.message",timestamp:Date.now(),entities:{},data:{messageId:e.error||Hs.GENERIC_FAIL},narrate:!0}]},report(t){return[{id:d4(),type:"game.message",timestamp:Date.now(),entities:{},data:{messageId:Hs.MAT_PLACED},narrate:!0}]}};var ha="dungeo.action.push_key",Xu={KEY_PUSHED:"dungeo.tiny_room.key_pushed",KEY_PUSHED_NO_MAT:"dungeo.tiny_room.key_pushed_no_mat",KEY_ALREADY_PUSHED:"dungeo.tiny_room.key_already_pushed",NO_SCREWDRIVER:"dungeo.tiny_room.no_screwdriver",NO_DOOR_HERE:"dungeo.tiny_room.no_door_here"};var vhe=0;function f4(){return`push-key-${Date.now()}-${++vhe}`}var V0,p4={id:ha,group:"manipulation",validate(t){let{world:e}=t,r=e.getPlayer();if(!r)return{valid:!1,error:"error.no_player"};let n=e.getLocation(r.id);if(!n)return{valid:!1,error:"error.no_location"};let i=To(e,n);return i?G0(e,r.id)?i.keyInLock?{valid:!0}:{valid:!1,error:Xu.KEY_ALREADY_PUSHED}:{valid:!1,error:Xu.NO_SCREWDRIVER}:{valid:!1,error:Xu.NO_DOOR_HERE}},execute(t){let{world:e}=t,r=e.getPlayer();if(!r)return;let n=e.getLocation(r.id);n&&(V0=s4(e,r.id,n))},blocked(t,e){return[{id:f4(),type:"game.message",timestamp:Date.now(),entities:{},data:{messageId:e.error||Xu.NO_DOOR_HERE},narrate:!0}]},report(t){let e=V0?.messageId||Xu.KEY_PUSHED;return V0=void 0,[{id:f4(),type:"game.message",timestamp:Date.now(),entities:{},data:{messageId:e},narrate:!0}]}};var Us="dungeo.action.inflate",si={SUCCESS:"dungeo.inflate.success",NO_PUMP:"dungeo.inflate.no_pump",ALREADY_INFLATED:"dungeo.inflate.already_inflated",NOT_INFLATABLE:"dungeo.inflate.not_inflatable",CANT_REACH:"dungeo.inflate.cant_reach"};var _o=S(b());function g4(t){let e=t.get(_o.IdentityTrait);if(!e)return!1;let r=e.name?.toLowerCase()||"",n=e.aliases||[],i=["boat","raft","plastic","pile"];return i.some(o=>r.includes(o))||n.some(o=>i.some(a=>o.toLowerCase().includes(a)))}function Ehe(t){let e=t.get(_o.IdentityTrait);if(!e)return!1;let r=e.name?.toLowerCase()||"",n=e.aliases||[];return r.includes("pump")||n.some(i=>i.toLowerCase().includes("pump"))}function The(t){return t.world.getContents(t.player.id).find(r=>Ehe(r))}function _he(t){let{world:e,player:r}=t,n=e.getLocation(r.id),o=e.getContents(r.id).find(a=>g4(a));if(o)return o;if(n){let s=e.getContents(n).find(c=>g4(c));if(s)return s}}var h4={id:Us,group:"manipulation",validate(t){let e=_he(t);if(!e)return{valid:!1,error:si.NOT_INFLATABLE};if(e.isInflated)return{valid:!1,error:si.ALREADY_INFLATED};let r=The(t);return r?(t.sharedData.boat=e,t.sharedData.pump=r,{valid:!0}):{valid:!1,error:si.NO_PUMP}},execute(t){let{sharedData:e}=t,r=e.boat;r.isInflated=!0;let n=r.get(_o.IdentityTrait);n&&(n.name="magic boat",n.article="a",n.description="The boat is a seaworthy craft approximately eight feet long. A pair of oars is affixed to the side."),r.attributes.displayName="magic boat",r.has(_o.TraitType.ENTERABLE)||r.add(new _o.EnterableTrait({preposition:"in"})),r.has(_o.TraitType.VEHICLE)||r.add(new _o.VehicleTrait({vehicleType:"watercraft",blocksWalkingMovement:!1,requiresExitBeforeLeaving:!1,isOperational:!0,transparent:!0}))},blocked(t,e){return[t.event("action.blocked",{actionId:Us,messageId:e.error||si.NOT_INFLATABLE,reason:e.error})]},report(t){return[t.event("game.message",{messageId:si.SUCCESS})]}};var bl="dungeo.action.deflate",bo={SUCCESS:"dungeo.deflate.success",ALREADY_DEFLATED:"dungeo.deflate.already_deflated",NOT_DEFLATABLE:"dungeo.deflate.not_deflatable",CANT_REACH:"dungeo.deflate.cant_reach"};var Ol=S(b());function Y0(t){let e=t.get(Ol.IdentityTrait);if(!e)return!1;let r=e.name?.toLowerCase()||"",n=e.aliases||[],i=["boat","raft","plastic","pile"];return i.some(o=>r.includes(o))||n.some(o=>i.some(a=>o.toLowerCase().includes(a)))}function bhe(t){let{world:e,player:r}=t,n=e.getLocation(r.id),o=e.getContents(r.id).find(a=>Y0(a));if(o)return o;if(n){let a=e.getEntity(n);if(a&&Y0(a))return a;let c=e.getContents(n).find(l=>Y0(l));if(c)return c}}var y4={id:bl,group:"manipulation",validate(t){let e=bhe(t);return e?e.isInflated?(t.sharedData.boat=e,{valid:!0}):{valid:!1,error:bo.ALREADY_DEFLATED}:{valid:!1,error:bo.NOT_DEFLATABLE}},execute(t){let{sharedData:e,world:r,player:n}=t,i=e.boat;if(r.getLocation(n.id)===i.id){let s=r.getLocation(i.id);s&&(r.moveEntity(n.id,s),e.wasEjected=!0)}i.isInflated=!1;let a=i.get(Ol.IdentityTrait);a&&(a.name="pile of plastic",a.article="a",a.description="There is a folded pile of plastic here which has a small valve attached."),i.attributes.displayName="pile of plastic",i.has(Ol.TraitType.ENTERABLE)&&i.remove(Ol.TraitType.ENTERABLE),i.has(Ol.TraitType.VEHICLE)&&i.remove(Ol.TraitType.VEHICLE)},blocked(t,e){return[t.event("action.blocked",{actionId:bl,messageId:e.error||bo.NOT_DEFLATABLE,reason:e.error})]},report(t){return[t.event("game.message",{messageId:bo.SUCCESS})]}};var Gg="dungeo.action.river_blocked",TS={NO_BOAT:"dungeo.river.no_boat"};var Ohe=0;function Ihe(){return`river-blocked-${Date.now()}-${++Ohe}`}var v4={id:Gg,group:"movement",validate(t){return{valid:!1,error:TS.NO_BOAT}},execute(t){},blocked(t,e){return[{id:Ihe(),type:"game.message",timestamp:Date.now(),entities:{},data:{messageId:TS.NO_BOAT},narrate:!0}]},report(t){return[]}};var qs=S(b());var Zu="dungeo.action.launch",Xr={SUCCESS:"dungeo.launch.success",NOT_IN_BOAT:"dungeo.launch.not_in_boat",NOT_AT_SHORE:"dungeo.launch.not_at_shore",BOAT_NOT_INFLATED:"dungeo.launch.boat_not_inflated",ALREADY_ON_RIVER:"dungeo.launch.already_on_river"};function She(t){let{world:e,player:r}=t,n=e.getLocation(r.id);if(!n)return{boat:null,isInBoat:!1};let i=e.getEntity(n);if(!i)return{boat:null,isInBoat:!1};if(!i.has(qs.TraitType.VEHICLE))return{boat:null,isInBoat:!1};let o=i.get(qs.VehicleTrait);return!o||o.vehicleType!=="watercraft"?{boat:null,isInBoat:!1}:{boat:i,isInBoat:!0}}function Ahe(t){let{world:e,player:r}=t,n=e.getContainingRoom(r.id);if(!n||!n.canLaunchBoat)return null;if(n.launchDestination)return n.launchDestination;let i=n.get(qs.RoomTrait);if(!i)return null;for(let o of[qs.Direction.EAST,qs.Direction.WEST]){let a=i.exits[o];if(a?.destination){let s=e.getEntity(a.destination);if(s&&s.isWaterRoom)return a.destination}}return null}var z0={id:Zu,group:"movement",validate(t){let{world:e,player:r}=t,{boat:n,isInBoat:i}=She(t);if(!i||!n)return{valid:!1,error:Xr.NOT_IN_BOAT};if(!n.isInflated)return{valid:!1,error:Xr.BOAT_NOT_INFLATED};let o=e.getContainingRoom(r.id);if(o&&o.isWaterRoom)return{valid:!1,error:Xr.ALREADY_ON_RIVER};let a=Ahe(t);return a?(t.sharedData.boat=n,t.sharedData.destination=a,{valid:!0}):{valid:!1,error:Xr.NOT_AT_SHORE}},execute(t){let{world:e}=t,{boat:r,destination:n}=t.sharedData;e.moveEntity(r.id,n)},blocked(t,e){return[t.event("action.blocked",{actionId:Zu,messageId:e.error||Xr.NOT_IN_BOAT,reason:e.error})]},report(t){let{world:e,player:r}=t,i=e.getContainingRoom(r.id)?.name||"the river";return[t.event("game.message",{messageId:Xr.SUCCESS}),t.event("if.event.actor_moved",{actorId:r.id,currentLocation:t.sharedData.destination})]}};var $0="dungeo.action.falls_death",K0={DEATH:"dungeo.falls.death"};var E4={id:$0,group:"special",validate(t){return{valid:!0}},execute(t){t.world.setStateValue("dungeo.player.dead",!0),t.world.setStateValue("dungeo.player.death_cause","falls")},blocked(t,e){return[]},report(t){return[t.event("if.event.player.died",{messageId:K0.DEATH,cause:"aragain_falls"})]}};var Il="dungeo.action.grue_death",Ju={WALKED_INTO_GRUE:"dungeo.grue.walked_into",SLITHERED_INTO_ROOM:"dungeo.grue.slithered_into",PITCH_DARK_WARNING:"dungeo.grue.pitch_dark_warning"};var T4={id:Il,group:"special",validate(t){return{valid:!0}},execute(t){t.world.setStateValue("dungeo.player.dead",!0),t.world.setStateValue("dungeo.player.death_cause","grue")},blocked(t,e){return[]},report(t){let e=t.command.parsed.extras?.grueDeathType||"walked_into",r=e==="slithered"?Ju.SLITHERED_INTO_ROOM:Ju.WALKED_INTO_GRUE;return[t.event("if.event.player.died",{messageId:r,cause:"grue",deathType:e})]}};var Sl="dungeo.chimney.blocked",ya={TOO_MUCH_BAGGAGE:"dungeo.chimney.too_much_baggage",EMPTY_HANDED:"dungeo.chimney.empty_handed"};var Rhe=0;function whe(){return`chimney-blocked-${Date.now()}-${++Rhe}`}var Q0={id:Sl,group:"movement",validate(t){return{valid:!1,error:t.command.parsed?.extras?.chimneyBlockReason==="empty"?ya.EMPTY_HANDED:ya.TOO_MUCH_BAGGAGE}},execute(t){},blocked(t,e){let r=t.command.parsed?.extras?.chimneyBlockReason,n,i;return r==="empty"?(n=ya.EMPTY_HANDED,i="Going up empty-handed is a bad idea."):(n=ya.TOO_MUCH_BAGGAGE,i="The chimney is too narrow for you and all of your baggage."),[{id:whe(),type:"game.message",timestamp:Date.now(),entities:{},data:{messageId:n,message:i},narrate:!0}]},report(t){return[]}};var va=S(b());var Ge={NO_TARGET:"dungeo.commanding.no_target",CANT_COMMAND:"dungeo.commanding.cant_command",CANT_SEE:"dungeo.commanding.cant_see",WHIRR_BUZZ_CLICK:"dungeo.commanding.whirr_buzz_click",STUPID_ROBOT:"dungeo.commanding.stupid_robot"},Fs="dungeo.action.commanding";var rt={DESCRIPTION:"dungeo.robot.description",FOLLOWS:"dungeo.robot.follows",WAITS:"dungeo.robot.waits",COMMAND_UNDERSTOOD:"dungeo.robot.command_understood",COMMAND_UNKNOWN:"dungeo.robot.command_unknown",PUSHES_BUTTON:"dungeo.robot.pushes_button",NO_BUTTON:"dungeo.robot.no_button",ALREADY_PUSHED:"dungeo.robot.already_pushed",ARRIVES:"dungeo.robot.arrives",TAKES_OBJECT:"dungeo.robot.takes_object",DROPS_OBJECT:"dungeo.robot.drops_object",CAROUSEL_FIXED:"dungeo.robot.carousel_fixed"};var Vg=S(b());function Yg(t){let e=t.get(Vg.NpcTrait);return e?.customProperties?e.customProperties:null}function _S(t,e,r){let n=[],i=Yg(e);if(!i)return n;i.buttonPushed=!0;let o=t.getEntity(r);return o&&(o.isFixed=!0),n.push({id:`robot-push-button-${Date.now()}`,type:"game.message",timestamp:Date.now(),entities:{actor:e.id},data:{npc:e.id,messageId:rt.PUSHES_BUTTON,npcName:"robot"},narrate:!0}),n.push({id:`carousel-fixed-${Date.now()}`,type:"game.message",timestamp:Date.now(),entities:{},data:{messageId:rt.CAROUSEL_FIXED},narrate:!0}),n}var Che=["walk","go","north","south","east","west","up","down","n","s","e","w","u","d","ne","nw","se","sw","northeast","northwest","southeast","southwest","take","get","pick","drop","put","push","press","throw","turn","leap","jump"],X0={n:"NORTH",north:"NORTH",s:"SOUTH",south:"SOUTH",e:"EAST",east:"EAST",w:"WEST",west:"WEST",u:"UP",up:"UP",d:"DOWN",down:"DOWN",ne:"NORTHEAST",northeast:"NORTHEAST",nw:"NORTHWEST",northwest:"NORTHWEST",se:"SOUTHEAST",southeast:"SOUTHEAST",sw:"SOUTHWEST",southwest:"SOUTHWEST"};function Nhe(t){if(!t)return!1;let e=t.get?.(va.IdentityTrait);return e?e.name==="Machine Room"&&e.description?.includes("triangular button"):!1}function Dhe(t){let e=t.world.getAllEntities();for(let r of e)if(r.get(va.IdentityTrait)?.name==="Round Room")return r;return null}function _4(t,e,r){let n=[],i=t.world.getLocation(e.id);if(!i)return n.push(t.event("game.message",{messageId:Ge.WHIRR_BUZZ_CLICK})),n;let o=t.world.getEntity(i);if(!o)return n.push(t.event("game.message",{messageId:Ge.WHIRR_BUZZ_CLICK})),n;let s=o.get(va.RoomTrait)?.exits||{},c=X0[r],u=s[c]?.destination;return u?(t.world.moveEntity(e.id,u),n.push(t.event("game.message",{messageId:Ge.WHIRR_BUZZ_CLICK})),t.world.getLocation(t.player.id)===u&&n.push(t.event("game.message",{messageId:rt.ARRIVES})),n):(n.push(t.event("game.message",{messageId:Ge.WHIRR_BUZZ_CLICK})),n)}function Phe(t,e,r){let n=[],i=t.world.getLocation(e.id);if(!i)return n.push(t.event("game.message",{messageId:Ge.WHIRR_BUZZ_CLICK})),n;let o=t.world.getContents(i),a=null;for(let s of o){if(s.id===e.id)continue;let c=s.get(va.IdentityTrait);if(!c)continue;let l=c.name?.toLowerCase()||"",u=c.aliases?.map(m=>m.toLowerCase())||[];if(l.includes(r)||u.some(m=>m.includes(r))){a=s;break}}return n.push(t.event("game.message",{messageId:Ge.WHIRR_BUZZ_CLICK})),a&&a.portable!==!1&&(t.world.moveEntity(a.id,e.id),n.push(t.event("game.message",{messageId:rt.TAKES_OBJECT,objectName:a.get(va.IdentityTrait)?.name||"object"}))),n}function Lhe(t,e,r){let n=[],i=t.world.getLocation(e.id);if(!i)return n.push(t.event("game.message",{messageId:Ge.WHIRR_BUZZ_CLICK})),n;let o=t.world.getContents(e.id),a=null;for(let s of o){let c=s.get(va.IdentityTrait);if(!c)continue;let l=c.name?.toLowerCase()||"",u=c.aliases?.map(m=>m.toLowerCase())||[];if(l.includes(r)||u.some(m=>m.includes(r))){a=s;break}}return n.push(t.event("game.message",{messageId:Ge.WHIRR_BUZZ_CLICK})),a&&(t.world.moveEntity(a.id,i),n.push(t.event("game.message",{messageId:rt.DROPS_OBJECT,objectName:a.get(va.IdentityTrait)?.name||"object"}))),n}function Mhe(t,e,r){let n=[],i=Yg(e);if(!i)return[t.event("action.blocked",{actionId:Fs,messageId:Ge.CANT_COMMAND})];let o=r.split(/\s+/),a=o[0]||"";if((a==="push"||a==="press")&&r.includes("button")){if(i.buttonPushed)return n.push(t.event("game.message",{npc:e.id,messageId:rt.ALREADY_PUSHED,npcName:"robot"})),n;let s=t.world.getLocation(e.id),c=s?t.world.getEntity(s):null;if(!Nhe(c))return n.push(t.event("game.message",{npc:e.id,messageId:rt.NO_BUTTON,npcName:"robot"})),n;n.push(t.event("game.message",{npc:e.id,messageId:Ge.WHIRR_BUZZ_CLICK,npcName:"robot"}));let l=Dhe(t);if(l){let u=_S(t.world,e,l.id);n.push(...u)}else n.push(t.event("game.message",{npc:e.id,messageId:rt.PUSHES_BUTTON,npcName:"robot"}));return n}if(a==="walk"||a==="go"){let s=o[1]||"";if(X0[s])return _4(t,e,s)}if(X0[a])return _4(t,e,a);if(a==="take"||a==="get"||a==="pick"){let s=o.slice(a==="pick"?2:1).join(" ");return s?Phe(t,e,s):(n.push(t.event("game.message",{messageId:Ge.WHIRR_BUZZ_CLICK})),n)}if(a==="drop"){let s=o.slice(1).join(" ");return s?Lhe(t,e,s):(n.push(t.event("game.message",{messageId:Ge.WHIRR_BUZZ_CLICK})),n)}return Che.includes(a)?(n.push(t.event("game.message",{npc:e.id,messageId:Ge.WHIRR_BUZZ_CLICK,npcName:"robot"})),n):(n.push(t.event("game.message",{npc:e.id,messageId:Ge.STUPID_ROBOT,npcName:"robot"})),n)}var Z0={id:Fs,group:"communication",validate(t){let e=t.command.directObject?.entity;return e?e.get(va.IdentityTrait)?.name!=="robot"?{valid:!1,error:Ge.CANT_COMMAND}:t.canSee(e)?{valid:!0}:{valid:!1,error:Ge.CANT_SEE}:{valid:!1,error:Ge.NO_TARGET}},execute(t){let e=t.command.directObject.entity,r=t.command.parsed?.textSlots?.get("command")||"";t.sharedData.robot=e,t.sharedData.command=r.toLowerCase().trim()},blocked(t,e){return[t.event("game.message",{actionId:Fs,messageId:e.error||Ge.CANT_COMMAND})]},report(t){let{robot:e,command:r}=t.sharedData;return Mhe(t,e,r)}};var O4=S(b()),Gs="dungeo.action.talk_to_troll",rf={CANT_HEAR_YOU:"dungeo.troll.cant_hear_you",GROWLS:"dungeo.troll.growls_at_player"};function b4(t){return t.sharedData}var J0={id:Gs,group:"communication",validate(t){let e=b4(t),r=t.world.getAllEntities().find(a=>!!(a.name.toLowerCase()==="troll"||a.get("identity")?.aliases?.some(c=>c.toLowerCase()==="troll")));if(!r)return{valid:!1,error:"no_troll",params:{}};let n=t.world.getLocation(r.id),i=t.world.getLocation(t.player.id);if(n!==i)return{valid:!1,error:"troll_not_here",params:{}};e.trollId=r.id;let o=r.get(O4.CombatantTrait);return e.isIncapacitated=o&&(!o.isAlive||!o.isConscious),{valid:!0}},execute(t){},report(t){let r=b4(t).isIncapacitated?rf.CANT_HEAR_YOU:rf.GROWLS;return[t.event("action.success",{actionId:Gs,messageId:r})]},blocked(t,e){return e.error==="troll_not_here"||e.error==="no_troll"?[t.event("action.blocked",{actionId:Gs,messageId:"core.entity_not_found"})]:[]}};var ed="dungeo.action.diagnose",Dn={PERFECT_HEALTH:"dungeo.diagnose.perfect_health",LIGHT_WOUND:"dungeo.diagnose.light_wound",SERIOUS_WOUND:"dungeo.diagnose.serious_wound",SEVERAL_WOUNDS:"dungeo.diagnose.several_wounds",WOUNDS_CURE:"dungeo.diagnose.wounds_cure",DEATHS_DOOR:"dungeo.diagnose.deaths_door",ONE_MORE_WOUND:"dungeo.diagnose.one_more_wound",SERIOUS_WOUND_KILL:"dungeo.diagnose.serious_wound_kill",SURVIVE_SERIOUS:"dungeo.diagnose.survive_serious",STRONG:"dungeo.diagnose.strong",KILLED_ONCE:"dungeo.diagnose.killed_once",KILLED_TWICE:"dungeo.diagnose.killed_twice"};function I4(t){return t.sharedData}var ex={id:ed,group:"meta",validate(t){return{valid:!0}},execute(t){let{world:e}=t,r=e.getPlayer(),n=I4(t);if(!r){n.health=100,n.maxHealth=100,n.woundLevel=0,n.strengthLevel=4,n.deaths=0;return}let i=r.get("combatant");if(i){n.health=i.health,n.maxHealth=i.maxHealth;let o=i.health/i.maxHealth;o>=1?n.woundLevel=0:o>=.75?n.woundLevel=1:o>=.5?n.woundLevel=2:o>=.25?n.woundLevel=3:n.woundLevel=4,i.health<=0?n.strengthLevel=0:i.health<=10?n.strengthLevel=1:i.health<=25?n.strengthLevel=2:i.health<=50?n.strengthLevel=3:n.strengthLevel=4,n.woundLevel>0&&(n.turnsToHeal=30*n.woundLevel)}else n.health=100,n.maxHealth=100,n.woundLevel=0,n.strengthLevel=4;n.deaths=e.getStateValue("dungeo.player.deaths")||0},blocked(t,e){return[t.event("action.blocked",{actionId:this.id,messageId:e.error,reason:e.error,params:e.params||{}})]},report(t){let e=I4(t),r=[];return r.push(t.event("dungeo.event.diagnose",{health:e.health,maxHealth:e.maxHealth,woundLevel:e.woundLevel,strengthLevel:e.strengthLevel,deaths:e.deaths,turnsToHeal:e.turnsToHeal})),r}};var td="dungeo.action.room",rd="dungeo.action.rname",Al="dungeo.action.objects",tx={NO_OBJECTS:"dungeo.room_info.no_objects"};var S4=S(b());var A4={id:td,group:"observation",validate(t){return{valid:!0}},execute(t){},blocked(t,e){return[t.event("action.blocked",{actionId:this.id,messageId:e.error,reason:e.error,params:e.params||{}})]},report(t){let e=[],{world:r,player:n}=t,i=r.getContainingRoom(n.id);if(!i)return e;let o=i.get(S4.TraitType.ROOM),a=i.description||"You see nothing special.";return e.push(t.event("if.event.room.description",{roomId:i.id,roomName:i.name,description:a,isVisited:o?.visited||!1})),e}};var R4={id:rd,group:"observation",validate(t){return{valid:!0}},execute(t){},blocked(t,e){return[t.event("action.blocked",{actionId:this.id,messageId:e.error,reason:e.error,params:e.params||{}})]},report(t){let e=[],{world:r,player:n}=t,i=r.getContainingRoom(n.id);return i&&e.push(t.event("dungeo.event.rname",{roomId:i.id,roomName:i.name})),e}};var zg=S(b());var w4={id:Al,group:"observation",validate(t){return{valid:!0}},execute(t){},blocked(t,e){return[t.event("action.blocked",{actionId:this.id,messageId:e.error,reason:e.error,params:e.params||{}})]},report(t){let e=[],{world:r,player:n}=t,i=r.getContainingRoom(n.id);if(!i)return e;let o=r.getContents(i.id),a=[],s=[];for(let c of o)if(c.id!==n.id&&!c.hasTrait(zg.TraitType.SCENERY)){if(c.hasTrait("npc")){let l=c.get("npc");if(l&&l.state==="DISABLED")continue}if(a.push({id:c.id,name:c.name,description:c.description}),c.hasTrait(zg.TraitType.CONTAINER)&&c.get(zg.TraitType.OPENABLE)?.isOpen){let u=r.getContents(c.id);if(u.length>0){let m=u.map(f=>({id:f.id,name:f.name}));s.push({containerId:c.id,containerName:c.name,preposition:"in",items:m})}}if(c.hasTrait(zg.TraitType.SUPPORTER)){let l=r.getContents(c.id);if(l.length>0){let u=l.map(m=>({id:m.id,name:m.name}));s.push({containerId:c.id,containerName:c.name,preposition:"on",items:u})}}}return e.push(t.event("dungeo.event.objects",{roomId:i.id,items:a,containerContents:s,hasItems:a.length>0})),e}};var C4=[A4,R4,w4];var nf=S(b());var rx="dungeo.balloon.burningObject",nx="dungeo.balloon.inflated",bS={PUT_IN_RECEPTACLE:"dungeo.balloon.put_in_receptacle",RECEPTACLE_EMPTY:"dungeo.balloon.receptacle_empty",NOT_BURNING:"dungeo.balloon.not_burning",OBJECT_BURNED_OUT:"dungeo.balloon.object_burned_out"},N4="dungeo.balloon.burn";var ci=null,$g=null;function ix(t){if(!ci)return null;let e=t.getEntity(ci);return e&&e.balloonState||null}function ox(t,e){if(!ci)return;let n=t.getContents(ci).find(i=>i.get(nf.IdentityTrait)?.name==="cloth bag");if(n){n.isInflated=e;let i=n.get(nf.IdentityTrait);i&&(e?i.description="The silk bag billows overhead, filled with hot air.":i.description="The cloth bag is draped over the basket.")}}function ax(t,e,r,n){ci=r,$g=n;let i=t.getEventProcessor();i.registerHandler("if.event.put_in",o=>{let a=o.data;if(!a)return[];if(a.targetId!==$g)return[];let c=a.itemId;if(!c)return[];let l=e.getEntity(c);if(!l)return[];let u=l.isBurning===!0,m=ix(e);return m?(u&&(m.burningObject=c,e.setStateValue(rx,c),e.setStateValue(nx,!0),ox(e,!0),e.setStateValue("dungeo.balloon.just_inflated",!0)),[]):[]}),i.registerHandler("if.event.taken",o=>{let a=o.data;if(!a)return[];let s=a.entityId;if(!s)return[];let c=ix(e);return c?(c.burningObject===s&&(c.burningObject=null,e.setStateValue(rx,null),e.getEntity($g)&&(e.getContents($g).some(f=>f.isBurning===!0)||(e.setStateValue(nx,!1),ox(e,!1),e.setStateValue("dungeo.balloon.just_deflated",!0)))),[]):[]})}function khe(){return{id:N4,name:"Balloon Burn Timer",priority:10,condition:t=>!0,run:t=>{let e=[],r=t.world,n=r.getAllEntities();for(let i of n){if(!(i.isBurning===!0))continue;let a=i.burnTurnsRemaining;if(typeof a!="number")continue;let s=a-1;if(i.burnTurnsRemaining=s,s<=0){if(i.isBurning=!1,i.burnTurnsRemaining=0,i.isBurnedOut=!0,r.getLocation(i.id)===$g){let u=ix(r);u&&u.burningObject===i.id&&(u.burningObject=null,r.setStateValue(rx,null),r.setStateValue(nx,!1),ox(r,!1),e.push({id:`burn-fuse-${t.turn}`,type:"daemon.message",timestamp:Date.now(),entities:{target:i.id},data:{messageId:K.BALLOON_DEFLATING,daemonId:N4,burnedOutItem:i.id}}))}let l=i.get(nf.IdentityTrait);e.push({id:`burned-out-${i.id}-${t.turn}`,type:"daemon.message",timestamp:Date.now(),entities:{target:i.id},data:{messageId:bS.OBJECT_BURNED_OUT,itemName:l?.name||"object",entityId:i.id}})}}return e}}}function sx(t){t.registerDaemon(khe())}var nd="dungeo.action.balloon-exit",Kg={EXIT_SUCCESS:"dungeo.balloon.exit_success",EXIT_BLOCKED_MIDAIR:"dungeo.balloon.exit_blocked_midair",EXIT_TO_LEDGE:"dungeo.balloon.exit_to_ledge"};function D4(){return(t,e)=>{if(t.action!=="exiting"||!ci)return t;let r=e.getPlayer();if(!r||e.getLocation(r.id)!==ci)return t;let i=e.getEntity(ci);if(!i)return t;let o=i.balloonState;if(!o)return t;let a=o.position;return a==="vlbot"?t:k0(a)?{...t,action:nd,structure:t.structure}:zu(a)?{...t,action:nd,structure:t.structure}:t}}var P4={id:nd,group:"movement",validate(t){let e=t.player,r=t.world.getLocation(e.id);if(!ci||r!==ci)return{valid:!1,error:"not_in_balloon"};let n=t.world.getEntity(ci);if(!n)return{valid:!1,error:"balloon_not_found"};let i=n.balloonState;if(!i)return{valid:!1,error:"balloon_state_not_found"};let o=i.position;return k0(o)?{valid:!1,error:Kg.EXIT_BLOCKED_MIDAIR}:(t.sharedData.balloonPosition=o,t.sharedData.balloonId=ci,{valid:!0})},execute(t){let e=t.sharedData.balloonPosition,r=t.world.getEntity(ci);if(!r)return;let n=r.get(nf.VehicleTrait);if(!n?.positionRooms)return;let i=n.positionRooms[e];i&&(t.world.moveEntity(t.player.id,i),t.sharedData.exitedToRoom=i,t.sharedData.exitSuccess=!0)},blocked(t,e){return e.error===Kg.EXIT_BLOCKED_MIDAIR?[t.event("action.blocked",{actionId:nd,messageId:Kg.EXIT_BLOCKED_MIDAIR,reason:"You are too high in the air to exit safely!"})]:[t.event("action.blocked",{actionId:nd,messageId:e.error||"action_failed"})]},report(t){if(!t.sharedData.exitSuccess)return[];let e=[];return e.push(t.event("if.event.exited",{fromLocation:t.sharedData.balloonId,toLocation:t.sharedData.exitedToRoom,preposition:"out of"})),e.push(t.event("action.success",{actionId:nd,messageId:Kg.EXIT_TO_LEDGE,params:{}})),e}};var L4=[...S3,...P3,...B3,n0,...H3,c0,u0,d0,f0,h0,v0,T0,_0,w0,C0,N0,b2,O2,D0,P0,S2,R2,w2,L0,N2,D2,P2,M2,H2,U2,P4,W0,r4,U0,m4,p4,n4,q0,h4,y4,v4,E4,T4,Q0,Z0,z0,J0,ex,...C4];var lx=S(b()),Rl={ATTACKS:"dungeo.bat.attacks",CARRIES_AWAY:"dungeo.bat.carries_away",COWERS:"dungeo.bat.cowers",DROPPED:"dungeo.bat.dropped"},cx="dungeo.bat.acted",OS="dungeo.bat.prevLocation",xhe=0;function IS(){return`bat-${Date.now()}-${++xhe}`}function Bhe(t){let e=t.get(lx.IdentityTrait);if(!e)return!1;let r=e.name?.toLowerCase()||"",n=e.aliases||[];return r.includes("garlic")||n.some(i=>i.toLowerCase().includes("garlic"))}function jhe(t,e){let r=n=>t.getContents(n).some(o=>Bhe(o)?!0:r(o.id));return r(e)}function Whe(t,e){let r=t.filter(i=>i!==e);if(r.length===0)return e;let n=Math.floor(Math.random()*r.length);return r[n]}function M4(t,e,r){let n={id:"dungeo-bat",name:"Vampire Bat",priority:50,condition:o=>o.playerLocation===e,run:o=>{let{world:a,playerId:s,playerLocation:c}=o,l=[];if(a.getStateValue(cx)||a.getStateValue(OS)===e)return l;if(a.setStateValue(cx,!0),a.setStateValue(OS,e),jhe(a,s))l.push({id:IS(),type:"npc.emoted",timestamp:Date.now(),entities:{},data:{messageId:Rl.COWERS},narrate:!0});else{l.push({id:IS(),type:"npc.emoted",timestamp:Date.now(),entities:{},data:{messageId:Rl.ATTACKS},narrate:!0});let m=Whe(r,e);l.push({id:IS(),type:"npc.emoted",timestamp:Date.now(),entities:{},data:{messageId:Rl.CARRIES_AWAY},narrate:!0}),a.moveEntity(s,m),a.setStateValue(OS,m);let g=a.getEntity(m)?.get(lx.IdentityTrait);l.push({id:IS(),type:"if.event.room.description",timestamp:Date.now(),entities:{},data:{roomId:m,roomName:g?.name||"somewhere",roomDescription:g?.description||"",includeContents:!0,verbose:!0},narrate:!0})}return l}},i={id:"dungeo-bat-reset",name:"Bat State Reset",priority:-100,condition:o=>!0,run:o=>(o.world.setStateValue(cx,!1),o.world.setStateValue(OS,o.playerLocation),[])};t.registerDaemon(n),t.registerDaemon(i)}var Cl=S(b()),wl={SPIRITS_BLOCK:"dungeo.exorcism.spirits_block",SPIRITS_VANISH:"dungeo.exorcism.spirits_vanish",PASSAGE_OPENS:"dungeo.exorcism.passage_opens",BELL_ECHOES:"dungeo.exorcism.bell_echoes",RITUAL_PROGRESS:"dungeo.exorcism.ritual_progress"},SS="dungeo.exorcism.",ux=`${SS}bell_rung`,dx=`${SS}book_read`,mx=`${SS}candles_lit`,fx=`${SS}spirits_banished`;function Hhe(t){return t?.exorcismRole==="bell"}function Uhe(t){return t?.exorcismRole==="book"}function qhe(t){return t?.exorcismRole==="candles"}function Fhe(t){let e={};for(let r of t.getAllEntities())Hhe(r)&&(e.bell=r.id),Uhe(r)&&(e.book=r.id),qhe(r)&&(e.candles=r.id);return e}function Ghe(t,e){return t.getStateValue(ux)===!0&&t.getStateValue(dx)===!0&&t.getStateValue(mx)===!0}function Vhe(t,e,r){let n=[];t.setStateValue(fx,!0);let i=t.getEntity(e);if(i){i.spiritsBlocking=!1,Cl.RoomBehavior.unblockExit(i,Cl.Direction.EAST);let o=i.get(Cl.IdentityTrait);o&&(o.description="You are at the entrance to Hades, the land of the dead. An eerie mist swirls around you. A passage leads east into darkness, and a corridor leads north.")}return n.push({id:`exorcism-spirits-vanish-${Date.now()}`,type:"npc.emoted",timestamp:Date.now(),entities:{},data:{messageId:wl.SPIRITS_VANISH},narrate:!0}),n.push({id:`exorcism-passage-opens-${Date.now()}`,type:"game.message",timestamp:Date.now(),entities:{},data:{messageId:wl.PASSAGE_OPENS}}),n.push({id:`exorcism-score-${Date.now()}`,type:"game.score_changed",timestamp:Date.now(),entities:{},data:{delta:10,reason:"exorcism",newScore:0}}),n}function k4(t,e,r,n){let i=Fhe(e);e.setStateValue(ux,!1),e.setStateValue(dx,!1),e.setStateValue(mx,!1),e.setStateValue(fx,!1),e.registerEventHandler("game.message",(a,s)=>{let c=a.data,l=c?.messageId,u=c?.location;l==="dungeo.ring.bell"&&u===r&&s.setStateValue(ux,!0)}),e.registerEventHandler("if.event.read",(a,s)=>{let c=a.data,l=c?.target||c?.targetId;if(l&&i.book&&l===i.book){let u=s.getPlayer();u&&s.getLocation(u.id)===r&&s.setStateValue(dx,!0)}}),e.registerEventHandler("if.event.switched_on",(a,s)=>{let l=a.data?.target;if(l&&i.candles&&l===i.candles){let u=s.getPlayer();u&&s.getLocation(u.id)===r&&s.setStateValue(mx,!0)}});let o={id:"dungeo-exorcism-check",name:"Exorcism Ritual Check",priority:40,condition:a=>a.world.getStateValue(fx)?!1:a.playerLocation===r,run:a=>{let{world:s}=a;return Ghe(s,r)?Vhe(s,r,n):[]}};t.registerDaemon(o)}var RS=S(b()),px={COMPASS_SPINNING:"dungeo.round_room.compass_spinning",DISORIENTED:"dungeo.round_room.disoriented",ROOM_FIXED:"dungeo.round_room.fixed"},gx="dungeo.round_room.prevLocation",Yhe=0;function AS(){return`round-room-${Date.now()}-${++Yhe}`}function zhe(t,e){let r=t.getEntity(e);if(!r)return[];let n=r.get(RS.RoomTrait);if(!n||!n.exits)return[];let i=[];for(let o of Object.values(n.exits))o&&typeof o=="object"&&"destination"in o&&i.push(o.destination);return i}function $he(t,e,r){let n=zhe(t,e),i=r?n.filter(a=>a!==r):n;if(i.length===0)return n.length>0?n[0]:null;let o=Math.floor(Math.random()*i.length);return i[o]}function Khe(t,e){let r=t.getEntity(e);return r?r.isFixed===!0:!0}function x4(t,e){let r={id:"dungeo-round-room",name:"Round Room Carousel",priority:60,condition:i=>i.world.getStateValue(gx)===e&&i.playerLocation!==e,run:i=>{let{world:o,playerId:a,playerLocation:s}=i,c=[];if(Khe(o,e))return c;let l=s,u=$he(o,e,l);if(!u||u===l)return c.push({id:AS(),type:"game.message",timestamp:Date.now(),entities:{},data:{messageId:px.COMPASS_SPINNING},narrate:!0}),c;c.push({id:AS(),type:"game.message",timestamp:Date.now(),entities:{},data:{messageId:px.COMPASS_SPINNING},narrate:!0}),o.moveEntity(a,u),c.push({id:AS(),type:"game.message",timestamp:Date.now(),entities:{},data:{messageId:px.DISORIENTED},narrate:!0}),o.setStateValue(gx,u);let f=o.getEntity(u)?.get(RS.IdentityTrait);return c.push({id:AS(),type:"if.event.room.description",timestamp:Date.now(),entities:{},data:{roomId:u,roomName:f?.name||"somewhere",roomDescription:f?.description||"",includeContents:!0,verbose:!0},narrate:!0}),c}},n={id:"dungeo-round-room-tracking",name:"Round Room Location Tracking",priority:-100,condition:i=>!0,run:i=>(i.world.setStateValue(gx,i.playerLocation),[])};t.registerDaemon(r),t.registerDaemon(n)}var hx=S(b());var Qg={GHOST_APPEARS:"dungeo.ghost.appears",CANVAS_SPAWNS:"dungeo.ghost.canvas_spawns",WRONG_ITEM:"dungeo.ghost.wrong_item",NOT_BLESSED:"dungeo.ghost.not_blessed"};function Qhe(t){return t?.isFramePiece===!0}function Xhe(t){return t.getAllEntities().find(r=>r.get(hx.IdentityTrait)?.name==="Basin Room")?.id}function Zhe(t){return t.getAllEntities().find(r=>r.get(hx.IdentityTrait)?.name==="Gallery")?.id}function B4(t){let e=Xhe(t),r=Zhe(t);if(!e){console.warn("Basin Room not found - ghost ritual handler not registered");return}if(!r){console.warn("Gallery not found - ghost ritual handler not registered");return}t.registerEventHandler("if.event.dropped",(n,i)=>{let o=n.data;if(!o)return;let a=o.itemId||o.target;if((o.location||o.locationId)!==e)return;let c=t.getEntity(a);if(!c||!Qhe(c))return;let l=t.getEntity(e);!l||l.basinState!=="disarmed"||Jhe(t,a,r)})}function Jhe(t,e,r){t.removeEntity(e);let n=V5(t);t.moveEntity(n.id,r),t.setStateValue("dungeo.ghost_ritual.complete",!0),t.setStateValue("dungeo.ghost_ritual.canvas_id",n.id)}var wS=S(b()),yx={REALITY_ALTERED:"dungeo.scoring.reality_altered"};function j4(t){t.registerEventHandler("if.event.score_displayed",(e,r)=>{let n=r.getCapability(wS.StandardCapabilities.SCORING);n&&n.realityAlteredPending&&(n.realityAlteredPending=!1,n.realityAlteredQueued=!0)})}function W4(t){let e={id:"dungeo-reality-altered",name:"Reality Altered Message",priority:100,condition:r=>r.world.getCapability(wS.StandardCapabilities.SCORING)?.realityAlteredQueued===!0,run:r=>{let n=r.world.getCapability(wS.StandardCapabilities.SCORING);return n?(n.realityAlteredQueued=!1,[{id:`reality-altered-${Date.now()}`,type:"game.message",timestamp:Date.now(),entities:{},data:{messageId:yx.REALITY_ALTERED},narrate:!0}]):[]}};t.registerDaemon(e)}var Ta=S(b()),Ea={DARKNESS_DESCENDS:"dungeo.endgame.darkness_descends",CLOAKED_FIGURE:"dungeo.endgame.cloaked_figure",TELEPORT:"dungeo.endgame.teleport",ENDGAME_BEGINS:"dungeo.endgame.begins"},of="dungeo.endgame.cryptWaitTurns",H4="game.endgameStarted",eye="game.savingDisabled",tye="scoring.endgameScore",rye="scoring.endgameMaxScore",nye=15;function iye(t,e){let n=t.getAllEntities().find(o=>o.get(Ta.IdentityTrait)?.name==="crypt door");if(!n)return!1;let i=n.get(Ta.OpenableTrait);return i?!i.isOpen:!1}function oye(t,e){let r=t.getPlayer();if(!r)return!0;let n=t.getEntity(e);if(!n)return!0;if(!n.get(Ta.RoomTrait)?.isDark)return!1;let o=t.getContents(r.id);for(let s of o)if(s.get(Ta.LightSourceTrait)?.isLit)return!1;let a=t.getContents(e);for(let s of a)if(s.get(Ta.LightSourceTrait)?.isLit)return!1;return!0}function aye(t){return t.getAllEntities().find(n=>{let i=n.get(Ta.IdentityTrait);return i?.aliases?.includes("elvish sword")||i?.name==="elvish sword"})?.id}function sye(t,e){let r=[],n=t.getPlayer();if(!n)return r;t.setStateValue(H4,!0),t.setStateValue(eye,!0),t.setStateValue(tye,15),t.setStateValue(rye,100),t.setStateValue(of,0);let i=aye(t);return i&&t.getLocation(i)!==n.id&&t.moveEntity(i,n.id),r.push({id:`endgame-cloaked-figure-${Date.now()}`,type:"game.message",timestamp:Date.now(),entities:{},data:{messageId:Ea.CLOAKED_FIGURE}}),t.moveEntity(n.id,e),r.push({id:`endgame-teleport-${Date.now()}`,type:"player.teleported",timestamp:Date.now(),entities:{actor:n.id,location:e},data:{messageId:Ea.TELEPORT,destination:e}}),r.push({id:`endgame-begins-${Date.now()}`,type:"game.message",timestamp:Date.now(),entities:{},data:{messageId:Ea.ENDGAME_BEGINS,score:15,maxScore:100}}),r}function U4(t,e,r,n){e.setStateValue(of,0);let i={id:"dungeo-endgame-trigger",name:"Endgame Crypt Trigger",priority:50,condition:o=>o.world.getStateValue(H4)?!1:o.playerLocation===r,run:o=>{let{world:a}=o,s=[];if(!iye(a,r)||!oye(a,r))return a.setStateValue(of,0),s;let l=(a.getStateValue(of)||0)+1;return a.setStateValue(of,l),l===5?s.push({id:`endgame-darkness-1-${Date.now()}`,type:"game.message",timestamp:Date.now(),entities:{},data:{messageId:Ea.DARKNESS_DESCENDS,turn:l}}):l===10&&s.push({id:`endgame-darkness-2-${Date.now()}`,type:"game.message",timestamp:Date.now(),entities:{},data:{messageId:Ea.DARKNESS_DESCENDS,turn:l}}),l>=nye?sye(a,n):s}};t.registerDaemon(i)}var vx=S(b()),Oo={BEAM_BROKEN:"dungeo.endgame.beam_broken",BEAM_ACTIVE:"dungeo.endgame.beam_active",BUTTON_LASER_ACTIVE:"dungeo.endgame.button_laser_active",BUTTON_PRESSED:"dungeo.endgame.button_pressed",BUTTON_ALREADY_PRESSED:"dungeo.endgame.button_already_pressed",LOOK_BEAM_ACTIVE:"dungeo.endgame.look_beam_active",LOOK_BEAM_BROKEN:"dungeo.endgame.look_beam_broken"},F4="endgame.laserBeamActive",G4="endgame.stoneButtonPressed",CS="endgame.beamJustBroken",NS="endgame.buttonJustPressed",DS="endgame.buttonBlocked";function q4(t){return t.getStateValue(F4)===!0}function cye(t){return t.getStateValue(G4)===!0}function lye(t){return t.getAllEntities().find(n=>{let i=n.get(vx.IdentityTrait);return i?.aliases?.includes("elvish sword")||i?.name==="elvish sword"})?.id}function V4(t,e,r,n,i){if(e.registerEventHandler("if.event.dropped",o=>{if(!e.getPlayer())return;let s=o.data;if((s?.location||s?.locationId)!==r||!q4(e))return;let l=s?.itemId||o.entities?.target,u=lye(e);l===u&&(e.setStateValue(F4,!1),e.setStateValue(CS,!0))}),e.registerEventHandler("if.event.pushed",o=>{let a=e.getPlayer();if(!a||e.getLocation(a.id)!==n)return;let c=o.entities?.target;if(!c)return;let l=e.getEntity(c);if(!(!l||!l.get(vx.IdentityTrait)?.name?.includes("stone button"))){if(q4(e)){e.setStateValue(DS,!0);return}cye(e)||(e.setStateValue(G4,!0),e.setStateValue(NS,!0))}}),i){let o={id:"dungeo-laser-feedback",name:"Laser Puzzle Feedback",priority:30,condition:a=>{let{world:s}=a;return s.getStateValue(CS)===!0||s.getStateValue(NS)===!0||s.getStateValue(DS)===!0},run:a=>{let{world:s}=a,c=[];return s.getStateValue(CS)&&(c.push({id:`laser-broken-${Date.now()}`,type:"game.message",timestamp:Date.now(),entities:{},data:{messageId:Oo.BEAM_BROKEN}}),s.setStateValue(CS,!1)),s.getStateValue(NS)&&(c.push({id:`button-pressed-${Date.now()}`,type:"game.message",timestamp:Date.now(),entities:{},data:{messageId:Oo.BUTTON_PRESSED}}),s.setStateValue(NS,!1)),s.getStateValue(DS)&&(c.push({id:`button-blocked-${Date.now()}`,type:"game.message",timestamp:Date.now(),entities:{},data:{messageId:Oo.BUTTON_LASER_ACTIVE}}),s.setStateValue(DS,!1)),c}};i.registerDaemon(o)}}var Vs={ENTER_TREASURY:"dungeo.victory.enter_treasury",VICTORY_TEXT:"dungeo.victory.text",FINAL_SCORE:"dungeo.victory.final_score",CONGRATULATIONS:"dungeo.victory.congratulations"},uye="game.victory",dye="game.ended",Y4="scoring.endgameScore",mye=0;function Xg(){return`victory-evt-${Date.now()}-${++mye}`}function fye(t,e){let r=t.getPlayer();return r?t.getLocation(r.id)===e:!1}function pye(t){let e=!1;return{id:"dungeo-victory",name:"Victory Check",priority:100,condition:r=>e||!r.world.getStateValue("game.endgameStarted")?!1:fye(r.world,t),run:r=>{let{world:n}=r;e=!0;let o=(n.getStateValue(Y4)??65)+35;n.setStateValue(Y4,o),n.setStateValue(uye,!0),n.setStateValue(dye,!0);let a=n.getStateValue("scoring.score")??616,s=a+o;return[{id:Xg(),type:"game.message",entities:{},data:{messageId:Vs.ENTER_TREASURY},timestamp:Date.now(),narrate:!0},{id:Xg(),type:"game.message",entities:{},data:{messageId:Vs.VICTORY_TEXT},timestamp:Date.now(),narrate:!0},{id:Xg(),type:"game.message",entities:{},data:{messageId:Vs.FINAL_SCORE,params:{endgameScore:o,mainScore:a,totalScore:s}},timestamp:Date.now(),narrate:!0},{id:Xg(),type:"game.message",entities:{},data:{messageId:Vs.CONGRATULATIONS},timestamp:Date.now(),narrate:!0},{id:Xg(),type:"game.victory",entities:{},data:{totalScore:s,endgameScore:o,mainScore:a},timestamp:Date.now(),narrate:!1}]}}}function z4(t,e){let r=pye(e);t.registerDaemon(r)}var $4=S(b()),gye="dungeo.rainbow.active";function hye(t){let e=t.getPlayer();if(!e)return!1;let r=t.getLocation(e.id);if(!r)return!1;let n=t.getEntity(r);return n?(n.get($4.IdentityTrait)?.name||"")==="Aragain Falls":!1}function yye(t){return t.getStateValue(gye)||!1}function vye(t){let e=t.action?.toLowerCase();if(e!=="go"&&e!=="going"&&e!=="if.action.going")return!1;let r;return t.extras?.direction?r=String(t.extras.direction).toLowerCase():t.structure?.directObject?.head&&(r=t.structure.directObject.head.toLowerCase()),r==="west"||r==="w"}function K4(){return(t,e)=>!hye(e)||!vye(t)||yye(e)?t:{...t,action:"dungeo.rainbow.blocked",extras:{...t.extras,originalAction:t.action,isRainbowBlocked:!0}}}var li=S(b()),Q4="dungeo.glacier.melted",af={GLACIER_MELTS:"dungeo.glacier.melts",TORCH_CONSUMED:"dungeo.glacier.torch_consumed",PASSAGE_REVEALED:"dungeo.glacier.passage_revealed",THROW_COLD:"dungeo.glacier.throw_cold",THROW_WRONG_ITEM:"dungeo.glacier.throw_wrong_item"};function Eye(t){return t.getStateValue(Q4)||!1}function X4(t,e,r){t.registerEventHandler("if.event.thrown",(n,i)=>{if(Eye(i))return;let o=n.data;if(!o||o.throwType!=="at_target")return;let a=o.target;if(!a)return;let s=i.getEntity(a);if(!s||(s.get(li.IdentityTrait)?.name||"")!=="glacier")return;let u=o.item;if(!u)return;let m=i.getEntity(u);if(!m||!(m.get(li.IdentityTrait)?.name||"").toLowerCase().includes("torch"))return;let h=m.get(li.LightSourceTrait);if(!h||!h.isLit){i.setStateValue("dungeo.glacier.throw_cold_pending",!0);return}Tye(i,e,r,u)})}function Tye(t,e,r,n){if(t.setStateValue(Q4,!0),t.getEntity(e)){let c=t.getContents(e).find(l=>l.get(li.IdentityTrait)?.name==="glacier");if(c){c.isMelted=!0;let l=c.get(li.IdentityTrait);l&&(l.description="A pool of water remains where the massive glacier once stood. The north passage is now clear.")}}let o=t.getEntity(e);if(o){let s=o.get(li.RoomTrait);s&&(s.exits[li.Direction.NORTH]={destination:r})}let a=t.getEntity(r);if(a){let s=a.get(li.RoomTrait);s&&(s.exits[li.Direction.SOUTH]={destination:e})}t.removeEntity(n),t.setStateValue("dungeo.glacier.just_melted",!0)}var nt=S(b());var Ex="dungeo.dam.state";function Tx(t){t.registerCapability(Ex,{initialData:{isDrained:!1,buttonPressed:!1}})}function Z4(t,e){let r=t.getCapability(Ex);r&&(r.buttonPressed=e)}function _x(t){t.registerEventHandler("dungeo.button.yellow.pressed",(e,r)=>{Z4(r,!0)})}var bx,Oye,PS,LS,MS;function Iye(t){let e=t.getEntity(bx);e&&(e.damOpen=!0),Aye(t),eQ(t,!0)}function Sye(t){let e=t.getEntity(bx);e&&(e.damOpen=!1),J4(t),eQ(t,!1)}function Aye(t){let e=t.getEntity(PS),r=t.getEntity(LS),n=t.getEntity(MS);e&&nt.RoomBehavior.unblockExit(e,nt.Direction.NORTH),r&&(nt.RoomBehavior.unblockExit(r,nt.Direction.NORTH),nt.RoomBehavior.unblockExit(r,nt.Direction.SOUTH)),n&&nt.RoomBehavior.unblockExit(n,nt.Direction.SOUTH)}function J4(t){let e=t.getEntity(PS),r=t.getEntity(LS),n=t.getEntity(MS);e&&nt.RoomBehavior.blockExit(e,nt.Direction.NORTH,"The reservoir is full of water. You cannot walk that way."),r&&(nt.RoomBehavior.blockExit(r,nt.Direction.NORTH,"The reservoir is full of water. You cannot continue north."),nt.RoomBehavior.blockExit(r,nt.Direction.SOUTH,"The reservoir is full of water. You cannot continue south.")),n&&nt.RoomBehavior.blockExit(n,nt.Direction.SOUTH,"The reservoir is full of water. You cannot walk that way.")}function eQ(t,e){let r=t.getEntity(PS),n=t.getEntity(LS),i=t.getEntity(MS);if(e){if(r){let o=r.get(nt.IdentityTrait);o&&(o.description="You are on the southern edge of what was once a reservoir. The water has drained away, leaving a muddy expanse stretching north. A path leads south.")}if(n){let o=n.get(nt.IdentityTrait);o&&(o.description="You are on the muddy bottom of a drained reservoir. The exposed lake bed stretches in all directions. Various objects that were once submerged are now visible.")}if(i){let o=i.get(nt.IdentityTrait);o&&(o.description="You are at the north end of a drained reservoir. The muddy bottom extends to the south, and a dark passage leads north.")}}else{if(r){let o=r.get(nt.IdentityTrait);o&&(o.description="You are on the southern shore of a large reservoir. The water extends north as far as you can see. A path leads south.")}if(n){let o=n.get(nt.IdentityTrait);o&&(o.description="You are on what used to be a large reservoir, now drained. The muddy bottom is exposed, and you can see various objects that were once submerged.")}if(i){let o=i.get(nt.IdentityTrait);o&&(o.description="You are at the north end of a large reservoir. A passage leads north into darkness, and the reservoir extends to the south.")}}}function tQ(t,e){bx=e.dam,Oye=e.maintenanceRoom,PS=e.reservoirSouth,LS=e.reservoir,MS=e.reservoirNorth,J4(t),t.registerEventHandler("dungeo.dam.opened",(r,n)=>{Iye(n)}),t.registerEventHandler("dungeo.dam.closed",(r,n)=>{Sye(n)})}var Nl=S(b());function Rye(t){let e=t.getPlayer();if(!e)return!1;let r=t.getLocation(e.id);if(!r)return!1;let n=t.getEntity(r);return!n||!n.has(Nl.TraitType.VEHICLE)?!1:n.get(Nl.VehicleTrait)?.vehicleType==="watercraft"}function wye(t,e){let r=t.getPlayer();if(!r)return null;let n=t.getContainingRoom(r.id);if(!n)return null;let i=n.get(Nl.RoomTrait);if(!i)return null;let o=e.toUpperCase();return i.exits[o]?.destination||null}function Cye(t){return t.extras?.direction?String(t.extras.direction).toLowerCase():t.structure?.directObject?.head?t.structure.directObject.head.toLowerCase():null}function Nye(t){let e=t.getPlayer();if(!e)return!1;let r=t.getContainingRoom(e.id);return r?r.isRainbowRoom===!0:!1}function rQ(){return(t,e)=>{let r=t.action?.toLowerCase();if(r!=="go"&&r!=="going"&&r!=="if.action.going")return t;let n=Cye(t);if(!n)return t;let i=wye(e,n);if(!i)return t;let o=e.getEntity(i);return!o||!o.isWaterRoom||Rye(e)||Nye(e)?t:{...t,action:Gg,extras:{...t.extras,originalAction:t.action,isRiverBlocked:!0}}}}function nQ(t,e){t.getEventProcessor().registerHandler("if.event.actor_moved",n=>{let i=n.data;if(!i)return[];let o=i.actorId;if(!o)return[];let a=e.getPlayer();if(!a||o!==a.id)return[];let s=i.previousLocation;if(!s)return[];let c=e.getEntity(s);if(!c||!c.has(Nl.TraitType.VEHICLE))return[];let l=c.get(Nl.VehicleTrait);if(!l||l.vehicleType!=="watercraft")return[];let u=i.currentLocation;return u&&(e.moveEntity(c.id,u),e.moveEntity(a.id,c.id)),[]})}var iQ={NO_BOAT:"dungeo.river.no_boat",NEED_INFLATED_BOAT:"dungeo.river.need_inflated_boat"};var oQ=S(b()),Ox=null,Dye="dungeo.action.falls_death",aQ={DEATH:"dungeo.falls.death"};function Pye(t){let e=t.getPlayer();if(!e)return null;let r=t.getLocation(e.id);return r?t.getEntity(r)?.has(oQ.TraitType.VEHICLE)?t.getLocation(r)||null:r:null}function Lye(t){let e=t.action?.toLowerCase()||"";if(["look","looking","if.action.looking","examine","examining","if.action.examining","l"].includes(e)||e.includes("wave")||e==="dungeo.action.wave"||e.startsWith("dungeo.action.gdt")||e==="dungeo.rainbow.blocked")return!0;if(e==="if.action.going"||e==="going"){let n=t.extras?.direction?.toUpperCase()||"";return!(n==="SOUTH"||n==="S")}return!1}function sQ(){return(t,e)=>!Ox||Pye(e)!==Ox||Lye(t)?t:{...t,action:Dye,extras:{...t.extras,originalAction:t.action,isFallsDeath:!0}}}function cQ(t){Ox=t}var _a=S(b()),Ix={PUNCTURED:"dungeo.boat.punctured",STICK_POKES:"dungeo.boat.stick_pokes"};function Mye(t){return!!t.puncturesBoat||!!t.isPointy}function kye(t){if(!t.isInflated)return!1;let e=t.get(_a.IdentityTrait);if(!e)return!1;let r=e.name?.toLowerCase()||"",n=e.aliases||[],i=["boat","raft"];return i.some(o=>r.includes(o))||n.some(o=>i.some(a=>o.toLowerCase().includes(a)))}function xye(t,e,r){let n=t.getLocation(e.id);n&&t.moveEntity(r,n),e.isInflated=!1;let i=e.get(_a.IdentityTrait);i&&(i.name="pile of plastic",i.article="a",i.description="There is a folded pile of plastic here which has a small valve attached. It appears to have been punctured."),e.attributes.displayName="pile of plastic",e.has(_a.TraitType.ENTERABLE)&&e.remove(_a.TraitType.ENTERABLE),e.has(_a.TraitType.VEHICLE)&&e.remove(_a.TraitType.VEHICLE)}function lQ(t){t.registerEventHandler("if.event.entered",(e,r)=>{let n=e.data;if(!n)return;let i=n.targetId;if(!i)return;let o=r.getEntity(i);if(!o||!kye(o))return;let s=r.getContents(i).filter(c=>c.has(_a.TraitType.ACTOR));for(let c of s){let u=r.getContents(c.id).find(m=>Mye(m));if(u){xye(r,o,c.id),r.setStateValue("dungeo.boat.just_punctured",!0),r.setStateValue("dungeo.boat.puncture_item",u.get(_a.IdentityTrait)?.name||"sharp object");return}}})}var dQ=S(b()),uQ=10,Bye=2,sf={PENALTY:"dungeo.death.penalty",GAME_OVER:"dungeo.death.game_over",DEATH_COUNT:"dungeo.death.count"};function mQ(t,e){return(r,n)=>{let i=[],o=t.getCapability(dQ.StandardCapabilities.SCORING),s=(o?.deaths??0)+1;return o&&(o.deaths=s),e.addPoints(-uQ,"Death penalty"),i.push({type:"score",points:-uQ,reason:"Death penalty"}),s>=Bye&&(i.push({type:"set_state",key:"dungeo.game_over",value:!0}),i.push({type:"set_state",key:"dungeo.game_over_reason",value:"too_many_deaths"}),i.push({type:"message",id:sf.GAME_OVER,data:{reason:"too_many_deaths",deaths:s}}),i.push({type:"emit",event:{id:`death-game-over-${Date.now()}`,type:"game.over",timestamp:Date.now(),entities:{},data:{messageId:sf.GAME_OVER,reason:"too_many_deaths",deaths:s}}})),i}}var Ys=S(b()),Sx={SLAMS_SHUT:"dungeo.trapdoor.slams_shut"},fQ="dungeo.trapdoor.prevLocation",pQ="dungeo.trapdoor.barred",jye=0;function Wye(){return`trapdoor-${Date.now()}-${++jye}`}function Hye(t){for(let e of t.getAllEntities())if(e.get(Ys.IdentityTrait)?.name==="trap door")return e.id;return null}function gQ(t,e,r){let n={id:"dungeo-trapdoor-autoclose",name:"Trapdoor Auto-Close",priority:80,condition:o=>{let a=o.world.getStateValue(fQ);return o.world.getStateValue(pQ)?!1:a===e&&o.playerLocation===r},run:o=>{let{world:a}=o,s=[],c=Hye(a);if(c){let u=a.getEntity(c);if(u){let m=u.get(Ys.OpenableTrait);m&&(m.isOpen=!1);let f=u.get(Ys.IdentityTrait);f&&(f.description="The dusty cover of a closed trap door.")}}let l=a.getEntity(r);if(l){let u=l.get(Ys.RoomTrait);u&&u.exits&&delete u.exits[Ys.Direction.UP]}return a.setStateValue(pQ,!0),s.push({id:Wye(),type:"game.message",timestamp:Date.now(),entities:{},data:{messageId:Sx.SLAMS_SHUT},narrate:!0}),s}},i={id:"dungeo-trapdoor-tracking",name:"Trapdoor Location Tracking",priority:-100,condition:o=>!0,run:o=>(o.world.setStateValue(fQ,o.playerLocation),[])};t.registerDaemon(n),t.registerDaemon(i)}var Ax=S(b());function Uye(t){let e=t.getPlayer();if(!e)return!1;let r=t.getLocation(e.id);if(!r)return!1;let n=t.getEntity(r);return n?(n.get(Ax.IdentityTrait)?.name||"")==="Studio":!1}function qye(t){let e=t.action?.toLowerCase();if(e!=="go"&&e!=="going"&&e!=="if.action.going")return!1;let r;return t.extras?.direction?r=String(t.extras.direction).toLowerCase():t.structure?.directObject?.head&&(r=t.structure.directObject.head.toLowerCase()),r==="up"||r==="u"}function Fye(t){let e=t.getAllEntities();for(let r of e){let n=r.get(Ax.IdentityTrait);if(n){let i=n.name.toLowerCase(),o=n.aliases.map(a=>a.toLowerCase());if(i==="brass lantern"||i==="lantern"||i==="lamp"||o.includes("lamp")||o.includes("lantern")||o.includes("brass lantern"))return r.id}}return null}function hQ(t){let e=t.getPlayer();return e?t.getContents(e.id).map(n=>n.id):[]}function Gye(t){let e=Fye(t);return e?hQ(t).includes(e):!1}function yQ(){return(t,e)=>{if(!Uye(e)||!qye(t))return t;let n=hQ(e).length;return n===0?{...t,action:Sl,extras:{...t.extras,originalAction:t.action,chimneyBlockReason:"empty"}}:n>2?{...t,action:Sl,extras:{...t.extras,originalAction:t.action,chimneyBlockReason:"baggage"}}:Gye(e)?t:{...t,action:Sl,extras:{...t.extras,originalAction:t.action,chimneyBlockReason:"baggage"}}}}var id=S(b());function Vye(t){return ul(t).immortal}function Yye(t){let e=t.getPlayer();return e?t.getContainingRoom(e.id):null}function zye(t){return t.extras?.direction?String(t.extras.direction).toLowerCase():t.structure?.directObject?.head?t.structure.directObject.head.toLowerCase():null}function $ye(t,e){let r=t.getPlayer();if(!r)return{destination:null,exitType:"invalid",isBlocked:!1};let n=t.getContainingRoom(r.id);if(!n)return{destination:null,exitType:"invalid",isBlocked:!1};let i=n.get(id.RoomTrait);if(!i)return{destination:null,exitType:"invalid",isBlocked:!1};let o=e.toUpperCase(),a=i.exits[o];if(!a||!a.destination)return{destination:null,exitType:"invalid",isBlocked:!1};if(a.via){let s=t.getEntity(a.via);if(s){let c=s.getTrait(id.TraitType.OPENABLE);if(c&&!c.isOpen)return{destination:a.destination,exitType:"door",isBlocked:!0,viaEntityId:a.via}}}return{destination:a.destination,exitType:"normal",isBlocked:!1,viaEntityId:a.via}}function Kye(){return Math.random()<.25}function Qye(t){let e=t.action?.toLowerCase()||"";return e==="go"||e==="going"||e==="if.action.going"}function vQ(){return(t,e)=>{if(Vye(e)||!Qye(t))return t;let r=Yye(e);if(!r||!id.VisibilityBehavior.isDark(r,e)||Kye())return t;let n=zye(t);if(!n)return t;let i=$ye(e,n);if(i.exitType==="invalid"||!i.destination)return{...t,action:Il,extras:{...t.extras,originalAction:t.action,grueDeathType:"walked_into",reason:"invalid_exit"}};if(i.isBlocked)return{...t,action:Il,extras:{...t.extras,originalAction:t.action,grueDeathType:"slithered",reason:"blocked_exit"}};let o=e.getEntity(i.destination);return o?id.VisibilityBehavior.isDark(o,e)?{...t,action:Il,extras:{...t.extras,originalAction:t.action,grueDeathType:"walked_into",reason:"dark_destination"}}:t:{...t,action:Il,extras:{...t.extras,originalAction:t.action,grueDeathType:"walked_into",reason:"no_destination"}}}}var Wt=S(b()),Rx={MIRROR_RUBBED:"dungeo.mirror_room.rubbed",ROOM_SHAKES:"dungeo.mirror_room.shakes"},wx="dungeo.mirror_room.state";function Xye(t){return t.getStateValue(wx)==="B"?"B":"A"}function Zye(t,e){let r=t==="A"?"B":"A",n=[];n.push({type:"set_state",key:wx,value:r});let i=r==="A"?e.stateA:e.stateB;return n.push({type:"update_exits",roomId:e.mirrorRoomId,exits:{[Wt.Direction.NORTH]:{destination:i.north},[Wt.Direction.WEST]:{destination:i.west},[Wt.Direction.EAST]:{destination:i.east}}}),r==="A"?(n.push({type:"update_exits",roomId:e.stateA.north,exits:{[Wt.Direction.SOUTHWEST]:{destination:e.mirrorRoomId}}}),n.push({type:"update_exits",roomId:e.stateA.west,exits:{[Wt.Direction.EAST]:{destination:e.mirrorRoomId}}}),n.push({type:"update_exits",roomId:e.stateA.east,exits:{[Wt.Direction.WEST]:{destination:e.mirrorRoomId}}}),n.push({type:"update_exits",roomId:e.stateB.north,exits:{[Wt.Direction.SOUTH]:null}}),n.push({type:"update_exits",roomId:e.stateB.west,exits:{[Wt.Direction.EAST]:null}}),n.push({type:"update_exits",roomId:e.stateB.east,exits:{[Wt.Direction.NORTH]:null}})):(n.push({type:"update_exits",roomId:e.stateB.north,exits:{[Wt.Direction.SOUTH]:{destination:e.mirrorRoomId}}}),n.push({type:"update_exits",roomId:e.stateB.west,exits:{[Wt.Direction.EAST]:{destination:e.mirrorRoomId}}}),n.push({type:"update_exits",roomId:e.stateB.east,exits:{[Wt.Direction.NORTH]:{destination:e.mirrorRoomId}}}),n.push({type:"update_exits",roomId:e.stateA.north,exits:{[Wt.Direction.SOUTHWEST]:null}}),n.push({type:"update_exits",roomId:e.stateA.west,exits:{[Wt.Direction.EAST]:null}}),n.push({type:"update_exits",roomId:e.stateA.east,exits:{[Wt.Direction.WEST]:null}})),n.push({type:"message",id:Rx.ROOM_SHAKES,data:{newState:r}}),n}function EQ(t){return(e,r)=>{let n=e.data;if(!n?.target)return[];if(n.target!==t.mirrorId)return[];let i=Xye(r);return Zye(i,t)}}function TQ(t,e){t.setStateValue(wx,"A");let r=e.stateA;t.updateEntity(e.mirrorRoomId,n=>{let i=n.get("room");i&&(i.exits||(i.exits={}),i.exits[Wt.Direction.NORTH]={destination:r.north},i.exits[Wt.Direction.WEST]={destination:r.west},i.exits[Wt.Direction.EAST]={destination:r.east})})}var ae=S(b()),Jye=0;function eve(){return`evt-${Date.now()}-${++Jye}`}function kS(t,e,r,n=[]){let i=t.createEntity(e,ae.EntityType.ROOM);return i.add(new ae.RoomTrait({exits:{},isDark:!1,isOutdoors:!0})),i.add(new ae.IdentityTrait({name:e,aliases:n,description:r,properName:!0,article:""})),i}function xS(t,e){let r=t.get(ae.RoomTrait);if(r)for(let[n,i]of Object.entries(e))r.exits[n]={destination:i}}function _Q(t){let e=kS(t,"West of House","This is an open field west of a white house with a boarded front door.",["west of house","field","open field"]),r=kS(t,"North of House","You are facing the north side of a white house. There is no door here, and all the windows are barred.",["north of house","north side"]),n=kS(t,"South of House","You are facing the south side of a white house. There is no door here, and all the windows are barred.",["south of house","south side"]),i=kS(t,"Behind House","You are behind the white house. In one corner of the house there is a small window which is slightly ajar.",["behind house","back of house","east of house"]),o={westOfHouse:e.id,northOfHouse:r.id,southOfHouse:n.id,behindHouse:i.id};return tve(t,o),o}function tve(t,e){let r=t.getEntity(e.westOfHouse);r&&xS(r,{[ae.Direction.NORTH]:e.northOfHouse,[ae.Direction.SOUTH]:e.southOfHouse});let n=t.getEntity(e.northOfHouse);n&&xS(n,{[ae.Direction.WEST]:e.westOfHouse,[ae.Direction.EAST]:e.behindHouse});let i=t.getEntity(e.southOfHouse);i&&xS(i,{[ae.Direction.WEST]:e.westOfHouse,[ae.Direction.EAST]:e.behindHouse});let o=t.getEntity(e.behindHouse);o&&xS(o,{[ae.Direction.NORTH]:e.northOfHouse,[ae.Direction.SOUTH]:e.southOfHouse})}function bQ(t,e,r){let n=rve(t),i=nve(t);t.moveEntity(n.id,e.westOfHouse);let o=n.get(ae.OpenableTrait);o&&(o.isOpen=!0,t.moveEntity(i.id,n.id),o.isOpen=!1);let a=ive(t);t.moveEntity(a.id,e.westOfHouse);let s=ave(t);t.moveEntity(s.id,e.westOfHouse);let c=ove(t);if(t.moveEntity(c.id,e.behindHouse),r){let l=t.getEntity(e.behindHouse),u=t.getEntity(r);l&&u&&(ae.RoomBehavior.setExit(l,ae.Direction.WEST,r,c.id),ae.RoomBehavior.setExit(l,ae.Direction.IN,r,c.id),ae.RoomBehavior.setExit(u,ae.Direction.EAST,e.behindHouse,c.id))}sve(t,e)}function rve(t){let e=t.createEntity("small mailbox",ae.EntityType.CONTAINER);return e.add(new ae.IdentityTrait({name:"small mailbox",aliases:["mailbox","box","mail box"],description:"It's a small mailbox.",properName:!1,article:"a"})),e.add(new ae.ContainerTrait({capacity:{maxItems:5}})),e.add(new ae.OpenableTrait({isOpen:!1})),e.add(new ae.SceneryTrait),e}function nve(t){let e=t.createEntity("leaflet",ae.EntityType.ITEM);return e.add(new ae.IdentityTrait({name:"leaflet",aliases:["paper","pamphlet","advertisement","ad"],description:"A small leaflet with some writing on it.",properName:!1,article:"a",weight:2})),e.add(new ae.ReadableTrait({text:`                         WELCOME TO DUNGEON

      DUNGEON is a game of adventure, danger, and low cunning.  In it you
  will explore some of the most amazing territory ever seen by mortal
  man.  Hardened adventurers have run screaming from the terrors
  contained within!

      In DUNGEON the intrepid explorer delves into the forgotten secrets
  of a lost labyrinth deep in the bowels of the earth, searching for
  vast treasures long hidden from prying eyes, treasures guarded by
  fearsome monsters and diabolical traps!

      No system should be without one!

      DUNGEON was created at the MIT Laboratory for Computer Science, by
  Tim Anderson, Marc Blank, Bruce Daniels, and Dave Lebling.  It was
  inspired by the ADVENTURE game of Crowther and Woods, and the long
  tradition of fantasy and science fiction adventure.  DUNGEON is written
  in Sharpee. This version was translated from the paranoid
  FORTRAN implementation by a DEC engineer to Sharpee by a less paranoid
  developer, David Cornelson.

      In-game information may be available using the HELP and INFO
  commands.`,isReadable:!0})),e}function ive(t){let e=t.createEntity("front door",ae.EntityType.SCENERY);return e.add(new ae.IdentityTrait({name:"front door",aliases:["door","boarded door","entrance"],description:"The door is boarded and you can't remove the boards.",properName:!1,article:"the"})),e.add(new ae.SceneryTrait),e}function ove(t){let e=t.createEntity("window",ae.EntityType.SCENERY);return e.add(new ae.IdentityTrait({name:"window",aliases:["small window","kitchen window"],description:"The window is slightly ajar, but not enough to allow entry.",properName:!1,article:"the"})),e.add(new ae.SceneryTrait),e.add(new ae.OpenableTrait({isOpen:!1})),e.on={"if.event.opened":r=>{let n=e.get(ae.IdentityTrait);return n&&(n.description="The window is open."),[{id:eve(),type:"game.message",entities:{actor:r.entities.actor,target:e.id},data:{messageId:"dungeo.window.opened"},timestamp:Date.now(),narrate:!0}]},"if.event.closed":r=>{let n=e.get(ae.IdentityTrait);return n&&(n.description="The window is slightly ajar, but not enough to allow entry."),[]}},e}function ave(t){let e=t.createEntity("welcome mat",ae.EntityType.ITEM);return e.add(new ae.IdentityTrait({name:"welcome mat",aliases:["mat","rubber mat"],description:'A rubber mat saying "Welcome to Dungeon!"',properName:!1,article:"a",weight:5})),e}function sve(t,e){let r=[e.westOfHouse,e.northOfHouse,e.southOfHouse,e.behindHouse];for(let n of r){let i=t.createEntity("white house",ae.EntityType.SCENERY);i.add(new ae.IdentityTrait({name:"white house",aliases:["house","building"],description:"The house is a beautiful colonial house which is painted white. It is clear that the owners must have been extremely wealthy.",properName:!1,article:"the"})),i.add(new ae.SceneryTrait),t.moveEntity(i.id,n)}}var j=S(b()),cve=0;function OQ(){return`evt-${Date.now()}-${++cve}`}function Cx(t,e,r,n=!1){let i=t.createEntity(e,j.EntityType.ROOM);return i.add(new j.RoomTrait({exits:{},isDark:n,isOutdoors:!1})),i.add(new j.IdentityTrait({name:e,description:r,properName:!0,article:"the"})),i}function Nx(t,e){let r=t.get(j.RoomTrait);if(r)for(let[n,i]of Object.entries(e))r.exits[n]={destination:i}}function IQ(t){let e=Cx(t,"Kitchen","This is the kitchen of the white house. A table seems to have been used recently for the preparation of food. A passage leads to the west, and a dark staircase can be seen leading upward. To the east is a small window which is open."),r=Cx(t,"Living Room","This is the living room. There is a door to the east. To the west is a wooden door with strange gothic lettering, which appears to be nailed shut."),n=Cx(t,"Attic","This is the attic. The only exit is stairs that lead down.",!0);return Nx(e,{[j.Direction.WEST]:r.id,[j.Direction.UP]:n.id}),Nx(r,{[j.Direction.EAST]:e.id}),Nx(n,{[j.Direction.DOWN]:e.id}),{kitchen:e.id,livingRoom:r.id,attic:n.id}}function SQ(t,e,r){lve(t,e.kitchen),uve(t,e.livingRoom,r),dve(t,e.attic)}function lve(t,e){let r=t.createEntity("kitchen table",j.EntityType.SCENERY);r.add(new j.IdentityTrait({name:"kitchen table",aliases:["table","wooden table"],description:"A sturdy wooden table used for food preparation.",properName:!1,article:"a"})),r.add(new j.SceneryTrait),t.moveEntity(r.id,e);let n=t.createEntity("brown sack",j.EntityType.CONTAINER);n.add(new j.IdentityTrait({name:"elongated brown sack",aliases:["sack","brown sack","bag","brown bag"],description:"A brown sack smelling of hot peppers.",properName:!1,article:"an",weight:5})),n.add(new j.ContainerTrait({capacity:{maxItems:10}})),n.add(new j.OpenableTrait({isOpen:!0})),t.moveEntity(n.id,e);let i=t.createEntity("lunch",j.EntityType.ITEM);i.add(new j.IdentityTrait({name:"lunch",aliases:["food","meal","provisions"],description:"A hearty lunch.",properName:!1,article:"a",weight:5})),t.moveEntity(i.id,n.id);let o=t.createEntity("garlic",j.EntityType.ITEM);o.add(new j.IdentityTrait({name:"clove of garlic",aliases:["garlic","clove"],description:"A clove of garlic. Its strong smell might ward off something...",properName:!1,article:"a",weight:3})),t.moveEntity(o.id,n.id);let a=t.createEntity("glass bottle",j.EntityType.CONTAINER);a.add(new j.IdentityTrait({name:"glass bottle",aliases:["bottle","clear bottle","water bottle"],description:"A clear glass bottle containing water.",properName:!1,article:"a",weight:5})),a.add(new j.ContainerTrait({capacity:{maxItems:1}})),a.add(new j.OpenableTrait({isOpen:!1})),t.moveEntity(a.id,e);let s=t.createEntity("water",j.EntityType.ITEM);s.add(new j.IdentityTrait({name:"quantity of water",aliases:["water"],description:"Clear, fresh water.",properName:!1,article:"a"}));let c=a.get(j.OpenableTrait);c&&(c.isOpen=!0,t.moveEntity(s.id,a.id),c.isOpen=!1)}function uve(t,e,r){let n=t.createEntity("trophy case",j.EntityType.CONTAINER);n.add(new j.IdentityTrait({name:"trophy case",aliases:["case","glass case","display case"],description:"A handsome trophy case with a glass front.",properName:!1,article:"a"})),n.add(new j.ContainerTrait({capacity:{maxItems:20}})),n.add(new j.OpenableTrait({isOpen:!1})),n.add(new j.SceneryTrait),t.moveEntity(n.id,e);let i=t.createEntity("elvish sword",j.EntityType.ITEM);i.add(new j.IdentityTrait({name:"elvish sword",aliases:["sword","elvish blade","blade","antique sword"],description:"An elvish sword of great antiquity. Its blade glows faintly blue.",properName:!1,article:"an",weight:10})),i.add(new j.WeaponTrait({damage:3,skillBonus:10,weaponType:"blade"})),t.moveEntity(i.id,e);let o=t.createEntity("brass lantern",j.EntityType.ITEM);o.add(new j.IdentityTrait({name:"brass lantern",aliases:["lantern","lamp","light","brass lamp"],description:"A battery-powered brass lantern.",properName:!1,article:"a",weight:5})),o.add(new j.LightSourceTrait({isLit:!1,brightness:3,fuelRemaining:330,maxFuel:330,fuelConsumptionRate:1})),o.add(new j.SwitchableTrait({isOn:!1})),t.moveEntity(o.id,e);let a=t.createEntity("trap door",j.EntityType.SCENERY);a.add(new j.IdentityTrait({name:"trap door",aliases:["trapdoor","door"],adjectives:["trap"],description:"The dusty cover of a closed trap door.",properName:!1,article:"a"})),a.add(new j.OpenableTrait({isOpen:!1})),a.add(new j.SceneryTrait),a.on={"if.event.opened":l=>{let u=a.get(j.IdentityTrait);return u&&(u.description="The trap door is open, revealing a rickety staircase descending into darkness."),[{id:OQ(),type:"game.message",entities:{actor:l.entities.actor,target:a.id},data:{messageId:"dungeo.trapdoor.opened"},timestamp:Date.now(),narrate:!0}]},"if.event.closed":l=>{let u=a.get(j.IdentityTrait);return u&&(u.description="The dusty cover of a closed trap door."),[]}};let s=t.createEntity("oriental rug",j.EntityType.SCENERY);s.add(new j.IdentityTrait({name:"large oriental rug",aliases:["rug","oriental rug","carpet","large rug"],description:"A large oriental rug in the center of the room.",properName:!1,article:"a"})),s.add(new j.SceneryTrait),s.add(new j.PushableTrait({pushType:"moveable",repeatable:!1,state:"default"})),s.on={"if.event.pushed":l=>{let u=s.get(j.PushableTrait);if(u&&u.state==="pushed")return[];if(t.moveEntity(a.id,e),r){let m=t.getEntity(e);m&&j.RoomBehavior.setExit(m,j.Direction.DOWN,r,a.id);let f=t.getEntity(r);f&&j.RoomBehavior.setExit(f,j.Direction.UP,e,a.id)}return u&&(u.state="pushed"),[{id:OQ(),type:"game.message",entities:{actor:l.entities.actor,target:a.id,location:e},data:{messageId:"dungeo.rug.moved.reveal_trapdoor"},timestamp:Date.now(),narrate:!0}]}},t.moveEntity(s.id,e);let c=t.createEntity("wooden door",j.EntityType.SCENERY);c.add(new j.IdentityTrait({name:"wooden door",aliases:["door","west door","gothic door"],description:"A wooden door with strange gothic lettering. It appears to be nailed shut.",properName:!1,article:"a"})),c.add(new j.SceneryTrait),t.moveEntity(c.id,e)}function dve(t,e){let r=t.createEntity("attic table",j.EntityType.SCENERY);r.add(new j.IdentityTrait({name:"table",aliases:["table","small table"],description:"A small table in the corner of the attic.",properName:!1,article:"a"})),r.add(new j.SceneryTrait),t.moveEntity(r.id,e);let n=t.createEntity("rope",j.EntityType.ITEM);n.add(new j.IdentityTrait({name:"large coil of rope",aliases:["rope","coil","coil of rope"],description:"A large coil of sturdy rope.",brief:"A large coil of rope is lying in the corner.",properName:!1,article:"a",weight:5})),t.moveEntity(n.id,e);let i=t.createEntity("nasty knife",j.EntityType.ITEM);i.add(new j.IdentityTrait({name:"nasty knife",aliases:["knife","nasty-looking knife","blade"],description:"A nasty-looking knife. It appears quite sharp.",brief:"On a table is a nasty-looking knife.",properName:!1,article:"a",weight:4})),i.add(new j.WeaponTrait({damage:2,skillBonus:5,weaponType:"blade"})),t.moveEntity(i.id,e);let o=t.createEntity("brick",j.EntityType.ITEM);o.add(new j.IdentityTrait({name:"brick",aliases:["red brick","clay brick","explosive"],description:"A square brick of calciumite with some fuse wire wrapped around it.",brief:"There is a square brick here which feels like clay.",properName:!1,article:"a",weight:5})),o.isExplosive=!0,o.hasFuse=!0,t.moveEntity(o.id,e);let a=t.createEntity("shiny wire",j.EntityType.ITEM);a.add(new j.IdentityTrait({name:"shiny wire",aliases:["wire","thin wire","metal wire","fuse wire"],description:"A thin piece of shiny wire, suitable as a fuse or for various mechanical uses.",properName:!1,article:"a",weight:5})),t.moveEntity(a.id,e)}var Y=S(b());var Zg=class Zg{constructor(e){d(this,"type",Zg.type);d(this,"position");d(this,"topRoomId");d(this,"bottomRoomId");this.topRoomId=e.topRoomId,this.bottomRoomId=e.bottomRoomId,this.position=e.initialPosition??"top"}getCurrentRoomId(){return this.position==="top"?this.topRoomId:this.bottomRoomId}getDestinationRoomId(){return this.position==="top"?this.bottomRoomId:this.topRoomId}};d(Zg,"type","dungeo.trait.basket_elevator"),d(Zg,"capabilities",["if.action.lowering","if.action.raising"]);var Zr=Zg;var Io=S(b());var So={LOWERED:"if.lower.lowered",ALREADY_DOWN:"if.lower.already_down",RAISED:"if.raise.raised",ALREADY_UP:"if.raise.already_up",PLAYER_TRANSPORTED:"dungeo.basket.player_transported"};function AQ(t,e,r){let n=e.getPlayer();return n&&e.getLocation(n.id)===t.id?(e.moveEntity(n.id,r),!0):!1}var Dx={validate(t,e,r,n){let i=t.get(Zr);return i?i.position==="bottom"?{valid:!1,error:So.ALREADY_DOWN}:{valid:!0}:{valid:!1,error:"if.lower.cant_lower_that"}},execute(t,e,r,n){let i=t.get(Zr);if(!i)return;i.position="bottom";let o=AQ(t,e,i.bottomRoomId);n.playerTransported=o},report(t,e,r,n){let i=[],o=n.playerTransported;return i.push((0,Io.createEffect)("if.event.lowered",{messageId:So.LOWERED,targetId:t.id,targetName:t.name})),i.push((0,Io.createEffect)("action.success",{actionId:"if.action.lowering",messageId:So.LOWERED,params:{target:t.name}})),o&&(i.push((0,Io.createEffect)("dungeo.basket.transported",{messageId:So.PLAYER_TRANSPORTED,direction:"down"})),i.push((0,Io.createEffect)("if.event.auto_look",{reason:"transported"}))),i},blocked(t,e,r,n,i){return[(0,Io.createEffect)("action.blocked",{actionId:"if.action.lowering",messageId:n,params:{target:t.name}})]}},Px={validate(t,e,r,n){let i=t.get(Zr);return i?i.position==="top"?{valid:!1,error:So.ALREADY_UP}:{valid:!0}:{valid:!1,error:"if.raise.cant_raise_that"}},execute(t,e,r,n){let i=t.get(Zr);if(!i)return;i.position="top";let o=AQ(t,e,i.topRoomId);n.playerTransported=o},report(t,e,r,n){let i=[],o=n.playerTransported;return i.push((0,Io.createEffect)("if.event.raised",{messageId:So.RAISED,targetId:t.id,targetName:t.name})),i.push((0,Io.createEffect)("action.success",{actionId:"if.action.raising",messageId:So.RAISED,params:{target:t.name}})),o&&(i.push((0,Io.createEffect)("dungeo.basket.transported",{messageId:So.PLAYER_TRANSPORTED,direction:"up"})),i.push((0,Io.createEffect)("if.event.auto_look",{reason:"transported"}))),i},blocked(t,e,r,n,i){return[(0,Io.createEffect)("action.blocked",{actionId:"if.action.raising",messageId:n,params:{target:t.name}})]}};var Jg=class Jg{constructor(e){d(this,"type",Jg.type);d(this,"guardianId");this.guardianId=e.guardianId}};d(Jg,"type","dungeo.trait.troll_axe"),d(Jg,"capabilities",["if.action.taking","if.scope.visible"]);var ui=Jg;var od=S(b());var cf={WHITE_HOT:"dungeo.troll.axe.white_hot",TAKEN:"taken"},Lx={validate(t,e,r,n){let i=t.get(ui);if(!i)return{valid:!0};let o=e.getEntity(i.guardianId);if(o){let a=o.get(od.TraitType.COMBATANT);if(a&&a.isAlive)return{valid:!1,error:cf.WHITE_HOT}}return n.entityName=t.name,{valid:!0}},execute(t,e,r,n){e.moveEntity(t.id,r)},report(t,e,r,n){let i=[];return i.push((0,od.createEffect)("if.event.taken",{messageId:cf.TAKEN,targetId:t.id,targetName:t.name})),i.push((0,od.createEffect)("action.success",{actionId:"if.action.taking",messageId:cf.TAKEN,params:{target:t.name}})),i},blocked(t,e,r,n,i){return[(0,od.createEffect)("action.blocked",{actionId:"if.action.taking",messageId:n,params:{target:t.name}})]}},Mx={validate(t,e,r,n){let i=t.get(ui);if(!i)return{valid:!0};let o=e.getEntity(i.guardianId);if(o){let a=o.get(od.TraitType.COMBATANT);if(a&&a.isAlive&&!a.isConscious)return{valid:!1}}return{valid:!0}},execute(){},report(){return[]},blocked(){return[]}};var eh=class eh{constructor(e){d(this,"type",eh.type);d(this,"roomId");d(this,"axeId");this.roomId=e.roomId,this.axeId=e.axeId}};d(eh,"type","dungeo.trait.troll"),d(eh,"capabilities",["if.action.taking","if.action.attacking","if.action.talking"]);var Ir=eh;var nr=S(b()),lf=S(so());var Qe={RECOVERS_AXE:"dungeo.troll.recovers_axe",COWERS:"dungeo.troll.cowers",CATCHES_ITEM:"dungeo.troll.catches_item",EATS_ITEM:"dungeo.troll.eats_item",THROWS_KNIFE_BACK:"dungeo.troll.throws_knife_back",SPITS_AT_PLAYER:"dungeo.troll.spits_at_player",MOCKS_UNARMED_ATTACK:"dungeo.troll.mocks_unarmed_attack",CANT_HEAR_YOU:"dungeo.troll.cant_hear_you",KNOCKED_OUT:"dungeo.troll.knocked_out",KILL_UNCONSCIOUS:"dungeo.troll.kill_unconscious",SMOKE_DISAPPEAR:"dungeo.troll.smoke_disappear",DEATH_PASSAGE_CLEAR:"dungeo.troll.death.passage_clear"};function mve(){return{next:()=>Math.random(),int:(t,e)=>Math.floor(Math.random()*(e-t+1))+t,chance:t=>Math.random()<t,pick:t=>t[Math.floor(Math.random()*t.length)],shuffle:t=>{let e=[...t];for(let r=e.length-1;r>0;r--){let n=Math.floor(Math.random()*(r+1));[e[r],e[n]]=[e[n],e[r]]}return e},getSeed:()=>0,setSeed:()=>{}}}var BS={SPITS_AT_PLAYER:"dungeo.troll.spits_at_player",MOCKS_UNARMED_ATTACK:"dungeo.troll.mocks_unarmed_attack",CANT_HEAR_YOU:"dungeo.troll.cant_hear_you"};function fve(t){let e=t.get?.(nr.CombatantTrait);return e?!e.isAlive||!e.isConscious:!1}var kx={validate(t,e,r,n){return t.get(Ir)?{valid:!1,error:BS.SPITS_AT_PLAYER}:{valid:!0}},execute(){},report(){return[]},blocked(t,e,r,n,i){let o=t.get(nr.IdentityTrait);return[(0,nr.createEffect)("action.blocked",{actionId:"if.action.taking",messageId:n,params:{target:o?.name||"troll"}})]}},xx={validate(t,e,r,n){if(!t.get(Ir))return{valid:!0};let o=t.get(nr.IdentityTrait);n.trollName=o?.name||"troll";let a=t.get(nr.CombatantTrait);if(a&&!a.isAlive)return{valid:!1,error:"already_dead",params:{target:n.trollName}};let s=e.getEntity(r);if(!s)return{valid:!1,error:"no_actor"};let c=(0,lf.findWieldedWeapon)(s,e);return n.hasWeapon=!!c,n.weapon=c,c?{valid:!0}:{valid:!1,error:BS.MOCKS_UNARMED_ATTACK}},execute(t,e,r,n){if(!n.hasWeapon||!n.weapon)return;let i=e.getEntity(r);if(!i)return;let a=new lf.CombatService().resolveAttack({attacker:i,target:t,weapon:n.weapon,world:e,random:mve()}),s=(0,lf.applyCombatResult)(t,a,e);n.combatResult=a,n.droppedItems=s.droppedItems},report(t,e,r,n){let i=[],o=n.combatResult;if(!o)return i;let a=e.getEntity(r),s=n.weapon,c=n.trollName||"troll";i.push((0,nr.createEffect)("if.event.attacked",{target:t.id,targetName:c,weapon:s?.id,weaponName:s?.name,unarmed:!1,hit:o.hit,damage:o.damage}));let l=o.targetKnockedOut?Qe.KNOCKED_OUT:o.messageId,u={target:c,weapon:s?.name,damage:o.damage,attackerName:a?.name||"player",targetName:c};if(o.messageData&&Object.assign(u,o.messageData),i.push((0,nr.createEffect)("action.success",{actionId:"if.action.attacking",messageId:l,params:u})),n.droppedItems?.length)for(let m of n.droppedItems){let f=e.getEntity(m);f&&i.push((0,nr.createEffect)("if.event.dropped",{item:m,itemName:f.name,dropper:t.id,dropperName:c}))}return o.targetKilled&&i.push((0,nr.createEffect)("if.event.death",{target:t.id,targetName:c,killedBy:r})),o.targetKnockedOut&&i.push((0,nr.createEffect)("if.event.knocked_out",{target:t.id,targetName:c,knockedOutBy:r})),i},blocked(t,e,r,n,i){return[(0,nr.createEffect)("action.blocked",{actionId:"if.action.attacking",messageId:n,params:{target:i.trollName||"troll"}})]}},Bx={validate(t,e,r,n){return t.get(Ir)?fve(t)?{valid:!1,error:BS.CANT_HEAR_YOU}:{valid:!0}:{valid:!0}},execute(){},report(){return[]},blocked(t,e,r,n,i){let o=t.get(nr.IdentityTrait);return[(0,nr.createEffect)("action.blocked",{actionId:"if.action.talking",messageId:n,params:{target:o?.name||"troll"}})]}};var th=class th{constructor(e={}){d(this,"type",th.type);d(this,"hasBeenOpened");this.hasBeenOpened=e.hasBeenOpened??!1}};d(th,"type","dungeo.trait.egg"),d(th,"capabilities",["if.action.opening"]);var Ao=th;var ad=S(b());var uf={NO_EXPERTISE:"dungeo.egg.no_expertise",OPENED:"opened"},jx={validate(t,e,r,n){if(!t.get(Ao))return{valid:!0};let o=e.getEntity(r);if(o){let a=o.get(ad.TraitType.ACTOR);if(a&&a.isPlayer)return{valid:!1,error:uf.NO_EXPERTISE}}return n.entityName=t.name,{valid:!0}},execute(t,e,r,n){let i=t.get(ad.TraitType.OPENABLE);i&&(i.isOpen=!0);let o=t.get(Ao);o&&(o.hasBeenOpened=!0)},report(t,e,r,n){let i=[];return i.push((0,ad.createEffect)("if.event.opened",{messageId:uf.OPENED,targetId:t.id,targetName:t.name})),i.push((0,ad.createEffect)("action.success",{actionId:"if.action.opening",messageId:uf.OPENED,params:{item:t.name}})),i},blocked(t,e,r,n,i){return[(0,ad.createEffect)("action.blocked",{actionId:"if.action.opening",messageId:n,params:{target:t.name}})]}};function jS(t,e,r){let n=t.createEntity(e,Y.EntityType.ROOM);return n.add(new Y.RoomTrait({exits:{},isDark:!1,isOutdoors:!0})),n.add(new Y.IdentityTrait({name:e,description:r,properName:!0,article:""})),n}function zs(t,e){let r=t.get(Y.RoomTrait);if(r)for(let[n,i]of Object.entries(e))r.exits[n]={destination:i}}function RQ(t){let e=t.createEntity("Forest-Path-1",Y.EntityType.ROOM);e.add(new Y.RoomTrait({exits:{},isDark:!1,isOutdoors:!0})),e.add(new Y.IdentityTrait({name:"Forest Path",aliases:["forest path","path","forest path 1"],description:"This is a path winding through a dimly lit forest. The path heads north-south here. One particularly large tree with some low branches stands at the side of the path.",properName:!0,article:""}));let r=t.createEntity("Forest-2",Y.EntityType.ROOM);r.add(new Y.RoomTrait({exits:{},isDark:!1,isOutdoors:!0})),r.add(new Y.IdentityTrait({name:"Forest",aliases:["forest","woods","trees"],description:"This is a dimly lit forest, with large trees all around.",properName:!0,article:"the"}));let n=t.createEntity("Forest Path-3",Y.EntityType.ROOM);n.add(new Y.RoomTrait({exits:{},isDark:!1,isOutdoors:!0})),n.add(new Y.IdentityTrait({name:"Forest Path",aliases:["forest path","path"],description:"The forest thins out, and the path becomes clearer.",properName:!0,article:""}));let i=t.createEntity("Twisting Path",Y.EntityType.ROOM);i.add(new Y.RoomTrait({exits:{},isDark:!1,isOutdoors:!0})),i.add(new Y.IdentityTrait({name:"Twisting Path",aliases:["twisting path","path","forest path"],description:"You are on a twisting path through a dense forest. The path splits here.",properName:!0,article:""}));let o=t.createEntity("Clearing",Y.EntityType.ROOM);o.add(new Y.RoomTrait({exits:{},isDark:!1,isOutdoors:!0})),o.add(new Y.IdentityTrait({name:"Clearing",aliases:["clearing","forest clearing"],description:"You are in a clearing, with a forest surrounding you on all sides. A path leads south. On the ground is a pile of leaves.",properName:!0,article:"the"}));let a=jS(t,"Up a Tree","You are about ten feet above the ground nestled among some large branches. The nearest branch above you is beyond your reach. On one of the branches is a small bird's nest."),s=jS(t,"Canyon View","You are at the top of the Great Canyon, on its west wall. From here there is a marvelous view of the canyon and parts of the Frigid River upstream. Across the canyon, the walls of the White Cliffs join the mighty ramparts of the Flathead Mountains to the east. Following the Canyon, you can see a small path at the bottom of the canyon. There is a path here which goes west into the forest."),c=jS(t,"Rocky Ledge","You are on a ledge about halfway up the wall of the river canyon. You can see from here that the path continues from the bottom of the canyon up to the cliff above. There is a small path going down."),l=jS(t,"Canyon Bottom","You are beneath the walls of the river canyon which may be climbed here. The canyon runs north-south along the river. You can see the massive walls of the White Cliffs rising to the east.");return zs(e,{[Y.Direction.NORTH]:o.id,[Y.Direction.UP]:a.id}),zs(r,{[Y.Direction.WEST]:o.id,[Y.Direction.EAST]:n.id}),zs(n,{[Y.Direction.WEST]:r.id,[Y.Direction.SOUTH]:i.id,[Y.Direction.EAST]:s.id}),zs(i,{[Y.Direction.NORTH]:n.id}),zs(o,{[Y.Direction.SOUTH]:e.id,[Y.Direction.EAST]:r.id}),zs(a,{[Y.Direction.DOWN]:e.id}),zs(s,{[Y.Direction.WEST]:n.id,[Y.Direction.DOWN]:c.id}),zs(c,{[Y.Direction.UP]:s.id,[Y.Direction.DOWN]:l.id}),zs(l,{[Y.Direction.UP]:c.id}),{forestPath1:e.id,forestPath2:r.id,forestPath3:n.id,forestPath4:i.id,clearing:o.id,upATree:a.id,canyonView:s.id,rockyLedge:c.id,canyonBottom:l.id}}function wQ(t,e,r,n){let i=t.getEntity(e.forestPath1);i&&(i.get(Y.RoomTrait).exits[Y.Direction.SOUTH]={destination:r});let o=t.getEntity(r);o&&(o.get(Y.RoomTrait).exits[Y.Direction.NORTH]={destination:e.forestPath1});let a=t.getEntity(n);a&&(a.get(Y.RoomTrait).exits[Y.Direction.EAST]={destination:e.clearing})}function CQ(t,e){pve(t,e.forestPath1),gve(t,e.clearing),hve(t,e.upATree)}function pve(t,e){let r=t.createEntity("large tree",Y.EntityType.SCENERY);r.add(new Y.IdentityTrait({name:"large tree",aliases:["tree","big tree","tall tree"],description:"A particularly large tree with some low branches. It looks climbable.",properName:!1,article:"a"})),r.add(new Y.SceneryTrait),t.moveEntity(r.id,e)}function gve(t,e){let r=t.createEntity("pile of leaves",Y.EntityType.SCENERY);r.add(new Y.IdentityTrait({name:"pile of leaves",aliases:["leaves","pile","leaf pile"],description:"A large pile of dead leaves. They rustle in the wind.",properName:!1,article:"a"})),r.add(new Y.SceneryTrait),t.moveEntity(r.id,e);let n=t.createEntity("grating",Y.EntityType.SCENERY);n.add(new Y.IdentityTrait({name:"grating",aliases:["grate","iron grating","metal grating"],description:"A grating firmly fixed into the ground. It appears to lead underground.",properName:!1,article:"a"})),n.add(new Y.OpenableTrait({isOpen:!1})),n.add(new Y.SceneryTrait),t.moveEntity(n.id,e)}function hve(t,e){let r=t.createEntity("nest",Y.EntityType.CONTAINER);r.add(new Y.IdentityTrait({name:"small bird's nest",aliases:["nest","bird nest","birds nest"],description:"A small bird's nest tucked among the branches.",properName:!1,article:"a"})),r.add(new Y.ContainerTrait({capacity:{maxItems:3}})),r.add(new Y.SceneryTrait),t.moveEntity(r.id,e);let n=t.createEntity("jewel-encrusted egg",Y.EntityType.CONTAINER);n.add(new Y.IdentityTrait({name:"jewel-encrusted egg",aliases:["egg","jeweled egg","beautiful egg","faberge egg"],description:"A beautiful jewel-encrusted egg. It appears to open somehow.",properName:!1,article:"a",weight:2})),n.add(new Y.ContainerTrait({capacity:{maxItems:1}})),n.add(new Y.OpenableTrait({isOpen:!1})),n.add(new Ao),n.isTreasure=!0,n.treasureId="jewel-encrusted-egg",n.treasureValue=5,n.trophyCaseValue=5,t.moveEntity(n.id,r.id);let i=t.createEntity("golden canary",Y.EntityType.ITEM);i.add(new Y.IdentityTrait({name:"golden clockwork canary",aliases:["canary","bird","clockwork canary","golden bird"],description:"A beautiful golden clockwork canary. It sings when wound.",properName:!1,article:"a",weight:10})),i.isTreasure=!0,i.treasureId="clockwork-canary",i.treasureValue=6,i.trophyCaseValue=2;let o=n.get(Y.OpenableTrait);o&&(o.isOpen=!0,t.moveEntity(i.id,n.id),o.isOpen=!1)}var P=S(b());var WS=S(so()),rh=S(b());function yve(t){return t.npcInventory.some(r=>r.has&&r.has(rh.TraitType.WEAPON))}function vve(t){let e=t.getEntitiesInRoom();for(let r of e){if(!r.get)continue;let n=r.get(rh.IdentityTrait);if(!n)continue;let i=n.name?.toLowerCase()||"",o=n.aliases||[];if([i,...o.map(s=>s.toLowerCase())].some(s=>s.includes("axe"))&&t.world.getLocation(r.id)===t.npcLocation)return r.id}return null}var Wx={id:"troll",name:"Troll Behavior",onTurn(t){let e=t.npc.get(rh.TraitType.COMBATANT);if(e&&(!e.isAlive||!e.isConscious))return[];if(!yve(t)){let n=vve(t);return n&&t.random.chance(.75)?[{type:"take",target:n},{type:"emote",messageId:Qe.RECOVERS_AXE,data:{npcName:t.npc.name}}]:[{type:"emote",messageId:Qe.COWERS,data:{npcName:t.npc.name}}]}return WS.guardBehavior.onTurn(t)},onPlayerEnters(t){return WS.guardBehavior.onPlayerEnters?.(t)||[]},onAttacked(t,e){return WS.guardBehavior.onAttacked?.(t,e)||[]},getState(t){return{}},setState(t,e){}};function NQ(t){t.registerBehavior(Wx)}function Pn(t,e,r,n=!0){let i=t.createEntity(e,P.EntityType.ROOM);return i.add(new P.RoomTrait({exits:{},isDark:n,isOutdoors:!1})),i.add(new P.IdentityTrait({name:e,description:r,properName:!0,article:"the"})),i}function di(t,e){let r=t.get(P.RoomTrait);if(r)for(let[n,i]of Object.entries(e))r.exits[n]={destination:i}}function DQ(t){let e=Pn(t,"Cellar","This is a dark and damp cellar with a narrow passageway leading east, and a crawlway to the south. To the west is the bottom of a steep metal ramp which is unclimbable."),r=Pn(t,"West of Chasm","You are on the west edge of a chasm, the walls of which are too steep to climb. A passage leads north."),n=Pn(t,"Gallery","This is an art gallery. Most of the paintings have been stolen by vandals with exceptional taste. The vandals left through either the north or west exits."),i=Pn(t,"North/South Crawlway","This is a north-south crawlway; a passage also goes to the east. There is a hole above, but it provides no opportunities for climbing."),o=Pn(t,"Troll Room","This is a small room with passages off in all directions. Bloodstains and deep scratches (perhaps made by an axe) mar the walls."),a=Pn(t,"East/West Passage","This is a narrow east-west passageway. There is a narrow stairway leading down at the north end of the room."),s=Pn(t,"Deep Ravine","You are in a deep ravine at a point where a crack opens to the east. A passage leads south, and a steep trail leads down."),c=Pn(t,"Rocky Crawl","This is a crawlway with a low ceiling. A passage goes to the east, and a narrow opening leads west."),l=Pn(t,"Dome Room","This is the periphery of a large dome, which forms the ceiling of another room below. Protecting you from a precipitous drop is a wooden railing which circles the dome.");l.ropeAttached=!1,l.hasRailing=!0;let u=Pn(t,"Tiny Room","This is a tiny room with passages leading east and west."),m=Pn(t,"Dreary Room","This is a dreary room with passages leading north and east."),f=Pn(t,"Chasm","A chasm runs southwest to northeast. You are on the east edge."),g=Pn(t,"Studio","This is what appears to have been an artist's studio. The walls and floors are splattered with paints of 69 different colors. Strangely enough, nothing of value is hanging here. At the north and northwest of the room are open doors (also covered with paint). An extremely dark and narrow chimney leads up from a fireplace; although you might be able to get up it, it seems unlikely you could get back down."),h=Pn(t,"Torch Room","This is a large room with a prominent doorway leading to a down staircase. To the west is a narrow twisting tunnel, covered with a thin layer of dust. Above you is a large dome painted with scenes depicting elfin hacking rites. Up around the edge of the dome (20 feet up) is a wooden railing. In the center of the room there is a white marble pedestal.");return l.torchRoomId=h.id,di(e,{[P.Direction.EAST]:o.id}),di(o,{[P.Direction.WEST]:e.id,[P.Direction.NORTH]:a.id,[P.Direction.EAST]:i.id}),P.RoomBehavior.blockExit(o,P.Direction.NORTH,"The troll blocks your way."),di(a,{[P.Direction.SOUTH]:o.id,[P.Direction.NORTH]:s.id,[P.Direction.DOWN]:s.id}),di(i,{[P.Direction.EAST]:o.id,[P.Direction.SOUTH]:g.id,[P.Direction.UP]:h.id}),di(g,{[P.Direction.NORTHWEST]:n.id,[P.Direction.NORTH]:i.id}),di(n,{[P.Direction.SOUTH]:g.id}),di(s,{[P.Direction.SOUTH]:a.id,[P.Direction.WEST]:c.id,[P.Direction.EAST]:f.id}),di(f,{[P.Direction.WEST]:s.id}),di(c,{[P.Direction.EAST]:s.id,[P.Direction.WEST]:l.id}),di(l,{[P.Direction.EAST]:c.id}),di(h,{[P.Direction.UP]:l.id,[P.Direction.DOWN]:i.id,[P.Direction.WEST]:u.id}),di(u,{[P.Direction.EAST]:h.id,[P.Direction.NORTH]:m.id}),di(m,{[P.Direction.SOUTH]:u.id}),{cellar:e.id,westOfChasm:r.id,gallery:n.id,northSouthCrawlway:i.id,trollRoom:o.id,eastWestPassage:a.id,deepRavine:s.id,rockyCrawl:c.id,domeRoom:l.id,tinyRoom:u.id,drearyRoom:m.id,chasm:f.id,studio:g.id,torchRoom:h.id}}function PQ(t,e,r){let n=t.getEntity(e.studio);if(n){let i=n.get(P.RoomTrait);i&&(i.exits[P.Direction.UP]={destination:r})}}var Eve=0;function df(){return`evt-${Date.now()}-${++Eve}`}function LQ(t,e){Tve(t,e.cellar),Ive(t,e.trollRoom),Sve(t,e.gallery),Ave(t,e.studio),Rve(t,e.domeRoom),wve(t,e.torchRoom),Cve(t,e.tinyRoom,e.drearyRoom),Nve(t,e.drearyRoom)}function Tve(t,e){let r=t.createEntity("metal ramp",P.EntityType.SCENERY);r.add(new P.IdentityTrait({name:"steep metal ramp",aliases:["ramp","metal ramp","steep ramp"],description:"A steep metal ramp leading up. It's too slippery to climb.",properName:!1,article:"a"})),r.add(new P.SceneryTrait),t.moveEntity(r.id,e)}var _ve="A nasty-looking troll stands here, wielding a bloody axe. He blocks the northern passage.",bve="An unconscious troll is sprawled on the floor. All passages out of the room are open.",Ove=2;function Ive(t,e){let r=t.createEntity("bloody axe",P.EntityType.ITEM);r.add(new P.IdentityTrait({name:"bloody axe",aliases:["axe","troll axe","bloody weapon"],description:"A large, bloody axe. It looks like it has seen plenty of use.",properName:!1,article:"a",weight:25})),r.add(new P.WeaponTrait({damage:5,weaponType:"blade",attackMessage:"The troll swings the bloody axe viciously!"}));let n=t.createEntity("troll",P.EntityType.ACTOR);n.add(new P.IdentityTrait({name:"nasty-looking troll",aliases:["troll","nasty troll","ugly troll"],description:_ve,properName:!1,article:"a"})),n.add(new P.ActorTrait({isPlayer:!1})),n.add(new P.NpcTrait({behaviorId:"troll",isHostile:!0,canMove:!1})),n.add(new P.CombatantTrait({health:10,maxHealth:10,skill:40,baseDamage:5,armor:0,hostile:!0,canRetaliate:!0,dropsInventory:!0,deathMessage:"The troll lets out a final grunt and collapses!"})),n.add(new Ir({roomId:e,axeId:r.id})),t.moveEntity(n.id,e),r.add(new ui({guardianId:n.id})),t.moveEntity(r.id,n.id);let i=t.getEntity(e);function o(a){if(!a)return!1;let s=a.get?.(P.IdentityTrait);if(!s)return!1;let c=s.name?.toLowerCase()||"",l=(s.aliases||[]).map(u=>u.toLowerCase());return[c,...l].some(u=>u.includes("knife")||u.includes("stiletto"))}n.on={"if.event.knocked_out":(a,s)=>{let c=[],l=n.get(P.IdentityTrait);l&&(l.description=bve),i&&P.RoomBehavior.unblockExit(i,P.Direction.NORTH);let u=n.get(P.CombatantTrait);return u&&(u.recoveryTurns=Ove),c},"if.event.death":(a,s)=>{let c=[];i&&P.RoomBehavior.unblockExit(i,P.Direction.NORTH);let l=s.getCapability(P.StandardCapabilities.SCORING);return l&&(l.scoreValue=(l.scoreValue||0)+10,l.achievements||(l.achievements=[]),l.achievements.push("Defeated the troll")),c.push({id:df(),type:"game.message",entities:{},data:{messageId:Qe.SMOKE_DISAPPEAR},timestamp:Date.now(),narrate:!0}),t.removeEntity(r.id),t.removeEntity(n.id),c},"if.event.given":(a,s)=>{let c=[],l=a.data;if(l.recipient!==n.id)return c;let u=s.getEntity(l.item);return u&&(o(u)?(t.moveEntity(u.id,e),c.push({id:df(),type:"game.message",entities:{target:n.id,instrument:u.id},data:{messageId:Qe.THROWS_KNIFE_BACK,itemName:u.name},timestamp:Date.now(),narrate:!0})):(t.removeEntity(u.id),c.push({id:df(),type:"game.message",entities:{target:n.id,instrument:u.id},data:{messageId:Qe.EATS_ITEM,itemName:u.name},timestamp:Date.now(),narrate:!0}))),c},"if.event.thrown":(a,s)=>{let c=[],l=a.data;if(l.target!==n.id||l.throwType!=="at_target")return c;let u=s.getEntity(l.item);return u&&(c.push({id:df(),type:"game.message",entities:{target:n.id,instrument:u.id},data:{messageId:Qe.CATCHES_ITEM,itemName:u.name},timestamp:Date.now(),narrate:!0}),o(u)?(t.moveEntity(u.id,e),c.push({id:df(),type:"game.message",entities:{target:n.id,instrument:u.id},data:{messageId:Qe.THROWS_KNIFE_BACK,itemName:u.name},timestamp:Date.now(),narrate:!0})):(t.removeEntity(u.id),c.push({id:df(),type:"game.message",entities:{target:n.id,instrument:u.id},data:{messageId:Qe.EATS_ITEM,itemName:u.name},timestamp:Date.now(),narrate:!0}))),c}}}function Sve(t,e){let r=t.createEntity("painting",P.EntityType.ITEM);r.add(new P.IdentityTrait({name:"painting",aliases:["painting","picture","art","artwork","canvas"],description:"A painting of remarkable beauty, depicting a woodland scene. It is the only painting remaining in the gallery.",properName:!1,article:"a",weight:20})),r.isTreasure=!0,r.treasureId="painting",r.treasureValue=4,r.trophyCaseValue=7,t.moveEntity(r.id,e)}function Ave(t,e){let r=t.createEntity("chimney",P.EntityType.SCENERY);r.add(new P.IdentityTrait({name:"chimney",aliases:["chimney","dark chimney","fireplace chimney","narrow chimney","fireplace"],description:"The chimney is very dark and narrow. You might be able to climb up it, but it seems unlikely you could get back down.",properName:!1,article:"a"})),r.add(new P.SceneryTrait),t.moveEntity(r.id,e);let n=t.createEntity("paint",P.EntityType.SCENERY);n.add(new P.IdentityTrait({name:"paint",aliases:["paint","paints","splatter","splatters","paint splatters","colors"],description:"The walls and floors are splattered with paints of 69 different colors. It looks like the work of a very messy artist.",properName:!1,article:"some"})),n.add(new P.SceneryTrait),t.moveEntity(n.id,e)}function Rve(t,e){let r=t.createEntity("railing",P.EntityType.SCENERY);r.add(new P.IdentityTrait({name:"railing",aliases:["rail","iron railing","sturdy railing"],description:"A sturdy iron railing surrounds a deep shaft in the center of the room. Looking down, you can see only darkness.",properName:!1,article:"a"})),r.add(new P.SceneryTrait),t.moveEntity(r.id,e)}function wve(t,e){let r=t.createEntity("ivory torch",P.EntityType.ITEM);r.add(new P.IdentityTrait({name:"ivory torch",aliases:["torch","ivory","white torch"],description:"A beautiful torch made of polished ivory. It is not currently lit.",properName:!1,article:"an",weight:5})),r.add(new P.LightSourceTrait({isLit:!1,brightness:3,fuelRemaining:1e3,maxFuel:1e3,fuelConsumptionRate:0})),r.add(new P.SwitchableTrait({isOn:!1})),r.isTreasure=!0,r.treasureId="ivory-torch",r.treasureValue=14,r.trophyCaseValue=6,t.moveEntity(r.id,e)}function Cve(t,e,r){let n=t.createEntity("small door",P.EntityType.DOOR);n.add(new P.IdentityTrait({name:"small door",aliases:["door","north door","wooden door","tiny door"],description:"A small wooden door leads north. There is a keyhole at eye level.",properName:!1,article:"a"})),n.add(new P.OpenableTrait({isOpen:!1})),n.add(new P.SceneryTrait),n.add(new P.LockableTrait({isLocked:!0})),n.keyInLock=!0,n.matUnderDoor=!1,n.keyOnMat=!1,n.connectsRooms=[e,r],n.blocksDirection={[e]:"NORTH",[r]:"SOUTH"},n.isTinyRoomDoor=!0,t.moveEntity(n.id,e);let i=t.createEntity("small key",P.EntityType.ITEM);i.add(new P.IdentityTrait({name:"small key",aliases:["key","brass key","tiny key"],description:"A small brass key.",properName:!1,article:"a",weight:25})),i.isHidden=!0,i.isTinyRoomKey=!0,t.moveEntity(i.id,e)}function Nve(t,e){let r=t.createEntity("blue crystal sphere",P.EntityType.ITEM);r.add(new P.IdentityTrait({name:"blue crystal sphere",aliases:["sphere","crystal sphere","blue sphere","crystal","blue crystal","ball"],description:"A beautiful sphere of blue crystal. It seems to glow with an inner light.",properName:!1,article:"a",weight:5})),r.isTreasure=!0,r.treasureId="blue-crystal-sphere",r.treasureValue=10,r.trophyCaseValue=5,t.moveEntity(r.id,e)}var x=S(b());function Ro(t,e,r,n=!0){let i=t.createEntity(e,x.EntityType.ROOM);return i.add(new x.RoomTrait({exits:{},isDark:n,isOutdoors:!1})),i.add(new x.IdentityTrait({name:e,description:r,properName:!0,article:"the"})),i}function wo(t,e){let r=t.get(x.RoomTrait);if(r)for(let[n,i]of Object.entries(e))r.exits[n]={destination:i}}function MQ(t){let e=Ro(t,"Deep Canyon","You are in a deep canyon with sheer walls rising on all sides. A narrow path leads north."),r=Ro(t,"Dam Lobby","This is a large, echoing hall. A passage leads south, and doors lead north and east."),n=Ro(t,"Flood Control Dam #3","You are standing on the top of the Flood Control Dam #3, which was quite a tourist attraction in times far distant. From here, a wide passage leads north and south."),i=Ro(t,"Dam Base","You are at the base of the dam. A stairway leads up."),o=Ro(t,"Maintenance Room","This is a small maintenance room. Various tools line the walls."),a=Ro(t,"Reservoir South","You are at the south end of a huge reservoir. The water is murky and cold."),s=Ro(t,"Reservoir","You are in the middle of a large reservoir. The water level is quite low."),c=Ro(t,"Reservoir North","You are at the north end of a large reservoir."),l=Ro(t,"Stream View","You are standing at a point where a stream emerges from underground."),u=Ro(t,"Small Cave","This is a small cave above the Atlantis Room. A stairway leads down."),m=Ro(t,"Atlantis Room","This is a large room with a vaulted ceiling. Ancient murals depicting undersea life cover the walls.");return wo(e,{[x.Direction.NORTHWEST]:a.id,[x.Direction.EAST]:n.id}),wo(r,{[x.Direction.SOUTH]:n.id,[x.Direction.NORTH]:o.id,[x.Direction.EAST]:o.id}),wo(n,{[x.Direction.SOUTH]:e.id,[x.Direction.NORTH]:r.id,[x.Direction.DOWN]:i.id}),wo(i,{[x.Direction.UP]:n.id}),wo(o,{[x.Direction.SOUTH]:r.id,[x.Direction.WEST]:r.id}),wo(a,{[x.Direction.UP]:e.id,[x.Direction.NORTH]:s.id,[x.Direction.WEST]:l.id}),wo(s,{[x.Direction.SOUTH]:a.id,[x.Direction.NORTH]:c.id}),wo(c,{[x.Direction.SOUTH]:s.id,[x.Direction.NORTH]:m.id}),wo(m,{[x.Direction.SOUTHEAST]:c.id,[x.Direction.UP]:u.id}),wo(u,{[x.Direction.DOWN]:m.id}),wo(l,{[x.Direction.EAST]:a.id}),{deepCanyon:e.id,damLobby:r.id,dam:n.id,damBase:i.id,maintenanceRoom:o.id,reservoirSouth:a.id,reservoir:s.id,reservoirNorth:c.id,streamView:l.id,smallCave:u.id,atlantisRoom:m.id}}function kQ(t,e,r){let n=t.getEntity(e.damBase);n&&(n.get(x.RoomTrait).exits[x.Direction.NORTH]={destination:r})}function xQ(t,e,r){let n=t.getEntity(e.streamView);n&&(n.get(x.RoomTrait).exits[x.Direction.SOUTH]={destination:r})}function BQ(t,e){Dve(t,e.damLobby),Pve(t,e.maintenanceRoom),Lve(t,e.dam),Mve(t,e.reservoir),kve(t,e.reservoirNorth),xve(t,e.damBase),Bve(t,e.atlantisRoom)}function Dve(t,e){let r=t.createEntity("guidebook",x.EntityType.ITEM);r.add(new x.IdentityTrait({name:"guidebook",aliases:["guide book","guide","book","brochure","pamphlet"],description:'This is a guidebook entitled "Flood Control Dam #3" with a picture of the dam on the cover.',properName:!1,article:"a",weight:5})),r.add(new x.ReadableTrait({text:`FLOOD CONTROL DAM #3

Constructed in Year 783 of the Great Underground Empire, Flood Control Dam #3 was a major engineering achievement. The dam is 400 feet tall and holds back the mighty Frigid River.

The dam is controlled from the Maintenance Room. In case of emergency, the control panel can be used to open or close the sluice gates.

NOTICE: Opening the sluice gates will drain the reservoir. This is not reversible without significant effort.`})),t.moveEntity(r.id,e);let n=t.createEntity("matchbook",x.EntityType.ITEM);n.add(new x.IdentityTrait({name:"matchbook",aliases:["matches","book of matches","match book"],description:'A matchbook advertising MIT Tech. The cover says "STRADDLING THE CUTTING EDGE OF NOTHING".',properName:!1,article:"a",weight:5})),n.add(new x.ReadableTrait({text:`   *** MIT TECH CORRESPONDENCE SCHOOL ***

"My income soared after I received my degree!" - Mr. TAA of Muddle, Mass.

"I got a great job in paper shuffling!" - Mr. MARC of Boston

Straddling the cutting edge of nothing! Earn your MDL degree at home!

       *** SEND FOR OUR FREE BROCHURE TODAY! ***`})),t.moveEntity(n.id,e)}function Pve(t,e){let r=t.createEntity("control panel",x.EntityType.ITEM);r.add(new x.IdentityTrait({name:"control panel",aliases:["panel","controls","buttons","switches","levers"],description:'The control panel has a row of buttons in various colors. There is also a large bolt holding a cover in place, and a yellow button labeled "DANGER".',properName:!1,article:"a"})),r.add(new x.SceneryTrait),r.boltLoose=!1,t.moveEntity(r.id,e);let n=t.createEntity("wrench",x.EntityType.ITEM);n.add(new x.IdentityTrait({name:"wrench",aliases:["spanner","tool"],description:"This is a heavy wrench, suitable for loosening large bolts.",properName:!1,article:"a",weight:5})),t.moveEntity(n.id,e);let i=t.createEntity("screwdriver",x.EntityType.ITEM);i.add(new x.IdentityTrait({name:"screwdriver",aliases:["screwdriver","tool"],description:"This is a large flathead screwdriver.",properName:!1,article:"a",weight:10})),t.moveEntity(i.id,e);let o=t.createEntity("yellow button",x.EntityType.ITEM);o.add(new x.IdentityTrait({name:"yellow button",aliases:["danger button","danger","button"],adjectives:["yellow"],description:'A yellow button labeled "DANGER".',properName:!1,article:"a"})),o.buttonColor="yellow",t.moveEntity(o.id,e);let a=t.createEntity("brown button",x.EntityType.ITEM);a.add(new x.IdentityTrait({name:"brown button",aliases:["button"],adjectives:["brown"],description:"A brown button.",properName:!1,article:"a"})),a.buttonColor="brown",t.moveEntity(a.id,e);let s=t.createEntity("red button",x.EntityType.ITEM);s.add(new x.IdentityTrait({name:"red button",aliases:["button"],adjectives:["red"],description:"A red button.",properName:!1,article:"a"})),s.buttonColor="red",t.moveEntity(s.id,e);let c=t.createEntity("blue button",x.EntityType.ITEM);c.add(new x.IdentityTrait({name:"blue button",aliases:["button"],adjectives:["blue"],description:"A blue button.",properName:!1,article:"a"})),c.buttonColor="blue",t.moveEntity(c.id,e)}function Lve(t,e){let r=t.createEntity("bolt",x.EntityType.ITEM);r.add(new x.IdentityTrait({name:"bolt",aliases:["large bolt","metal bolt"],description:"A large metal bolt on the control panel. Above it is a small green plastic bubble.",properName:!1,article:"a"})),r.turnable=!0,t.moveEntity(r.id,e)}function Mve(t,e){let r=t.createEntity("trunk",x.EntityType.ITEM);r.add(new x.IdentityTrait({name:"trunk",aliases:["trunk of jewels","treasure trunk","chest"],description:"This is an old trunk, covered in mud. It appears to contain a fortune in jewels!",properName:!1,article:"a",weight:5})),r.add(new x.ContainerTrait({capacity:{maxItems:10,maxWeight:50}})),r.add(new x.OpenableTrait({isOpen:!0})),r.isTreasure=!0,r.treasureId="trunk-of-jewels",r.treasureValue=15,r.trophyCaseValue=8,t.moveEntity(r.id,e)}function kve(t,e){let r=t.createEntity("hand pump",x.EntityType.ITEM);r.add(new x.IdentityTrait({name:"hand pump",aliases:["pump","air pump","hand pump","rubber pump"],description:"This is a small hand-held air pump.",properName:!1,article:"a",weight:5})),t.moveEntity(r.id,e)}function xve(t,e){let r=t.createEntity("pile of plastic",x.EntityType.ITEM);r.add(new x.IdentityTrait({name:"pile of plastic",aliases:["boat","rubber boat","raft","inflatable boat","inflatable raft","plastic","pile"],description:"There is a folded pile of plastic here which has a small valve attached.",properName:!1,article:"a",weight:2})),r.add(new x.ContainerTrait({capacity:{maxItems:10,maxWeight:100}})),r.isInflated=!1,t.moveEntity(r.id,e);let n=t.createEntity("tan label",x.EntityType.ITEM);n.add(new x.IdentityTrait({name:"tan label",aliases:["label","tan label","instructions"],description:"A tan label attached to the boat.",properName:!1,article:"a",weight:0})),n.add(new x.ReadableTrait({text:`    !!!! FROBOZZ MAGIC BOAT COMPANY !!!!

Hello, sailor!

Instructions for use:

To get into the boat, say "BOARD"
To leave the boat, say "DISEMBARK"
To get into a body of water, say "LAUNCH"
To get to shore, say "LAND"

Warranty:

This boat is guaranteed against all defects in parts and workmanship for a period of 76 milliseconds from date of purchase or until first used, whichever comes first.

Warning: This boat is made of plastic.

Good luck!`})),t.moveEntity(n.id,r.id);let i=t.createEntity("sharp stick",x.EntityType.ITEM);i.add(new x.IdentityTrait({name:"sharp stick",aliases:["stick","broken stick","sharp stick","broken sharp stick","pointed stick"],description:"A sharp stick, which appears to have been broken at one end, is here.",properName:!1,article:"a",weight:5})),i.isPointy=!0,i.puncturesBoat=!0,i.isSceptre=!0,t.moveEntity(i.id,e);let o=t.createEntity("river-dam-base",x.EntityType.ITEM);o.add(new x.IdentityTrait({name:"Frigid River",aliases:["river","water","frigid river","stream"],description:"The Frigid River is flowing by here. Across the river are the White Cliffs, which seem to form a giant wall stretching from north to south along the east shore of the river as it winds its way downstream.",properName:!0,article:"the"})),o.add(new x.SceneryTrait),o.isWaterBody=!0,t.moveEntity(o.id,e)}function Bve(t,e){let r=t.createEntity("crystal trident",x.EntityType.ITEM);r.add(new x.IdentityTrait({name:"crystal trident",aliases:["trident","poseidon trident","poseidons trident","crystal"],description:"On the shore lies Poseidon's own crystal trident.",properName:!1,article:"a",weight:5})),r.isTreasure=!0,r.treasureId="crystal-trident",r.treasureValue=4,r.trophyCaseValue=11,t.moveEntity(r.id,e);let n=t.createEntity("tin of spices",x.EntityType.ITEM);n.add(new x.IdentityTrait({name:"tin of spices",aliases:["tin","spices","saffron","rare spices","tin of rare spices"],description:"A tin of rare spices. The aroma is exotic and enticing.",properName:!1,article:"a",weight:8})),n.isTreasure=!0,n.treasureId="saffron",n.treasureValue=5,n.trophyCaseValue=5,t.moveEntity(n.id,e)}var A=S(b());function ir(t,e,r,n=!0){let i=t.createEntity(e,A.EntityType.ROOM);return i.add(new A.RoomTrait({exits:{},isDark:n,isOutdoors:!1})),i.add(new A.IdentityTrait({name:e,description:r,properName:!0,article:"the"})),i}function Ue(t,e){let r=t.get(A.RoomTrait);if(r)for(let[n,i]of Object.entries(e))r.exits[n]={destination:i}}function jQ(t){let e=ir(t,"Cold Passage","You are in a cold, damp passage. The air here is noticeably colder than elsewhere in the underground. Passages lead in several directions."),r=ir(t,"Steep Crawlway","You are in a steep, narrow crawlway. The passage slopes steeply here, making movement difficult."),n=ir(t,"Slide Room","You are in a room with a steep slide leading down into darkness. The slide appears to be one-way - once you go down, there may be no coming back up. Passages lead north and east."),i=t.createEntity("Slide-1",A.EntityType.ROOM);i.add(new A.RoomTrait({exits:{},isDark:!0,isOutdoors:!1})),i.add(new A.IdentityTrait({name:"Slide",aliases:["slide","chute"],description:"You are on a steep slide, sliding downward. The walls are too smooth to grab onto. You continue to slide down...",properName:!0,article:"the"}));let o=t.createEntity("Slide-2",A.EntityType.ROOM);o.add(new A.RoomTrait({exits:{},isDark:!0,isOutdoors:!1})),o.add(new A.IdentityTrait({name:"Slide",aliases:["slide","chute"],description:"You continue sliding down the steep chute. There is no way to stop or go back up.",properName:!0,article:"the"}));let a=t.createEntity("Slide-3",A.EntityType.ROOM);a.add(new A.RoomTrait({exits:{},isDark:!0,isOutdoors:!1})),a.add(new A.IdentityTrait({name:"Slide",aliases:["slide","chute"],description:"You are at the bottom of a long slide. There is a small ledge to the east where you might be able to stop. Otherwise, you will continue sliding down into the depths below.",properName:!0,article:"the"}));let s=ir(t,"Slide Ledge","You are on a small ledge beside a steep slide. The ledge is barely wide enough to stand on. A passage leads south."),c=ir(t,"Sooty Room","You are in a room covered with a thick layer of coal dust and soot. Everything here is coated in black grime. A passage leads north."),l=ir(t,"Mine Entrance","You are at the entrance to an old coal mine. Wooden support beams frame the entrance, and you can see passages leading in several directions. The air smells of dust and old coal."),u=ir(t,"Squeaky Room","You are in a room with a wooden floor that squeaks loudly with every step you take. The floorboards are old and warped."),m=ir(t,"Small Room","This is a small, cramped room carved out of the rock. A passage leads east."),f=ir(t,"Shaft Room","This is a small room near the top of a deep shaft. A rusty iron basket hangs from a chain here, suspended over the darkness below. An opening leads west."),g=ir(t,"Wooden Tunnel","You are in a tunnel reinforced with wooden beams and supports. The timbers creak ominously as you pass through."),h=ir(t,"Smelly Room","You are in a room with a strong, unpleasant odor. The smell of natural gas is unmistakable. A hole in the floor leads down."),y=ir(t,"Gas Room","This room has a strong, unpleasant smell. The air feels heavy and slightly nauseating. It would be very dangerous to bring an open flame here. Passages lead north and east.");y.hasGas=!0;let _="You are in a maze of twisty little passages, all alike.",v=t.createEntity("Mine Maze-1",A.EntityType.ROOM);v.add(new A.RoomTrait({exits:{},isDark:!0,isOutdoors:!1})),v.add(new A.IdentityTrait({name:"Maze",aliases:["maze","mine maze"],description:_,properName:!1,article:"a"}));let E=t.createEntity("Mine Maze-2",A.EntityType.ROOM);E.add(new A.RoomTrait({exits:{},isDark:!0,isOutdoors:!1})),E.add(new A.IdentityTrait({name:"Maze",aliases:["maze","mine maze"],description:_,properName:!1,article:"a"}));let T=t.createEntity("Mine Maze-3",A.EntityType.ROOM);T.add(new A.RoomTrait({exits:{},isDark:!0,isOutdoors:!1})),T.add(new A.IdentityTrait({name:"Maze",aliases:["maze","mine maze"],description:_,properName:!1,article:"a"}));let O=t.createEntity("Mine Maze-4",A.EntityType.ROOM);O.add(new A.RoomTrait({exits:{},isDark:!0,isOutdoors:!1})),O.add(new A.IdentityTrait({name:"Maze",aliases:["maze","mine maze"],description:_,properName:!1,article:"a"}));let R=t.createEntity("Mine Maze-5",A.EntityType.ROOM);R.add(new A.RoomTrait({exits:{},isDark:!0,isOutdoors:!1})),R.add(new A.IdentityTrait({name:"Maze",aliases:["maze","mine maze"],description:_,properName:!1,article:"a"}));let I=t.createEntity("Mine Maze-6",A.EntityType.ROOM);I.add(new A.RoomTrait({exits:{},isDark:!0,isOutdoors:!1})),I.add(new A.IdentityTrait({name:"Maze",aliases:["maze","mine maze"],description:_,properName:!1,article:"a"}));let w=t.createEntity("Mine Maze-7",A.EntityType.ROOM);w.add(new A.RoomTrait({exits:{},isDark:!0,isOutdoors:!1})),w.add(new A.IdentityTrait({name:"Maze",aliases:["maze","mine maze"],description:_,properName:!1,article:"a"}));let N=ir(t,"Ladder Top","You are at the top of a rickety wooden ladder that descends into darkness. A passage leads north."),G=ir(t,"Ladder Bottom","You are at the bottom of a rickety wooden ladder. A passage leads south into an area with a strange smell. You can climb up the ladder."),k=t.createEntity("Coal Mine Dead End",A.EntityType.ROOM);k.add(new A.RoomTrait({exits:{},isDark:!0,isOutdoors:!1})),k.add(new A.IdentityTrait({name:"Dead End",aliases:["dead end"],description:"You have reached a dead end in the coal mine. The passage ends abruptly here.",properName:!1,article:"a"}));let pe=ir(t,"Timber Room","This room is supported by massive wooden beams that creak ominously. The timber looks old but sturdy. Passages lead north, west, and south."),oe=ir(t,"Bottom of Shaft","You are at the bottom of a deep shaft. The walls rise up into darkness above you. Passages lead east and northeast."),le=ir(t,"Machine Room","This is a large room full of old mining equipment. In the center stands a massive coal-powered machine with a prominent slot. The walls are blackened with soot. A passage leads west.");return Ue(e,{[A.Direction.WEST]:n.id,[A.Direction.NORTH]:r.id}),Ue(r,{[A.Direction.SOUTHWEST]:e.id}),Ue(n,{[A.Direction.DOWN]:i.id,[A.Direction.EAST]:e.id,[A.Direction.NORTH]:l.id}),Ue(i,{[A.Direction.DOWN]:o.id}),Ue(o,{[A.Direction.DOWN]:a.id}),Ue(a,{[A.Direction.EAST]:s.id}),Ue(s,{[A.Direction.UP]:o.id,[A.Direction.SOUTH]:c.id}),Ue(c,{[A.Direction.NORTH]:s.id}),Ue(l,{[A.Direction.SOUTH]:n.id,[A.Direction.NORTHWEST]:u.id,[A.Direction.NORTHEAST]:f.id}),Ue(u,{[A.Direction.SOUTH]:l.id,[A.Direction.WEST]:m.id}),Ue(m,{[A.Direction.EAST]:u.id}),Ue(f,{[A.Direction.WEST]:l.id,[A.Direction.NORTH]:g.id}),Ue(g,{[A.Direction.SOUTH]:f.id,[A.Direction.WEST]:h.id,[A.Direction.NORTHEAST]:v.id}),Ue(h,{[A.Direction.EAST]:g.id,[A.Direction.DOWN]:y.id}),Ue(y,{[A.Direction.UP]:h.id}),Ue(v,{[A.Direction.NORTH]:O.id,[A.Direction.SOUTHWEST]:E.id,[A.Direction.EAST]:g.id}),Ue(E,{[A.Direction.SOUTH]:v.id,[A.Direction.WEST]:R.id,[A.Direction.UP]:T.id,[A.Direction.NORTHEAST]:O.id}),Ue(T,{[A.Direction.WEST]:E.id,[A.Direction.NORTHEAST]:R.id,[A.Direction.EAST]:R.id}),Ue(O,{[A.Direction.UP]:R.id,[A.Direction.NORTHEAST]:I.id,[A.Direction.SOUTH]:v.id,[A.Direction.WEST]:E.id}),Ue(R,{[A.Direction.DOWN]:I.id,[A.Direction.NORTH]:w.id,[A.Direction.WEST]:E.id,[A.Direction.SOUTH]:T.id,[A.Direction.UP]:T.id,[A.Direction.EAST]:O.id}),Ue(I,{[A.Direction.SOUTHEAST]:O.id,[A.Direction.UP]:R.id,[A.Direction.NORTHWEST]:w.id}),Ue(w,{[A.Direction.EAST]:v.id,[A.Direction.WEST]:R.id,[A.Direction.DOWN]:N.id,[A.Direction.SOUTH]:I.id}),Ue(N,{[A.Direction.UP]:w.id,[A.Direction.DOWN]:G.id}),Ue(G,{[A.Direction.UP]:N.id,[A.Direction.SOUTH]:pe.id,[A.Direction.NORTHEAST]:k.id}),Ue(k,{[A.Direction.SOUTH]:G.id}),Ue(pe,{[A.Direction.NORTH]:G.id,[A.Direction.SOUTHWEST]:oe.id}),Ue(oe,{[A.Direction.EAST]:le.id,[A.Direction.NORTHEAST]:pe.id}),Ue(le,{[A.Direction.NORTHWEST]:oe.id}),{coldPassage:e.id,steepCrawlway:r.id,slideRoom:n.id,slide1:i.id,slide2:o.id,slide3:a.id,slideLedge:s.id,sootyRoom:c.id,mineEntrance:l.id,squeakyRoom:u.id,smallRoom:m.id,shaftRoom:f.id,woodenTunnel:g.id,smellyRoom:h.id,gasRoom:y.id,mineMaze1:v.id,mineMaze2:E.id,mineMaze3:T.id,mineMaze4:O.id,mineMaze5:R.id,mineMaze6:I.id,mineMaze7:w.id,ladderTop:N.id,ladderBottom:G.id,coalMineDeadEnd:k.id,timberRoom:pe.id,bottomOfShaft:oe.id,machineRoom:le.id}}function WQ(t,e){jve(t,e.shaftRoom,e.bottomOfShaft),Wve(t,e.coalMineDeadEnd),Hve(t,e.machineRoom),Uve(t,e.squeakyRoom),qve(t,e.squeakyRoom),Fve(t,e.gasRoom),Gve(t,e.sootyRoom),Vve(t,e.timberRoom)}function jve(t,e,r){let n=t.createEntity("basket",A.EntityType.CONTAINER);return n.add(new A.IdentityTrait({name:"rusty iron basket",aliases:["basket","iron basket","rusty basket"],description:"A rusty iron basket hangs from a sturdy chain. It looks large enough to hold a person and some items. There is a wheel mechanism nearby to lower and raise it.",properName:!1,article:"a"})),n.add(new A.ContainerTrait({capacity:{maxItems:10,maxWeight:100}})),n.add(new A.EnterableTrait),n.add(new A.SceneryTrait),n.add(new Zr({topRoomId:e,bottomRoomId:r,initialPosition:"top"})),t.moveEntity(n.id,e),n}function Wve(t,e){let r=t.createEntity("coal",A.EntityType.ITEM);return r.add(new A.IdentityTrait({name:"pile of coal",aliases:["coal","black coal","lump of coal"],description:"A pile of black coal. It would make excellent fuel for a machine.",properName:!1,article:"a",weight:10})),t.moveEntity(r.id,e),r}function Hve(t,e){let r=t.createEntity("machine",A.EntityType.CONTAINER);return r.add(new A.IdentityTrait({name:"machine",aliases:["machine","coal machine","big machine","coal-powered machine"],description:"This is a massive machine with a lid on top and a switch on the side. The lid is open, revealing a small compartment inside. It looks like it could exert enormous pressure.",properName:!1,article:"a"})),r.add(new A.ContainerTrait({capacity:{maxItems:1,maxWeight:10}})),r.add(new A.OpenableTrait({isOpen:!0})),r.add(new A.SceneryTrait),r.machineActivated=!1,t.moveEntity(r.id,e),r}function Uve(t,e){let r=t.createEntity("vampire bat",A.EntityType.ACTOR);return r.add(new A.IdentityTrait({name:"vampire bat",aliases:["bat","giant bat","large bat"],description:"A giant vampire bat hangs from the ceiling, watching you with beady eyes. It looks strong enough to carry a person.",properName:!1,article:"a"})),r.add(new A.ActorTrait({isPlayer:!1})),r.add(new A.NpcTrait({behaviorId:"bat",isHostile:!1,canMove:!0})),r.repelledBy="garlic",t.moveEntity(r.id,e),r}function qve(t,e){let r=t.createEntity("jade figurine",A.EntityType.ITEM);return r.add(new A.IdentityTrait({name:"jade figurine",aliases:["figurine","jade","statue","jade statue"],description:"A beautiful jade figurine of an oriental dragon. It is exquisitely carved.",properName:!1,article:"a",weight:5})),r.isTreasure=!0,r.treasureId="jade-figurine",r.treasureValue=5,r.trophyCaseValue=5,t.moveEntity(r.id,e),r}function Fve(t,e){let r=t.createEntity("sapphire bracelet",A.EntityType.ITEM);return r.add(new A.IdentityTrait({name:"sapphire bracelet",aliases:["bracelet","sapphire","blue bracelet"],description:"A delicate bracelet set with brilliant blue sapphires.",properName:!1,article:"a",weight:5})),r.isTreasure=!0,r.treasureId="sapphire-bracelet",r.treasureValue=5,r.trophyCaseValue=3,t.moveEntity(r.id,e),r}function Gve(t,e){let r=t.createEntity("red crystal sphere",A.EntityType.ITEM);return r.add(new A.IdentityTrait({name:"red crystal sphere",aliases:["sphere","crystal sphere","red sphere","crystal","red crystal","ball"],description:"A beautiful sphere of red crystal. It seems to glow with an inner light.",properName:!1,article:"a",weight:5})),r.isTreasure=!0,r.treasureId="red-crystal-sphere",r.treasureValue=10,r.trophyCaseValue=5,t.moveEntity(r.id,e),r}function Vve(t,e){let r=t.createEntity("timber",A.EntityType.ITEM);return r.add(new A.IdentityTrait({name:"wooden timber",aliases:["timber","beam","wooden beam","lumber","wood"],description:"A large, sturdy piece of timber. It could be useful for propping things up.",properName:!1,article:"a",weight:20})),t.moveEntity(r.id,e),r}var H=S(b());function Ln(t,e,r,n=!0){let i=t.createEntity(e,H.EntityType.ROOM);return i.add(new H.RoomTrait({exits:{},isDark:n,isOutdoors:!1})),i.add(new H.IdentityTrait({name:e,description:r,properName:!0,article:"the"})),i}function Mn(t,e){let r=t.get(H.RoomTrait);if(r)for(let[n,i]of Object.entries(e))r.exits[n]={destination:i}}function HQ(t){let e=Ln(t,"Temple","This is the interior of a large temple of ancient construction. Flickering torches cast shadows on the walls. A stairway leads down."),r=Ln(t,"Altar","This is the altar room of the temple. A large stone altar dominates the room."),n=Ln(t,"North/South Passage","This is a wide passage running north and south. The walls are damp and cold."),i=Ln(t,"Grail Room","You are in a small chamber with walls of granite. A narrow passage exits to the west."),o=Ln(t,"Winding Passage","This is a winding passage through the rock. It leads northwest and east."),a=Ln(t,"Mirror Room","You are in a large room with a great mirror on the wall. Passages lead northeast and west.");a.mirrorRubCount=0;let s=Ln(t,"Narrow Crawlway","This is a narrow crawlway. Passages lead north, south, and southwest."),c=Ln(t,"Loud Room","This is a large room with a ceiling which cannot be detected from the ground. A narrow passage leads east; a stairway leads up. The room is extremely noisy."),l=Ln(t,"Damp Cave","This cave is extremely damp. A stairway leads down."),u=Ln(t,"Ancient Chasm","You are at the edge of an ancient chasm. Passages lead in several directions."),m=Ln(t,"Basin Room","You are in a small room with a stone basin in the center."),f=Ln(t,"Dead End","You are at a dead end in the passage."),g=Ln(t,"Dead End","You are at a dead end in the passage."),h=Ln(t,"Small Cave","This is a small cave. A passage leads west.");return Mn(e,{[H.Direction.EAST]:r.id,[H.Direction.DOWN]:i.id}),Mn(r,{[H.Direction.WEST]:e.id}),Mn(i,{[H.Direction.UP]:e.id,[H.Direction.EAST]:s.id}),Mn(n,{[H.Direction.NORTHEAST]:c.id}),Mn(c,{[H.Direction.SOUTHWEST]:n.id,[H.Direction.UP]:l.id,[H.Direction.EAST]:u.id}),Mn(l,{[H.Direction.DOWN]:c.id}),Mn(u,{[H.Direction.WEST]:c.id,[H.Direction.NORTH]:g.id,[H.Direction.EAST]:h.id,[H.Direction.SOUTH]:m.id}),Mn(m,{[H.Direction.NORTH]:u.id}),Mn(f,{[H.Direction.EAST]:u.id}),Mn(g,{[H.Direction.SOUTH]:u.id}),Mn(h,{[H.Direction.WEST]:u.id}),Mn(s,{[H.Direction.WEST]:i.id,[H.Direction.SOUTHWEST]:a.id,[H.Direction.SOUTH]:o.id}),Mn(a,{[H.Direction.NORTHEAST]:s.id,[H.Direction.WEST]:o.id}),Mn(o,{[H.Direction.EAST]:a.id,[H.Direction.NORTH]:s.id}),{temple:e.id,altar:r.id,northSouthPassage:n.id,grailRoom:i.id,windingPassage:o.id,mirrorRoom:a.id,narrowCrawlway:s.id,loudRoom:c.id,dampCave:l.id,ancientChasm:u.id,basinRoom:m.id,deadEnd1:f.id,deadEnd2:g.id,smallCave:h.id}}function UQ(t,e,r){let n=t.getEntity(e.northSouthPassage),i=t.getEntity(r);n&&(n.get(H.RoomTrait).exits[H.Direction.NORTH]={destination:r}),i&&(i.get(H.RoomTrait).exits[H.Direction.EAST]={destination:e.northSouthPassage})}function qQ(t,e,r){let n=t.getEntity(e.mirrorRoom),i=t.getEntity(r);n&&(n.get(H.RoomTrait).exits[H.Direction.EAST]={destination:r}),i&&(i.get(H.RoomTrait).exits[H.Direction.WEST]={destination:e.mirrorRoom})}function FQ(t,e,r){let n=t.getEntity(e.smallCave),i=t.getEntity(r);n&&(n.get(H.RoomTrait).exits[H.Direction.NORTHWEST]={destination:r}),i&&(i.get(H.RoomTrait).exits[H.Direction.SOUTHEAST]={destination:e.smallCave})}var Yve="dungeo-mirror";function GQ(t,e){zve(t,e.altar),$ve(t,e.grailRoom),Kve(t,e.mirrorRoom),Qve(t,e.smallCave),Xve(t,e.basinRoom),Zve(t,e.loudRoom)}function zve(t,e){let r=t.createEntity("stone altar",H.EntityType.SCENERY);r.add(new H.IdentityTrait({name:"stone altar",aliases:["altar","massive altar"],description:"A massive stone altar covered in ancient runes. It radiates an aura of ancient power.",properName:!1,article:"a"})),r.add(new H.SceneryTrait),t.moveEntity(r.id,e);let n=t.createEntity("brass bell",H.EntityType.ITEM);n.add(new H.IdentityTrait({name:"brass bell",aliases:["bell","brass","small bell"],description:"A brass bell with strange symbols engraved around its rim.",properName:!1,article:"a",weight:5})),n.isExorcismItem=!0,n.exorcismRole="bell",t.moveEntity(n.id,e);let i=t.createEntity("black book",H.EntityType.ITEM);i.add(new H.IdentityTrait({name:"black book",aliases:["book","ancient book","leather book"],description:"An ancient book bound in black leather. Strange symbols cover the cover.",properName:!1,article:"a",weight:5})),i.add(new H.ReadableTrait({text:`The book is written in a strange language, but one passage stands out:

"To banish the spirits of the dead, one must perform the Ritual of Exorcism:
Ring the bell, read the book aloud, light the candles with a flame.
Only then shall the gates of Hades be opened to the living."`})),i.isExorcismItem=!0,i.exorcismRole="book",t.moveEntity(i.id,e);let o=t.createEntity("pair of candles",H.EntityType.ITEM);o.add(new H.IdentityTrait({name:"pair of candles",aliases:["candles","candle","white candles"],description:"A pair of white wax candles.",properName:!1,article:"a",weight:20})),o.add(new H.LightSourceTrait({isLit:!1,brightness:2,fuelRemaining:50,maxFuel:50,fuelConsumptionRate:1})),o.add(new H.SwitchableTrait({isOn:!1})),o.isExorcismItem=!0,o.exorcismRole="candles",t.moveEntity(o.id,e)}function $ve(t,e){let r=t.createEntity("pedestal",H.EntityType.SCENERY);r.add(new H.IdentityTrait({name:"stone pedestal",aliases:["pedestal","stone pedestal","altar"],description:"A stone pedestal stands in the center of the room, carved with ancient symbols.",properName:!1,article:"a"})),r.add(new H.SceneryTrait),t.moveEntity(r.id,e);let n=t.createEntity("grail",H.EntityType.ITEM);n.add(new H.IdentityTrait({name:"grail",aliases:["grail","holy grail","cup","goblet","sacred grail"],description:"A plain wooden grail, yet it radiates an aura of ancient holiness. Its simple appearance belies its true value.",properName:!1,article:"a",weight:5})),n.isTreasure=!0,n.treasureId="grail",n.treasureValue=2,n.trophyCaseValue=5,t.moveEntity(n.id,e)}function Kve(t,e){let r=t.createEntity("mirror",H.EntityType.SCENERY);r.customId=Yve,r.add(new H.IdentityTrait({name:"enormous mirror",aliases:["mirror","enormous mirror","south mirror","wall mirror","large mirror"],description:"An enormous mirror fills the entire south wall of the room. Its surface is flawless and seems to shimmer with an otherworldly quality.",properName:!1,article:"an"})),r.add(new H.SceneryTrait),t.moveEntity(r.id,e)}function Qve(t,e){let r=t.createEntity("shovel",H.EntityType.ITEM);r.add(new H.IdentityTrait({name:"shovel",aliases:["shovel","spade"],description:"A sturdy shovel with a wooden handle and metal blade.",properName:!1,article:"a",weight:5})),t.moveEntity(r.id,e)}function Xve(t,e){let r=t.createEntity("stone basin",H.EntityType.ITEM);r.add(new H.IdentityTrait({name:"stone basin",aliases:["basin","carved basin","gargoyle basin"],description:"The basin is carved from a single block of dark stone, surrounded by gargoyles and serpent figures. It is filled with what can only be described as a mystical fog.",properName:!1,article:"a"})),r.add(new H.SceneryTrait),r.isRitualBasin=!0,t.moveEntity(r.id,e)}function Zve(t,e){let r=t.createEntity("platinum bar",H.EntityType.ITEM);r.add(new H.IdentityTrait({name:"platinum bar",aliases:["bar","platinum","ingot","metal bar"],description:'This is a large bar of platinum, stamped "FROBOZZ MAGIC COMPANY".',properName:!1,article:"a",weight:20})),r.isTreasure=!0,r.treasureId="platinum-bar",r.treasureValue=12,r.trophyCaseValue=10,t.moveEntity(r.id,e)}var M=S(b());function Co(t,e,r,n=!0){let i=t.createEntity(e,M.EntityType.ROOM);return i.add(new M.RoomTrait({exits:{},isDark:n,isOutdoors:!1})),i.add(new M.IdentityTrait({name:e,description:r,properName:!0,article:"the"})),i}function $s(t,e){let r=t.get(M.RoomTrait);if(r)for(let[n,i]of Object.entries(e))r.exits[n]={destination:i}}function YQ(t){let e=Co(t,"East of Chasm","You are on the east edge of a great chasm. A wooden bridge once spanned the gap, but it has long since collapsed. Far below, you can hear the faint sound of rushing water. A narrow ledge runs along the north wall of the chasm."),r=Co(t,"West of Chasm","You are on the west edge of a great chasm. The remains of a collapsed bridge dangle into the darkness below. A narrow ledge runs along the north wall of the chasm, providing precarious passage to the east. To the south, an ornate doorway leads into what appears to be a building."),n=Co(t,"Bank Entrance",'You are in the grand entrance hall of the Bank of Zork. Marble columns rise to a vaulted ceiling decorated with gold leaf. A brass plaque on the wall reads "BANK OF ZORK - Securing Your Treasures Since 668 GUE". The main lobby lies to the south.',!1),i=Co(t,"Bank Lobby",'You are in the main lobby of the Bank of Zork. Teller windows line the east and west walls, though they have long been abandoned. Dust covers the once-polished marble floor. A velvet rope blocks access to the south, where a sign reads "Employees Only". The entrance is to the north.',!1),o=Co(t,"West Teller's Room",`This is a small square room, which was used by a bank officer whose job it was to retrieve safety deposit boxes for the customer. On the north side of the room is a sign which reads "Viewing Room". On the west side of the room, above an open door, is a sign reading

            BANK PERSONNEL ONLY`,!1),a=Co(t,"East Teller","You are behind the eastern teller window. This area is much like the western side, with a dusty counter and abandoned paperwork. A passage leads west, and a door to the south leads to the back offices.",!1),s=Co(t,"Chairman's Office","You are in the opulent office of the Bank's former chairman. A massive mahogany desk dominates the room, and the walls are lined with bookshelves containing leather-bound volumes. A painting hangs on the north wall. Doors lead north and east.",!1),c=Co(t,"Safety Depository",'This is a large rectangular room. The east and west walls here were used for storing safety deposit boxes. As might be expected, all have been carefully removed by evil persons. To the east, west, and south of the room are large doorways. The northern "wall" of the room is a shimmering curtain of light. In the center of the room is a large stone cube, about 10 feet on a side. Engraved on the side of the cube is some lettering.',!1),l=Co(t,"Vault","This is the Vault of the Bank of Zork, in which there are no doors.",!1),u=Co(t,"Viewing Room",`This is a room used by holders of safety deposit boxes to view their contents. On the north side of the room is a sign which says

REMAIN HERE WHILE THE BANK OFFICER RETRIEVES YOUR DEPOSIT BOX
WHEN YOU ARE FINISHED, LEAVE THE BOX, AND EXIT TO THE SOUTH
AN ADVANCED PROTECTIVE DEVICE PREVENTS ALL CUSTOMERS FROM
REMOVING ANY SAFETY DEPOSIT BOX FROM THIS VIEWING AREA!
Thank you for banking at the Zork!`,!1),m=Co(t,"Small Room","This is a small bare room with no distinguishing features. There are no exits from this room.",!1);return $s(e,{[M.Direction.WEST]:r.id}),$s(r,{[M.Direction.EAST]:e.id}),$s(n,{[M.Direction.NORTHWEST]:o.id,[M.Direction.NORTHEAST]:a.id}),$s(i,{[M.Direction.NORTH]:n.id,[M.Direction.WEST]:o.id,[M.Direction.EAST]:a.id}),$s(o,{[M.Direction.WEST]:c.id,[M.Direction.SOUTHEAST]:n.id}),$s(a,{[M.Direction.WEST]:o.id,[M.Direction.SOUTH]:s.id}),$s(s,{[M.Direction.NORTH]:a.id,[M.Direction.WEST]:u.id,[M.Direction.EAST]:c.id}),$s(c,{[M.Direction.EAST]:o.id,[M.Direction.WEST]:o.id,[M.Direction.SOUTH]:s.id}),$s(u,{[M.Direction.SOUTH]:n.id}),{eastOfChasm:e.id,westOfChasm:r.id,bankEntrance:n.id,bankLobby:i.id,westTeller:o.id,eastTeller:a.id,chairmansOffice:s.id,safetyDeposit:c.id,vault:l.id,viewingRoom:u.id,smallRoom:m.id}}function zQ(t,e,r,n,i){let o=t.getEntity(r);o&&(o.get(M.RoomTrait).exits[M.Direction.SOUTH]={destination:e.westOfChasm});let a=t.getEntity(e.westOfChasm);if(a){let l=a.get(M.RoomTrait);l.exits[M.Direction.WEST]={destination:r},l.exits[M.Direction.SOUTH]={destination:n},i&&(l.exits[M.Direction.NORTH]={destination:i})}if(i){let l=t.getEntity(i);l&&(l.get(M.RoomTrait).exits[M.Direction.NORTH]={destination:e.westOfChasm})}let s=t.getEntity(n);if(s){let l=s.get(M.RoomTrait);l.exits[M.Direction.NORTH]={destination:e.westOfChasm},l.exits[M.Direction.WEST]={destination:e.bankEntrance}}let c=t.getEntity(e.bankEntrance);c&&(c.get(M.RoomTrait).exits[M.Direction.EAST]={destination:n})}function $Q(t,e){Jve(t,e.chairmansOffice),eEe(t,e.vault),tEe(t,e.smallRoom),rEe(t,e.chairmansOffice),nEe(t,e.safetyDeposit),iEe(t,e.safetyDeposit),oEe(t,e.viewingRoom),aEe(t,e.chairmansOffice),sEe(t,e.bankEntrance),cEe(t,e.safetyDeposit),VQ(t,e.safetyDeposit,"safety-north-wall"),VQ(t,e.vault,"vault-north-wall"),lEe(t,e.smallRoom)}function Jve(t,e){let r=t.createEntity("portrait",M.EntityType.ITEM);return r.add(new M.IdentityTrait({name:"portrait",aliases:["portrait","flathead portrait"],description:"A magnificent oil portrait of J. Pierpont Flathead, founder of the Bank of Zork. The ornate gilded frame alone must be worth a fortune.",properName:!1,article:"a",weight:20})),r.isTreasure=!0,r.treasureId="portrait",r.treasureValue=10,r.trophyCaseValue=5,t.moveEntity(r.id,e),r}function eEe(t,e){let r=t.createEntity("stack of zorkmid bills",M.EntityType.ITEM);return r.add(new M.IdentityTrait({name:"stack of zorkmid bills",aliases:["zorkmid bills","bills","zorkmids","stack of bills","money","currency"],description:"A thick stack of crisp zorkmid bills in various denominations. The bills bear the stern likeness of Lord Dimwit Flathead.",properName:!1,article:"a",weight:20})),r.isTreasure=!0,r.treasureId="zorkmid-bills",r.treasureValue=10,r.trophyCaseValue=15,t.moveEntity(r.id,e),r}function tEe(t,e){let r=t.createEntity("zorkmid coin",M.EntityType.ITEM);return r.add(new M.IdentityTrait({name:"zorkmid coin",aliases:["coin","zorkmid","gold coin"],description:"A large gold zorkmid coin. One side shows a portrait of Lord Dimwit Flathead; the other depicts the great underground dam.",properName:!1,article:"a",weight:5})),r.isTreasure=!0,r.treasureId="zorkmid-coin",r.treasureValue=10,r.trophyCaseValue=12,t.moveEntity(r.id,e),r}function rEe(t,e){let r=t.createEntity("safe",M.EntityType.ITEM);r.add(new M.IdentityTrait({name:"safe",aliases:["safe","steel safe","box","steel box"],description:"A massive steel safe, the kind used to store valuable items. It has a complex combination lock.",properName:!1,article:"a"})),r.add(new M.ContainerTrait({capacity:{maxItems:5}})),r.add(new M.OpenableTrait({isOpen:!1})),r.add(new M.LockableTrait({isLocked:!0})),r.add(new M.SceneryTrait),t.moveEntity(r.id,e);let n=t.createEntity("crown",M.EntityType.ITEM);return n.add(new M.IdentityTrait({name:"crown",aliases:["crown","gaudy crown","lord dimwit's crown","flathead crown"],description:"The excessively gaudy crown of Lord Dimwit Flathead. It is encrusted with diamonds, rubies, and other precious gems, all in questionable taste.",properName:!1,article:"a",weight:10})),n.isTreasure=!0,n.treasureId="crown",n.treasureValue=15,n.trophyCaseValue=10,new M.AuthorModel(t.getDataStore(),t).moveEntity(n.id,r.id),r}function nEe(t,e){let r=t.createEntity("stone cube",M.EntityType.ITEM);return r.add(new M.IdentityTrait({name:"stone cube",aliases:["cube","large cube","large stone cube","lettering","engraving"],description:"A large stone cube, about 10 feet on a side. Engraved on the side of the cube is some lettering.",properName:!1,article:"a"})),r.add(new M.SceneryTrait),r.add(new M.ReadableTrait({text:`             Bank of Zork
              VAULT
            *722 GUE*
     Frobozz Magic Vault Company`})),t.moveEntity(r.id,e),r}function iEe(t,e){let r=t.createEntity("shimmering curtain",M.EntityType.ITEM);return r.add(new M.IdentityTrait({name:"shimmering curtain",aliases:["curtain","curtain of light","shimmering curtain of light","light"],description:'The northern "wall" of the room is a shimmering curtain of light. It seems almost tangible, yet ethereal at the same time.',properName:!1,article:"a"})),r.add(new M.SceneryTrait),r.isPassable=!0,t.moveEntity(r.id,e),r}function oEe(t,e){let r=t.createEntity("velvet curtain",M.EntityType.ITEM);return r.add(new M.IdentityTrait({name:"velvet curtain",aliases:["curtain","heavy curtain","drape"],description:"A heavy velvet curtain in deep burgundy. It hangs from ceiling to floor on the south wall.",properName:!1,article:"a"})),r.add(new M.SceneryTrait),r.add(new M.OpenableTrait({isOpen:!1})),t.moveEntity(r.id,e),r}function aEe(t,e){let r=t.createEntity("mahogany desk",M.EntityType.ITEM);return r.add(new M.IdentityTrait({name:"mahogany desk",aliases:["desk","massive desk","chairman desk"],description:"A massive mahogany desk that must weigh several hundred pounds. Its surface is covered with a layer of dust.",properName:!1,article:"a"})),r.add(new M.SceneryTrait),t.moveEntity(r.id,e),r}function sEe(t,e){let r=t.createEntity("brass plaque",M.EntityType.ITEM);return r.add(new M.IdentityTrait({name:"brass plaque",aliases:["plaque","sign"],description:'The brass plaque reads: "BANK OF ZORK - Securing Your Treasures Since 668 GUE".',properName:!1,article:"a"})),r.add(new M.SceneryTrait),t.moveEntity(r.id,e),r}function cEe(t,e){let r=t.createEntity("vault door",M.EntityType.ITEM);return r.add(new M.IdentityTrait({name:"vault door",aliases:["massive door","steel door","vault"],description:"A massive circular vault door made of reinforced steel. It stands slightly ajar, its intricate locking mechanism long since broken.",properName:!1,article:"a"})),r.add(new M.SceneryTrait),r.add(new M.OpenableTrait({isOpen:!0})),t.moveEntity(r.id,e),r}function VQ(t,e,r){let n=t.createEntity(r,M.EntityType.SCENERY);return n.add(new M.IdentityTrait({name:"north wall",aliases:["north wall","n wall","northern wall"],description:"The north wall looks solid but somehow insubstantial.",properName:!1,article:"the"})),n.add(new M.SceneryTrait),t.moveEntity(n.id,e),n}function lEe(t,e){let r=t.createEntity("south wall",M.EntityType.SCENERY);return r.add(new M.IdentityTrait({name:"south wall",aliases:["south wall","s wall","southern wall"],description:"The south wall looks solid but somehow insubstantial.",properName:!1,article:"the"})),r.add(new M.SceneryTrait),t.moveEntity(r.id,e),r}var V=S(b());function No(t,e,r,n=!0){let i=t.createEntity(e,V.EntityType.ROOM);return i.add(new V.RoomTrait({exits:{},isDark:n,isOutdoors:!1})),i.add(new V.IdentityTrait({name:e,description:r,properName:!0,article:"the"})),i}function Do(t,e){let r=t.get(V.RoomTrait);if(r)for(let[n,i]of Object.entries(e))r.exits[n]={destination:i}}function QQ(t){let e=No(t,"Engravings Cave","You are in a cave with strange engravings on the walls. A passage leads north, and stairs lead down."),r=No(t,"Riddle Room",`This is a room which is bare on all sides. There is an exit down. To the east is a great door made of stone. Above the stone, the following words are written: 'No man shall enter this room without solving this riddle:

What is tall as a house,
round as a cup,
and all the king's horses can't draw it up?'

(Reply via 'ANSWER "answer"')`);r.riddleSolved=!1;let n=No(t,"Broom Closet","This is a former broom closet. The exits are to the east and west."),i=No(t,"Well Bottom","You are at the bottom of a well. The walls are too smooth to climb."),o=No(t,"Top of Well","You are at the top of a well. A bucket hangs from a rope here."),a=No(t,"Low Room","This is a low room with passages leading in several directions."),s=No(t,"Machine Room","This is a large room filled with strange machinery. A small triangular button is set into the wall. A passage leads west."),c=No(t,"Dingy Closet","This is a small, dingy closet. A door leads south."),l=No(t,"Tea Room","This appears to be a tea room. A passage leads north."),u=No(t,"Pool Room","This is a large room with a pool of water in the center."),m=No(t,"Cave","This is a tiny cave with entrances west and north, and a dark, forbidding staircase leading down.");return m.mirrorRubCount=0,Do(e,{[V.Direction.SOUTHEAST]:r.id,[V.Direction.DOWN]:r.id}),Do(r,{[V.Direction.UP]:e.id}),Do(n,{[V.Direction.WEST]:r.id}),Do(i,{[V.Direction.UP]:o.id}),Do(o,{[V.Direction.DOWN]:i.id,[V.Direction.NORTH]:a.id}),Do(a,{[V.Direction.SOUTH]:o.id,[V.Direction.EAST]:s.id,[V.Direction.WEST]:l.id}),Do(s,{[V.Direction.WEST]:a.id}),Do(l,{[V.Direction.EAST]:a.id,[V.Direction.NORTH]:c.id}),Do(c,{[V.Direction.SOUTH]:l.id}),Do(u,{}),Do(m,{}),{engravingsCave:e.id,riddleRoom:r.id,pearlRoom:n.id,wellBottom:i.id,topOfWell:o.id,lowRoom:a.id,machineRoom:s.id,dingyCloset:c.id,teaRoom:l.id,poolRoom:u.id,cave:m.id}}function XQ(t,e,r){let n=t.getEntity(e.cave);n&&(n.get(V.RoomTrait).exits[V.Direction.DOWN]={destination:r})}function ZQ(t,e){KQ(t,e.topOfWell),KQ(t,e.wellBottom),uEe(t,e.wellBottom,e.topOfWell,e.wellBottom),dEe(t,e.poolRoom),mEe(t,e.pearlRoom),fEe(t,e.riddleRoom),pEe(t,e.teaRoom),gEe(t,e.lowRoom),hEe(t,e.machineRoom),yEe(t,e.dingyCloset)}function KQ(t,e){let r=t.createEntity("well",V.EntityType.ITEM);return r.add(new V.IdentityTrait({name:"well",aliases:["deep well","stone well"],description:"The well is constructed of ancient fitted stones. It descends into darkness, and you cannot see the bottom. A rope is attached to a windlass above the well.",properName:!1,article:"a"})),r.add(new V.SceneryTrait),t.moveEntity(r.id,e),r}function uEe(t,e,r,n){let i=t.createEntity("bucket",V.EntityType.ITEM);return i.add(new V.IdentityTrait({name:"bucket",aliases:["wooden bucket","pail"],description:"A wooden bucket attached to a rope wound around a windlass.",properName:!1,article:"a",weight:5})),i.add(new V.ContainerTrait({capacity:{maxItems:5,maxWeight:20}})),i.add(new V.EnterableTrait),i.add(new V.OpenableTrait({isOpen:!0})),i.add(new V.VehicleTrait({vehicleType:"counterweight",blocksWalkingMovement:!0,requiresExitBeforeLeaving:!0,currentPosition:"bottom",positionRooms:{top:r,bottom:n},isOperational:!0})),i.hasWater=!1,t.moveEntity(i.id,e),i}function dEe(t,e){let r=t.createEntity("silver chalice",V.EntityType.ITEM);return r.add(new V.IdentityTrait({name:"silver chalice",aliases:["chalice","silver cup","cup","goblet"],description:"A beautiful silver chalice, tarnished with age but still valuable. It bears an inscription in an ancient language.",properName:!1,article:"a",weight:40})),r.isTreasure=!0,r.treasureId="silver-chalice",r.treasureValue=10,r.trophyCaseValue=10,t.moveEntity(r.id,e),r}function mEe(t,e){let r=t.createEntity("pearl necklace",V.EntityType.ITEM);return r.add(new V.IdentityTrait({name:"pearl necklace",aliases:["necklace","pearls","string of pearls"],description:"A pearl necklace with hundreds of large pearls. It must be worth a fortune.",properName:!1,article:"a",weight:5})),r.isTreasure=!0,r.treasureId="pearl-necklace",r.treasureValue=9,r.trophyCaseValue=5,t.moveEntity(r.id,e),r}function fEe(t,e){let r=t.createEntity("riddle inscription",V.EntityType.ITEM);return r.add(new V.IdentityTrait({name:"riddle inscription",aliases:["inscription","riddle","writing","carved writing","symbols"],description:'The inscription reads: "What has roots as nobody sees, is taller than trees, up, up it goes, and yet never grows?"',properName:!1,article:"a"})),r.add(new V.SceneryTrait),t.moveEntity(r.id,e),r}function pEe(t,e){let r=t.createEntity("dusty table",V.EntityType.ITEM);r.add(new V.IdentityTrait({name:"dusty table",aliases:["table","tea table"],description:"A small wooden table, covered in a thick layer of dust. It appears to have been used for serving tea long ago.",properName:!1,article:"a"})),r.add(new V.SceneryTrait),t.moveEntity(r.id,e);let n=t.createEntity("green paper",V.EntityType.ITEM);n.add(new V.IdentityTrait({name:"piece of paper",aliases:["paper","green paper","note","piece of green paper"],description:"A small piece of green paper with some writing on it.",properName:!1,article:"a",weight:2})),n.readText=`
     ============================================
              FROBOZZ MAGIC BOAT COMPANY
     ============================================

     Hello, Sailor!

     Instructions for use:

     To Inflate: Apply pump to valve.
     To Deflate: Open valve.
     To Patch: Apply patch to boat.

     WARNING: Boat should be properly deflated before
     leaving water as sharp objects may puncture it.

     ============================================`,t.moveEntity(n.id,e);let i=t.createEntity("eat-me cake",V.EntityType.ITEM);i.add(new V.IdentityTrait({name:'"Eat Me" cake',aliases:["eat me","eat-me","eat me cake","white cake"],description:'A small cake with "Eat Me" written on it in frosting.',properName:!1,article:"an",weight:5})),i.isEdible=!0,i.onEatEffect="grow",t.moveEntity(i.id,e);let o=t.createEntity("drink-me cake",V.EntityType.ITEM);o.add(new V.IdentityTrait({name:'"Drink Me" cake',aliases:["drink me","drink-me","drink me cake","blue cake"],description:'A small blue cake with "Drink Me" written on it.',properName:!1,article:"a",weight:5})),o.isEdible=!0,o.onEatEffect="shrink",t.moveEntity(o.id,e);let a=t.createEntity("orange cake",V.EntityType.ITEM);a.add(new V.IdentityTrait({name:"orange cake",aliases:["orange","orange colored cake","cake"],description:"A small orange-colored cake. It looks delicious.",properName:!1,article:"an",weight:5})),a.isEdible=!0,t.moveEntity(a.id,e)}function gEe(t,e){let r=t.createEntity("robot",V.EntityType.ACTOR);return r.add(new V.IdentityTrait({name:"robot",aliases:["robot","mechanical man","machine","mechanical device"],description:"A metallic robot with a hinged panel on its chest. It appears to be waiting for instructions.",properName:!1,article:"a"})),r.add(new V.ActorTrait({isPlayer:!1})),r.add(new V.NpcTrait({behaviorId:"robot",isHostile:!1,canMove:!0,customProperties:{following:!1,buttonPushed:!1,homeRoomId:e}})),t.moveEntity(r.id,e),r}function hEe(t,e){let r=t.createEntity("triangular button",V.EntityType.ITEM);return r.add(new V.IdentityTrait({name:"triangular button",aliases:["button","small button","triangle button"],description:"A small triangular button set into the wall. It is too small for your finger to push.",properName:!1,article:"a"})),r.add(new V.SceneryTrait),r.isPushed=!1,t.moveEntity(r.id,e),r}function yEe(t,e){let r=t.createEntity("metal cage",V.EntityType.ITEM);r.add(new V.IdentityTrait({name:"metal cage",aliases:["cage","iron cage","wire cage"],description:"A strange wire cage with bars too close together to reach through. Something glows beneath it.",properName:!1,article:"a"})),r.add(new V.SceneryTrait),r.isLifted=!1,t.moveEntity(r.id,e);let n=t.createEntity("white crystal sphere",V.EntityType.ITEM);n.add(new V.IdentityTrait({name:"white crystal sphere",aliases:["sphere","crystal sphere","white sphere","crystal ball","crystal"],description:"A perfectly smooth sphere of white crystal. It glows with an inner light.",properName:!1,article:"a",weight:5})),n.isTreasure=!0,n.treasureId="white-crystal-sphere",n.treasureValue=6,n.trophyCaseValue=6,t.moveEntity(n.id,e)}var de=S(b());function JQ(t){let e=t.createEntity("Round Room",de.EntityType.ROOM);return e.add(new de.RoomTrait({exits:{},isDark:!0,isOutdoors:!1})),e.add(new de.IdentityTrait({name:"Round Room",aliases:["round room","circular room"],description:"You are in a circular room with passages off in eight directions.",properName:!0,article:"the"})),e.isFixed=!1,{roundRoom:e.id}}function e6(t,e){let r=t.createEntity("steel box",de.EntityType.ITEM);r.add(new de.IdentityTrait({name:"steel box",aliases:["box","steel box","dented box","dented steel box"],description:"A dented steel box. It appears to have survived quite a fall.",properName:!1,article:"a",weight:40})),r.add(new de.ContainerTrait({capacity:{maxItems:5}})),r.add(new de.OpenableTrait({isOpen:!1})),t.moveEntity(r.id,e.roundRoom);let n=t.createEntity("violin",de.EntityType.ITEM);n.add(new de.IdentityTrait({name:"violin",aliases:["violin","stradivarius","strad","fancy violin"],description:"A Stradivarius! This exquisite instrument is in perfect condition despite its surroundings. It must be worth a fortune.",properName:!1,article:"a",weight:10})),n.isTreasure=!0,n.treasureId="stradivarius",n.treasureValue=10,n.trophyCaseValue=10,new de.AuthorModel(t.getDataStore(),t).moveEntity(n.id,r.id)}function t6(t,e,r){let n=t.getEntity(e.roundRoom),i=t.getEntity(r);n&&i&&(n.get(de.RoomTrait).exits[de.Direction.WEST]={destination:r},i.get(de.RoomTrait).exits[de.Direction.EAST]={destination:e.roundRoom})}function r6(t,e,r){let n=t.getEntity(e.roundRoom);if(n){let s=n.get(de.RoomTrait);s.exits[de.Direction.NORTHEAST]={destination:r.northSouthPassage},s.exits[de.Direction.EAST]={destination:r.grailRoom},s.exits[de.Direction.SOUTHEAST]={destination:r.windingPassage}}let i=t.getEntity(r.northSouthPassage);i&&(i.get(de.RoomTrait).exits[de.Direction.SOUTHWEST]={destination:e.roundRoom});let o=t.getEntity(r.grailRoom);o&&(o.get(de.RoomTrait).exits[de.Direction.WEST]={destination:e.roundRoom});let a=t.getEntity(r.windingPassage);a&&(a.get(de.RoomTrait).exits[de.Direction.NORTHWEST]={destination:e.roundRoom})}function n6(t,e,r){let n=t.getEntity(e.roundRoom),i=t.getEntity(r);if(n){let o=n.get(de.RoomTrait);o.exits[de.Direction.SOUTH]={destination:r},o.exits[de.Direction.NORTH]={destination:r}}i&&(i.get(de.RoomTrait).exits[de.Direction.NORTH]={destination:e.roundRoom})}function i6(t,e,r){let n=t.getEntity(e.roundRoom),i=t.getEntity(r);n&&(n.get(de.RoomTrait).exits[de.Direction.NORTHWEST]={destination:r}),i&&(i.get(de.RoomTrait).exits[de.Direction.SOUTHEAST]={destination:e.roundRoom})}function o6(t,e,r){let n=t.getEntity(e.roundRoom),i=t.getEntity(r);n&&(n.get(de.RoomTrait).exits[de.Direction.SOUTHWEST]={destination:r}),i&&(i.get(de.RoomTrait).exits[de.Direction.NORTHEAST]={destination:e.roundRoom})}var L=S(b());function mf(t,e,r,n=!1,i=!0){let o=t.createEntity(e,L.EntityType.ROOM);return o.add(new L.RoomTrait({exits:{},isDark:n,isOutdoors:i})),o.add(new L.IdentityTrait({name:e,description:r,properName:!0,article:"the"})),o}function kn(t,e){let r=t.get(L.RoomTrait);if(r)for(let[n,i]of Object.entries(e))r.exits[n]={destination:i}}function a6(t){let e=t.createEntity("Frigid River-1",L.EntityType.ROOM);e.add(new L.RoomTrait({exits:{},isDark:!1,isOutdoors:!0})),e.add(new L.IdentityTrait({name:"Frigid River",aliases:["frigid river","river"],description:"You are on the Frigid River in the vicinity of the dam. The river flows quietly here. There is a landing on the west shore.",properName:!0,article:"the"})),e.isWaterRoom=!0,e.riverPosition=1;let r=t.createEntity("Frigid River-2",L.EntityType.ROOM);r.add(new L.RoomTrait({exits:{},isDark:!1,isOutdoors:!0})),r.add(new L.IdentityTrait({name:"Frigid River",aliases:["frigid river","river"],description:"The river turns a corner here making it impossible to see the dam. The White Cliffs loom on the east bank, and large rocks prevent landing on the west.",properName:!0,article:"the"})),r.isWaterRoom=!0,r.riverPosition=2;let n=t.createEntity("Frigid River-3",L.EntityType.ROOM);n.add(new L.RoomTrait({exits:{},isDark:!1,isOutdoors:!0})),n.add(new L.IdentityTrait({name:"Frigid River",aliases:["frigid river","river"],description:"The river descends here into a valley. There is a narrow beach on the east below the cliffs, and there is some shore on the west which may be suitable. In the distance a faint rumbling can be heard.",properName:!0,article:"the"})),n.isWaterRoom=!0,n.riverPosition=3;let i=t.createEntity("Frigid River-4",L.EntityType.ROOM);i.add(new L.RoomTrait({exits:{},isDark:!1,isOutdoors:!0})),i.add(new L.IdentityTrait({name:"Frigid River",aliases:["frigid river","river"],description:"The river is running faster here, and the sound ahead appears to be that of rushing water. On the west shore is a sandy beach. A small area of beach can also be seen below the cliffs.",properName:!0,article:"the"})),i.isWaterRoom=!0,i.riverPosition=4;let o=t.createEntity("Frigid River-5",L.EntityType.ROOM);o.add(new L.RoomTrait({exits:{},isDark:!1,isOutdoors:!0})),o.add(new L.IdentityTrait({name:"Frigid River",aliases:["frigid river","river"],description:"The sound of rushing water is nearly unbearable here. On the west shore is a large landing area.",properName:!0,article:"the"})),o.isWaterRoom=!0,o.riverPosition=5,o.isLastBeforeFalls=!0;let a=mf(t,"Rocky Shore","This is the west shore of the river. An entrance to a cave is to the northwest. The shore is very rocky here.");a.canLaunchBoat=!0;let s=mf(t,"Small Cave","This is a small cave whose exits are on the south and northwest.",!0,!1),c=mf(t,"White Cliffs Beach","This is a rocky, narrow strip of beach beside the cliffs. A narrow path leads north along the shore.");c.canLaunchBoat=!0;let l=t.createEntity("White Cliffs Beach-2",L.EntityType.ROOM);l.add(new L.RoomTrait({exits:{},isDark:!1,isOutdoors:!0})),l.add(new L.IdentityTrait({name:"White Cliffs Beach",aliases:["white cliffs beach","beach","cliffs beach"],description:"This is a narrow strip of beach which runs along the base of the White Cliffs. The only path here is a narrow one, heading south along the cliffs.",properName:!0,article:""})),l.canLaunchBoat=!0;let u=mf(t,"Sandy Beach","This is a large sandy beach at the shore of the river, which is flowing quickly by. A path runs beside the river to the south here.");u.canLaunchBoat=!0;let m=mf(t,"Shore","This is the shore of the river. The river here seems somewhat treacherous. A path travels from north to south here, the south end quickly turning around a sharp corner.");m.canLaunchBoat=!0;let f=t.createEntity("Aragain Falls",L.EntityType.ROOM);f.add(new L.RoomTrait({exits:{},isDark:!1,isOutdoors:!0,blockedExits:{[L.Direction.EAST]:"The rainbow is beautiful, but it looks far too insubstantial to walk on."}})),f.add(new L.IdentityTrait({name:"Aragain Falls",aliases:["aragain falls","falls","waterfall"],description:"You are at the top of Aragain Falls, an enormous waterfall with a drop of about 450 feet. The only path here is on the north end.",properName:!0,article:""}));let g=t.createEntity("On the Rainbow",L.EntityType.ROOM);g.add(new L.RoomTrait({exits:{},isDark:!1,isOutdoors:!0})),g.add(new L.IdentityTrait({name:"On the Rainbow",aliases:["on the rainbow","rainbow"],description:"You are on top of a rainbow (I bet you never thought you would walk on a rainbow), with a magnificent view of the falls. The rainbow travels east-west here.",properName:!0,article:""})),g.isRainbowRoom=!0;let h=mf(t,"End of Rainbow","You are on a small, rocky beach on the continuation of the Frigid River past the falls. The beach is narrow due to the presence of the White Cliffs. The river canyon opens here, and sunlight shines in from above. A rainbow crosses over the falls to the west, and a narrow path continues to the southeast.");return h.isRainbowRoom=!0,kn(e,{[L.Direction.DOWN]:r.id}),kn(r,{[L.Direction.DOWN]:n.id}),kn(n,{[L.Direction.DOWN]:i.id,[L.Direction.WEST]:a.id,[L.Direction.EAST]:c.id}),kn(i,{[L.Direction.DOWN]:o.id,[L.Direction.WEST]:u.id,[L.Direction.EAST]:l.id}),kn(o,{[L.Direction.WEST]:m.id}),kn(a,{[L.Direction.NORTHWEST]:s.id,[L.Direction.EAST]:n.id}),kn(s,{[L.Direction.SOUTH]:a.id}),kn(c,{[L.Direction.WEST]:n.id,[L.Direction.SOUTH]:l.id}),kn(l,{[L.Direction.WEST]:i.id,[L.Direction.NORTH]:c.id}),kn(u,{[L.Direction.EAST]:i.id,[L.Direction.SOUTH]:m.id}),kn(m,{[L.Direction.NORTH]:u.id,[L.Direction.SOUTH]:f.id,[L.Direction.EAST]:o.id}),kn(f,{[L.Direction.NORTH]:m.id}),kn(g,{[L.Direction.WEST]:f.id,[L.Direction.EAST]:h.id}),kn(h,{[L.Direction.WEST]:g.id}),{frigidRiver1:e.id,frigidRiver2:r.id,frigidRiver3:n.id,frigidRiver4:i.id,frigidRiver5:o.id,rockyShore:a.id,whiteCliffsBeach1:c.id,whiteCliffsBeach2:l.id,sandyBeach:u.id,shore:m.id,aragainFalls:f.id,onTheRainbow:g.id,endOfRainbow:h.id,smallCave:s.id}}function s6(t,e,r){let n=t.getEntity(r);n&&(n.canLaunchBoat=!0,n.launchDestination=e.frigidRiver1)}function c6(t,e,r){let n=t.getEntity(e.endOfRainbow);n&&(n.get(L.RoomTrait).exits[L.Direction.SOUTHEAST]={destination:r});let i=t.getEntity(r);i&&(i.get(L.RoomTrait).exits[L.Direction.NORTH]={destination:e.endOfRainbow})}function l6(t,e){vEe(t,e.endOfRainbow),EEe(t,e.frigidRiver2),TEe(t,e.sandyBeach),_Ee(t,e.smallCave),bEe(t,e.aragainFalls),OEe(t,e.aragainFalls),Hx(t,e.rockyShore),Hx(t,e.sandyBeach),Hx(t,e.shore)}function vEe(t,e){let r=t.createEntity("pot of gold",L.EntityType.ITEM);return r.add(new L.IdentityTrait({name:"pot of gold",aliases:["pot","gold","gold coins","treasure pot"],description:"A small iron pot filled to the brim with gold coins. It is surprisingly heavy for its size.",properName:!1,article:"a",weight:5})),r.isTreasure=!0,r.treasureId="pot-of-gold",r.treasureValue=10,r.trophyCaseValue=10,t.moveEntity(r.id,e),r}function EEe(t,e){let r=t.createEntity("buoy",L.EntityType.ITEM);r.add(new L.IdentityTrait({name:"red buoy",aliases:["buoy","red buoy","floating buoy","warning buoy"],description:"There is a red buoy here (probably a warning).",properName:!1,article:"a",weight:10})),r.add(new L.ContainerTrait({capacity:{maxItems:1,maxWeight:5}})),r.add(new L.OpenableTrait({isOpen:!1})),t.moveEntity(r.id,e);let n=t.createEntity("emerald",L.EntityType.ITEM);return n.add(new L.IdentityTrait({name:"large emerald",aliases:["emerald","green gem","large emerald","gem"],description:"A large emerald of exceptional clarity and color.",properName:!1,article:"a",weight:5})),n.isTreasure=!0,n.treasureId="buoy-emerald",n.treasureValue=5,n.trophyCaseValue=10,new L.AuthorModel(t.getDataStore(),t).moveEntity(n.id,r.id),r}function TEe(t,e){let r=t.createEntity("statue",L.EntityType.ITEM);return r.add(new L.IdentityTrait({name:"beautiful statue",aliases:["statue","sculpture","figure","figurine","small statue"],description:"A beautiful statue of an ancient adventurer, carved from a single piece of white marble. The craftsmanship is exquisite.",properName:!1,article:"a",weight:2})),r.isTreasure=!0,r.treasureId="statue",r.treasureValue=10,r.trophyCaseValue=13,r.isBuried=!0,r.isVisible=!1,t.setStateValue("dungeo.statue.locationId",e),r}function _Ee(t,e){let r=t.createEntity("shovel",L.EntityType.ITEM);r.add(new L.IdentityTrait({name:"shovel",aliases:["shovel","spade","large shovel"],description:"This is a large shovel, suitable for digging in sand or soft earth.",properName:!1,article:"a",weight:5})),t.moveEntity(r.id,e);let n=t.createEntity("guano",L.EntityType.ITEM);n.add(new L.IdentityTrait({name:"guano",aliases:["guano","bat guano","hunk of guano","bat droppings"],description:"There is a hunk of bat guano here.",properName:!1,article:"a",weight:5})),t.moveEntity(n.id,e)}function bEe(t,e){let r=t.createEntity("rainbow",L.EntityType.ITEM);return r.add(new L.IdentityTrait({name:"rainbow",aliases:["beautiful rainbow","arc"],description:"A beautiful rainbow can be seen over the falls and to the east.",properName:!1,article:"a"})),r.add(new L.SceneryTrait),r.isSolid=!1,t.moveEntity(r.id,e),r}function OEe(t,e){let r=t.createEntity("barrel",L.EntityType.ITEM);return r.add(new L.IdentityTrait({name:"barrel",aliases:["barrel","wooden barrel","man-sized barrel"],description:"There is a man-sized barrel here, which you might be able to enter.",properName:!1,article:"a"})),r.add(new L.ContainerTrait({capacity:{maxItems:1,maxWeight:200}})),t.moveEntity(r.id,e),r}function Hx(t,e){let r=t.createEntity("river-"+e,L.EntityType.ITEM);return r.add(new L.IdentityTrait({name:"Frigid River",aliases:["river","water","frigid river","stream"],description:"The Frigid River flows swiftly past, its icy waters dark and cold.",properName:!0,article:"the"})),r.add(new L.SceneryTrait),r.isWaterBody=!0,r.attributes.displayName="Frigid River",t.moveEntity(r.id,e),r}var C=S(b());function Ux(t,e,r,n=[]){let i=t.createEntity(e,C.EntityType.ROOM);return i.add(new C.RoomTrait({exits:{},isDark:!0,isOutdoors:!1})),i.add(new C.IdentityTrait({name:e,aliases:n,description:r,properName:!0,article:"the"})),i}function Jr(t,e){let r=t.createEntity("Maze",C.EntityType.ROOM);return r.add(new C.RoomTrait({exits:{},isDark:!0,isOutdoors:!1})),r.add(new C.IdentityTrait({name:"Maze",aliases:["maze",`maze ${e}`,`maze${e}`],description:"You are in a maze of twisty little passages, all alike.",properName:!1,article:"the"})),r}function HS(t,e){let r=t.createEntity(`Dead End ${e}`,C.EntityType.ROOM);return r.add(new C.RoomTrait({exits:{},isDark:!0,isOutdoors:!1})),r.add(new C.IdentityTrait({name:"Dead End",aliases:["dead end",`dead end ${e}`,`deadend${e}`],description:"You have come to a dead end in the maze.",properName:!0,article:"the"})),r}function yt(t,e){let r=t.get(C.RoomTrait);if(r)for(let[n,i]of Object.entries(e))r.exits[n]={destination:i}}function u6(t){let e=Ux(t,"Grating Room","You are in a small room near the surface. A metal grating in the ceiling leads upward.",["grating room","small room","room near surface"]),r=Jr(t,1),n=Jr(t,2),i=Jr(t,3),o=Jr(t,4),a=Jr(t,5),s=Jr(t,6),c=Jr(t,7),l=Jr(t,8),u=Jr(t,9),m=Jr(t,10),f=Jr(t,11),g=Jr(t,12),h=Jr(t,13),y=Jr(t,14),_=Jr(t,15),v=HS(t,1),E=HS(t,2),T=HS(t,3),O=HS(t,4),R=Ux(t,"Cyclops Room","This room has an exit on the northwest, and a staircase leading up.",["cyclops room"]),I=Ux(t,"Treasure Room","This is a large room, whose north wall is solid marble. A doorway leads south, and a narrow chimney leads up.",["treasure room","thief lair","thiefs lair"]),w={gratingRoom:e.id,maze1:r.id,maze2:n.id,maze3:i.id,maze4:o.id,maze5:a.id,maze6:s.id,maze7:c.id,maze8:l.id,maze9:u.id,maze10:m.id,maze11:f.id,maze12:g.id,maze13:h.id,maze14:y.id,maze15:_.id,deadEnd1:v.id,deadEnd2:E.id,deadEnd3:T.id,deadEnd4:O.id,cyclopsRoom:R.id,treasureRoom:I.id};return IEe(t,w),w}function IEe(t,e){let r=t.getEntity(e.maze1);r&&yt(r,{[C.Direction.NORTH]:e.maze1,[C.Direction.SOUTH]:e.maze2,[C.Direction.EAST]:e.maze4});let n=t.getEntity(e.maze2);n&&yt(n,{[C.Direction.SOUTH]:e.maze1,[C.Direction.NORTH]:e.maze4,[C.Direction.EAST]:e.maze3});let i=t.getEntity(e.maze3);i&&yt(i,{[C.Direction.WEST]:e.maze2,[C.Direction.NORTH]:e.maze4,[C.Direction.UP]:e.maze5});let o=t.getEntity(e.maze4);o&&yt(o,{[C.Direction.WEST]:e.maze3,[C.Direction.NORTH]:e.maze1,[C.Direction.EAST]:e.deadEnd1});let a=t.getEntity(e.maze5);a&&yt(a,{[C.Direction.EAST]:e.deadEnd2,[C.Direction.NORTH]:e.maze3,[C.Direction.SOUTHWEST]:e.maze6});let s=t.getEntity(e.maze6);s&&yt(s,{[C.Direction.DOWN]:e.maze5,[C.Direction.EAST]:e.maze7,[C.Direction.WEST]:e.maze6,[C.Direction.UP]:e.maze9});let c=t.getEntity(e.maze7);c&&yt(c,{[C.Direction.UP]:e.maze14,[C.Direction.WEST]:e.maze6,[C.Direction.NORTHEAST]:e.deadEnd1,[C.Direction.EAST]:e.maze8,[C.Direction.SOUTH]:e.maze15});let l=t.getEntity(e.maze8);l&&yt(l,{[C.Direction.NORTHEAST]:e.maze7,[C.Direction.WEST]:e.maze8,[C.Direction.SOUTHEAST]:e.deadEnd3});let u=t.getEntity(e.maze9);u&&yt(u,{[C.Direction.NORTH]:e.maze6,[C.Direction.EAST]:e.maze11,[C.Direction.DOWN]:e.maze10,[C.Direction.SOUTH]:e.maze13,[C.Direction.WEST]:e.maze12,[C.Direction.NORTHWEST]:e.maze9});let m=t.getEntity(e.maze10);m&&yt(m,{[C.Direction.EAST]:e.maze9,[C.Direction.WEST]:e.maze13,[C.Direction.UP]:e.maze11});let f=t.getEntity(e.maze11);f&&yt(f,{[C.Direction.NORTHEAST]:e.gratingRoom,[C.Direction.DOWN]:e.maze10,[C.Direction.NORTHWEST]:e.maze13,[C.Direction.SOUTHWEST]:e.maze12});let g=t.getEntity(e.maze12);g&&yt(g,{[C.Direction.WEST]:e.maze5,[C.Direction.SOUTHWEST]:e.maze11,[C.Direction.EAST]:e.maze13,[C.Direction.UP]:e.maze9,[C.Direction.NORTH]:e.deadEnd4});let h=t.getEntity(e.maze13);h&&yt(h,{[C.Direction.EAST]:e.maze9,[C.Direction.DOWN]:e.maze12,[C.Direction.SOUTH]:e.maze10,[C.Direction.WEST]:e.maze11});let y=t.getEntity(e.maze14);y&&yt(y,{[C.Direction.WEST]:e.maze15,[C.Direction.NORTHWEST]:e.maze14,[C.Direction.NORTHEAST]:e.maze7,[C.Direction.SOUTH]:e.maze7});let _=t.getEntity(e.maze15);_&&yt(_,{[C.Direction.WEST]:e.maze14,[C.Direction.SOUTH]:e.maze7,[C.Direction.NORTHEAST]:e.cyclopsRoom});let v=t.getEntity(e.deadEnd1);v&&yt(v,{[C.Direction.SOUTH]:e.maze4});let E=t.getEntity(e.deadEnd2);E&&yt(E,{[C.Direction.WEST]:e.maze5});let T=t.getEntity(e.deadEnd3);T&&yt(T,{[C.Direction.NORTH]:e.maze8});let O=t.getEntity(e.deadEnd4);O&&yt(O,{[C.Direction.SOUTH]:e.maze12});let R=t.getEntity(e.gratingRoom);R&&yt(R,{[C.Direction.SOUTHWEST]:e.maze11});let I=t.getEntity(e.cyclopsRoom);I&&yt(I,{[C.Direction.WEST]:e.maze15,[C.Direction.UP]:e.treasureRoom});let w=t.getEntity(e.treasureRoom);w&&yt(w,{[C.Direction.DOWN]:e.cyclopsRoom})}function d6(t,e,r){let n=t.getEntity(e.gratingRoom);if(n){let o=n.get(C.RoomTrait);o&&(o.exits[C.Direction.UP]={destination:r})}let i=t.getEntity(r);if(i){let o=i.get(C.RoomTrait);o&&(o.exits[C.Direction.DOWN]={destination:e.gratingRoom})}}function m6(t,e,r){let n=t.getEntity(e.cyclopsRoom);if(n){let i=n.get(C.RoomTrait);i&&(i.exits[C.Direction.NORTH]={destination:r})}}function f6(t,e,r){let n=t.getEntity(e.maze1);if(n){let o=n.get(C.RoomTrait);o&&(o.exits[C.Direction.WEST]={destination:r})}let i=t.getEntity(r);if(i){let o=i.get(C.RoomTrait);o&&(o.exits[C.Direction.SOUTH]={destination:e.maze1})}}function p6(t,e,r){let n=t.getEntity(r);if(n){let o=n.get(C.RoomTrait);o&&(o.exits[C.Direction.SOUTHWEST]={destination:e.maze1})}let i=t.getEntity(e.maze1);if(i){let o=i.get(C.RoomTrait);o&&(o.exits[C.Direction.NORTHEAST]={destination:r})}}function g6(t,e){SEe(t,e.gratingRoom),AEe(t,e.maze5),e.treasureRoom}function SEe(t,e){let r=t.createEntity("metal grating",C.EntityType.SCENERY);r.add(new C.IdentityTrait({name:"metal grating",aliases:["grating","grate","metal grate","iron grating"],description:"A metal grating is set into the ceiling, leading up to the surface. It appears to be locked.",properName:!1,article:"a"})),r.add(new C.SceneryTrait),r.add(new C.OpenableTrait({isOpen:!1})),r.add(new C.LockableTrait({startsLocked:!0,isLocked:!0})),t.moveEntity(r.id,e)}function AEe(t,e){let r=t.createEntity("skeleton",C.EntityType.SCENERY);r.add(new C.IdentityTrait({name:"skeleton",aliases:["skeleton","bones","remains","adventurer skeleton","dead adventurer"],description:"A skeleton lies here, the remains of some unfortunate adventurer who lost their way in this maze long ago.",properName:!1,article:"a"})),r.add(new C.SceneryTrait),t.moveEntity(r.id,e);let n=t.createEntity("bag of coins",C.EntityType.CONTAINER);n.add(new C.IdentityTrait({name:"leather bag of coins",aliases:["bag","leather bag","bag of coins","coins","coin bag"],description:"A leather bag containing a quantity of coins of various denominations.",properName:!1,article:"a",weight:5})),n.add(new C.ContainerTrait({capacity:{maxItems:10}})),n.isTreasure=!0,n.treasureId="bag-of-coins",n.treasureValue=10,n.trophyCaseValue=5,t.moveEntity(n.id,e);let i=t.createEntity("skeleton key",C.EntityType.ITEM);i.add(new C.IdentityTrait({name:"skeleton key",aliases:["key","skeleton key","rusty key","old key"],description:"An old skeleton key, probably dropped by the unfortunate adventurer whose remains lie nearby.",properName:!1,article:"a",weight:25})),i.unlocksId="metal grating",t.moveEntity(i.id,e);let o=t.createEntity("rusty knife",C.EntityType.ITEM);o.add(new C.IdentityTrait({name:"rusty knife",aliases:["knife","rusty knife","old knife"],description:"A rusty knife. It is almost totally rusted and quite useless as a weapon.",properName:!1,article:"a",weight:10})),t.moveEntity(o.id,e);let a=G5(t);t.moveEntity(a.id,e)}var F=S(b()),REe="dungeo.exorcism.spirits_block";function ba(t,e,r,n=!1){let i=t.createEntity(e,F.EntityType.ROOM);return i.add(new F.RoomTrait({exits:{},isDark:n,isOutdoors:!1})),i.add(new F.IdentityTrait({name:e,description:r,properName:!1,article:"the"})),i}function Oa(t,e){let r=t.get(F.RoomTrait);if(r)for(let[n,i]of Object.entries(e))r.exits[n]={destination:i}}function h6(t){let e=ba(t,"Top of Stairs","This is a room with an exit on the west side, and a staircase leading up."),r=ba(t,"Stone Room","This is a small stone room with passages leading north and south. Set into one wall is a stone button."),n=ba(t,"Small Room","This is a small room, with narrow passages exiting to the north and south. A narrow red beam of light crosses the room at the north end, inches above the floor.");t.setStateValue("endgame.laserBeamActive",!0);let i=ba(t,"Hallway",`This is part of the long hallway. The east and west walls are dressed stone. In the center of the hall is a shallow stone channel. In the center of the room the channel widens into a large hole around which is engraved a compass rose. Sitting in the center of the room is a strange wooden structure.

Identical stone statues face each other from pedestals on opposite sides of the corridor. The statues represent Guardians of Zork, a military order of ancient lineage. They are portrayed as heavily armored warriors standing at ease, hands clasped around formidable bludgeons.`),o=ba(t,"Inside Mirror",`You are inside a rectangular box of wood whose structure is rather complicated. Four sides and the roof are filled in, and the floor is open.

As you face the side opposite the entrance, two short sides of carved and polished wood are to your left and right. The left panel is mahogany, the right pine. The wall you face is red on its left half and black on its right. On the entrance side, the wall is white opposite the red part of the wall it faces, and yellow opposite the black section. The painted walls are at least twice the length of the unpainted ones. The ceiling is painted blue.

In the floor is a stone channel about six inches wide and a foot deep. The channel is oriented in a north-south direction. In the exact center of the room the channel widens into a circular depression perhaps two feet wide. Incised in the stone around this area is a compass rose.

Running from one short wall to the other at about waist height is a wooden bar, carefully carved and drilled. This bar is pierced in two places. Through each hole runs a wooden pole.`);t.setStateValue("insideMirror.direction",0),t.setStateValue("insideMirror.position",0),t.setStateValue("insideMirror.poleState",1);let a=ba(t,"Dungeon Entrance","This is a north-south hallway which ends in a large wooden door. The wooden door has a barred panel in it at about head height.");t.setStateValue("trivia.questionsAnswered",0),t.setStateValue("trivia.wrongAttempts",0),t.setStateValue("trivia.currentQuestion",-1);let s=ba(t,"Narrow Corridor","This is a narrow north-south corridor. At the south end is a door and at the north end is an east-west corridor.");s.awardsPointsOnEntry=20;let c=ba(t,"East-West Corridor","This is a large east-west corridor which opens out to a northern parapet at its center. You can see flames and smoke as you peer towards the parapet. The corridor turns south at its east and west ends, and due south is a massive wooden door. In the door is a small window barred with iron."),l=ba(t,"Parapet",`You are standing behind a stone retaining wall which rims a large parapet overlooking a fiery pit. It is difficult to see through the smoke and flame which fills the pit, but it seems to be more or less bottomless. It also extends upwards out of sight. The pit itself is of roughly dressed stone and is circular in shape. It is about two hundred feet in diameter. The flames generate considerable heat, so it is rather uncomfortable standing here.

There is an object here which looks like a sundial. On it are an indicator arrow and (in the center) a large button. On the face of the dial are numbers "one" through "eight".`);t.setStateValue("parapet.dialSetting",1);let u=ba(t,"Prison Cell","This is a featureless prison cell. You can see only the flames and smoke of the pit out of the small window in a closed wooden door in front of you.");t.setStateValue("prisonCell.currentCell",null),t.setStateValue("prisonCell.bronzeDoorVisible",!1);let m=t.createEntity("Treasury of Zork",F.EntityType.ROOM);m.add(new F.RoomTrait({exits:{},isDark:!1,isOutdoors:!1})),m.add(new F.IdentityTrait({name:"Treasury of Zork",aliases:["treasury","treasury of zork"],description:"This is the Treasury of Zork. You have reached the end of your journey! Untold riches surround you - gold, gems, and artifacts beyond measure.",properName:!0,article:"the"})),m.isVictoryRoom=!0,m.awardsPointsOnEntry=35;let f=t.createEntity("Entrance to Hades",F.EntityType.ROOM);f.add(new F.RoomTrait({exits:{},isDark:!0,isOutdoors:!1,blockedExits:{[F.Direction.EAST]:REe}})),f.add(new F.IdentityTrait({name:"Entrance to Hades",aliases:["entrance to hades","hades entrance","gates of hades"],description:"You are at the entrance to Hades, the land of the dead. An eerie mist swirls around you. Ghostly figures seem to hover in the air, blocking passage to the east. A corridor leads north.",properName:!0,article:"the"})),f.spiritsBlocking=!0;let g=t.createEntity("Land of the Dead",F.EntityType.ROOM);g.add(new F.RoomTrait({exits:{},isDark:!0,isOutdoors:!1})),g.add(new F.IdentityTrait({name:"Land of the Dead",aliases:["land of dead","land of the dead","hades"],description:"You have entered the Land of the Dead. The air is cold and still. Ghostly shapes drift silently in the darkness. This is not a place for the living. A faint glow emanates from the north.",properName:!0,article:"the"}));let h=t.createEntity("Tomb of the Unknown Implementer",F.EntityType.ROOM);return h.add(new F.RoomTrait({exits:{},isDark:!0,isOutdoors:!1})),h.add(new F.IdentityTrait({name:"Tomb of the Unknown Implementer",aliases:["tomb","tomb of unknown implementer","tomb of the unknown implementer"],description:`This is the Tomb of the Unknown Implementer. A hollow voice says, "That's not a bug, it's a feature!" In the north wall of the room is the Crypt of the Implementers. It is made of the finest marble and is apparently large enough for four headless corpses. Above the entrance is the cryptic inscription: "Feel Free". To the south is a small opening, apparently of recent origin.`,properName:!0,article:"the"})),Oa(e,{[F.Direction.WEST]:r.id}),Oa(r,{[F.Direction.EAST]:e.id,[F.Direction.SOUTH]:n.id}),Oa(n,{[F.Direction.NORTH]:r.id,[F.Direction.SOUTH]:i.id}),Oa(i,{[F.Direction.NORTH]:n.id,[F.Direction.SOUTH]:a.id,[F.Direction.IN]:o.id}),Oa(s,{[F.Direction.SOUTH]:a.id,[F.Direction.NORTH]:c.id}),Oa(c,{[F.Direction.SOUTH]:s.id,[F.Direction.NORTH]:l.id}),Oa(l,{[F.Direction.SOUTH]:c.id}),Oa(f,{[F.Direction.EAST]:g.id}),Oa(g,{[F.Direction.WEST]:f.id,[F.Direction.EAST]:h.id}),Oa(h,{[F.Direction.WEST]:g.id}),t.setStateValue("endgame.topOfStairsId",e.id),t.setStateValue("endgame.insideMirrorId",o.id),{topOfStairs:e.id,stoneRoom:r.id,smallRoom:n.id,hallway:i.id,insideMirror:o.id,dungeonEntrance:a.id,narrowCorridor:s.id,eastWestCorridor:c.id,parapet:l.id,prisonCell:u.id,treasury:m.id,entryToHades:f.id,landOfDead:g.id,tomb:h.id}}function y6(t,e){wEe(t,e.smallRoom),CEe(t,e.stoneRoom),NEe(t,e.parapet),DEe(t,e.parapet),PEe(t,e.insideMirror),LEe(t,e.insideMirror),MEe(t,e.insideMirror),kEe(t,e.insideMirror),xEe(t,e.insideMirror),BEe(t,e.insideMirror),jEe(t,e.prisonCell)}function wEe(t,e){let r=t.createEntity("laser beam",F.EntityType.SCENERY);return r.add(new F.IdentityTrait({name:"laser beam",aliases:["beam","red beam","light beam","narrow beam","beam of light"],description:"A narrow red beam of light crosses the room at the north end, inches above the floor.",article:"a"})),r.add(new F.SceneryTrait),t.moveEntity(r.id,e),r.isLaserBeam=!0,r}function CEe(t,e){let r=t.createEntity("stone button",F.EntityType.OBJECT);return r.add(new F.IdentityTrait({name:"stone button",aliases:["button","stone button"],description:"A stone button is set into the wall. It looks like it can be pushed.",article:"a"})),r.add(new F.SceneryTrait),t.moveEntity(r.id,e),r.isPushable=!0,r.buttonType="stone",r}function NEe(t,e){let r=t.createEntity("sundial",F.EntityType.OBJECT);return r.add(new F.IdentityTrait({name:"sundial",aliases:["sundial","dial","sun dial"],description:'An object that looks like a sundial. On it are an indicator arrow and (in the center) a large button. On the face of the dial are numbers "one" through "eight".',article:"a"})),r.add(new F.SceneryTrait),t.moveEntity(r.id,e),r.isDial=!0,r}function DEe(t,e){let r=t.createEntity("dial button",F.EntityType.OBJECT);return r.add(new F.IdentityTrait({name:"button",aliases:["button","dial button","large button"],description:"A large button in the center of the dial.",article:"a"})),r.add(new F.SceneryTrait),t.moveEntity(r.id,e),r.isPushable=!0,r.buttonType="dial",r}function PEe(t,e){let r=t.createEntity("short pole",F.EntityType.OBJECT);return r.add(new F.IdentityTrait({name:"short pole",aliases:["short pole","pole","left pole"],description:"The pole at the left end of the bar is short, extending about a foot above the bar, and ends in a hand grip.",article:"a"})),r.add(new F.SceneryTrait),t.moveEntity(r.id,e),r.isPole=!0,r.poleType="short",r}function LEe(t,e){let r=t.createEntity("long pole",F.EntityType.OBJECT);return r.add(new F.IdentityTrait({name:"long pole",aliases:["long pole","pole","center pole","t-bar"],description:"The long pole at the center of the bar extends from the ceiling through the bar to the circular area in the stone channel. The bottom end of this pole has a T-bar a bit less than two feet long attached to it. On the T-bar is carved an arrow.",article:"a"})),r.add(new F.SceneryTrait),t.moveEntity(r.id,e),r.isPole=!0,r.poleType="long",r}function MEe(t,e){let r=t.createEntity("mahogany panel",F.EntityType.OBJECT);return r.add(new F.IdentityTrait({name:"mahogany panel",aliases:["mahogany panel","mahogany wall","mahogany","left panel","left wall"],description:"The mahogany panel is smooth and well-polished. It forms one of the short walls of the structure.",article:"a"})),r.add(new F.SceneryTrait),t.moveEntity(r.id,e),r.isPanel=!0,r.panelType="mahogany",r}function kEe(t,e){let r=t.createEntity("pine panel",F.EntityType.OBJECT);return r.add(new F.IdentityTrait({name:"pine panel",aliases:["pine panel","pine wall","pine","right panel","right wall","pine door"],description:"The pine panel is sturdy but plain. It forms one of the short walls of the structure.",article:"a"})),r.add(new F.SceneryTrait),t.moveEntity(r.id,e),r.isPanel=!0,r.panelType="pine",r}function xEe(t,e){let r=t.createEntity("red panel",F.EntityType.OBJECT);return r.add(new F.IdentityTrait({name:"red panel",aliases:["red panel","red wall","red","red section"],description:"The red panel is painted a deep crimson. It forms part of the long wall opposite the entrance.",article:"a"})),r.add(new F.SceneryTrait),t.moveEntity(r.id,e),r.isPanel=!0,r.panelType="red",r}function BEe(t,e){let r=t.createEntity("yellow panel",F.EntityType.OBJECT);return r.add(new F.IdentityTrait({name:"yellow panel",aliases:["yellow panel","yellow wall","yellow","yellow section"],description:"The yellow panel is painted a bright gold color. It forms part of the wall on the entrance side.",article:"a"})),r.add(new F.SceneryTrait),t.moveEntity(r.id,e),r.isPanel=!0,r.panelType="yellow",r}function jEe(t,e){let r=t.createEntity("bronze door",F.EntityType.OBJECT);return r.add(new F.IdentityTrait({name:"bronze door",aliases:["bronze door","door"],description:"A heavy bronze door.",article:"a"})),r.add(new F.SceneryTrait),r.add(new F.OpenableTrait({isOpen:!1})),t.moveEntity(r.id,e),r.isTreasuryDoor=!0,r}var WEe="1.0.64-beta.20260124.0738",HEe="2026-01-24T07:38:03Z",UEe="0.9.56-beta.20260124.0738",qx={version:WEe,buildDate:HEe,engineVersion:UEe};function v6(t){t.define("gdt").mapsTo(oa).withPriority(200).build();let e=["da","ds","he","ex","nd","rd","nc","rc","nr","rr","nt","rt"],r=["dr","dx","do","de","dv","dc","dh","dl","df","dn","dm","dt","dp","d2","dz","ah","tk","ar","af","ac","aa","ax","av","an","az","pd","kl","ko","wu","fo"],n=["ao","pz","tq"];for(let i of e)t.define(i).mapsTo(Vr).withPriority(250).build();for(let i of r)t.define(i).mapsTo(Vr).withPriority(250).build(),t.define(`${i} :arg...`).mapsTo(Vr).withPriority(251).build();for(let i of n)t.define(i).mapsTo(Vr).withPriority(250).build(),t.define(`${i} :arg...`).mapsTo(Vr).withPriority(251).build()}function E6(t){t.define("say :arg").mapsTo(kt).withPriority(150).build(),t.define("say odysseus").mapsTo(kt).withPriority(155).build(),t.define("say ulysses").mapsTo(kt).withPriority(155).build(),t.define("echo").mapsTo(kt).withPriority(155).build(),t.define("ulysses").mapsTo(kt).withPriority(155).build(),t.define("odysseus").mapsTo(kt).withPriority(155).build(),t.define("xyzzy").mapsTo(kt).withPriority(155).build(),t.define("tell :npc to :command...").mapsTo(Fs).withPriority(150).build(),t.define("order :npc to :command...").mapsTo(Fs).withPriority(150).build(),t.define("talk to troll").mapsTo(Gs).withPriority(200).build(),t.define("talk to the troll").mapsTo(Gs).withPriority(200).build(),t.define("hello troll").mapsTo(Gs).withPriority(200).build(),t.define("knock").mapsTo(yl).withPriority(150).build(),t.define("knock on :target").mapsTo(yl).withPriority(155).build(),t.define("knock on door").mapsTo(yl).withPriority(160).build(),t.define("knock on the door").mapsTo(yl).withPriority(160).build(),t.define("knock door").mapsTo(yl).withPriority(155).build(),t.define("answer :text...").mapsTo(Ug).withPriority(150).build()}function T6(t){t.define("walk through :target").mapsTo(Ci).withPriority(150).build(),t.define("go through :target").mapsTo(Ci).withPriority(150).build(),t.define("pass through :target").mapsTo(Ci).withPriority(150).build(),t.define("walk through south wall").mapsTo(Ci).withPriority(155).build(),t.define("walk through north wall").mapsTo(Ci).withPriority(155).build(),t.define("go through south wall").mapsTo(Ci).withPriority(155).build(),t.define("go through north wall").mapsTo(Ci).withPriority(155).build(),t.define("push :direction wall").direction("direction").mapsTo(ju).withPriority(160).build(),t.define("push the :direction wall").direction("direction").mapsTo(ju).withPriority(160).build(),t.define("push red panel").mapsTo(wt).withPriority(170).build(),t.define("push red wall").mapsTo(wt).withPriority(170).build(),t.define("push red").mapsTo(wt).withPriority(170).build(),t.define("push yellow panel").mapsTo(wt).withPriority(170).build(),t.define("push yellow wall").mapsTo(wt).withPriority(170).build(),t.define("push yellow").mapsTo(wt).withPriority(170).build(),t.define("push mahogany panel").mapsTo(wt).withPriority(170).build(),t.define("push mahogany wall").mapsTo(wt).withPriority(170).build(),t.define("push mahogany").mapsTo(wt).withPriority(170).build(),t.define("push pine panel").mapsTo(wt).withPriority(170).build(),t.define("push pine wall").mapsTo(wt).withPriority(170).build(),t.define("push pine").mapsTo(wt).withPriority(170).build(),t.define("lift pole").mapsTo(Ms).withPriority(155).build(),t.define("raise pole").mapsTo(Ms).withPriority(155).build(),t.define("lift short pole").mapsTo(Ms).withPriority(156).build(),t.define("raise short pole").mapsTo(Ms).withPriority(156).build(),t.define("lower pole").mapsTo(Uu).withPriority(155).build(),t.define("lower short pole").mapsTo(Uu).withPriority(156).build(),t.define("set dial to :number").text("number").mapsTo(qu).withPriority(150).build(),t.define("turn dial to :number").text("number").mapsTo(qu).withPriority(150).build(),t.define("set indicator to :number").text("number").mapsTo(qu).withPriority(150).build(),t.define("turn indicator to :number").text("number").mapsTo(qu).withPriority(150).build(),t.define("push dial button").mapsTo(ks).withPriority(165).build(),t.define("press dial button").mapsTo(ks).withPriority(165).build(),t.define("push the dial button").mapsTo(ks).withPriority(165).build(),t.define("press the dial button").mapsTo(ks).withPriority(165).build(),t.define("push sundial button").mapsTo(ks).withPriority(165).build(),t.define("press sundial button").mapsTo(ks).withPriority(165).build(),t.define("press :target").mapsTo($u).withPriority(150).build(),t.define("turn bolt").mapsTo(Ws).withPriority(150).build(),t.define("turn the bolt").mapsTo(Ws).withPriority(150).build(),t.define("turn bolt with :instrument").instrument("instrument").mapsTo(Ws).withPriority(155).build(),t.define("turn switch").mapsTo(ki).withPriority(150).build(),t.define("turn the switch").mapsTo(ki).withPriority(150).build(),t.define("flip switch").mapsTo(ki).withPriority(150).build(),t.define("flip the switch").mapsTo(ki).withPriority(150).build(),t.define("activate machine").mapsTo(ki).withPriority(150).build(),t.define("activate the machine").mapsTo(ki).withPriority(150).build(),t.define("put :item under :target").mapsTo(_l).withPriority(160).build(),t.define("slide :item under :target").mapsTo(_l).withPriority(160).build(),t.define("put mat under door").mapsTo(_l).withPriority(165).build(),t.define("slide mat under door").mapsTo(_l).withPriority(165).build(),t.define("push key with :tool").mapsTo(ha).withPriority(160).build(),t.define("push key with screwdriver").mapsTo(ha).withPriority(165).build(),t.define("use :tool on keyhole").mapsTo(ha).withPriority(160).build(),t.define("use screwdriver on keyhole").mapsTo(ha).withPriority(165).build(),t.define("poke key with :tool").mapsTo(ha).withPriority(160).build(),t.define("push key through keyhole").mapsTo(ha).withPriority(165).build(),t.define("dig").mapsTo(xs).withPriority(150).build(),t.define("dig with :tool").mapsTo(xs).withPriority(155).build(),t.define("dig :target").mapsTo(xs).withPriority(150).build(),t.define("dig in :target").mapsTo(xs).withPriority(150).build(),t.define("send for brochure").mapsTo(pa).withPriority(150).build(),t.define("send for free brochure").mapsTo(pa).withPriority(155).build(),t.define("order brochure").mapsTo(pa).withPriority(150).build(),t.define("mail order").mapsTo(pa).withPriority(145).build()}function _6(t){t.define("ring :target").mapsTo(pl).withPriority(150).build(),t.define("ring bell").mapsTo(pl).withPriority(155).build(),t.define("ring the bell").mapsTo(pl).withPriority(155).build(),t.define("break :target").mapsTo(Wu).withPriority(150).build(),t.define("smash :target").mapsTo(Wu).withPriority(150).build(),t.define("burn :target").mapsTo(Hu).withPriority(150).build(),t.define("light :target").mapsTo(Hu).withPriority(145).build(),t.define("pray").mapsTo(hl).withPriority(150).build(),t.define("pray at :target").mapsTo(hl).withPriority(155).build(),t.define("pray to :target").mapsTo(hl).withPriority(155).build(),t.define("incant :challenge :response").text("challenge").text("response").mapsTo(jg).withPriority(200).build(),t.define("wave :target").mapsTo(Fu).withPriority(150).build(),t.define("wave :target at :location").mapsTo(Fu).withPriority(155).build(),t.define("wind :target").mapsTo(Gu).withPriority(150).build(),t.define("wind up :target").mapsTo(Gu).withPriority(155).build()}function b6(t){t.define("pour :target").mapsTo(er).withPriority(150).build(),t.define("pour water").mapsTo(er).withPriority(155).build(),t.define("pour water in :container").mapsTo(er).withPriority(160).build(),t.define("pour water into :container").mapsTo(er).withPriority(160).build(),t.define("pour :target in :container").mapsTo(er).withPriority(155).build(),t.define("pour :target into :container").mapsTo(er).withPriority(155).build(),t.define("fill :target").mapsTo(Or).withPriority(150).build(),t.define("fill bottle").mapsTo(Or).withPriority(155).build(),t.define("fill :target from :source").mapsTo(Or).withPriority(160).build(),t.define("fill bottle from bucket").mapsTo(Or).withPriority(165).build(),t.define("fill bottle with water").mapsTo(Or).withPriority(160).build(),t.define("light :object with :tool").mapsTo(Tl).withPriority(160).build(),t.define("set fire to :object with :tool").mapsTo(Tl).withPriority(160).build(),t.define("ignite :object with :tool").mapsTo(Tl).withPriority(160).build(),t.define("tie :object to :target").mapsTo(Bs).withPriority(150).build(),t.define("tie :object").mapsTo(Bs).withPriority(145).build(),t.define("fasten :object to :target").mapsTo(Bs).withPriority(150).build(),t.define("attach :object to :target").mapsTo(Bs).withPriority(150).build(),t.define("untie :object").mapsTo(js).withPriority(150).build(),t.define("untie :object from :target").mapsTo(js).withPriority(155).build(),t.define("unfasten :object").mapsTo(js).withPriority(150).build(),t.define("detach :object").mapsTo(js).withPriority(150).build()}var O6=S(b());function I6(t){t.define("inflate :target").mapsTo(Us).withPriority(150).build(),t.define("inflate :target with :tool").mapsTo(Us).withPriority(155).build(),t.define("pump :target").mapsTo(Us).withPriority(150).build(),t.define("pump up :target").mapsTo(Us).withPriority(155).build(),t.define("deflate :target").mapsTo(bl).withPriority(150).build(),t.define("open valve").mapsTo(bl).withPriority(155).build(),t.define("let air out of :target").mapsTo(bl).withPriority(155).build(),t.define("board :target").hasTrait("target",O6.TraitType.ENTERABLE).mapsTo("if.action.entering").withPriority(150).build(),t.define("disembark").mapsTo("if.action.exiting").withPriority(150).build(),t.define("leave boat").mapsTo("if.action.exiting").withPriority(150).build(),t.define("get out of boat").mapsTo("if.action.exiting").withPriority(155).build(),t.define("launch").mapsTo(Zu).withPriority(150).build()}function S6(t){t.define("diagnose").mapsTo(ed).withPriority(150).build(),t.define("room").mapsTo(td).withPriority(150).build(),t.define("rname").mapsTo(rd).withPriority(150).build(),t.define("objects").mapsTo(Al).withPriority(150).build(),t.define("object").mapsTo(Al).withPriority(150).build()}function A6(t){let e=t.getStoryGrammar();t.addPreposition("under"),t.addPreposition("beneath"),v6(e),E6(e),T6(e),_6(e),b6(e),I6(e),S6(e)}var ff=S(b());function R6(t){let e=t.get(ff.NpcTrait);return e?.customProperties?e.customProperties:null}function US(t){return R6(t)?.state==="FLED"}var Fx={id:"cyclops",name:"Cyclops Behavior",onTurn(t){return US(t.npc)?[]:t.playerVisible&&t.random.chance(.15)?[{type:"emote",messageId:Fe.GROWLS,data:{npcName:t.npc.name}}]:[]},onPlayerEnters(t){return US(t.npc)?[]:[{type:"emote",messageId:Fe.BLOCKS,data:{npcName:t.npc.name}}]},onSpokenTo(t,e){if(US(t.npc))return[];let r=e.toLowerCase();if(r.includes("odysseus")||r.includes("ulysses")){let i=R6(t.npc)?.roomId??t.npcLocation;return[{type:"emote",messageId:Fe.PANICS,data:{npcName:t.npc.name}},{type:"emote",messageId:Fe.FLEES,data:{npcName:t.npc.name}},{type:"custom",handler:()=>{let o=Bg(t.world,t.npc,i);return o.push({id:`cyclops-flee-${Date.now()}`,type:"game.message",entities:{},data:{messageId:Fe.PASSAGE_OPENS},timestamp:Date.now(),narrate:!0}),o}}]}return[{type:"emote",messageId:Fe.IGNORES,data:{npcName:t.npc.name}}]},onAttacked(t,e){if(US(t.npc))return[];let r=t.npc.get(ff.CombatantTrait);return r&&(r.hostile=!0),[{type:"emote",messageId:Fe.COUNTERATTACKS,data:{npcName:t.npc.name}},{type:"attack",target:e.id}]},getState(t){return t.get(ff.NpcTrait)?.customProperties??{}},setState(t,e){let r=t.get(ff.NpcTrait);r&&(r.customProperties=e)}};var qS=S(b());function w6(t,e,r){t.registerBehavior(Fx);let n=e.getEntity(r);return n&&qS.RoomBehavior.blockExit(n,qS.Direction.NORTH,"The cyclops blocks your way north!"),t0(e,r)}var C6=S(b());var sd=S(b());var qEe=0;function D6(){return`dm-evt-${Date.now()}-${++qEe}`}function N6(t){let e=t.get(sd.NpcTrait);return e?.customProperties?e.customProperties:null}function P6(t){return t?t.get(sd.IdentityTrait)?.name==="Parapet":!1}var L6={id:"dungeon-master",name:"Dungeon Master Behavior",onTurn(t){if(Hk(t.world)!=="FOLLOWING")return[];if(t.playerLocation!==t.npcLocation){let n=t.world.getEntity(t.npcLocation)?.get(sd.RoomTrait);if(n?.exits){for(let[i,o]of Object.entries(n.exits))if(o&&"destination"in o&&o.destination===t.playerLocation)return t.world.moveEntity(t.npc.id,t.playerLocation),[{type:"emote",messageId:Z.FOLLOWING,data:{npcName:"Dungeon Master"}}]}}return[]},onSpokenTo(t,e){let r=N6(t.npc);if(!r)return[];let n=e.toLowerCase().trim(),i=Hk(t.world);if(n.includes("follow")||n==="come"||n==="come with me")return r.triviaPassed?(xu(t.world,"FOLLOWING"),[{type:"emote",messageId:Z.FOLLOWING,data:{npcName:"Dungeon Master"}}]):[{type:"emote",messageId:Z.NO_ANSWER_YET,data:{npcName:"Dungeon Master"}}];if(n==="stay"||n==="wait"||n.includes("stay here")||n.includes("wait here"))return xu(t.world,"WAITING"),[{type:"emote",messageId:Z.STAYING,data:{npcName:"Dungeon Master"}}];let o=n.match(/(?:set|turn)\s+dial\s+to\s+(\d)/);return o?FEe(t,parseInt(o[1],10)):n.includes("push button")||n.includes("press button")||n.includes("push the button")||n.includes("press the button")?GEe(t):[{type:"emote",messageId:Z.CANNOT_DO_THAT,data:{npcName:"Dungeon Master"}}]},getState(t){let e=N6(t);return e?{...e}:{}},setState(t,e){let r=t.get(sd.NpcTrait);r&&(r.customProperties=e)}};function FEe(t,e){if(e<1||e>8)return[{type:"emote",messageId:Z.CANNOT_DO_THAT,data:{npcName:"Dungeon Master"}}];let r=t.world.getEntity(t.npcLocation);return P6(r)?(t.world.setStateValue("parapet.dialSetting",e),[{type:"custom",handler:()=>[{id:D6(),type:"game.message",entities:{actor:t.npc.id},data:{messageId:Z.SETS_DIAL,params:{dialValue:e}},timestamp:Date.now(),narrate:!0}]}]):[{type:"emote",messageId:Z.CANNOT_DO_THAT,data:{npcName:"Dungeon Master"}}]}function GEe(t){let e=t.world.getEntity(t.npcLocation);if(!P6(e))return[{type:"emote",messageId:Z.CANNOT_DO_THAT,data:{npcName:"Dungeon Master"}}];let r=t.world.getStateValue("parapet.dialSetting")??1,n=t.world.getStateValue("parapet.activatedCell")??0;return t.world.setStateValue("parapet.activatedCell",r),[{type:"custom",handler:()=>{let i=[];return i.push({id:D6(),type:"game.message",entities:{actor:t.npc.id},data:{messageId:Z.PUSHES_BUTTON,params:{dialValue:r}},timestamp:Date.now(),narrate:!0}),r===4?t.world.setStateValue("prisonCell.bronzeDoorVisible",!0):n===4&&t.world.setStateValue("prisonCell.bronzeDoorVisible",!1),i}}]}function M6(t,e,r){return t.registerBehavior(L6),_3(e,r)}function Gx(t){t.addMessage(Qe.KNOCKED_OUT,"The troll is battered into unconsciousness."),t.addMessage(Qe.KILL_UNCONSCIOUS,"The unconscious troll cannot defend himself: he dies."),t.addMessage(Qe.SMOKE_DISAPPEAR,"Almost as soon as the troll breathes his last, a cloud of sinister black smoke envelops him, and when the fog lifts, the carcass has disappeared."),t.addMessage(Qe.DEATH_PASSAGE_CLEAR,"With the troll dispatched, the passage to the north is now clear."),t.addMessage(Qe.RECOVERS_AXE,"The troll, now worried about this encounter, recovers his bloody axe."),t.addMessage(Qe.COWERS,"The troll, disarmed, cowers in terror, pleading for his life in the guttural tongue of the trolls."),t.addMessage(Qe.CATCHES_ITEM,"The troll, who is remarkably coordinated, catches the {itemName}."),t.addMessage(Qe.EATS_ITEM,"The troll, not having the most discriminating tastes, gleefully eats the {itemName}."),t.addMessage(Qe.THROWS_KNIFE_BACK,"Being for the moment sated, the troll throws it back. Fortunately, the troll has poor control, and the knife falls to the floor. He does not look pleased."),t.addMessage(Qe.SPITS_AT_PLAYER,'The troll spits in your face, saying "Better luck next time."'),t.addMessage(Qe.MOCKS_UNARMED_ATTACK,"The troll laughs at your puny gesture."),t.addMessage(Qe.CANT_HEAR_YOU,"Unfortunately, the troll can't hear you."),t.addMessage(cf.WHITE_HOT,"The troll's axe seems white-hot. You can't hold on to it."),t.addMessage(rf.GROWLS,"The troll growls menacingly at you."),t.addMessage(xe.APPEARS,"A seedy-looking gentleman sidles into view."),t.addMessage(xe.LEAVES,"The thief slinks away into the shadows."),t.addMessage(xe.LURKS,"The thief lurks in the shadows, watching."),t.addMessage(xe.STEALS_FROM_PLAYER,'"My, what a lovely {itemName}!" The thief snatches it away.'),t.addMessage(xe.STEALS_FROM_ROOM,"The thief pockets the {itemName}."),t.addMessage(xe.NOTICES_VALUABLES,"The thief's eyes gleam as he notices your possessions."),t.addMessage(xe.GLOATS,"The thief grins smugly at you."),t.addMessage(xe.OPENS_EGG,"The thief, eyeing the jeweled egg with professional interest, skillfully opens it and reveals a clockwork canary!"),t.addMessage(xe.ATTACKS,"The thief lunges at you with his stiletto!"),t.addMessage(xe.COUNTERATTACKS,"The thief parries and counterattacks!"),t.addMessage(xe.DODGES,"The thief deftly dodges your attack."),t.addMessage(xe.WOUNDED,"The thief staggers from your blow."),t.addMessage(xe.FLEES,"The thief, badly wounded, stumbles away into the darkness."),t.addMessage(xe.DIES,"The thief falls to the ground, a look of surprise frozen on his face."),t.addMessage(xe.DROPS_LOOT,"The thief's ill-gotten gains scatter across the floor."),t.addMessage("dungeo.thief.frame_spawns","As the thief falls, an ornate but empty picture frame crashes to the ground."),t.addMessage(Fe.BLOCKS,"A huge cyclops stands before you, blocking the northern passage!"),t.addMessage(Fe.GROWLS,"The cyclops growls menacingly."),t.addMessage(Fe.IGNORES,"The cyclops ignores your words."),t.addMessage(Fe.PANICS,"The cyclops, hearing that dreaded name, panics!"),t.addMessage(Fe.FLEES,"The cyclops runs away in terror, revealing a hidden passage!"),t.addMessage(Fe.PASSAGE_OPENS,"A passage north to the Strange Passage is now clear."),t.addMessage(Fe.ATTACKS,"The cyclops swings at you with massive fists!"),t.addMessage(Fe.COUNTERATTACKS,"The cyclops roars and swings back at you!"),t.addMessage(Fe.WOUNDED,"The cyclops staggers from your blow."),t.addMessage(Fe.DIES,"The cyclops crashes to the ground with a tremendous thud!"),t.addMessage(rt.DESCRIPTION,"A metallic robot with a hinged panel on its chest."),t.addMessage(rt.FOLLOWS,"The robot follows you."),t.addMessage(rt.WAITS,"The robot will wait here."),t.addMessage(rt.COMMAND_UNDERSTOOD,"The robot beeps in acknowledgment."),t.addMessage(rt.COMMAND_UNKNOWN,"The robot whirs confusedly."),t.addMessage(rt.PUSHES_BUTTON,"The robot extends a thin metal finger and pushes the triangular button."),t.addMessage(rt.NO_BUTTON,"The robot looks around but sees no button to push."),t.addMessage(rt.ALREADY_PUSHED,"The robot has already pushed the button."),t.addMessage(rt.ARRIVES,"The robot enters."),t.addMessage(rt.TAKES_OBJECT,"The robot takes the {objectName}."),t.addMessage(rt.DROPS_OBJECT,"The robot drops the {objectName}."),t.addMessage(rt.CAROUSEL_FIXED,"You hear a grinding noise from somewhere nearby. The carousel mechanism has stopped spinning!"),t.addMessage(Ge.NO_TARGET,"Command whom?"),t.addMessage(Ge.CANT_COMMAND,"You cannot command that."),t.addMessage(Ge.CANT_SEE,"You don't see that here."),t.addMessage(Ge.WHIRR_BUZZ_CLICK,'"Whirr, buzz, click!"'),t.addMessage(Ge.STUPID_ROBOT,'"I am only a stupid robot and cannot perform that command."'),t.addMessage(Z.DESCRIPTION,"A strange old man with a long, flowing beard and penetrating eyes."),t.addMessage(Z.APPEARS_AT_DOOR,"The barred panel in the door slides open, revealing a strange old man with a long, flowing beard and penetrating eyes. He speaks in a deep, resonant voice."),t.addMessage(Z.FOLLOWING,"The Dungeon Master follows you."),t.addMessage(Z.STAYING,"The Dungeon Master nods and remains where he is."),t.addMessage(Z.SETS_DIAL,"The Dungeon Master turns the dial to {dialValue}."),t.addMessage(Z.PUSHES_BUTTON,"The Dungeon Master pushes the button. You hear machinery grinding somewhere below."),t.addMessage(Z.CANNOT_DO_THAT,"The Dungeon Master shakes his head slowly."),t.addMessage(Z.QUESTION_0,'"What room can one enter, but yet not enter, and reach the lair of the thief?"'),t.addMessage(Z.QUESTION_1,'"Where, besides the temple, can one end up after going through the altar?"'),t.addMessage(Z.QUESTION_2,'"What is the minimum total value of the zorkmid treasures in the game?"'),t.addMessage(Z.QUESTION_3,'"What item enables one to determine the function of the various cakes?"'),t.addMessage(Z.QUESTION_4,'"What is a useful thing to do with the mirror?"'),t.addMessage(Z.QUESTION_5,'"What body part offends the spirits in the land of the dead?"'),t.addMessage(Z.QUESTION_6,'"What object in the game is haunted?"'),t.addMessage(Z.QUESTION_7,`"Is the phrase 'hello sailor' useful anywhere in the game?"`),t.addMessage(Z.CORRECT_ANSWER,'The old man nods approvingly. "Correct."'),t.addMessage(Z.WRONG_ANSWER_1,'The old man frowns. "That is not correct. Think carefully."'),t.addMessage(Z.WRONG_ANSWER_2,'The old man shakes his head. "Wrong again. You have three more chances."'),t.addMessage(Z.WRONG_ANSWER_3,'The old man sighs. "Still incorrect. Two chances remain."'),t.addMessage(Z.WRONG_ANSWER_4,'The old man looks disappointed. "Wrong. This is your last chance."'),t.addMessage(Z.WRONG_ANSWER_5,'The old man waves his hand dismissively. "You have failed. The door shall remain closed to you forever."'),t.addMessage(Z.TRIVIA_PASSED,'The old man smiles warmly. "You have proven your knowledge. Enter, friend, and face the final challenge."'),t.addMessage(Z.TRIVIA_FAILED,"The panel slides shut. You are not worthy to continue."),t.addMessage(Z.DOOR_OPENS,"The wooden door swings open with a creak."),t.addMessage(Z.NO_ANSWER_YET,"You must first knock on the door to begin the challenge."),t.addMessage(Z.ALREADY_PASSED,"You have already passed the challenge. The door is open."),t.addMessage("npc.guard.blocks","The {npcName} growls menacingly, blocking your way."),t.addMessage("npc.guard.attacks","The {npcName} swings at you!"),t.addMessage("npc.guard.defeated","The {npcName} has been defeated!"),t.addMessage("npc.attacks","The {npcName} attacks!"),t.addMessage("npc.misses","The {npcName} misses."),t.addMessage("npc.hits","The {npcName} hits you!"),t.addMessage("npc.killed","The {npcName} is dead."),t.addMessage("npc.unconscious","The {npcName} slumps to the ground, unconscious."),t.addMessage("npc.enters","A {npcName} enters."),t.addMessage("npc.leaves","The {npcName} leaves."),t.addMessage("npc.notices_player","The {npcName} notices you."),t.addMessage("npc.no_response","The {npcName} does not respond."),t.addMessage(uf.NO_EXPERTISE,"You have neither the tools nor the expertise.")}var Dl=S(b());var FS="dungeo.lantern.battery",GS="dungeo.lantern.warning.dim",VS="dungeo.lantern.warning.flicker",B6=330,k6=50,x6=20;function VEe(t){return{id:FS,name:"Lantern Battery",turns:B6,entityId:t,priority:10,tickCondition:e=>{let r=e.world.getEntity(t);return r?r.get(Dl.LightSourceTrait)?.isLit===!0:!1},trigger:e=>{let r=e.world.getEntity(t);if(!r)return[];let n=r.get(Dl.LightSourceTrait),i=r.get(Dl.SwitchableTrait);return n&&(n.isLit=!1,n.fuelRemaining=0),i&&(i.isOn=!1),[{id:`lantern-dies-${e.turn}`,type:"scheduler.fuse.triggered",timestamp:Date.now(),entities:{target:t},data:{messageId:K.LANTERN_DIES,fuseId:FS,isLightSource:!0,willDarkenLocation:!0}}]}}}function YEe(t,e,r){r>k6&&t.setFuse({id:GS,name:"Lantern Dim Warning",turns:r-k6,entityId:e,priority:5,tickCondition:n=>{let i=n.world.getEntity(e);return i?i.get(Dl.LightSourceTrait)?.isLit===!0:!1},trigger:n=>[{id:`lantern-dim-${n.turn}`,type:"scheduler.fuse.triggered",timestamp:Date.now(),entities:{target:e},data:{messageId:K.LANTERN_DIM,fuseId:GS}}]}),r>x6&&t.setFuse({id:VS,name:"Lantern Flicker Warning",turns:r-x6,entityId:e,priority:5,tickCondition:n=>{let i=n.world.getEntity(e);return i?i.get(Dl.LightSourceTrait)?.isLit===!0:!1},trigger:n=>[{id:`lantern-flicker-${n.turn}`,type:"scheduler.fuse.triggered",timestamp:Date.now(),entities:{target:e},data:{messageId:K.LANTERN_FLICKERS,fuseId:VS}}]})}function Vx(t,e){let r=e.getAllEntities().find(a=>a.get("identity")?.name==="brass lantern");if(!r){console.warn("Lantern not found - lantern fuse not registered");return}let n=r.id,o=r.get(Dl.LightSourceTrait)?.fuelRemaining??B6;t.setFuse(VEe(n)),YEe(t,n,o),e.registerEventHandler("if.event.switched_on",(a,s)=>{a.data?.target===n&&(t.resumeFuse(FS),t.resumeFuse(GS),t.resumeFuse(VS))}),e.registerEventHandler("if.event.switched_off",(a,s)=>{a.data?.target===n&&(t.pauseFuse(FS),t.pauseFuse(GS),t.pauseFuse(VS))})}var Ia=S(b());var YS="dungeo.candles.burn",zS="dungeo.candles.warning.low",$S="dungeo.candles.warning.flicker",H6=50,j6=15,W6=5;function zEe(t){return{id:YS,name:"Candle Burning",turns:H6,entityId:t,priority:10,tickCondition:e=>{let r=e.world.getEntity(t);return r?r.get(Ia.LightSourceTrait)?.isLit===!0:!1},trigger:e=>{let r=e.world.getEntity(t);if(!r)return[];let n=r.get(Ia.LightSourceTrait),i=r.get(Ia.SwitchableTrait),o=r.get(Ia.IdentityTrait);return n&&(n.isLit=!1,n.fuelRemaining=0),i&&(i.isOn=!1),o&&(o.description="A pair of burned-out candle stubs.",o.name="burned-out candles"),r.burnedOut=!0,[{id:`candles-out-${e.turn}`,type:"scheduler.fuse.triggered",timestamp:Date.now(),entities:{target:t},data:{messageId:K.CANDLES_OUT,fuseId:YS,isLightSource:!0,willDarkenLocation:!0}}]}}}function $Ee(t,e,r){r>j6&&t.setFuse({id:zS,name:"Candle Low Warning",turns:r-j6,entityId:e,priority:5,tickCondition:n=>{let i=n.world.getEntity(e);return i?i.get(Ia.LightSourceTrait)?.isLit===!0:!1},trigger:n=>[{id:`candles-low-${n.turn}`,type:"scheduler.fuse.triggered",timestamp:Date.now(),entities:{target:e},data:{messageId:K.CANDLES_LOW,fuseId:zS}}]}),r>W6&&t.setFuse({id:$S,name:"Candle Flicker Warning",turns:r-W6,entityId:e,priority:5,tickCondition:n=>{let i=n.world.getEntity(e);return i?i.get(Ia.LightSourceTrait)?.isLit===!0:!1},trigger:n=>[{id:`candles-flicker-${n.turn}`,type:"scheduler.fuse.triggered",timestamp:Date.now(),entities:{target:e},data:{messageId:K.CANDLES_FLICKER,fuseId:$S}}]})}function Yx(t,e){let r=e.getAllEntities().find(a=>a.get("identity")?.name==="pair of candles");if(!r){console.warn("Candles not found - candle fuse not registered");return}let n=r.id,o=r.get(Ia.LightSourceTrait)?.fuelRemaining??H6;t.setFuse(zEe(n)),$Ee(t,n,o),e.registerEventHandler("if.event.switched_on",(a,s)=>{if(a.data?.target===n){if(s.getEntity(n)?.burnedOut)return;t.resumeFuse(YS),t.resumeFuse(zS),t.resumeFuse($S)}}),e.registerEventHandler("if.event.switched_off",(a,s)=>{a.data?.target===n&&(t.pauseFuse(YS),t.pauseFuse(zS),t.pauseFuse($S))})}var KEe=S(b());var xn={LEAK_STARTED:"dungeo.flooding.leak_started",WATER_ANKLES:"dungeo.flooding.water_ankles",WATER_SHINS:"dungeo.flooding.water_shins",WATER_KNEES:"dungeo.flooding.water_knees",WATER_HIPS:"dungeo.flooding.water_hips",WATER_WAIST:"dungeo.flooding.water_waist",WATER_CHEST:"dungeo.flooding.water_chest",WATER_NECK:"dungeo.flooding.water_neck",WATER_HEAD:"dungeo.flooding.water_head",ROOM_FLOODED:"dungeo.flooding.room_flooded",DROWNED:"dungeo.flooding.drowned",BUTTON_JAMMED:"dungeo.flooding.button_jammed"};var q6=S(b());var U6="dungeo.forest.ambience",QEe=.15,F6=new Set,zx=[{messageId:K.FOREST_BIRD,weight:4},{messageId:K.FOREST_RUSTLE,weight:3},{messageId:K.FOREST_BREEZE,weight:2},{messageId:K.FOREST_BRANCH,weight:1}];function XEe(t){let e=zx.reduce((n,i)=>n+i.weight,0),r=t.random.next()*e;for(let n of zx)if(r-=n.weight,r<=0)return n.messageId;return zx[0].messageId}function ZEe(t,e){if(F6.has(t))return!0;let r=e.getEntity(t);if(!r||!r.get(q6.RoomTrait)?.isOutdoors)return!1;let i=r.get("identity");if(!i)return!1;let o=i.name?.toLowerCase()||"",a=i.aliases||[];return o.includes("forest")||o.includes("clearing")||o.includes("tree")||a.some(s=>s.toLowerCase().includes("forest"))}function JEe(){return{id:U6,name:"Forest Ambience",priority:1,condition:t=>ZEe(t.playerLocation,t.world),run:t=>{if(!t.random.chance(QEe))return[];let e=XEe(t);return[{id:`forest-ambience-${t.turn}`,type:"ambient",timestamp:Date.now(),entities:{},data:{messageId:e,daemonId:U6,isAmbient:!0}}]}}}function $x(t,e){F6=new Set(e),t.registerDaemon(JEe())}var Bn=S(b()),eTe=["portrait","zorkmid-bills"],Kx="An alarm rings briefly, and an invisible force prevents you from leaving.",Qx="dungeo.bank.alarm.active";function tTe(t,e){if(!t.getEntity(e))return!1;let n=t.getContents(e);for(let i of n){let o=i.treasureId;if(o&&eTe.includes(o))return!0}return!1}function Xx(t,e,r){let n=r.safetyDeposit,i={id:"bank-alarm",name:"Bank of Zork Alarm System",priority:100,condition:o=>o.playerLocation===n,run:o=>{let{world:a,playerId:s,playerLocation:c}=o,l=a.getStateValue(Qx)||!1,u=tTe(a,s),m=a.getEntity(n);return m?(u&&!l?(Bn.RoomBehavior.blockExit(m,Bn.Direction.EAST,Kx),Bn.RoomBehavior.blockExit(m,Bn.Direction.WEST,Kx),Bn.RoomBehavior.blockExit(m,Bn.Direction.SOUTH,Kx),a.setStateValue(Qx,!0)):!u&&l&&(Bn.RoomBehavior.unblockExit(m,Bn.Direction.EAST),Bn.RoomBehavior.unblockExit(m,Bn.Direction.WEST),Bn.RoomBehavior.unblockExit(m,Bn.Direction.SOUTH),a.setStateValue(Qx,!1)),[]):[]}};t.registerDaemon(i)}var Zx=S(b());var G6="dungeo.incense.burn",rTe=3;function nTe(t,e){return{id:G6,name:"Incense Burning",turns:rTe,entityId:t,priority:10,tickCondition:r=>r.world.getEntity(t)?.isBurning===!0,trigger:r=>{let n=r.world.getEntity(t);if(!n)return[];n.isBurning=!1,n.burnedOut=!0;let i=n.get(Zx.IdentityTrait);i&&(i.description="A pile of ash that was once fragrant incense.",i.name="ash");let o=r.world.getEntity(e);return o&&o.basinState==="disarmed"&&(o.basinState="normal"),r.world.setStateValue("dungeo.incense.burning_id",null),[{id:`incense-out-${r.turn}`,type:"scheduler.fuse.triggered",timestamp:Date.now(),entities:{target:t},data:{messageId:K.INCENSE_BURNS_OUT,fuseId:G6}}]}}}function Jx(t,e){let r=e.getAllEntities().find(i=>i.isIncense===!0);if(!r){console.warn("Incense not found - incense fuse not registered");return}let n=e.getAllEntities().find(i=>i.get(Zx.IdentityTrait)?.name==="Basin Room");if(!n){console.warn("Basin Room not found - incense fuse not registered");return}t.setFuse(nTe(r.id,n.id))}var XS=S(b());var KS="dungeo.balloon.movement",iTe=3,V6=0,xi=null,QS=null;function oTe(t){if(!QS)return!1;let e=t.getEntity(QS);return!e||!e.get(XS.OpenableTrait)?.isOpen?!1:t.getContents(QS).some(i=>i.isBurning===!0)}function Y6(t){if(!xi)return null;let e=t.getEntity(xi);if(!e)return null;let r=e.balloonState;return r?{entity:e,state:r}:null}function z6(t,e){if(!xi)return;let r=t.getEntity(xi);if(!r)return;let n=r.get(XS.VehicleTrait);n&&(n.currentPosition=e)}function aTe(t){if(!xi)return!1;let e=t.getPlayer();return e?t.getLocation(e.id)===xi:!1}function sTe(t,e){return t==="vair4"?K.BALLOON_CRASH:t==="vlbot"?K.BALLOON_LANDED:zu(t)?K.BALLOON_AT_LEDGE:e?K.BALLOON_RISING:K.BALLOON_FALLING}function cTe(t,e){let r=[];return r.push({id:`balloon-crash-${e.turn}`,type:"game.death",timestamp:Date.now(),entities:{target:xi||""},data:{messageId:K.BALLOON_CRASH,daemonId:KS,cause:"balloon_crash",balloonId:xi}}),r}function lTe(){return{id:KS,name:"Balloon Movement",priority:5,condition:t=>{let e=Y6(t.world);return!(!e||!e.state.daemonEnabled||t.turn-V6<iTe)},run:t=>{V6=t.turn;let e=[],r=Y6(t.world);if(!r)return e;let{state:n}=r,i=oTe(t.world),o=aTe(t.world),a=null;if(i?a=B2(n.position):a=j2(n.position),a===null)return e;if(a==="vair4")return n.position=a,z6(t.world,a),cTe(t.world,t);let s=n.position;if(n.position=a,z6(t.world,a),o){let c=sTe(a,i);e.push({id:`balloon-move-${t.turn}`,type:"daemon.message",timestamp:Date.now(),entities:{target:xi||""},data:{messageId:c,daemonId:KS,oldPosition:s,newPosition:a,isRising:i,balloonId:xi,params:{from:s,to:a}}}),zu(a)&&e.push({id:`balloon-ledge-${t.turn}`,type:"daemon.message",timestamp:Date.now(),entities:{},data:{messageId:K.BALLOON_HOOK_VISIBLE,daemonId:KS,balloonId:xi}})}return e}}}function eB(t,e,r,n){xi=r,QS=n,t.registerDaemon(lTe())}var Po=S(b());var $6="dungeo.troll.recovery",uTe="A nasty-looking troll stands here, wielding a bloody axe. He blocks the northern passage.",Pl=null,nh=null;function dTe(t){let e=t.getAllEntities();for(let r of e)if(r.get(Po.IdentityTrait)?.name?.toLowerCase().includes("troll")&&r.get(Po.CombatantTrait))return r.id;return null}function mTe(){return{id:$6,name:"Troll Recovery",priority:10,condition:t=>{if(Pl||(Pl=dTe(t.world)),!Pl)return!1;let e=t.world.getEntity(Pl);if(!e)return!1;let r=e.get(Po.CombatantTrait);return r?r.isAlive&&!r.isConscious&&r.recoveryTurns!==void 0:!1},run:t=>{if(!Pl)return[];let e=t.world.getEntity(Pl);if(!e)return[];let r=e.get(Po.CombatantTrait);if(!r||r.recoveryTurns===void 0)return[];let n=[];if(r.recoveryTurns--,r.recoveryTurns<=0){r.wakeUp();let i=e.get(Po.IdentityTrait);if(i&&(i.description=uTe),nh){let o=t.world.getEntity(nh);o&&Po.RoomBehavior.blockExit(o,Po.Direction.NORTH,"The troll blocks your way.")}nh&&t.playerLocation===nh&&n.push({id:`troll-wakeup-${t.turn}`,type:"game.message",timestamp:Date.now(),entities:{target:Pl},data:{messageId:K.TROLL_WAKES_UP,daemonId:$6},narrate:!0})}return n}}}function tB(t,e){nh=e,Pl=null,t.registerDaemon(mTe())}var Ks=S(b()),K6="dungeo.sword.glow",Ll={GLOW_BRIGHT:"dungeo.sword.glow_bright",GLOW_FAINT:"dungeo.sword.glow_faint",GLOW_OFF:"dungeo.sword.glow_off"},rB=0,X6=1,Z6=2,ZS=rB,cd=null,pf=null;function fTe(t){let e=t.getAllEntities();for(let r of e)if(r.get(Ks.IdentityTrait)?.name?.toLowerCase().includes("elvish sword"))return r.id;return null}function pTe(t){let e=t.getAllEntities();for(let r of e)if(r.get(Ks.ActorTrait)?.isPlayer)return r.id;return null}function gTe(t,e){let r=t.get?.(Ks.IdentityTrait);if(!r)return!1;let n=r.name?.toLowerCase()||"",i=t.get?.(Ks.CombatantTrait);return i&&!i.isAlive?!1:n.includes("troll")||n.includes("thief")||n.includes("cyclops")}function Q6(t,e){let r=e.getContents(t);for(let n of r)if(gTe(n,e))return!0;return!1}function hTe(t,e){let r=e.getEntity(t);if(!r)return[];let n=r.get(Ks.RoomTrait);if(!n)return[];let i=[],o=n.exits||{};for(let[a,s]of Object.entries(o))typeof s=="string"?i.push(s):s&&typeof s=="object"&&"destination"in s&&i.push(s.destination);return i}function yTe(t){return!cd||!pf?!1:t.getLocation(cd)===pf}function vTe(t,e){if(Q6(e,t))return Z6;let r=hTe(e,t);for(let n of r)if(Q6(n,t))return X6;return rB}function ETe(){return{id:K6,name:"Sword Glow",priority:5,condition:t=>(cd||(cd=fTe(t.world)),pf||(pf=pTe(t.world)),!cd||!pf?!1:yTe(t.world)),run:t=>{let e=[],r=t.playerLocation;if(!r)return e;let n=vTe(t.world,r);if(n!==ZS){let i;switch(n){case Z6:i=Ll.GLOW_BRIGHT;break;case X6:i=Ll.GLOW_FAINT;break;default:i=Ll.GLOW_OFF;break}e.push({id:`sword-glow-${t.turn}`,type:"game.message",timestamp:Date.now(),entities:{instrument:cd},data:{messageId:i,daemonId:K6,previousLevel:ZS,newLevel:n},narrate:!0}),ZS=n}return e}}}function nB(t){ZS=rB,cd=null,pf=null,t.registerDaemon(ETe())}function J6(t,e,r,n,i,o){Vx(t,e),Yx(t,e),Tx(e),_x(e);let a=Object.values(r);$x(t,a),Xx(t,e,i),Jx(t,e),o&&eB(t,e,o.balloonId,o.receptacleId),sx(t),nB(t)}function iB(t){t.addMessage(K.LANTERN_DIM,"Your lantern is getting dim."),t.addMessage(K.LANTERN_FLICKERS,"Your lantern flickers ominously."),t.addMessage(K.LANTERN_DIES,"Your lantern flickers and goes out."),t.addMessage(K.LANTERN_DEAD,"The lantern is dead. You need a new battery."),t.addMessage(K.CANDLES_LOW,"The candles are burning low."),t.addMessage(K.CANDLES_FLICKER,"The candles flicker."),t.addMessage(K.CANDLES_OUT,"The candles sputter and go out."),t.addMessage(K.MATCH_BURNING,"The match sputters."),t.addMessage(K.MATCH_OUT,"The match goes out."),t.addMessage(K.DAM_GATES_OPEN,"The sluice gates open and water pours through the dam."),t.addMessage(K.DAM_GATES_CLOSE,"The sluice gates close and water starts to collect behind the dam."),t.addMessage(K.DAM_TRUNK_REVEALED,"As the mud settles, a trunk becomes visible in the reservoir bed!"),t.addMessage(xn.LEAK_STARTED,"There is a rumbling sound, and a stream of water appears to burst from the east wall of the room (apparently, a leak has occurred in a pipe)."),t.addMessage(xn.WATER_ANKLES,"The water level is now up to your ankles."),t.addMessage(xn.WATER_SHINS,"The water level is now up to your shins."),t.addMessage(xn.WATER_KNEES,"The water level is now up to your knees."),t.addMessage(xn.WATER_HIPS,"The water level is now up to your hips."),t.addMessage(xn.WATER_WAIST,"The water level is now up to your waist."),t.addMessage(xn.WATER_CHEST,"The water level is now up to your chest."),t.addMessage(xn.WATER_NECK,"The water level is now up to your neck."),t.addMessage(xn.WATER_HEAD,"The water level is now over your head."),t.addMessage(xn.ROOM_FLOODED,"The room is full of water and cannot be entered."),t.addMessage(xn.DROWNED,"I'm afraid you have done drowned yourself."),t.addMessage(xn.BUTTON_JAMMED,"The blue button appears to be jammed."),t.addMessage(K.BALLOON_RISING,"The balloon rises slowly."),t.addMessage(K.BALLOON_FALLING,"The balloon sinks slowly."),t.addMessage(K.BALLOON_AT_LEDGE,"The balloon drifts near a ledge."),t.addMessage(K.BALLOON_LANDED,"The balloon settles to the ground."),t.addMessage(K.BALLOON_CRASH,"The balloon rises too high and hits the jagged ceiling of the volcano! The bag is torn apart and the balloon plunges to the ground far below."),t.addMessage(K.BALLOON_HOOK_VISIBLE,"You can see a hook on the rock face here."),t.addMessage(K.BALLOON_INFLATING,"Hot air fills the balloon and it begins to rise."),t.addMessage(K.BALLOON_DEFLATING,"The balloon deflates as the heat source dies."),t.addMessage(bS.OBJECT_BURNED_OUT,"The {itemName} has burned out completely.");let e={EXIT_SUCCESS:"dungeo.balloon.exit_success",EXIT_BLOCKED_MIDAIR:"dungeo.balloon.exit_blocked_midair",EXIT_TO_LEDGE:"dungeo.balloon.exit_to_ledge"};t.addMessage(e.EXIT_SUCCESS,"You climb out of the balloon."),t.addMessage(e.EXIT_BLOCKED_MIDAIR,"You are too high in the air to exit safely! The balloon is floating in mid-air."),t.addMessage(e.EXIT_TO_LEDGE,"You carefully climb out of the balloon onto the ledge."),t.addMessage(K.FOREST_BIRD,"A songbird chirps in the distance."),t.addMessage(K.FOREST_RUSTLE,"Leaves rustle in the undergrowth."),t.addMessage(K.FOREST_BREEZE,"A gentle breeze stirs the branches."),t.addMessage(K.FOREST_BRANCH,"A branch cracks somewhere in the forest."),t.addMessage(K.UNDERGROUND_DRIP,"Water drips somewhere in the darkness."),t.addMessage(K.UNDERGROUND_ECHO,"A distant echo reaches your ears."),t.addMessage(K.UNDERGROUND_CREAK,"The timbers creak ominously."),t.addMessage(Ll.GLOW_BRIGHT,"Your sword has begun to glow very brightly."),t.addMessage(Ll.GLOW_FAINT,"Your sword is glowing with a faint blue glow."),t.addMessage(Ll.GLOW_OFF,"Your sword is no longer glowing."),t.addMessage(K.INCENSE_BURNING,"The incense continues to smolder."),t.addMessage(K.INCENSE_BURNS_OUT,"The incense sputters and burns out completely, leaving only ash."),t.addMessage(K.TROLL_KNOCKED_OUT,"The troll is battered into unconsciousness."),t.addMessage(K.TROLL_WAKES_UP,"The troll stirs, quickly resuming a fighting stance.")}function oB(t){t.addMessage(st.NOTHING_TO_SAY,"You need to say something."),t.addMessage(st.SAY_TO_AIR,"You speak, but nobody is here to listen."),t.addMessage(st.NPC_RESPONDS,"{npcName} responds to your words."),t.addMessage(st.LOUD_ROOM_ECHO_DEATH,"The acoustics of the room cause your voice to echo back with increasing volume. The reverberations are deafening! CRASH! The room collapses around you!"),t.addMessage(st.LOUD_ROOM_ECHO_SAFE,'The platinum bar seems to absorb the sound, preventing dangerous reverberations. The acoustics of the room cause your voice to echo: "echo...echo...echo..."'),t.addMessage(st.LOUD_ROOM_ACOUSTICS,'The acoustics of the room cause your voice to echo: "echo...echo...echo..."'),t.addMessage(st.RIDDLE_CORRECT,"There is a loud rumble as the stone door swings open, revealing a passage to the east!"),t.addMessage(st.RIDDLE_WRONG,'A hollow voice intones: "Wrong, adventurer! Think more carefully about the riddle..."'),t.addMessage(st.RIDDLE_ALREADY_SOLVED,"The stone door is already open. You may proceed east."),t.addMessage(Di.RING_SUCCESS,"Ding!"),t.addMessage(Di.RING_BELL,"The bell produces a clear, resonant tone."),t.addMessage(Di.NOT_RINGABLE,"That doesn't make a sound when rung."),t.addMessage(Di.NO_TARGET,"Ring what?"),t.addMessage(An.BREAK_SUCCESS,"You break the {target}."),t.addMessage(An.BREAK_FRAME,'The frame shatters! Among the debris, you find a carved piece bearing strange symbols: "Only devotion can reveal my location."'),t.addMessage(An.CANT_BREAK,"You can't break that."),t.addMessage(An.NO_TARGET,"Break what?"),t.addMessage(An.NOT_VISIBLE,"You don't see that here."),t.addMessage(xt.BURN_SUCCESS,"You burn the {target}."),t.addMessage(xt.BURN_INCENSE,"The incense begins to smolder, releasing fragrant smoke that fills the room."),t.addMessage(xt.ALREADY_BURNING,"It is already burning."),t.addMessage(xt.BURNED_OUT,"The incense has already burned out."),t.addMessage(xt.CANT_BURN,"You can't burn that."),t.addMessage(xt.NO_TARGET,"Burn what?"),t.addMessage(xt.NOT_VISIBLE,"You don't see that here."),t.addMessage(da.PRAY_GENERIC,"If you pray hard enough, your prayers may be answered."),t.addMessage(da.PRAY_TELEPORT,"In a shocking development, your prayer is answered!"),t.addMessage(Ls.success,'A hollow voice speaks: "Greetings, Implementor." You feel disoriented as reality shifts around you...'),t.addMessage(Ls.failure,"Nothing happens."),t.addMessage(Ls.syntax,"The spell fizzles. (Usage: INCANT <challenge> <response>)"),t.addMessage(Rn.CANT_LIFT,"You can't lift that."),t.addMessage(Rn.NO_TARGET,"Lift what?"),t.addMessage(Rn.NOT_VISIBLE,"You don't see that here."),t.addMessage(Rn.NOT_IN_MIRROR,"There is nothing here to lift."),t.addMessage(wn.CANT_LOWER,"You can't lower that."),t.addMessage(wn.NO_TARGET,"Lower what?"),t.addMessage(wn.NOT_VISIBLE,"You don't see that here."),t.addMessage(wn.NOT_IN_MIRROR,"There is nothing here to lower."),t.addMessage(mt.NOT_IN_PUZZLE,"There are no walls to push here."),t.addMessage(mt.NO_DIRECTION,"Push which wall?"),t.addMessage(mt.INVALID_DIRECTION,"That is not a valid direction."),t.addMessage(mt.NO_WALL,"There is no wall in that direction."),t.addMessage(mt.IMMOVABLE,"That wall is solid marble. It will not budge."),t.addMessage(mt.NO_ROOM,"There is no room for the wall to slide."),t.addMessage(mt.BOUNDARY,"You cannot push walls at the edge."),t.addMessage(mt.SUCCESS,"The sandstone wall slides into the space beyond."),t.addMessage(mt.SUCCESS_FIRST,"The sandstone wall slides into the space beyond. You step into the vacated space."),t.addMessage(mt.LADDER_VISIBLE,"One of the sandstone walls has a wooden ladder attached to it."),t.addMessage(mt.CARD_VISIBLE,"Set into one wall is a small depression. Within it rests a gold card."),t.addMessage(ho.NOT_IN_MIRROR,"There are no panels to push here."),t.addMessage(ho.NO_TARGET,"Push which panel?"),t.addMessage(ho.NOT_VISIBLE,"You don't see a {target} here."),t.addMessage(ho.NOT_A_PANEL,"That isn't a panel you can push."),t.addMessage(_r.SUCCESS,"You wave the {target}."),t.addMessage(_r.RAINBOW_APPEARS,"Suddenly, the rainbow appears to become solid and, I venture, walkable (I think the giveaway was the stairs and bannister)."),t.addMessage(_r.RAINBOW_GONE,"The rainbow seems to have become somewhat run of the mill."),t.addMessage(_r.NO_EFFECT,"You wave the {target}, but nothing happens."),t.addMessage(_r.NO_TARGET,"Wave what?"),t.addMessage(_r.NOT_HOLDING,"You're not holding that."),t.addMessage(br.SUCCESS,"You dig for a while."),t.addMessage(br.FOUND_STATUE,"Your shovel strikes something solid! Digging more carefully, you uncover a beautiful statue."),t.addMessage(br.KEEP_DIGGING,"You dig some sand away. You could swear the sand looks a bit different here."),t.addMessage(br.NOTHING_HERE,"You've already dug up everything here."),t.addMessage(br.NO_SHOVEL,"You have nothing to dig with."),t.addMessage(br.CANT_DIG_HERE,"The ground is too hard to dig here."),t.addMessage(Bt.SUCCESS,"You wind the {target}."),t.addMessage(Bt.CANARY_SINGS,"The canary begins to sing a beautiful song."),t.addMessage(Bt.BAUBLE_APPEARS,"The canary begins to sing. From somewhere nearby, an answering song is heard. Suddenly, a shiny brass bauble drops at your feet!"),t.addMessage(Bt.NOT_IN_FOREST,"The canary sings, but there is no response."),t.addMessage(Bt.NO_TARGET,"Wind what?"),t.addMessage(Bt.NOT_WINDABLE,"That doesn't have a winding mechanism."),t.addMessage(Bt.NOT_HOLDING,"You're not holding that."),t.addMessage(Bt.ALREADY_WOUND,"The canary seems content and doesn't need winding."),t.addMessage(Li.SEND_FOR_BROCHURE,"Ok, but you know how strapped the postal service is lately..."),t.addMessage(Li.ALREADY_SENT,"You've already sent for the brochure."),t.addMessage(Li.NO_TARGET,"Send for what?"),t.addMessage(Li.BROCHURE_KNOCK,"There is a knocking sound from the front of the house. The postal service must be getting faster!"),t.addMessage(jt.SUCCESS,"The water spills on the ground and evaporates."),t.addMessage(jt.INTO_BUCKET,"The water splashes into the bucket."),t.addMessage(jt.BUCKET_RISES,"The bucket becomes heavy with water and slowly rises to the top of the well, carrying you with it!"),t.addMessage(jt.BUCKET_AT_TOP,"The water splashes into the bucket, but it is already at the top of the well."),t.addMessage(jt.NO_WATER,"You don't have any water to pour."),t.addMessage(jt.NO_TARGET,"Pour what?"),t.addMessage(jt.NOTHING_HAPPENS,"Nothing happens."),t.addMessage(jt.NOT_IN_BUCKET,"You're not in the bucket."),t.addMessage(_t.SUCCESS,"You fill the bottle."),t.addMessage(_t.FROM_BUCKET,"You fill the bottle from the bucket."),t.addMessage(_t.BUCKET_DESCENDS,"As the water leaves the bucket, it becomes lighter and slowly descends to the bottom of the well, carrying you with it!"),t.addMessage(_t.BUCKET_AT_BOTTOM,"You fill the bottle from the bucket, but it is already at the bottom of the well."),t.addMessage(_t.NO_BOTTLE,"You don't have a bottle to fill."),t.addMessage(_t.BOTTLE_FULL,"The bottle is already full."),t.addMessage(_t.NO_SOURCE,"There is no water source here."),t.addMessage(_t.NO_WATER_IN_BUCKET,"The bucket is empty."),t.addMessage(_t.NOTHING_HAPPENS,"Nothing happens."),t.addMessage(tr.SUCCESS,"The {target} catches fire."),t.addMessage(tr.NO_FIRE_SOURCE,"You don't have a way to light that."),t.addMessage(tr.NOT_FLAMMABLE,"That won't burn."),t.addMessage(tr.ALREADY_BURNING,"It is already burning."),t.addMessage(tr.GUIDEBOOK_LIT,"The guidebook catches fire and begins to burn brightly."),t.addMessage(tr.IN_RECEPTACLE,"You place the burning {target} in the receptacle. The balloon begins to rise!"),t.addMessage(ft.SUCCESS,"The balloon is now anchored."),t.addMessage(ft.NO_ROPE,"You don't have anything to tie with."),t.addMessage(ft.NOT_AT_LEDGE,"There is nothing to tie the rope to here."),t.addMessage(ft.ALREADY_TIED,"The rope is already tied to a hook."),t.addMessage(ft.NO_HOOK,"There is no hook to tie the rope to."),t.addMessage(ft.NOT_IN_BALLOON,"You're not in the balloon."),t.addMessage(ft.ROPE_TIED_TO_RAILING,"The rope is now securely fastened to the railing, dangling down into the darkness below."),t.addMessage(ft.ROPE_ALREADY_TIED,"The rope is already tied to the railing."),t.addMessage(ft.NO_RAILING,"There is nothing here to tie the rope to."),t.addMessage(ft.NEED_ROPE,"You don't have any rope."),t.addMessage(Mi.SUCCESS,"You untie the rope."),t.addMessage(Mi.NOT_TIED,"The rope isn't tied to anything."),t.addMessage(Mi.NO_ROPE,"There's no rope here to untie."),t.addMessage(Ct.CLICK,"Click."),t.addMessage(Ct.NOT_A_BUTTON,"That's not a button."),t.addMessage(Ct.LIGHTS_ON,"The lights come on."),t.addMessage(Ct.LIGHTS_OFF,"The lights go out."),t.addMessage(Ct.BLUE_JAMMED,"The blue button appears to be jammed."),t.addMessage(Ct.BLUE_LEAK_STARTED,"There is a rumbling sound from below, and water begins to leak into the room!"),t.addMessage(rr.NOT_A_BOLT,"You can't turn that."),t.addMessage(rr.WONT_TURN,"The bolt won't turn. Perhaps the control panel has something to do with it."),t.addMessage(rr.NO_TOOL,"You can't turn the bolt with your bare hands."),t.addMessage(rr.WRONG_TOOL,"The wrench won't fit on that."),t.addMessage(rr.GATES_OPEN,"The sluice gates open and water pours through the dam."),t.addMessage(rr.GATES_CLOSE,"The sluice gates close, stopping the flow of water."),t.addMessage(ai.NO_SWITCH,"There's no switch here."),t.addMessage(ai.NO_COAL,"The machine makes a grinding noise, but nothing happens. Perhaps it needs fuel."),t.addMessage(ai.ALREADY_USED,"The machine has already been used."),t.addMessage(ai.SUCCESS,"The machine comes to life with a deafening roar! The lid slams shut, and the sounds of immense pressure fill the room. After a moment, the lid opens to reveal that the coal has been transformed into a huge diamond!"),t.addMessage(Hs.GENERIC_FAIL,"You can't put that under there."),t.addMessage(ef.DOOR_LOCKED,"The door is locked, and there is no keyhole on this side."),t.addMessage(si.SUCCESS,"The boat inflates and rises to its full size."),t.addMessage(si.NO_PUMP,"You don't have anything to inflate it with."),t.addMessage(si.ALREADY_INFLATED,"The boat is already inflated."),t.addMessage(si.NOT_INFLATABLE,"That can't be inflated."),t.addMessage(si.CANT_REACH,"You can't reach the boat from here."),t.addMessage(bo.SUCCESS,"The boat deflates."),t.addMessage(bo.ALREADY_DEFLATED,"The boat is already deflated."),t.addMessage(bo.NOT_DEFLATABLE,"That can't be deflated."),t.addMessage(bo.CANT_REACH,"You can't reach the boat from here."),t.addMessage(Xr.SUCCESS,"You are now on the river."),t.addMessage(Xr.NOT_IN_BOAT,"You're not in a boat."),t.addMessage(Xr.NOT_AT_SHORE,"There's no water here to launch into."),t.addMessage(Xr.BOAT_NOT_INFLATED,"The boat must be inflated first."),t.addMessage(Xr.ALREADY_ON_RIVER,"You're already on the river."),t.addMessage($r.KNOCK_GENERIC,"You knock, but no one answers."),t.addMessage($r.KNOCK_DOOR,"You knock on the door."),t.addMessage($r.DM_APPEARS,'The barred panel in the door slides open, revealing a strange old man with a long, flowing beard. He speaks: "I am the Dungeon Master. To prove yourself worthy of entry, you must answer my questions correctly. Three correct answers will grant you passage; five wrong answers will seal your fate."'),t.addMessage($r.DM_ALREADY_APPEARED,"The Dungeon Master waits for your answer."),t.addMessage($r.TRIVIA_ALREADY_PASSED,"The door is already open. You may proceed."),t.addMessage($r.TRIVIA_ALREADY_FAILED,"The door remains sealed. You have already failed the challenge."),t.addMessage($r.NOTHING_TO_KNOCK,"There is nothing here to knock on."),t.addMessage(Pi.NO_QUESTION,"There is no question to answer."),t.addMessage(Pi.NO_ANSWER_GIVEN,"Answer what?"),t.addMessage(Pi.TRIVIA_NOT_STARTED,"You must first knock on the door to begin the challenge."),t.addMessage(Pi.TRIVIA_ALREADY_PASSED,"You have already passed the challenge."),t.addMessage(Pi.TRIVIA_ALREADY_FAILED,"You have already failed the challenge. There are no more questions."),t.addMessage(ma.SET_DIAL,"You turn the dial to {dialValue}."),t.addMessage(ma.DIAL_MUST_BE_1_TO_8,"The dial only has numbers one through eight."),t.addMessage(ma.NOT_AT_PARAPET,"There is no dial here."),t.addMessage(ma.NO_DIAL_HERE,"There is no dial here."),t.addMessage(yo.PUSH_BUTTON,"You push the button in the center of the dial."),t.addMessage(yo.MACHINERY_SOUNDS,"You hear grinding machinery somewhere below, as the cells around the pit rotate."),t.addMessage(yo.CELL_ROTATES,"Cell {dialSetting} is now in position."),t.addMessage(yo.NOT_AT_PARAPET,"There is no button here to push."),t.addMessage(yo.NO_BUTTON,"There is no button here."),t.addMessage(Dn.PERFECT_HEALTH,"You are in perfect health."),t.addMessage(Dn.LIGHT_WOUND,"You have a light wound,"),t.addMessage(Dn.SERIOUS_WOUND,"You have a serious wound,"),t.addMessage(Dn.SEVERAL_WOUNDS,"You have several wounds,"),t.addMessage(Dn.WOUNDS_CURE," which will be cured after {turns} moves."),t.addMessage(Dn.DEATHS_DOOR,"You are at death's door."),t.addMessage(Dn.ONE_MORE_WOUND,"You can be killed by one more light wound."),t.addMessage(Dn.SERIOUS_WOUND_KILL,"You can be killed by a serious wound."),t.addMessage(Dn.SURVIVE_SERIOUS,"You can survive one serious wound."),t.addMessage(Dn.STRONG,"You are strong enough to take several wounds."),t.addMessage(Dn.KILLED_ONCE,"You have been killed once."),t.addMessage(Dn.KILLED_TWICE,"You have been killed twice."),t.addMessage(tx.NO_OBJECTS,"There is nothing here."),t.addMessage(Ju.WALKED_INTO_GRUE,`Oh, no! You have walked into the slavering fangs of a lurking grue!

    **** You have died ****`),t.addMessage(Ju.SLITHERED_INTO_ROOM,`Oh, no! A lurking grue slithered into the room and devoured you!

    **** You have died ****`),t.addMessage(ya.TOO_MUCH_BAGGAGE,"The chimney is too narrow for you and all of your baggage."),t.addMessage(ya.EMPTY_HANDED,"Going up empty-handed is a bad idea.")}function aB(t){t.addMessage(ct.ENTER_PUZZLE,"You squeeze through the narrow hole and find yourself in a confusing maze of sandstone walls."),t.addMessage(ct.EXIT_PUZZLE,"You climb the ladder and squeeze back through the hole in the ceiling."),t.addMessage(ct.CANT_EXIT,"There is no way to reach the hole in the ceiling."),t.addMessage(ct.MOVE_BLOCKED,"You cannot go that way."),t.addMessage(ct.MOVE_SUCCESS,"OK."),t.addMessage(ct.ROOM_DESCRIPTION,"{text}"),t.addMessage(ct.TAKE_CARD,"You carefully extract the gold card from its depression in the wall."),t.addMessage(ct.CANT_TAKE_CARD,"You are not close enough to reach the card."),t.addMessage(ct.PUSH_SUCCESS,"The sandstone wall slides into the space beyond."),t.addMessage(ct.PUSH_NO_WALL,"There is no wall there."),t.addMessage(ct.PUSH_IMMOVABLE,"The marble wall is unyielding."),t.addMessage(ct.PUSH_NO_ROOM,"There is no room for the wall to slide."),t.addMessage(Rx.ROOM_SHAKES,"There is a rumble from deep within the earth, and the room shakes."),t.addMessage(wl.SPIRITS_BLOCK,"Ghostly figures bar your way, their hollow eyes staring through you. They will not let you pass."),t.addMessage(wl.SPIRITS_VANISH,"The spirits shriek in terror and vanish in a blinding flash of light!"),t.addMessage(wl.PASSAGE_OPENS,"The way to the south is now clear."),t.addMessage(wl.BELL_ECHOES,"The bell echoes through the chamber."),t.addMessage(wl.RITUAL_PROGRESS,"You feel a strange energy building..."),t.addMessage(Qg.GHOST_APPEARS,`The fragrant smoke swirls around the basin. A spectral figure rises - the ghost of the thief! Dressed in adventurer's robes, he gestures toward the Gallery and speaks: "Well done, my friend. You are nearing the end game. Look to the Gallery for your reward." Then he fades away...`),t.addMessage(Qg.CANVAS_SPAWNS,"A magnificent rolled up canvas has appeared in the Gallery!"),t.addMessage(Qg.WRONG_ITEM,'The spirit laughs mockingly: "As we said, you have no rights here!" The item vanishes.'),t.addMessage(Qg.NOT_BLESSED,"Nothing happens. The basin remains still."),t.addMessage(yx.REALITY_ALTERED,"The death of the thief seems to alter reality in some subtle way..."),t.addMessage(Oo.BEAM_BROKEN,"The sword falls through the beam of light, breaking it. The beam flickers and dies."),t.addMessage(Oo.BEAM_ACTIVE,"A narrow red beam of light crosses the room at the north end."),t.addMessage(Oo.BUTTON_LASER_ACTIVE,"You push the button, but nothing happens."),t.addMessage(Oo.BUTTON_PRESSED,"There is a rumbling sound from the north."),t.addMessage(Oo.BUTTON_ALREADY_PRESSED,"The button has already been pushed."),t.addMessage(Oo.LOOK_BEAM_ACTIVE,"A narrow red beam of light crosses the room at the north end, inches above the floor."),t.addMessage(Oo.LOOK_BEAM_BROKEN,"The beam of light is no longer visible."),t.addMessage(he.POLE_RAISED,"You raise the short pole until it is almost touching the ceiling."),t.addMessage(he.POLE_LOWERED_CHANNEL,"The short pole slides smoothly into the stone channel and clicks into place."),t.addMessage(he.POLE_LOWERED_FLOOR,"The short pole falls to the floor with a clunk. It doesn't fit into the channel at this angle."),t.addMessage(he.POLE_ALREADY_RAISED,"The pole is already raised."),t.addMessage(he.POLE_ALREADY_LOWERED,"The pole is already lowered."),t.addMessage(he.POLE_CANT_LOWER,"You can't lower the pole right now."),t.addMessage(he.BOX_ROTATES,"The structure rotates with a grinding sound. The T-bar arrow now points {direction}."),t.addMessage(he.BOX_MOVES,"The structure slides along the groove with a rumbling sound."),t.addMessage(he.BOX_CANT_ROTATE,"The structure won't rotate. The pole is locking it in place."),t.addMessage(he.BOX_CANT_MOVE_UNLOCKED,"The structure wobbles but doesn't move. The pole must be lowered into the channel first."),t.addMessage(he.BOX_CANT_MOVE_ORIENTATION,"The structure is not aligned with the groove. It won't slide."),t.addMessage(he.BOX_AT_END,"The structure has reached the end of the groove."),t.addMessage(he.ENTER_MIRROR,"You step into the strange wooden structure."),t.addMessage(he.EXIT_MIRROR,"You climb out of the structure to the north."),t.addMessage(he.CANT_EXIT,"You can't exit that way. The structure is not properly positioned."),t.addMessage(he.NO_MIRROR_HERE,"There is no structure here to enter."),t.addMessage(he.TBAR_DIRECTION,"The arrow on the T-bar points {direction}."),t.addMessage(Ea.DARKNESS_DESCENDS,"The darkness seems to press in around you. You sense a presence watching from the shadows..."),t.addMessage(Ea.CLOAKED_FIGURE,'A cloaked figure appears from the shadows! "So, you have discovered the secret. Your quest is nearly at an end, but the final challenge awaits." The figure gestures, and reality dissolves around you...'),t.addMessage(Ea.TELEPORT,"When your vision clears, you find yourself in a completely different place."),t.addMessage(Ea.ENDGAME_BEGINS,"The endgame has begun. Your score is now 15 out of a possible 100."),t.addMessage(Vs.ENTER_TREASURY,"You have entered the Treasury of Zork!"),t.addMessage(Vs.VICTORY_TEXT,"Congratulations, brave adventurer! You have completed the greatest of all treasure hunts and discovered the legendary Treasury of Zork. The riches of the Great Underground Empire are yours!"),t.addMessage(Vs.FINAL_SCORE,`Your final score is {totalScore} points out of a possible 716 (616 main game + 100 endgame).
Endgame score: {endgameScore}/100
Main game score: {mainScore}/616`),t.addMessage(Vs.CONGRATULATIONS,`You have achieved the rank of MASTER ADVENTURER.

*** THE END ***`),t.addMessage(Rl.ATTACKS,"A large vampire bat swoops down from the ceiling and grabs you!"),t.addMessage(Rl.CARRIES_AWAY,"The bat carries you off into the darkness..."),t.addMessage(Rl.COWERS,"The vampire bat cowers away from you, repelled by the smell of garlic!"),t.addMessage(Rl.DROPPED,"The bat drops you unceremoniously."),t.addMessage(Ni.WALK_THROUGH,"You feel somewhat disoriented as you pass through..."),t.addMessage(Ni.NO_WALL,"I can't see any {direction} wall here."),t.addMessage(Ni.CANT_WALK_THROUGH,"You can't walk through that.")}function sB(t){t.addMessage("dungeo.window.opened","With great effort, you open the window far enough to allow entry."),t.addMessage("dungeo.rug.moved.reveal_trapdoor","Moving the rug reveals a trap door."),t.addMessage("dungeo.trapdoor.opened","The door reluctantly opens to reveal a rickety staircase descending into darkness."),t.addMessage(Sx.SLAMS_SHUT,"The door crashes shut, and you hear someone barring it."),t.addMessage("dungeo.treasure.scored","Your score just went up by {points} points!"),t.addMessage(Ng.ENTERED,"{message}"),t.addMessage(Ng.EXITED,"{message}"),t.addMessage(Ng.OUTPUT,"{output}"),t.addMessage(Ng.UNKNOWN_COMMAND,"{message}"),t.addMessage(af.GLACIER_MELTS,"The torch strikes the glacier and begins to melt into it! Steam billows from the ice as a massive section collapses, revealing a passage to the north."),t.addMessage(af.TORCH_CONSUMED,"The torch is consumed by the melting ice."),t.addMessage(af.PASSAGE_REVEALED,"A passage north has been revealed!"),t.addMessage(af.THROW_COLD,"The torch bounces off the glacier harmlessly. Perhaps if it were lit, it might have more effect."),t.addMessage(af.THROW_WRONG_ITEM,"The {item} bounces off the glacier and falls to the ground."),t.addMessage(Ix.PUNCTURED,"The sharp object you are carrying punctures the boat! The air rushes out and the boat deflates beneath you."),t.addMessage(Ix.STICK_POKES,"The {item} punctures the boat! With a loud hiss, the boat deflates."),t.addMessage(iQ.NO_BOAT,"The water is too cold and the current too strong to swim. You need a boat."),t.addMessage(aQ.DEATH,`You tumble over Aragain Falls, plunging hundreds of feet to your doom in the mist below.

    **** You have died ****`),t.addMessage(Te.MAT_PLACED,"You slide the mat under the door."),t.addMessage(Te.MAT_NOT_HELD,"You don't have a mat."),t.addMessage(Te.MAT_ALREADY_PLACED,"The mat is already under the door."),t.addMessage(Te.NO_DOOR_HERE,"There's no door here to put anything under."),t.addMessage(Te.KEY_PUSHED,"You insert the screwdriver in the keyhole and push. You hear a small clink as the key falls on the other side."),t.addMessage(Te.KEY_PUSHED_NO_MAT,"You insert the screwdriver in the keyhole and push. You hear a small clink as the key falls... and then nothing. Without something to catch it, the key has slid away under the door, out of reach."),t.addMessage(Te.KEY_ALREADY_PUSHED,"The keyhole is empty."),t.addMessage(Te.NO_SCREWDRIVER,"You don't have anything suitable to push the key out."),t.addMessage(Te.MAT_PULLED,"You pull the mat back from under the door."),t.addMessage(Te.MAT_PULLED_WITH_KEY,"You pull the mat back from under the door. A small brass key comes with it!"),t.addMessage(Te.MAT_NOT_UNDER_DOOR,"There's no mat under the door."),t.addMessage(Te.DOOR_LOCKED,"The door is locked, and there is no keyhole on this side."),t.addMessage(Te.DOOR_UNLOCKED,"The door is now unlocked."),t.addMessage(Te.WRONG_KEY,"That key doesn't fit this lock."),t.addMessage(Te.KEYHOLE_BLOCKED,"Something is blocking the keyhole from the other side."),t.addMessage(sf.PENALTY,"You have lost 10 points for dying."),t.addMessage(sf.GAME_OVER,`You have died too many times. The Great Underground Empire claims another victim.

    **** GAME OVER ****`),t.addMessage(sf.DEATH_COUNT,"Deaths: {deaths}")}function e8(t){Gx(t),iB(t),oB(t),aB(t),sB(t),TTe(t)}function TTe(t){t.addMessage("game.started.banner",`{title}

Story v{version} built on Sharpee v{engineVersion}
Web Client version: {clientVersion}

A port of Mainframe Zork (1981)
By {author}
Ported by David Cornelson

Type HELP for instructions, ABOUT for credits.`),t.addMessage("if.action.version",`{title}

Story v{version} built on Sharpee v{engineVersion}
Web Client version: {clientVersion}

A port of Mainframe Zork (1981)
By {author}
Ported by David Cornelson

Type HELP for instructions, ABOUT for credits.`)}function t8(t,e,r){t.registerParsedCommandTransformer((n,i)=>!Pg(i)||n.action!==Vr&&n.action!==oa?n:{...n,structure:{...n.structure,directObject:void 0,indirectObject:void 0}}),t.registerParsedCommandTransformer((n,i)=>n.action!==wt?n:{...n,structure:{...n.structure,directObject:void 0,indirectObject:void 0}}),t.registerParsedCommandTransformer(V3()),t.registerParsedCommandTransformer(K4()),t.registerParsedCommandTransformer(D4()),t.registerParsedCommandTransformer(l4()),t.registerParsedCommandTransformer(u4()),t.registerParsedCommandTransformer(rQ()),t.registerParsedCommandTransformer(yQ()),nQ(t,e),cQ(r.aragainFallsId),t.registerParsedCommandTransformer(sQ()),t.registerParsedCommandTransformer(vQ())}function r8(t,e,r){J6(t,e,r.forestIds,r.damIds,r.bankIds,r.balloonIds),kk(e,t);let n=[r.undergroundIds.cellar,r.undergroundIds.trollRoom,r.undergroundIds.eastWestPassage,r.roundRoomIds.roundRoom,r.undergroundIds.northSouthCrawlway,r.undergroundIds.gallery,r.undergroundIds.studio,r.templeIds.temple,r.endgameIds.narrowCorridor,r.damIds.damLobby,r.damIds.dam,r.mazeIds.maze1,r.mazeIds.maze5,r.mazeIds.maze11];M4(t,r.coalMineIds.squeakyRoom,n),k4(t,e,r.endgameIds.entryToHades,r.endgameIds.landOfDead),x4(t,r.roundRoomIds.roundRoom),gQ(t,r.houseInteriorIds.livingRoom,r.undergroundIds.cellar),Y3(t,r.royalPuzzleIds),B4(e),W4(t),U4(t,e,r.endgameIds.tomb,r.endgameIds.topOfStairs),z4(t,r.endgameIds.treasury),tB(t,r.undergroundIds.trollRoom),ES(t,r.damIds.maintenanceRoom)}function n8(t,e,r){let n=t.getScheduler();V4(t,e,r.endgameIds.smallRoom,r.endgameIds.stoneRoom,n||void 0),d2(t,e,r.endgameIds.hallway,r.endgameIds.insideMirror,r.endgameIds.dungeonEntrance,n||void 0)}function i8(t,e,r,n){i3(e,r,n.treasureRoomId,n.surfaceRoomIds),w6(e,r,n.cyclopsRoomId),NQ(e),M6(e,r,n.dungeonEntranceId),Gk(t)}var o8=S(b());function a8(t,e,r,n,i){let o=t.getEventProcessor();if(r.mirrorConfig){let a=EQ(r.mirrorConfig);o.registerHandler("if.event.touched",a)}n.initializeHandlers(o),_Te(o,e,r.bottomOfShaftId,n),o.registerHandler("if.event.player.died",mQ(e,i)),r.balloonIds&&ax(t,e,r.balloonIds.balloonId,r.balloonIds.receptacleId)}function _Te(t,e,r,n){t.registerHandler("if.event.actor_moved",i=>{let o=i.data;if(!o?.toRoomId||o.toRoomId!==r)return[];let a=e.getPlayer();if(!a||o.actorId!==a.id)return[];let s=e.getEntity(r);return s?(!o8.VisibilityBehavior.isDark(s,e)&&n.awardOnce("light-shaft",10,"LIGHT-SHAFT achievement"),[]):[]})}function s8(t,e,r,n,i){let o={aragainFallsId:r.frigidRiverIds.aragainFalls};t8(t,e,o);let a=t.getScheduler();if(a){let u={forestIds:r.forestIds,damIds:r.damIds,bankIds:r.bankIds,balloonIds:r.balloonIds,undergroundIds:r.undergroundIds,roundRoomIds:r.roundRoomIds,coalMineIds:r.coalMineIds,templeIds:r.templeIds,endgameIds:r.endgameIds,mazeIds:r.mazeIds,houseInteriorIds:r.houseInteriorIds,royalPuzzleIds:r.royalPuzzleIds};r8(a,e,u)}let s={endgameIds:{smallRoom:r.endgameIds.smallRoom,stoneRoom:r.endgameIds.stoneRoom,hallway:r.endgameIds.hallway,insideMirror:r.endgameIds.insideMirror,dungeonEntrance:r.endgameIds.dungeonEntrance}};n8(t,e,s);let c=t.getNpcService();if(c){let m={surfaceRoomIds:[...Object.values(r.whiteHouseIds),...Object.values(r.houseInteriorIds),...Object.values(r.forestIds)],treasureRoomId:r.mazeIds.treasureRoom,cyclopsRoomId:r.mazeIds.cyclopsRoom,dungeonEntranceId:r.endgameIds.dungeonEntrance};i8(t,c,e,m)}let l={mirrorConfig:r.mirrorConfig,bottomOfShaftId:r.coalMineIds.bottomOfShaft,balloonIds:r.balloonIds};a8(t,e,l,n,i)}var c8={id:"dungeon",title:"DUNGEON",author:"Tim Anderson, Marc Blank, Bruce Daniels, and Dave Lebling",version:qx.version,description:"A port of Mainframe Zork (1981)",custom:{portedBy:"David Cornelson"}},cB=class{constructor(){d(this,"config",c8);d(this,"world");d(this,"scoringService");d(this,"scoringProcessor");d(this,"whiteHouseIds",{});d(this,"houseInteriorIds",{});d(this,"forestIds",{});d(this,"undergroundIds",{});d(this,"damIds",{});d(this,"coalMineIds",{});d(this,"templeIds",{});d(this,"volcanoIds",{});d(this,"bankIds",{});d(this,"wellRoomIds",{});d(this,"frigidRiverIds",{});d(this,"mazeIds",{});d(this,"royalPuzzleIds",{});d(this,"endgameIds",{});d(this,"roundRoomIds",{});d(this,"balloonIds",null);d(this,"mirrorConfig",null)}initializeWorld(e){this.world=e,e.versionInfo=qx,e.storyConfig=c8,Qs.MetaCommandRegistry.register(ed),Qs.MetaCommandRegistry.register(oa),Qs.MetaCommandRegistry.register(Vr),Qs.MetaCommandRegistry.register(td),Qs.MetaCommandRegistry.register(rd),Qs.MetaCommandRegistry.register(Al),e.registerCapability(Se.StandardCapabilities.SCORING,{initialData:{scoreValue:0,maxScore:616,moves:0,deaths:0,achievements:[],scoredTreasures:[]}}),this.scoringService=new Cg(e),this.scoringProcessor=new Qs.ScoringEventProcessor(this.scoringService,e).enableDynamicTreasures("trophy case").setTreasureTakeCallback((n,i)=>{this.scoringService.scoreTreasureTake(n,i)}).setTreasurePlaceCallback((n,i)=>{this.scoringService.scoreTreasureCase(n,i)}),(0,Se.hasCapabilityBehavior)(Zr.type,"if.action.lowering")||(0,Se.registerCapabilityBehavior)(Zr.type,"if.action.lowering",Dx),(0,Se.hasCapabilityBehavior)(Zr.type,"if.action.raising")||(0,Se.registerCapabilityBehavior)(Zr.type,"if.action.raising",Px),(0,Se.hasCapabilityBehavior)(ui.type,"if.action.taking")||(0,Se.registerCapabilityBehavior)(ui.type,"if.action.taking",Lx),(0,Se.hasCapabilityBehavior)(ui.type,"if.scope.visible")||(0,Se.registerCapabilityBehavior)(ui.type,"if.scope.visible",Mx),(0,Se.hasCapabilityBehavior)(Ir.type,"if.action.taking")||(0,Se.registerCapabilityBehavior)(Ir.type,"if.action.taking",kx),(0,Se.hasCapabilityBehavior)(Ir.type,"if.action.attacking")||(0,Se.registerCapabilityBehavior)(Ir.type,"if.action.attacking",xx),(0,Se.hasCapabilityBehavior)(Ir.type,"if.action.talking")||(0,Se.registerCapabilityBehavior)(Ir.type,"if.action.talking",Bx),(0,Se.hasCapabilityBehavior)(Ao.type,"if.action.opening")||(0,Se.registerCapabilityBehavior)(Ao.type,"if.action.opening",jx),j4(e),this.whiteHouseIds=_Q(e),this.houseInteriorIds=IQ(e),this.forestIds=RQ(e),this.undergroundIds=DQ(e),this.damIds=MQ(e),this.coalMineIds=jQ(e),this.templeIds=HQ(e),this.volcanoIds=k2(e),this.bankIds=YQ(e),this.wellRoomIds=QQ(e),this.frigidRiverIds=a6(e),this.mazeIds=u6(e),this.royalPuzzleIds=g3(e),this.endgameIds=h6(e),this.roundRoomIds=JQ(e),this.houseInteriorIds,this.whiteHouseIds.behindHouse,wQ(e,this.forestIds,this.whiteHouseIds.northOfHouse,this.whiteHouseIds.behindHouse),this.undergroundIds,this.houseInteriorIds.livingRoom,PQ(e,this.undergroundIds,this.houseInteriorIds.kitchen),t6(e,this.roundRoomIds,this.undergroundIds.eastWestPassage),r6(e,this.roundRoomIds,{northSouthPassage:this.templeIds.northSouthPassage,grailRoom:this.templeIds.grailRoom,windingPassage:this.templeIds.windingPassage}),n6(e,this.roundRoomIds,this.wellRoomIds.engravingsCave),i6(e,this.roundRoomIds,this.damIds.deepCanyon),o6(e,this.roundRoomIds,this.mazeIds.maze1),UQ(e,this.templeIds,this.undergroundIds.chasm),qQ(e,this.templeIds,this.wellRoomIds.cave),FQ(e,this.templeIds,this.frigidRiverIds.rockyShore),x2(e,this.volcanoIds,this.undergroundIds.rockyCrawl),kQ(e,this.damIds,this.frigidRiverIds.frigidRiver1),xQ(e,this.damIds,this.volcanoIds.glacierRoom),zQ(e,this.bankIds,this.undergroundIds.cellar,this.undergroundIds.gallery,this.undergroundIds.northSouthCrawlway),e.setStateValue("dungeo.bank.roomIds",this.bankIds),s6(e,this.frigidRiverIds,this.damIds.damBase),c6(e,this.frigidRiverIds,this.forestIds.canyonBottom),d6(e,this.mazeIds,this.forestIds.clearing),m6(e,this.mazeIds,this.houseInteriorIds.livingRoom),f6(e,this.mazeIds,this.undergroundIds.trollRoom),p6(e,this.mazeIds,this.roundRoomIds.roundRoom),h3(e,this.royalPuzzleIds,this.mazeIds.treasureRoom),z3(e,this.royalPuzzleIds),XQ(e,this.wellRoomIds,this.endgameIds.entryToHades),bQ(e,this.whiteHouseIds,this.houseInteriorIds.kitchen),SQ(e,this.houseInteriorIds,this.undergroundIds.cellar),CQ(e,this.forestIds),LQ(e,this.undergroundIds),BQ(e,this.damIds),WQ(e,this.coalMineIds),GQ(e,this.templeIds),this.balloonIds=W2(e,this.volcanoIds),$Q(e,this.bankIds),ZQ(e,this.wellRoomIds),l6(e,this.frigidRiverIds),g6(e,this.mazeIds),e6(e,this.roundRoomIds),y6(e,{smallRoom:this.endgameIds.smallRoom,stoneRoom:this.endgameIds.stoneRoom,parapet:this.endgameIds.parapet,insideMirror:this.endgameIds.insideMirror,prisonCell:this.endgameIds.prisonCell}),this.initializeMirrorRoomHandler(e),X4(e,this.volcanoIds.glacierRoom,this.volcanoIds.volcanoView),lQ(e),tQ(e,{dam:this.damIds.dam,maintenanceRoom:this.damIds.maintenanceRoom,reservoirSouth:this.damIds.reservoirSouth,reservoir:this.damIds.reservoir,reservoirNorth:this.damIds.reservoirNorth}),this.scoringProcessor.registerRoomVisit(this.houseInteriorIds.kitchen,10),this.scoringProcessor.registerRoomVisit(this.undergroundIds.cellar,25),this.scoringProcessor.registerRoomVisit(this.volcanoIds.volcanoBottom,10),this.scoringProcessor.registerRoomVisit(this.mazeIds.treasureRoom,25),this.scoringProcessor.registerRoomVisit(this.endgameIds.narrowCorridor,5),this.scoringProcessor.registerRoomVisit(this.endgameIds.landOfDead,30),this.scoringProcessor.registerRoomVisit(this.wellRoomIds.topOfWell,10),this.scoringProcessor.registerRoomVisit(this.endgameIds.insideMirror,15),this.scoringProcessor.registerRoomVisit(this.endgameIds.tomb,5),this.scoringProcessor.registerRoomVisit(this.undergroundIds.torchRoom,10),this.scoringProcessor.registerRoomVisit(this.endgameIds.dungeonEntrance,20),this.scoringProcessor.registerRoomVisit(this.endgameIds.hallway,15),this.scoringProcessor.registerRoomVisit(this.endgameIds.treasury,35);let r=e.getPlayer();r&&e.moveEntity(r.id,this.whiteHouseIds.westOfHouse)}initializeMirrorRoomHandler(e){if(!e.getEntity(this.templeIds.mirrorRoom))return;let i=e.getContents(this.templeIds.mirrorRoom).find(o=>o.get("identity")?.aliases?.includes("mirror"));if(!i){console.warn("Mirror not found in Mirror Room");return}this.mirrorConfig={mirrorRoomId:this.templeIds.mirrorRoom,mirrorId:i.id,stateA:{north:this.templeIds.narrowCrawlway,west:this.templeIds.windingPassage,east:this.wellRoomIds.cave},stateB:{north:this.coalMineIds.steepCrawlway,west:this.coalMineIds.coldPassage,east:this.templeIds.smallCave}},TQ(e,this.mirrorConfig)}createPlayer(e){let r=e.getPlayer();if(r)return r.add(new Se.IdentityTrait({name:"yourself",description:"A brave adventurer, ready to explore the Great Underground Empire.",aliases:["self","myself","me","yourself","adventurer"],properName:!0,article:""})),r.has("actor")||r.add(new Se.ActorTrait({isPlayer:!0})),r.has("container")||r.add(new Se.ContainerTrait({capacity:{maxItems:15,maxWeight:100}})),r.has("combatant")||r.add(new Se.CombatantTrait({health:100,maxHealth:100,skill:50,baseDamage:1,armor:0,hostile:!1,canRetaliate:!1})),r;let n=e.createEntity("yourself",Se.EntityType.ACTOR);return n.add(new Se.IdentityTrait({name:"yourself",description:"A brave adventurer, ready to explore the Great Underground Empire.",aliases:["self","myself","me","yourself","adventurer"],properName:!0,article:""})),n.add(new Se.ActorTrait({isPlayer:!0})),n.add(new Se.ContainerTrait({capacity:{maxItems:15,maxWeight:100}})),n.add(new Se.CombatantTrait({health:100,maxHealth:100,skill:50,baseDamage:1,armor:0,hostile:!1,canRetaliate:!1})),n}extendParser(e){A6(e)}extendLanguage(e){e8(e)}getCustomActions(){return L4}initialize(){}isComplete(){return!1}onEngineReady(e){s8(e,this.world,{whiteHouseIds:this.whiteHouseIds,houseInteriorIds:this.houseInteriorIds,forestIds:this.forestIds,undergroundIds:this.undergroundIds,frigidRiverIds:this.frigidRiverIds,roundRoomIds:this.roundRoomIds,damIds:this.damIds,bankIds:this.bankIds,coalMineIds:this.coalMineIds,templeIds:this.templeIds,mazeIds:this.mazeIds,endgameIds:this.endgameIds,royalPuzzleIds:this.royalPuzzleIds,balloonIds:this.balloonIds||void 0,mirrorConfig:this.mirrorConfig||void 0},this.scoringProcessor,this.scoringService)}},gf=new cB;var lB=S(ri()),uB=new JS.WorldModel,p8=uB.createEntity("player",JS.EntityType.ACTOR);uB.setPlayer(p8.id);var dB=new m8.LanguageProvider,g8=new d8.Parser(dB);gf.extendParser&&gf.extendParser(g8);gf.extendLanguage&&gf.extendLanguage(dB);var bTe=new f8.PerceptionService,h8=new u8.GameEngine({world:uB,player:p8,parser:g8,language:dB,perceptionService:bTe});h8.setStory(gf);var y8=document.getElementById("root");if(!y8)throw new Error("Root element not found");var OTe=(0,l8.createRoot)(y8);OTe.render((0,lB.jsx)(UI,{engine:h8,children:(0,lB.jsx)(XI,{storyId:"dungeo"})}));})();
/*! Bundled license information:

react/cjs/react.production.min.js:
  (**
   * @license React
   * react.production.min.js
   *
   * Copyright (c) Facebook, Inc. and its affiliates.
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE file in the root directory of this source tree.
   *)

scheduler/cjs/scheduler.production.min.js:
  (**
   * @license React
   * scheduler.production.min.js
   *
   * Copyright (c) Facebook, Inc. and its affiliates.
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE file in the root directory of this source tree.
   *)

react-dom/cjs/react-dom.production.min.js:
  (**
   * @license React
   * react-dom.production.min.js
   *
   * Copyright (c) Facebook, Inc. and its affiliates.
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE file in the root directory of this source tree.
   *)

react/cjs/react-jsx-runtime.production.min.js:
  (**
   * @license React
   * react-jsx-runtime.production.min.js
   *
   * Copyright (c) Facebook, Inc. and its affiliates.
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE file in the root directory of this source tree.
   *)
*/
//# sourceMappingURL=dungeo.js.map
