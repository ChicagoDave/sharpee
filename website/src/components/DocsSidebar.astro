---
import { getCollection } from 'astro:content';

interface Props {
  currentSection: string;
}

const { currentSection } = Astro.props;
const currentPath = Astro.url.pathname;

// Get all docs and group by section
const allDocs = await getCollection('docs');

const sections = [
  {
    id: 'getting-started',
    label: 'Get Started',
    basePath: '/docs/getting-started',
  },
  {
    id: 'author-guide',
    label: 'Author Guide',
    basePath: '/docs/author-guide',
  },
  {
    id: 'developer-guide',
    label: 'Developer Guide',
    basePath: '/docs/developer-guide',
  },
];

// Group docs by section and sort by order
const docsBySection = sections.map((section) => ({
  ...section,
  docs: allDocs
    .filter((doc) => doc.data.section === section.id && !doc.data.draft)
    .sort((a, b) => a.data.order - b.data.order),
}));

function isActive(path: string): boolean {
  return currentPath === path || currentPath === path + '/';
}
---

<nav class="space-y-6">
  {docsBySection.map((section) => (
    <div>
      <h3 class="text-sm font-semibold text-slate-900 uppercase tracking-wide mb-2">
        {section.label}
      </h3>
      <ul class="space-y-1">
        {section.docs.length > 0 ? (
          section.docs.map((doc) => {
            const href = `/docs/${doc.data.section}/${doc.slug.split('/').pop()}`;
            return (
              <li>
                <a
                  href={href}
                  class:list={[
                    'block px-3 py-2 text-sm rounded-lg transition-colors',
                    isActive(href)
                      ? 'bg-emerald-100 text-emerald-700 font-medium'
                      : 'text-slate-600 hover:text-slate-900 hover:bg-slate-100',
                  ]}
                >
                  {doc.data.title}
                </a>
              </li>
            );
          })
        ) : (
          <li class="px-3 py-2 text-sm text-slate-400 italic">
            Coming soon
          </li>
        )}
      </ul>
    </div>
  ))}
</nav>
