title: Troll Recovery Daemon
story: dungeo
author: Sharpee Team
description: Tests that the troll wakes up after being knocked out, with description change (TROLLDESC -> TROLLOUT), exit blocking/unblocking, and recovery after 4 turns.

---

# From MDL source (act1.254): OUT!/IN! transitions
# Recovery time: 4 daemon ticks (MDL original was ~5; accounts for GDT turns consuming ticks)
# Note: GDT commands (KO, EX) each count as a game turn, consuming 2 of the 4 ticks

# Get lantern first (Troll Room is dark)
> GDT
[OK: contains "GDT"]

> TK brass lantern
[OK: contains "Taken"]

> EX
[OK: contains "Returning"]

> turn on lantern
[OK: contains "on"]

# Get to the Troll Room via GDT teleport
> GDT
[OK: contains "GDT"]

> AH Troll Room
[OK: contains "Teleported"]

> EX
[OK: contains "Returning"]

# Verify initial state - troll is present
> look
[OK: contains "Troll Room"]
[OK: contains "troll"]

# Examine troll - should show TROLLDESC (blocking northern passage)
> examine troll
[OK: contains "blocks"]
[OK: contains "northern passage"]

# Try to go north - blocked by troll
> north
[OK: contains "troll blocks"]

# Knock out the troll via GDT
> GDT
[OK: contains "GDT"]

> KO troll
[OK: contains "Knocked out"]
[OK: contains "isConscious: false"]

> EX
[OK: contains "Returning"]

# Description should change to TROLLOUT (troll is unconscious)
# Recovery daemon has ticked twice during GDT (KO + EX), so 2 ticks remain
> examine troll
[OK: contains "unconscious"]
[OK: contains "sprawled"]
[OK: contains "passages"]
[OK: contains "open"]

# North passage should now be open
> north
[OK: contains "East-West Passage"]

# Go back to troll room - daemon ticks consumed all 4 ticks by now
# Troll wakes up during the "north" turn (tick 4), player has already moved
> south
[OK: contains "Troll Room"]

# Troll should now be conscious again (woke up after 4 daemon ticks)
> examine troll
[OK: contains "blocks"]
[OK: contains "northern passage"]

# Exit should be blocked again
> north
[OK: contains "troll blocks"]
