title: Troll Combat
story: dungeo
author: Sharpee Team
description: Test killing the troll, sword glow, and smoke disappear

---

# Get equipment from Living Room
> north
[OK: contains "North of House"]

> east
[OK: contains "Behind House"]

> open window
[OK: contains "open"]

> west
[OK: contains "Kitchen"]

> west
[OK: contains "Living Room"]

# Get the lantern, sword, and turn on lantern
> take lantern
[OK: contains "Taken"]

> take sword
[OK: contains "Taken"]

> switch on lantern
[OK: contains "on"]

# Go to Troll Room
> push rug
[OK: contains "trap door"]

> open trapdoor
[OK: contains "open"]

> down
[OK: contains "Cellar"]

# Enter troll room - sword should glow
> east
[OK: contains "Troll Room"]
[OK: contains "troll"]
[OK: contains "sword"]
[OK: contains "glow"]

# Wait one turn - troll should attack us
> z
[EVENT: true, type="npc.attacked"]

# Use GDT to kill the troll directly (deterministic test)
# After death: troll and axe are removed from the game
> gdt
[OK: contains "GDT"]

> kl troll
[OK: contains "Killed"]
[OK: contains "Death handler triggered"]

# Troll and axe should be removed from the game
# (Room name "Troll Room" still contains "troll" - check for absence of "can see")
> look
[OK: contains "Troll Room"]
[OK: not contains "You can see"]
