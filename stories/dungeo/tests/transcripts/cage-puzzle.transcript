title: Cage/Sphere Puzzle (Dingy Closet)
story: dungeo
description: Tests the cage trap when taking sphere, robot raising cage, and taking sphere after solved

---

# Setup - get light and teleport directly to Dingy Closet
# (Avoid Low Room navigation since carousel randomizes exits)
> gdt
[OK: contains "GDT ready"]

> tk brass lantern
[OK: contains "Taken"]

# Teleport to Dingy Closet and move robot there
> ah Dingy Closet
[OK: contains "Teleported"]

> ao robot here
[OK: contains "Moved"]

> ex
[OK: contains "Returning to game"]

> turn on lantern
[OK: contains "on"]

# Verify robot, sphere, and cage are visible
> look
[OK: contains "Dingy Closet"]
[OK: contains "robot"]
[OK: contains "sphere"]
[OK: contains "cage"]

# ============================================================
# Test: Take sphere with robot present → cage trap
# ============================================================

> take sphere
[OK: contains "steel cage falls"]
[OK: contains "poisonous gas"]
[EVENT: true, type="if.event.take_blocked"]

# Try to leave - exits should be blocked
> north
[OK: contains "cage is too strong"]
[EVENT: true, type="if.event.went"]

# ============================================================
# Test: Tell robot to raise cage → puzzle solved
# ============================================================

> tell robot to raise cage
[OK: contains "cage shakes"]
[OK: contains "hurled across"]
[EVENT: true, type="game.message" messageId="dungeo.cage.raised"]

# ============================================================
# Test: Take sphere after cage raised → success
# ============================================================

> take sphere
[OK: contains "Taken"]
[EVENT: true, type="if.event.taken"]

> inventory
[OK: contains "sphere"]
