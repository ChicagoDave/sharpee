<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cloak of Darkness - Sharpee IF</title>
    <link rel="stylesheet" href="../src/style.css">
</head>
<body>
    <div id="game-container">
        <!-- Status line - fixed at top -->
        <div id="status-line">
            <span id="location-name">Foyer of the Opera House</span>
            <span id="score-turns">Score: 0 | Turns: 0</span>
        </div>
        
        <!-- Main text window - scrollable -->
        <div id="main-window">
            <div id="text-content">
                <h2>Cloak of Darkness</h2>
                <p>A simple demonstration story for Sharpee IF</p>
                <p>Loading...</p>
            </div>
        </div>
        
        <!-- Command line - fixed at bottom -->
        <div id="command-line">
            <span id="prompt">&gt;</span>
            <input type="text" id="command-input" autofocus disabled>
        </div>
    </div>
    
    <!-- Load the browser text service and demo runner -->
    <script type="module">
        import { BrowserTextService } from '../src/browser-text-service.js';
        
        // Initialize when ready
        window.addEventListener('DOMContentLoaded', async () => {
            const service = new BrowserTextService();
            
            // For now, create a mock engine interface
            window.sharpeeEngine = {
                handleMessage: (msg) => {
                    console.log('Command received:', msg.text);
                    
                    // Mock responses for testing
                    const responses = {
                        'look': [
                            {
                                type: 'room.description',
                                data: {
                                    name: 'Foyer of the Opera House',
                                    description: 'You are standing in a spacious hall, splendidly decorated in red and gold, with glittering chandeliers overhead. The entrance from the street is to the north, and there are doorways south and west.'
                                }
                            }
                        ],
                        'inventory': [
                            {
                                type: 'inventory.list',
                                data: {
                                    items: ['a velvet cloak']
                                }
                            }
                        ],
                        'examine cloak': [
                            {
                                type: 'object.description',
                                data: {
                                    description: 'A handsome cloak, of velvet trimmed with satin, and slightly splattered with raindrops. Its blackness is so deep that it almost seems to suck light from the room.'
                                }
                            }
                        ],
                        'west': [
                            {
                                type: 'room.description',
                                data: {
                                    name: 'Cloakroom',
                                    description: 'The walls of this small room were clearly once lined with hooks, though now only one remains. The exit is a door to the east.'
                                }
                            }
                        ],
                        'hang cloak on hook': [
                            {
                                type: 'action.success',
                                data: {
                                    message: 'You hang the velvet cloak on the small brass hook.'
                                }
                            },
                            {
                                type: 'game.score',
                                data: { score: 1 }
                            }
                        ]
                    };
                    
                    const response = responses[msg.text.toLowerCase()];
                    if (response) {
                        service.handleEngineMessage({
                            type: 'events',
                            events: response
                        });
                    } else {
                        service.handleEngineMessage({
                            type: 'events',
                            events: [{
                                type: 'text.output',
                                data: { text: "I don't understand that command." }
                            }]
                        });
                    }
                }
            };
            
            // Enable input
            document.getElementById('command-input').disabled = false;
            
            // Clear loading message and show intro
            document.getElementById('text-content').innerHTML = `
                <h2>Cloak of Darkness</h2>
                <p>A simple demonstration story</p>
                <p>Hurrying through the rainswept November night, you're glad to see the bright lights of the Opera House. It's surprising that there aren't more people about but, hey, what do you expect in a cheap demo game...?</p>
                <p></p>
            `;
            
            // Show initial room description
            window.sharpeeEngine.handleMessage({ text: 'look' });
        });
    </script>
</body>
</html>