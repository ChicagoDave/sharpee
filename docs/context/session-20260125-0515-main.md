# Session Summary: 2026-01-25 - main

## Status: Completed

## Goals
- Add buildDate to Story object in platform
- Use buildDate in banner display
- Remove timestamp suffix from version strings

## Completed

### Added buildDate to StoryConfig

Added `buildDate?: string` field to `StoryConfig` in `packages/engine/src/story.ts`:
- ISO 8601 format (e.g., "2026-01-25T05:16:47Z")
- Auto-generated by build.sh
- Used in banner display

### Updated Version Validation

Changed version regex from `/^\d+\.\d+\.\d+$/` to `/^\d+\.\d+\.\d+(-[a-zA-Z0-9.-]+)?$/`:
- Now allows prerelease tags like `-beta`, `-alpha.1`
- Supports semantic versioning with optional prerelease identifiers

### Updated Event Data Structures

Added `buildDate` to `GameEventStoryData` interface in:
- `packages/core/src/events/game-events.ts`
- `packages/core/src/events/game-events.d.ts`

Updated `packages/engine/src/game-engine.ts` to pass `buildDate` when creating game.started event.

### Updated Text Service Handler

Modified `packages/text-service/src/handlers/game.ts`:
- Added `buildDate` to template params
- Formatted as date-only (YYYY-MM-DD) for display

### Simplified Version Format in build.sh

Changed version generation logic:
- **Before**: `1.0.64-beta.20260125.0258` (timestamp embedded in version)
- **After**: `1.0.64-beta` (clean semantic version)

Build date remains as separate `BUILD_DATE` constant in version.ts.

### Updated Dungeo Story

**stories/dungeo/src/index.ts**:
- Added `buildDate: VERSION_INFO.buildDate` to config

**stories/dungeo/src/messages/index.ts**:
- Updated banner template to use `{buildDate}`
- Simplified format, removed redundant "Web Client version" line

## Banner Output

**Before:**
```
DUNGEON

Story v1.0.64-beta.20260125.0258 built on Sharpee v0.9.60-beta.20260125.0258
Web Client version: N/A

A port of Mainframe Zork (1981)
By Tim Anderson, Marc Blank, Bruce Daniels, and Dave Lebling
Ported by David Cornelson
```

**After:**
```
DUNGEON

Story v1.0.64-beta (built 2026-01-25)
Sharpee v0.9.60-beta

A port of Mainframe Zork (1981)
By Tim Anderson, Marc Blank, Bruce Daniels, and Dave Lebling
Ported by David Cornelson
```

## Files Modified

**Platform (packages/)**:
- `packages/engine/src/story.ts` - Added buildDate to StoryConfig, updated version regex
- `packages/core/src/events/game-events.ts` - Added buildDate to GameEventStoryData
- `packages/core/src/events/game-events.d.ts` - Same (declaration file)
- `packages/engine/src/game-engine.ts` - Pass buildDate in game.started event
- `packages/text-service/src/handlers/game.ts` - Added buildDate to template params

**Build System**:
- `build.sh` - Simplified version format, removed timestamp suffix

**Story (stories/dungeo/)**:
- `stories/dungeo/src/index.ts` - Added buildDate to config
- `stories/dungeo/src/messages/index.ts` - Updated banner template
- `stories/dungeo/src/version.ts` - Auto-regenerated with new format

## Testing

- Build completed successfully
- Banner displays correctly with new format
- Version validation accepts prerelease tags

---

**Session completed**: 2026-01-25 05:20
