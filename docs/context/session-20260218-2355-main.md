# Session Summary: 20260218-2355 - main

## Status: Complete

## Goals
- Implement ADR-132 (Player Character Switching)

## Completed

### ADR-132: Player Character Switching
Added `switchPlayer(entityId)` public API to `GameEngine` so stories can switch the active player character mid-game. Also fixed an existing bug where `loadSaveData()` and `undo()` did not re-sync `context.player` after restoring world state.

**Core events (`packages/core/src/events/game-events.ts`):**
- Added `GameEventType.PC_SWITCHED` (`'game.pc_switched'`)
- Added `GameLifecyclePcSwitchedData` interface
- Added `createPcSwitchedEvent()` factory function

**Event registry (`packages/core/src/events/event-registry.ts`):**
- Added `'game.pc_switched': PcSwitchedData` to typed `EventDataRegistry`

**Engine (`packages/engine/src/game-engine.ts`):**
- Added `switchPlayer(entityId)` public method — validates entity exists, has ActorTrait, isPlayable; clears old PC's isPlayer, sets new PC's isPlayer; updates WorldModel + GameContext; emits `game.pc_switched` event
- Added `syncPlayerState(newPlayerId)` private helper — syncs context.player, parser world context, pronoun context, scope vocabulary, and narrative settings
- Fixed `loadSaveData()` — replaced separate pronoun reset + vocabulary update with `syncPlayerState()`, fixing missing `context.player` re-sync after restore
- Fixed `undo()` — replaced `updateScopeVocabulary()` with `syncPlayerState()`, same fix pattern

**ADR status:**
- `docs/architecture/adrs/adr-132-pc-switching.md` — Status: Proposed → Accepted

## Verification
- Full build: `./build.sh -s dungeo` — all packages compiled successfully
- Walkthrough tests: 811/811 passed across 17 transcripts (1.3s)

## Files Modified
- `packages/core/src/events/game-events.ts`
- `packages/core/src/events/event-registry.ts`
- `packages/engine/src/game-engine.ts`
- `docs/architecture/adrs/adr-132-pc-switching.md`

## Notes
- Session started: 2026-02-18 23:55 CST
- No changes needed to WorldModel, ActorTrait, parser, or save-restore service
- The `syncPlayerState()` helper is reused by switchPlayer, loadSaveData, and undo — single source of truth for player re-sync
