# Work Summary: ADR-085 & ADR-086 Platform Fixes

**Date**: 2026-01-04 04:30
**Branch**: `dungeo` (merged from `scoring` and `events-issues`)
**Duration**: ~3 hours

## Completed Work

### ADR-085: Event-Based Scoring System
- Added `SCORE_GAINED`/`SCORE_LOST` events to if-domain
- Updated `ScoringService` with `ScoringDefinition` interface
- New methods: `hasScored()`, `scorePoints()`, `losePoints()`, `getRankMessageId()`
- Trophy case handler migrated to EventProcessor
- DungeoScoringService updated with new config format
- PR #43 merged to main

### ADR-086: Event Handler Unification
- **Fixed critical bug**: `world.registerEventHandler()` handlers were never called
- Added `IEventProcessorWiring` interface to if-domain
- `WorldModel.connectEventProcessor()` wires handlers to EventProcessor
- `registerEventHandler()` auto-wires new handlers if already connected
- Engine calls `connectEventProcessor()` during initialization
- PR #44 merged to main

## Impact

**All 16 handlers using `world.registerEventHandler()` now work**:

| File | Handlers | Status |
|------|----------|--------|
| lantern-fuse.ts | switched_on/off | ✅ Fixed |
| candle-fuse.ts | switched_on/off | ✅ Fixed |
| exorcism-handler.ts | message, read, switched_on | ✅ Fixed |
| glacier-handler.ts | thrown | ✅ Fixed |
| ghost-ritual-handler.ts | dropped | ✅ Fixed |
| endgame-laser-handler.ts | dropped, pushed | ✅ Fixed |
| dam-fuse.ts | custom events | ✅ Fixed |
| reality-altered-handler.ts | score_displayed | ✅ Fixed |
| balloon-handler.ts | put_in, taken | ✅ Fixed |
| index.ts (trophy case) | put_in | ✅ Fixed |

## Test Results

```
Total: 675 tests in 39 transcripts
670 passed, 5 expected failures
Duration: 340ms
✓ All tests passed!
```

## Files Changed (Platform)

```
packages/if-domain/src/events.ts
packages/world-model/src/world/WorldModel.ts
packages/engine/src/game-engine.ts
packages/stdlib/src/services/scoring/scoring-service.ts
packages/lang-en-us/src/actions/scoring.ts
```

## Obsolete Docs

`docs/work/dungeo/event-handler-migration-plan.md` - No longer needed since handlers work without migration.

## Current State

- Branch: `dungeo`
- Main merged with ADR-085 + ADR-086
- All platform scoring and event handler issues resolved
- Ready to continue dungeo implementation
