# Work Summary: ADR-085 Scoring System - Complete

**Date**: 2026-01-04 03:00
**Branch**: `scoring`
**Status**: Ready for merge

## What Was Done

### ADR-085 Implementation (Complete)

**Phase 1 - Core Infrastructure:**
- Added `SCORE_GAINED` and `SCORE_LOST` events to if-domain
- Updated `ScoringService` with new interfaces:
  - `ScoringDefinition` (points, reasonMessageId, category)
  - `ScoringServiceConfig` (maxScore, enabled, ranks, definitions)
  - `RankDefinition` with `messageId` for i18n
- New methods: `hasScored()`, `scorePoints()`, `losePoints()`, `getRankMessageId()`, `setMaxScore()`

**Phase 2 - Language Layer:**
- Added `'no_scoring'` message for disabled scoring
- Added `scoringSystemMessages` export

**Phase 3 - Dungeo Migration:**
- Trophy case handler migrated to EventProcessor
- DungeoScoringService updated with new config format
- Balloon handler migrated to EventProcessor (discovered during work)

### Bug Discovery

`world.registerEventHandler()` handlers are **never called**. The engine uses `EventProcessor.processEvents()` which calls `storyHandlers`, not the `eventHandlers` Map in WorldModel.

**Fix pattern**: Use `engine.getEventProcessor().registerHandler()` in `onEngineReady()`.

### Migration Plan Created

14 remaining handlers in 8 files documented in `event-handler-migration-plan.md`:
- lantern-fuse.ts (2 handlers)
- candle-fuse.ts (2 handlers)
- exorcism-handler.ts (3 handlers)
- glacier-handler.ts (1 handler)
- ghost-ritual-handler.ts (1 handler)
- endgame-laser-handler.ts (2 handlers)
- dam-fuse.ts (2 handlers)
- reality-altered-handler.ts (1 handler)

These will be migrated as part of ongoing dungeo work, not this PR.

## Test Results

```
Total: 675 tests in 39 transcripts
670 passed, 5 expected failures
Duration: 319ms
âœ“ All tests passed!
```

## Files Changed

```
packages/if-domain/src/events.ts
packages/lang-en-us/src/actions/scoring.ts
packages/stdlib/src/actions/standard/scoring/scoring.ts
packages/stdlib/src/services/index.ts
packages/stdlib/src/services/scoring/index.ts
packages/stdlib/src/services/scoring/scoring-service.ts
stories/dungeo/src/handlers/balloon-handler.ts
stories/dungeo/src/index.ts
stories/dungeo/src/scoring/dungeo-scoring-service.ts
docs/architecture/adrs/adr-085-scoring-system.md
docs/work/dungeo/context/2026-01-04-0200-adr-085-implementation.md
docs/work/dungeo/event-handler-migration-plan.md
```

## Follow-up Work

1. Migrate 14 remaining handlers (dungeo work, not platform)
2. Consider removing broken `world.registerEventHandler()` API (platform ADR)
