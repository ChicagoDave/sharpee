# Work Summary: ADR-082 Typed Event System - Complete

**Date:** 2026-01-01 06:00
**Branch:** `beta-release`

## Overview

Implemented ADR-082 in 4 phases to add type safety to the event system.

## Phase 1: Core Infrastructure

Created typed event system in `packages/core/src/events/`:

| File | Exports |
|------|---------|
| `event-registry.ts` | `EventDataRegistry` interface (25+ event data types) |
| `typed-event.ts` | `TypedSemanticEvent<T>`, `KnownSemanticEvent` |
| `event-factory.ts` | `createTypedEvent()`, `createMessageEvent()`, `createEmptyEvent()` |
| `event-helpers.ts` | `isEventType()`, `getEventData()`, `getEventDataWithDefaults()`, `getUntypedEventData()` |

## Phase 2: Stdlib Event Types

Created `packages/stdlib/src/events/event-registry.ts` using declaration merging:

```typescript
declare module '@sharpee/core' {
  interface EventDataRegistry {
    'if.event.taken': TakenEventData;
    'if.event.dropped': DroppedEventData;
    // ... 25+ IF action event types
  }
}
```

Event categories: Taking/Dropping, Looking/Examining, Movement, Opening/Closing, Containers, Locking, Wearing, Entering/Exiting, Switching, Meta, Generic.

## Phase 3: Migration

Replaced `event.data as any` with typed helpers in production code:

| Package | Pattern Used |
|---------|--------------|
| text-services | `getUntypedEventData()`, `getEventDataWithDefaults()` |
| event-processor | `getUntypedEventData()` with type guards |
| engine | Object spread with type checks |

17 casts migrated. ~40 remain in test files (acceptable).

## Phase 4: Documentation

Updated ADR-082:
- Status: Proposed â†’ Accepted
- Added Implementation Notes section
- Documented all 4 phases

## Commits

1. `da08569` - feat(core): Add typed event system (ADR-082 Phase 1)
2. `6d8b66f` - feat(stdlib): Add IF event types to EventDataRegistry (ADR-082 Phase 2)
3. `6231265` - refactor: Migrate event.data access to typed helpers (ADR-082 Phase 3)
4. (pending) - docs: Update ADR-082 to Accepted status (ADR-082 Phase 4)

## Usage Examples

```typescript
// Type-safe event creation
const event = createTypedEvent('query.invalid', {
  message: 'Invalid input',
  hint: 'Try again'
});

// Type guards narrow the type
if (isEventType(event, 'quit.confirmed')) {
  console.log(event.data.finalScore);  // TypeScript knows this exists
}

// Safe data extraction with defaults
const { message, hint } = getEventDataWithDefaults(event, 'query.invalid', {
  message: 'Invalid response.',
  hint: undefined
});

// For untyped/dynamic events
const data = getUntypedEventData(event);
```

## Build Status

All packages build successfully.
